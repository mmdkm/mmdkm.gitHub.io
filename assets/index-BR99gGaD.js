var Bs=Object.defineProperty;var Fs=(e,r,o)=>r in e?Bs(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o;var se=(e,r,o)=>Fs(e,typeof r!="symbol"?r+"":r,o);import{u as useSelector,a as useDispatch,r as reactExports,d as distExports,b as defaultsDeep,c as createSlice,D,C as Color,p as partition,e as createSelector,f as del,g as update,s as setMany,h as entries,i as styled,j as jsxRuntimeExports,k as useCombobox,R as React,S as StateManagedSelect,l as useTranslation,m as distExports$1,F as FontAwesomeIcon,n as faLightbulb,o as faHeadphones,q as faDisplay,t as faGear,v as lodashExports,w as createListenerMiddleware,x as captureException,y as configureStore,z as createReduxEnhancer,A as faBook,B as faSquare,E as faCircle,G as faUndo,H as faSave,I as faTrash,J as faCompress,K as faExpand,L as faMagicWandSparkles,M as faStopwatch,N as faXmarkCircle,O as ReactTextareaAutocomplete,P as faClapperboard,Q as faCode,T as faFloppyDisk,U as stringify,_ as __vitePreload,V as shallowEqual,W as faCopy,X as faAdd,Y as faMinus,Z as faRotateLeft,$ as faImage,a0 as faVideo,a1 as faStop,a2 as faPlay,a3 as faFileImport,a4 as faDownload,a5 as faShare,a6 as SketchPicker,a7 as faPlus,a8 as Draggable,a9 as faChevronLeft,aa as faTrashCan,ab as t,ac as faWarning,ad as keyframes,ae as faMicrochip,af as faAngleDown,ag as faUpload,ah as faXmark,ai as faToolbox,aj as useProgress,ak as faCircleQuestion,al as faComputer,am as useLocation,an as Link$1,ao as faCancel,ap as faKeyboard,aq as faStethoscope,ar as faBrush,as as faBug,at as faSatelliteDish,au as faDiscord,av as faGithub,aw as faLanguage,ax as useResizeObserver,ay as useThree,az as J,aA as useFrame,aB as PerspectiveCamera,aC as Shape,aD as E,aE as Html,aF as useGLTF,aG as Segments,aH as Segment,aI as PresentationControls,aJ as BufferAttribute,aK as Object3D,aL as SpotLight,aM as mt,aN as Canvas,aO as OrbitControls,aP as faUnlock,aQ as faSpinner,aR as createGlobalStyle,aS as Route,aT as ErrorBoundary,aU as Router,aV as useLocationProperty,aW as navigate,aX as Provider,aY as instance,aZ as Browser$1,a_ as initReactI18next,a$ as resourcesToBackend,b0 as clientExports}from"./vendor-Cg-ir5zG.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(a){if(a.ep)return;a.ep=!0;const d=o(a);fetch(a.href,d)}})();const __variableDynamicImportRuntimeHelper=(e,r,o)=>{const i=e[r];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((a,d)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(d.bind(null,new Error("Unknown variable dynamic import: "+r+(r.split("/").length!==o?". Note that variables only represent file names one level deep.":""))))})};var TestKeyState=(e=>(e[e.Initial=0]="Initial",e[e.KeyDown=1]="KeyDown",e[e.KeyUp=2]="KeyUp",e))(TestKeyState||{}),DKSPoint=(e=>(e[e.Hold=0]="Hold",e[e.Down=1]="Down",e[e.Up=2]="Up",e[e.Single=3]="Single",e))(DKSPoint||{});let globalAudioContext,globalAmp,globalAmpGain=1;const ampGain=.25,ampAttack=.05,ampDecay=.05,ampSustain=1,ampRelease=.05;function getAudioContext(){return globalAudioContext===void 0&&(globalAudioContext=new AudioContext),globalAudioContext}function getGlobalAmp(){if(globalAmp===void 0){const e=getAudioContext();globalAmp=e.createGain(),globalAmp.gain.value=globalAmpGain,globalAmp.connect(e.destination)}return globalAmp}function setGlobalAmpGain(e){globalAmpGain=e,globalAmp!==void 0&&(globalAmp.gain.setValueAtTime(globalAmp.gain.value,getAudioContext().currentTime),globalAmp.gain.linearRampToValueAtTime(globalAmpGain,getAudioContext().currentTime+.2))}function midiNoteToFrequency(e){return Math.pow(2,(e-69)/12)*440}class Note{constructor(r,o){se(this,"audioContext");se(this,"osc");se(this,"amp");se(this,"ampSustainTime");se(this,"midiNote");this.midiNote=r,this.audioContext=getAudioContext(),this.osc=new OscillatorNode(this.audioContext,{type:o,frequency:midiNoteToFrequency(this.midiNote)}),this.ampSustainTime=0,this.amp=this.audioContext.createGain(),this.amp.gain.value=0,this.amp.connect(getGlobalAmp()),this.osc.connect(this.amp)}noteOn(){const r=this.audioContext.currentTime;this.osc.start(r),this.ampSustainTime=r+ampAttack+ampDecay,this.amp.gain.linearRampToValueAtTime(ampGain,r+ampAttack),this.amp.gain.linearRampToValueAtTime(ampGain*ampSustain,this.ampSustainTime)}noteOff(){this.audioContext.currentTime>=this.ampSustainTime&&this.amp.gain.setValueAtTime(ampGain*ampSustain,this.audioContext.currentTime);const r=Math.max(this.audioContext.currentTime,this.ampSustainTime)+ampRelease;this.osc.stop(r),this.amp.gain.linearRampToValueAtTime(0,r)}}const useAppSelector=useSelector,useAppDispatch=useDispatch;var TestKeyboardSoundsMode=(e=>(e[e.Random=0]="Random",e[e.WickiHayden=1]="WickiHayden",e[e.Chromatic=2]="Chromatic",e))(TestKeyboardSoundsMode||{});let lastPressedKeys=[],notes={};const baseSeed=Math.floor(Math.random()*1e3),seededRandom=e=>((baseSeed+e)*9301+49297)%233280/233280,calculateMidiNote=(e,r,o,i,a)=>{const d=Math.min(4,o-i-1)+Math.max(0,5-o);switch(e){case 1:return[-18,-19,-14,-9,-4][d]+72+r+a*2;case 2:return[-15,-12,-7,-1,4][d]+72+r+a;case 0:default:return 72+r+Math.floor(seededRandom(i*1e3+a)*24)-12}},turnOffAllTheNotes=()=>{Object.values(notes).forEach(e=>e==null?void 0:e.noteOff())},TestKeyboardSounds=({pressedKeys:e})=>{const{waveform:r,volume:o,mode:i,transpose:a}=useAppSelector(getTestKeyboardSoundsSettings);return reactExports.useEffect(()=>{setGlobalAmpGain(o/100)},[o]),reactExports.useEffect(()=>{if(e.length===0)turnOffAllTheNotes();else{const d=e.length;lastPressedKeys=e.reduce((l,p,m)=>[...l,p.reduce((_,C,y)=>{var j,w;const b=`${m},${y}`,K=((j=lastPressedKeys==null?void 0:lastPressedKeys.at(m))==null?void 0:j.at(y))??TestKeyState.KeyUp,v=C??TestKeyState.KeyUp;if(v!=K)if(v==TestKeyState.KeyDown){const L=calculateMidiNote(i,a,d,m,y);notes[b]=new Note(L,r),notes[b].noteOn()}else v==TestKeyState.KeyUp&&((w=notes[b])==null||w.noteOff());return[..._,C]},[])],[])}},[e]),reactExports.useEffect(()=>()=>{turnOffAllTheNotes()},[]),null},THEMES={OLIVIA_DARK:{alpha:{c:"#363434",t:"#E8C4B8"},mod:{c:"#363434",t:"#E8C4B8"},accent:{c:"#E8C4B8",t:"#363434"}},OLIVE:{alpha:{t:"#66665A",c:"#D9D7C4"},mod:{c:"#66665A",t:"#9DA183"},accent:{c:"#9DA183",t:"#66665A"}},OLIVE_DARK:{alpha:{c:"#66665A",t:"#9DA183"},mod:{c:"#66665A",t:"#9DA183"},accent:{c:"#9DA183",t:"#66665A"}},OLNY:{alpha:{c:"#c20018",t:"#cfa174"},mod:{c:"#c20018",t:"#cfa174"},accent:{t:"#c20018",c:"#cfa174"}},GREG:{alpha:{c:"#f8c200",t:"#393b3b"},mod:{c:"#f7f2ea",t:"#393b3b"},accent:{c:"#171718",t:"#393b3b"}},CARBON_BLACK_A:{alpha:{c:"#788194",t:"#f3f3f3"},mod:{c:"#3b3b3e",t:"#f3f3f3"},accent:{c:"#e66b67",t:"#f3f3f3"}},CARBON_BLACK_B:{alpha:{c:"#3b3b3e",t:"#f3f3f3"},mod:{c:"#788194",t:"#f3f3f3"},accent:{c:"#e66b67",t:"#f3f3f3"}},SILVER_GREY_A:{alpha:{c:"#b2b3b8",t:"#f3f3f3"},mod:{c:"#838589",t:"#f3f3f3"},accent:{c:"#e8db5d",t:"#3d3125"}},SILVER_GREY_B:{alpha:{c:"#838589",t:"#f3f3f3"},mod:{c:"#b2b3b8",t:"#f3f3f3"},accent:{c:"#e8db5d",t:"#3d3125"}},NAVY_BLUE_A:{alpha:{c:"#547be8",t:"#f3f3f3"},mod:{c:"#49599f",t:"#f3f3f3"},accent:{c:"#4dcfe0",t:"#f3f3f3"}},NAVY_BLUE_B:{alpha:{c:"#49599f",t:"#f3f3f3"},mod:{c:"#547be8",t:"#f3f3f3"},accent:{c:"#4dcfe0",t:"#f3f3f3"}},FENDAI:{alpha:{c:"#f0ebec",t:"#07010f"},mod:{c:"#f0ebec",t:"#56395c"},accent:{c:"#fc5d75",t:"#56395c"}},HONEY_MILK:{alpha:{c:"#fffff8",t:"#07010f"},mod:{c:"#fffff8",t:"#07010f"},accent:{c:"#f8b140",t:"#07010f"}},MATCHA:{alpha:{c:"#e8e8df",t:"#4e475c"},mod:{c:"#828572",t:"#4e475c"},accent:{c:"#828572",t:"#4e475c"}},BLACK_GREY:{alpha:{c:"#7e8293",t:"#a5cbe6"},mod:{c:"#364352",t:"#eff3f2"},accent:{c:"#364352",t:"#eff3f2"}},WHITE_GREEN:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#275c65",t:"#d0eae8"},accent:{c:"#275c65",t:"#d0eae8"}},WHITE:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#fefefe",t:"#272727"},accent:{c:"#fefefe",t:"#272727"}},BLACK:{alpha:{c:"#272727",t:"#fefefe"},mod:{c:"#272727",t:"#fefefe"},accent:{c:"#272727",t:"#fefefe"}},BLACK_AND_WHITE:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#272727",t:"#fefefe"},accent:{c:"#272727",t:"#fefefe"}},CLASSIC_GREY:{alpha:{c:"#fcfcfc",t:"#1a1a1a"},mod:{c:"#a0a0a0",t:"#1a1a1a"},accent:{c:"#a0a0a0",t:"#1a1a1a"}},...distExports.THEMES};class Store{constructor(r){se(this,"store");const o=localStorage.getItem("via-app-store");this.store=o?defaultsDeep(JSON.parse(o),r):r}get(r){return this.store[r]}set(r,o){const i={...this.store,[r]:{...o}};this.store=i,setTimeout(()=>{localStorage.setItem("via-app-store",JSON.stringify(i))},0)}}const entryLog=[],logCommand=(e,r,o)=>{entryLog.push({kbAddr:e,request:r,response:o,ts:Date.now()})},getLog=window.__getLogs=()=>entryLog;window.addEventListener("message",e=>{e.data.command==="fetchLogs"&&window.postMessage({command:"getLogs",payload:getLog()},"*")});const useRetry=(e,r)=>async()=>{let i=0;for(;i<=r.retries;)try{await e();break}catch(a){if(i===r.retries)throw console.debug("Retry limit exceeded",i),a;i++,console.debug(a,"retry",i,"after",r.delay),await new Promise(d=>setTimeout(d,r.delay))}},globalBuffer={},eventWaitBuffer={},filterHIDDevices=e=>e.filter(r=>{var o;return(o=r.collections)==null?void 0:o.some(i=>i.usage===97&&i.usagePage===65376)}),getVIAPathIdentifier=()=>self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||`via-path:${Math.random()}`,tagDevice=e=>{const r=e.__path||getVIAPathIdentifier();e.__path=r;const o={_device:e,usage:97,usagePage:65376,interface:1,vendorId:e.vendorId??-1,productId:e.productId??-1,path:r,productName:e.productName};return ExtendedHID._cache[r]=o},tryForgetDevice=e=>{const r=ExtendedHID._cache[e.path];if(r)return r._device.forget()},ExtendedHID={_cache:{},requestDevice:async()=>{const e=await navigator.hid.requestDevice({filters:[{usagePage:65376,usage:97}]});return e.forEach(tagDevice),e[0]},getFilteredDevices:async()=>{try{return filterHIDDevices(await navigator.hid.getDevices())}catch{return[]}},devices:async(e=!1)=>{let r=await ExtendedHID.getFilteredDevices();if(r.length===0||e){try{await ExtendedHID.requestDevice()}catch{return[]}r=await ExtendedHID.getFilteredDevices()}return r.map(tagDevice)},HID:class{constructor(r){se(this,"_hidDevice");se(this,"interface",-1);se(this,"vendorId",-1);se(this,"productId",-1);se(this,"productName","");se(this,"path","");se(this,"openPromise",Promise.resolve());se(this,"readP",promisify(r=>this.read(r)));if(this._hidDevice=ExtendedHID._cache[r],this._hidDevice)this.vendorId=this._hidDevice.vendorId,this.productId=this._hidDevice.productId,this.path=this._hidDevice.path,this.interface=this._hidDevice.interface,this.productName=this._hidDevice.productName,globalBuffer[this.path]=globalBuffer[this.path]||[],eventWaitBuffer[this.path]=eventWaitBuffer[this.path]||[],this._hidDevice._device.opened||this.open();else throw new Error("Missing hid device in cache")}async open(){return this._hidDevice&&!this._hidDevice._device.opened&&(this.openPromise=this._hidDevice._device.open(),this.setupListeners(),await this.openPromise),Promise.resolve()}setupListeners(){this._hidDevice&&this._hidDevice._device.addEventListener("inputreport",r=>{eventWaitBuffer[this.path].length!==0?eventWaitBuffer[this.path].shift()(new Uint8Array(r.data.buffer)):globalBuffer[this.path].push({currTime:Date.now(),message:new Uint8Array(r.data.buffer)})})}read(r){var o;this.fastForwardGlobalBuffer(Date.now()),globalBuffer[this.path].length>0?r(void 0,(o=globalBuffer[this.path].shift())==null?void 0:o.message):eventWaitBuffer[this.path].push(i=>r(void 0,i))}fastForwardGlobalBuffer(r){let o=globalBuffer[this.path].length;for(;o&&(o--,globalBuffer[this.path][0].currTime<r);)globalBuffer[this.path].shift()}async write(r){var i;await this.openPromise;const o=new Uint8Array(r.slice(1));(i=this._hidDevice)==null||i._device.sendReport(0,o)}async send(r){await this.openPromise;const o=new Uint8Array(r.slice(1)),i=Date.now();return await useRetry(async()=>{var l;await((l=this._hidDevice)==null?void 0:l._device.sendReport(0,o))},{retries:3,delay:0})(),new Promise(l=>{var p;this.fastForwardGlobalBuffer(i),globalBuffer[this.path].length>0?l((p=globalBuffer[this.path].shift())==null?void 0:p.message):eventWaitBuffer[this.path].push(m=>l(m))})}}},promisify=e=>()=>new Promise((r,o)=>{e((i,a)=>{i?o(i):r(a)})}),HID=ExtendedHID,Ae=class Ae{static startMonitoring(){this.shouldMonitor=!0,!this.hasMonitored&&navigator.hid&&(navigator.hid.addEventListener("connect",Ae.onConnect),navigator.hid.addEventListener("disconnect",Ae.onDisconnect))}static stopMonitoring(){this.shouldMonitor=!1}static on(r,o){this._listeners[r]=[...this._listeners[r],o]}static off(r,o){this._listeners[r]=this._listeners[r].filter(i=>i!==o)}};se(Ae,"_listeners",{change:[],remove:[]}),se(Ae,"shouldMonitor",!1),se(Ae,"hasMonitored",!1),se(Ae,"onConnect",({device:r})=>{console.log("Detected Connection"),Ae.shouldMonitor&&Ae._listeners.change.forEach(o=>o(r))}),se(Ae,"onDisconnect",({device:r})=>{console.log("Detected Disconnection"),Ae.shouldMonitor&&(Ae._listeners.change.forEach(o=>o(r)),Ae._listeners.remove.forEach(o=>o(r)))});let usbDetect=Ae;async function scanDevices(e){return HID.devices(e)}function initAndConnectDevice({path:e}){return new HID.HID(e)}function startMonitoring(){usbDetect.startMonitoring()}const extractDeviceInfo=e=>({productId:e.productId,vendorId:e.vendorId,productName:e.productName,protocol:e.protocol}),initialState$c={appErrors:[]},getErrorTimestamp=()=>{const e=new Date;return`${e.toLocaleTimeString([],{hour12:!1})}.${e.getMilliseconds().toString().padStart(3,"0")}`},extractMessageFromKeyboardAPIError=e=>`Command Name: ${e.commandName}
Command: ${formatBytes(e.commandBytes)}
Response: ${formatBytes(e.responseBytes)}`,getMessageFromError=e=>e.stack||e.message,formatBytes=e=>e.join(" "),errorsSlice=createSlice({name:"errors",initialState:initialState$c,reducers:{logAppError:(e,r)=>{e.appErrors.push({...r.payload,timestamp:getErrorTimestamp()})},logKeyboardAPIError:(e,r)=>{const{deviceInfo:o}=r.payload;e.appErrors.push({timestamp:getErrorTimestamp(),message:extractMessageFromKeyboardAPIError(r.payload),deviceInfo:o})},clearAppErrors:e=>{e.appErrors=[]}}}),{logKeyboardAPIError,logAppError,clearAppErrors}=errorsSlice.actions,errorsReducer=errorsSlice.reducer,getAppErrors=e=>e.errors.appErrors,maxBitSize=5,packBits=e=>e.reduce((r,[o,i])=>r<<minBitSize(i)|o,0)>>>0,numIntoBytes=e=>[e>>24,e>>16,e>>8,e].map(r=>r&255),bytesIntoNum=e=>(e[0]<<24|e[1]<<16|e[2]<<8|e[3])>>>0,unpackBits=(e,r)=>r.reverse().reduce(({res:o,bits:i},a)=>({bits:i>>minBitSize(a),res:[i&(1<<minBitSize(a))-1,...o]}),{bits:e,res:[]}).res,minBitSize=e=>1+Array(maxBitSize).fill(0).findIndex((r,o)=>2<<o>=e),COMMAND_START=0,PER_KEY_RGB_CHANNEL_COMMAND=[0,1];var APICommand=(e=>(e[e.GET_PROTOCOL_VERSION=1]="GET_PROTOCOL_VERSION",e[e.GET_KEYBOARD_VALUE=2]="GET_KEYBOARD_VALUE",e[e.SET_KEYBOARD_VALUE=3]="SET_KEYBOARD_VALUE",e[e.DYNAMIC_KEYMAP_GET_KEYCODE=4]="DYNAMIC_KEYMAP_GET_KEYCODE",e[e.DYNAMIC_KEYMAP_SET_KEYCODE=5]="DYNAMIC_KEYMAP_SET_KEYCODE",e[e.CUSTOM_MENU_SET_VALUE=7]="CUSTOM_MENU_SET_VALUE",e[e.CUSTOM_MENU_GET_VALUE=8]="CUSTOM_MENU_GET_VALUE",e[e.CUSTOM_MENU_SAVE=9]="CUSTOM_MENU_SAVE",e[e.EEPROM_RESET=10]="EEPROM_RESET",e[e.BOOTLOADER_JUMP=11]="BOOTLOADER_JUMP",e[e.DYNAMIC_KEYMAP_MACRO_GET_COUNT=12]="DYNAMIC_KEYMAP_MACRO_GET_COUNT",e[e.DYNAMIC_KEYMAP_MACRO_GET_BUFFER_SIZE=13]="DYNAMIC_KEYMAP_MACRO_GET_BUFFER_SIZE",e[e.DYNAMIC_KEYMAP_MACRO_GET_BUFFER=14]="DYNAMIC_KEYMAP_MACRO_GET_BUFFER",e[e.DYNAMIC_KEYMAP_MACRO_SET_BUFFER=15]="DYNAMIC_KEYMAP_MACRO_SET_BUFFER",e[e.DYNAMIC_KEYMAP_MACRO_RESET=16]="DYNAMIC_KEYMAP_MACRO_RESET",e[e.DYNAMIC_KEYMAP_GET_LAYER_COUNT=17]="DYNAMIC_KEYMAP_GET_LAYER_COUNT",e[e.DYNAMIC_KEYMAP_GET_BUFFER=18]="DYNAMIC_KEYMAP_GET_BUFFER",e[e.DYNAMIC_KEYMAP_SET_BUFFER=19]="DYNAMIC_KEYMAP_SET_BUFFER",e[e.DYNAMIC_KEYMAP_GET_ENCODER=20]="DYNAMIC_KEYMAP_GET_ENCODER",e[e.DYNAMIC_KEYMAP_SET_ENCODER=21]="DYNAMIC_KEYMAP_SET_ENCODER",e[e.BACKLIGHT_CONFIG_SET_VALUE=7]="BACKLIGHT_CONFIG_SET_VALUE",e[e.BACKLIGHT_CONFIG_GET_VALUE=8]="BACKLIGHT_CONFIG_GET_VALUE",e[e.BACKLIGHT_CONFIG_SAVE=9]="BACKLIGHT_CONFIG_SAVE",e[e.TAB_MATRIX_LIGHTING_SET_INFO=192]="TAB_MATRIX_LIGHTING_SET_INFO",e[e.TAB_MATRIX_LIGHTING_SET_BUFFER=193]="TAB_MATRIX_LIGHTING_SET_BUFFER",e[e.TAB_ACTUATION=208]="TAB_ACTUATION",e[e.TAB_FILE_SET_INFO=224]="TAB_FILE_SET_INFO",e[e.TAB_FILE_SET_BUFFER=225]="TAB_FILE_SET_BUFFER",e[e.TAB_FILE_SET_CANCEL=226]="TAB_FILE_SET_CANCEL",e))(APICommand||{});const APICommandValueToName=Object.entries(APICommand).reduce((e,[r,o])=>({...e,[o]:r}),{});var KeyboardValue=(e=>(e[e.UPTIME=1]="UPTIME",e[e.LAYOUT_OPTIONS=2]="LAYOUT_OPTIONS",e[e.SWITCH_MATRIX_STATE=3]="SWITCH_MATRIX_STATE",e[e.FIRMWARE_VERSION=4]="FIRMWARE_VERSION",e[e.DEVICE_INDICATION=5]="DEVICE_INDICATION",e))(KeyboardValue||{});const BACKLIGHT_BRIGHTNESS=9,BACKLIGHT_EFFECT=10,BACKLIGHT_COLOR_1=12,BACKLIGHT_COLOR_2=13,BACKLIGHT_CUSTOM_COLOR=23,PROTOCOL_ALPHA=7,PROTOCOL_BETA=8,PROTOCOL_GAMMA=9,cache$1={},eqArr=(e,r)=>e.length!==r.length?!1:e.every((o,i)=>r[i]===o),shiftTo16Bit=([e,r])=>e<<8|r,shiftFrom16Bit=e=>[e>>8,e&255],shiftBufferTo16Bit=e=>{const r=[];for(let o=0;o<e.length;o+=2)r.push(shiftTo16Bit([e[o],e[o+1]]));return r},shiftBufferFrom16Bit=e=>e.map(shiftFrom16Bit).flatMap(r=>r),globalCommandQueue={},canConnect=e=>{try{return new KeyboardAPI(e.path),!0}catch(r){return console.error("Skipped ",e,r),!1}};class KeyboardAPI{constructor(r){se(this,"kbAddr");if(this.kbAddr=r,!cache$1[r]){const o=initAndConnectDevice({path:r});cache$1[r]={hid:o}}}refresh(r){this.kbAddr=r,cache$1[r]={...cache$1[r],hid:initAndConnectDevice({path:r})}}async getByteBuffer(){return this.getHID().readP()}async getProtocolVersion(){try{const[,r,o]=await this.hidCommand(1);return shiftTo16Bit([r,o])}catch{return-1}}async getFirmwareVersion(){try{const r=await this.getKeyboardValue(4,[],4);return bytesIntoNum(r)}catch{return 0}}async getKey(r,o,i){const a=await this.hidCommand(4,[r,o,i]);return shiftTo16Bit([a[4],a[5]])}async getLayerCount(){if(await this.getProtocolVersion()>=PROTOCOL_BETA){const[,o]=await this.hidCommand(17);return o}return 4}async readRawMatrix(r,o){const i=await this.getProtocolVersion();if(i>=PROTOCOL_BETA)return this.fastReadRawMatrix(r,o);if(i===PROTOCOL_ALPHA)return this.slowReadRawMatrix(r,o);throw new Error("Unsupported protocol version")}async getKeymapBuffer(r,o){if(o>28)throw new Error("Max data length is 28");return[...await this.hidCommand(18,[...shiftFrom16Bit(r),o])].slice(4,o+4)}async fastReadRawMatrix({rows:r,cols:o},i){const a=r*o,d=14,l=new Array(Math.ceil(a/d)).fill(0),{res:p}=l.reduce(({res:_,remaining:C})=>C<d?{res:[..._,this.getKeymapBuffer(i*a*2+2*(a-C),C*2)],remaining:0}:{res:[..._,this.getKeymapBuffer(i*a*2+2*(a-C),d*2)],remaining:C-d},{res:[],remaining:a});return(await Promise.all(p)).flatMap(shiftBufferTo16Bit)}async slowReadRawMatrix({rows:r,cols:o},i){const a=r*o,d=new Array(a).fill(0).map((l,p)=>this.getKey(i,~~(p/o),p%o));return Promise.all(d)}async writeRawMatrix(r,o){const i=await this.getProtocolVersion();if(i>=PROTOCOL_BETA)return this.fastWriteRawMatrix(o);if(i===PROTOCOL_ALPHA)return this.slowWriteRawMatrix(r,o)}async slowWriteRawMatrix({cols:r},o){o.forEach(async(i,a)=>i.forEach(async(d,l)=>{await this.setKey(a,~~(l/r),l%r,d)}))}async fastWriteRawMatrix(r){const o=r.flatMap(d=>d.map(l=>l)),i=shiftBufferFrom16Bit(o),a=28;for(let d=0;d<i.length;d+=a){const l=i.slice(d,d+a);await this.hidCommand(19,[...shiftFrom16Bit(d),l.length,...l])}}async getKeyboardValue(r,o,i=1){const a=[r,...o];return(await this.hidCommand(2,a)).slice(1+a.length,1+a.length+i)}async setKeyboardValue(r,...o){const i=[r,...o];await this.hidCommand(3,i)}async getEncoderValue(r,o,i){const a=[r,o,+i],d=await this.hidCommand(20,a);return shiftTo16Bit([d[4],d[5]])}async setEncoderValue(r,o,i,a){const d=[r,o,+i,...shiftFrom16Bit(a)];await this.hidCommand(21,d)}async getCustomMenuValue(r){return(await this.hidCommand(8,r)).slice(0+r.length)}async setCustomMenuValue(...r){await this.hidCommand(7,r)}async getPerKeyRGBMatrix(r){return(await Promise.all(r.map(i=>this.hidCommand(8,[...PER_KEY_RGB_CHANNEL_COMMAND,i,1])))).map(i=>[...i.slice(5,7)])}async setPerKeyRGBMatrix(r,o,i){await this.hidCommand(7,[...PER_KEY_RGB_CHANNEL_COMMAND,r,1,o,i])}async getBacklightValue(r,o=1){const i=[r];return(await this.hidCommand(8,i)).slice(2,2+o)}async setBacklightValue(r,...o){const i=[r,...o];await this.hidCommand(7,i)}async getRGBMode(){const r=[BACKLIGHT_EFFECT],[,,o]=await this.hidCommand(8,r);return o}async getBrightness(){const r=[BACKLIGHT_BRIGHTNESS],[,,o]=await this.hidCommand(8,r);return o}async getColor(r){const o=[r===1?BACKLIGHT_COLOR_1:BACKLIGHT_COLOR_2],[,,i,a]=await this.hidCommand(8,o);return{hue:i,sat:a}}async setColor(r,o,i){const a=[r===1?BACKLIGHT_COLOR_1:BACKLIGHT_COLOR_2,o,i];await this.hidCommand(7,a)}async getCustomColor(r){const o=[BACKLIGHT_CUSTOM_COLOR,r],[,,,i,a]=await this.hidCommand(8,o);return{hue:i,sat:a}}async setCustomColor(r,o,i){const a=[BACKLIGHT_CUSTOM_COLOR,r,o,i];await this.hidCommand(7,a)}async setRGBMode(r){const o=[BACKLIGHT_EFFECT,r];await this.hidCommand(7,o)}async commitCustomMenu(r){await this.hidCommand(9,[r])}async saveLighting(){await this.hidCommand(9)}async resetEEPROM(){await this.hidCommand(10)}async jumpToBootloader(){await this.hidCommand(11)}async setKey(r,o,i,a){const d=await this.hidCommand(5,[r,o,i,...shiftFrom16Bit(a)]);return shiftTo16Bit([d[4],d[5]])}async getMacroCount(){const[,r]=await this.hidCommand(12);return r}async getMacroBufferSize(){const[,r,o]=await this.hidCommand(13);return shiftTo16Bit([r,o])}async getMacroBytes(){const r=await this.getMacroBufferSize(),o=28,i=[];for(let d=0;d<r;d+=28)i.push(this.hidCommand(14,[...shiftFrom16Bit(d),o]));return(await Promise.all(i)).flatMap(d=>d.slice(4))}async setMacroBytes(r){const o=await this.getMacroBufferSize(),i=r.length;if(i>o)throw new Error(`Macro size (${i}) exceeds buffer size (${o})`);const a=o-1,d=shiftFrom16Bit(a);await this.resetMacros();try{await this.hidCommand(15,[...shiftFrom16Bit(a),1,255]);const l=28;for(let p=0;p<r.length;p+=l){const m=r.slice(p,p+l);await this.hidCommand(15,[...shiftFrom16Bit(p),m.length,...m])}}finally{await this.hidCommand(15,[...d,1,0])}}async resetMacros(){await this.hidCommand(16)}async setMatrixLighting(r,o,i,a,d){const l=await this.hidCommand(192,[r,o,i,a]);if(l&&l[5]===238){const m=new Error("Error: "+l[5]);m.cause=l[5]}const p=26;for(let m=0;m<d.length;m+=p){const _=d.slice(m,m+p);await this.hidCommand(193,[...numIntoBytes(m),_.length,..._])}}async setTabFile(r,o,i){const a=await this.hidCommand(224,r.slice(0,20));if(a&&a[21]===238){const l=new Error("Error: "+a[21]);throw l.cause=a[21],l}const d=26;for(let l=0;l<r.length;l+=d){const p=r.slice(l,l+d);if(await this.hidCommand(225,[...numIntoBytes(l),p.length,...p]),i&&i()){await this.hidCommand(226);return}o&&o(l+p.length)}}async actuationCommand(r,o=[]){return await this.hidCommand(208,[r,...o])}get commandQueueWrapper(){return globalCommandQueue[this.kbAddr]?globalCommandQueue[this.kbAddr]:(globalCommandQueue[this.kbAddr]={isFlushing:!1,commandQueue:[]},globalCommandQueue[this.kbAddr])}async timeout(r){return new Promise((o,i)=>{this.commandQueueWrapper.commandQueue.push({res:o,rej:i,args:()=>new Promise(a=>setTimeout(()=>{a(),o(void 0)},r))}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async hidCommand(r,o=[]){return new Promise((i,a)=>{this.commandQueueWrapper.commandQueue.push({res:i,rej:a,args:[r,o]}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async flushQueue(){if(this.commandQueueWrapper.isFlushing!==!0){for(this.commandQueueWrapper.isFlushing=!0;this.commandQueueWrapper.commandQueue.length!==0;){const{res:r,rej:o,args:i}=this.commandQueueWrapper.commandQueue.shift();if(typeof i=="function")await i(),r();else try{const a=await this._hidCommand(...i);r(a)}catch(a){const d=extractDeviceInfo(this.getHID());store.dispatch(logAppError({message:getMessageFromError(a),deviceInfo:d})),o(a)}}this.commandQueueWrapper.isFlushing=!1}}getHID(){return cache$1[this.kbAddr].hid}async _hidCommand(r,o=[]){const i=[COMMAND_START,r,...o],a=new Array(33).fill(0);i.forEach((m,_)=>{a[_]=m});const d=await this.getHID().send(a),l=Array.from(d),p=l.slice(0,i.length-1);if(logCommand(this.kbAddr,i,l),[208].includes(r)&&eqArr([255],l.slice(0,1))&&eqArr(i.slice(2),p.slice(1)))return console.debug(`Command for ${this.kbAddr}`,i,"Correct Resp:",l),[];if(!eqArr(i.slice(1),p)){console.error(`Command for ${this.kbAddr}:`,i,"Bad Resp:",l);const m=extractDeviceInfo(this.getHID()),_=APICommandValueToName[r];throw store.dispatch(logKeyboardAPIError({commandName:_,commandBytes:i.slice(1),responseBytes:l,deviceInfo:m})),new Error("Receiving incorrect response for command")}return r===208&&console.debug(`Command for ${this.kbAddr}`,i,"Correct Resp:",l),l}}function getVendorProductId(e,r){return e*65536+r}const idExists=({productId:e,vendorId:r},o)=>o[getVendorProductId(r,e)],getRecognisedDevices=async(e,r=!1)=>(await scanDevices(r)).filter(i=>idExists(i,e)&&canConnect(i));let deviceStore;const defaultStoreData={definitionIndex:{generatedAt:-1,hash:"",version:"2.0.0",theme:distExports.getTheme(),accentColor:"#ad7070",supportedVendorProductIdMap:{}},definitions:{},settings:{showDesignTab:!1,disableFastRemap:!1,renderMode:"2D",themeMode:"dark",designDefinitionVersion:"v3",themeName:"OLIVIA_DARK",macroEditor:{smartOptimizeEnabled:!0,recordDelaysEnabled:!1,tapEnterAtEOMEnabled:!1},testKeyboardSoundsSettings:{isEnabled:!0,volume:100,waveform:"sine",mode:TestKeyboardSoundsMode.WickiHayden,transpose:0}}};function initDeviceStore(){deviceStore=new Store(defaultStoreData)}initDeviceStore();const getMissingDefinition=async(e,r)=>{const o=getVendorProductId(e.vendorId,e.productId),i=`/definitions/${r}/${o}.json`,d=await(await fetch(i)).json();let l=deviceStore.get("definitions");const p={...l,[o]:{...l[o],[r]:d}};try{deviceStore.set("definitions",p)}catch{localStorage.clear(),initDeviceStore(),l=deviceStore.get("definitions"),deviceStore.set("definitions",{...l,[o]:{...l[o],[r]:d}})}return[d,r]},getSupportedIdsFromStore=()=>{var e;return(e=deviceStore.get("definitionIndex"))==null?void 0:e.supportedVendorProductIdMap},getDefinitionsFromStore=()=>deviceStore.get("definitions"),getThemeModeFromStore=()=>{var e;return(e=deviceStore.get("settings"))==null?void 0:e.themeMode},getThemeNameFromStore=()=>{var e;return(e=deviceStore.get("settings"))==null?void 0:e.themeName},getSettings=()=>deviceStore.get("settings"),setSettings=e=>{deviceStore.set("settings",D(e))},quantumRangesKeys=["_QK_MODS","_QK_MODS_MAX","_QK_MOD_TAP","_QK_MOD_TAP_MAX","_QK_LAYER_TAP","_QK_LAYER_TAP_MAX","_QK_LAYER_MOD","_QK_LAYER_MOD_MAX","_QK_TO","_QK_TO_MAX","_QK_MOMENTARY","_QK_MOMENTARY_MAX","_QK_DEF_LAYER","_QK_DEF_LAYER_MAX","_QK_TOGGLE_LAYER","_QK_TOGGLE_LAYER_MAX","_QK_ONE_SHOT_LAYER","_QK_ONE_SHOT_LAYER_MAX","_QK_ONE_SHOT_MOD","_QK_ONE_SHOT_MOD_MAX","_QK_LAYER_TAP_TOGGLE","_QK_LAYER_TAP_TOGGLE_MAX","_QK_KB","_QK_KB_MAX","_QK_MACRO","_QK_MACRO_MAX","_QK_TAP_DANCE","_QK_TAP_DANCE_MAX"],quantumRanges=e=>Object.keys(e).reduce((r,o)=>quantumRangesKeys.includes(o)?{...r,[o]:e[o]}:r,{}),modCodes={QK_LCTL:256,QK_LSFT:512,QK_LALT:1024,QK_LGUI:2048,QK_RMODS_MIN:4096,QK_RCTL:4352,QK_RSFT:4608,QK_RALT:5120,QK_RGUI:6144},modMasks={MOD_LCTL:1,MOD_LSFT:2,MOD_LALT:4,MOD_LGUI:8,MOD_RCTL:17,MOD_RSFT:18,MOD_RALT:20,MOD_RGUI:24,MOD_HYPR:15,MOD_MEH:7},topLevelMacroToValue={MT:"_QK_MOD_TAP",LT:"_QK_LAYER_TAP",LM:"_QK_LAYER_MOD",TO:"_QK_TO",MO:"_QK_MOMENTARY",DF:"_QK_DEF_LAYER",TG:"_QK_TOGGLE_LAYER",OSL:"_QK_ONE_SHOT_LAYER",OSM:"_QK_ONE_SHOT_MOD",TT:"_QK_LAYER_TAP_TOGGLE",CUSTOM:"_QK_KB",MACRO:"_QK_MACRO",TD:"_QK_TAP_DANCE"},modifierKeyToValue={LCTL:modCodes.QK_LCTL,C:modCodes.QK_LCTL,LSFT:modCodes.QK_LSFT,S:modCodes.QK_LSFT,LALT:modCodes.QK_LALT,A:modCodes.QK_LALT,LGUI:modCodes.QK_LGUI,LCMD:modCodes.QK_LGUI,LWIN:modCodes.QK_LGUI,G:modCodes.QK_LGUI,RCTL:modCodes.QK_RCTL,RSFT:modCodes.QK_RSFT,ALGR:modCodes.QK_RALT,RALT:modCodes.QK_RALT,RCMD:modCodes.QK_RGUI,RWIN:modCodes.QK_RGUI,RGUI:modCodes.QK_RGUI,SCMD:modCodes.QK_LSFT|modCodes.QK_LGUI,SWIN:modCodes.QK_LSFT|modCodes.QK_LGUI,SGUI:modCodes.QK_LSFT|modCodes.QK_LGUI,LSG:modCodes.QK_LSFT|modCodes.QK_LGUI,LAG:modCodes.QK_LALT|modCodes.QK_LGUI,RSG:modCodes.QK_RSFT|modCodes.QK_RGUI,RAG:modCodes.QK_RALT|modCodes.QK_RGUI,LCA:modCodes.QK_LCTL|modCodes.QK_LALT,LSA:modCodes.QK_LSFT|modCodes.QK_LALT,SAGR:modCodes.QK_RSFT|modCodes.QK_RALT,RSA:modCodes.QK_RSFT|modCodes.QK_RALT,RCS:modCodes.QK_RCTL|modCodes.QK_RSFT,LCAG:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LGUI,MEH:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LSFT,HYPR:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LSFT|modCodes.QK_LGUI},modifierValueToKey=Object.entries(modifierKeyToValue).reduce((e,[r,o])=>({...e,[o]:r}),{}),leftModifierValueToKey=Object.entries(modifierKeyToValue).filter(([e,r])=>Object.values(modCodes).includes(r)&&r<modCodes.QK_RMODS_MIN).reduce((e,[r,o])=>({...e,[o]:r}),{}),rightModifierValueToKey=Object.entries(modifierKeyToValue).filter(([e,r])=>Object.values(modCodes).includes(r)&&r>=modCodes.QK_RMODS_MIN).reduce((e,[r,o])=>({...e,[o]:r}),{}),topLevelValueToMacro=e=>Object.entries(topLevelMacroToValue).reduce((r,[o,i])=>({...r,[e[i]]:o}),{}),advancedStringToKeycode=(e,r)=>{const i=e.toUpperCase().split(/\(|\)/).map(a=>a.trim());return Object.keys(topLevelMacroToValue).includes(i[0])?parseTopLevelMacro(i,r):Object.keys(modifierKeyToValue).includes(i[0])?parseModifierCode(i,r):0},advancedKeycodeToString=(e,r,o)=>{let i=Object.entries(quantumRanges(r)).map(([b,K])=>[K,b]).sort((b,K)=>b[0]-K[0]),a=null,d=-1;for(let b=0;b<i.length;b+=2)e>=i[b][0]&&e<=i[b+1][0]&&(a=i[b][1],d=+i[b][0]);if(["_QK_MODS"].includes(a))return topLevelModToString(e,o);let p=topLevelValueToMacro(r)[d]+"(",m=e&~d,_=0,C="",y=0;switch(a){case"_QK_KB":case"_QK_MACRO":case"_QK_TAP_DANCE":p+=e-d+")";break;case"_QK_MOMENTARY":case"_QK_DEF_LAYER":case"_QK_TOGGLE_LAYER":case"_QK_ONE_SHOT_LAYER":case"_QK_LAYER_TAP_TOGGLE":case"_QK_TO":p+=m+")";break;case"_QK_LAYER_TAP":_=m>>8,C=o[m&255],p+=_+","+C+")";break;case"_QK_ONE_SHOT_MOD":p+=modValueToString(m)+")";break;case"_QK_LAYER_MOD":let b=r._QK_LAYER_MOD_MASK,K=Math.log2(b+1);_=m>>K,y=m&b,p+=_+","+modValueToString(y)+")";break;case"_QK_MOD_TAP":y=m>>8&31,C=o[m&255],p+=modValueToString(y)+","+C+")";break;default:p=null}return p},modValueToString=e=>{const r=["MOD_HYPR","MOD_MEH"];return Object.entries(modMasks).filter(i=>!r.includes(i[0])&&(i[1]&e)===i[1]).map(i=>i[0]).join(" | ")},topLevelModToString=(e,r)=>{const o=r[e&255],i=e&7936,a=modifierValueToKey[i];if(a!=null)return a+"("+o+")";const d=Object.entries(i&modCodes.QK_RMODS_MIN?rightModifierValueToKey:leftModifierValueToKey).filter(l=>{const p=Number.parseInt(l[0]);return(p&i)===p}).map(l=>l[1]);return d.join("(")+"("+o+")".repeat(d.length)},parseTopLevelMacro=(e,r)=>{const o=e[0],i=e[1]??"";let[a,d]=["",""],l=0,p=0;switch(o){case"MO":case"DF":case"TG":case"OSL":case"TT":case"TO":return l=Number.parseInt(i),l<0?0:r[topLevelMacroToValue[o]]|l&255;case"OSM":return p=parseMods(i),p===0?0:r[topLevelMacroToValue[o]]|p&255;case"LM":[a,d]=i.split(",").map(C=>C.trim());let m=r._QK_LAYER_MOD_MASK,_=Math.log2(m+1);return l=Number.parseInt(a),p=parseMods(d),l<0||p===0?0:r[topLevelMacroToValue[o]]|(l&15)<<_|p&m;case"LT":return[a,d]=i.split(",").map(C=>C.trim()),l=Number.parseInt(a),l<0||!r.hasOwnProperty(d)?0:r[topLevelMacroToValue[o]]|(l&15)<<8|r[d];case"MT":return[a,d]=i.split(",").map(C=>C.trim()),p=parseMods(a),p===0||!r.hasOwnProperty(d)?0:r[topLevelMacroToValue[o]]|(p&31)<<8|r[d]&255;case"CUSTOM":{const C=Number.parseInt(i),y=r._QK_KB_MAX-r._QK_KB;return C>=0&&C<=y?r[topLevelMacroToValue[o]]+C:0}case"MACRO":{const C=Number.parseInt(i),y=r._QK_MACRO_MAX-r._QK_MACRO;return C>=0&&C<=y?r[topLevelMacroToValue[o]]+C:0}case"TD":{const C=Number.parseInt(i),y=r._QK_TAP_DANCE_MAX-r._QK_TAP_DANCE;return C>=0&&C<=y?r[topLevelMacroToValue[o]]+C:0}default:return 0}},parseMods=(e="")=>{const r=e.split("|").map(o=>o.trim());return r.reduce((o,i)=>o&&modMasks.hasOwnProperty(i),!0)?r.reduce((o,i)=>o|modMasks[i],0):0},parseModifierCode=(e,r)=>{const o=e.filter(a=>a.length!==0),i=o.map((a,d)=>d===o.length-1?r.hasOwnProperty(a)?r[a]:null:modifierKeyToValue.hasOwnProperty(a)?modifierKeyToValue[a]:null);return i.find(a=>a===null)?0:i.reduce((a,d)=>a|d,0)},anyKeycodeToString=(e,r,o)=>{let i="";const a=advancedKeycodeToString(e,r,o);return o[e]&&!o[e].startsWith("_QK")?i=o[e]:a!==null&&(i=a),i};function isAlpha(e){return/[A-Za-z]/.test(e)&&e.length===1}function isNumpadNumber(e){return/['0-9]/.test(e)&&e.length===1}function isArrowKey(e){return/[🠗🠕🠖🠔←↑→↓]$/.test(e)}function isNumpadSymbol(e){const r="-+.÷×".split("");return e.length===1&&r.includes(e[0])}function isMultiLegend(e){const r='~!@#$%^&*()_+|{}:"<>?'.split("");return e.length!==1&&r.includes(e[0])}function getByteForCode(e,r){const o=r[e];if(o!==void 0)return o;if(isLayerCode(e))return getByteForLayerCode(e,r);if(advancedStringToKeycode(e,r)!==null)return advancedStringToKeycode(e,r);throw`Could not find byte for ${e}`}function isLayerCode(e){return/([A-Za-z]+)\((\d+)\)/.test(e)}function getByteForLayerCode(e,r){const o=e.match(/([A-Za-z]+)\((\d+)\)/);if(o){const[,i,a]=o,d=parseInt(a);switch(i){case"TO":return Math.min(r._QK_TO+d,r._QK_TO_MAX);case"MO":return Math.min(r._QK_MOMENTARY+d,r._QK_MOMENTARY_MAX);case"DF":return Math.min(r._QK_DEF_LAYER+d,r._QK_DEF_LAYER_MAX);case"TG":return Math.min(r._QK_TOGGLE_LAYER+d,r._QK_TOGGLE_LAYER_MAX);case"OSL":return Math.min(r._QK_ONE_SHOT_LAYER+d,r._QK_ONE_SHOT_LAYER_MAX);case"TT":return Math.min(r._QK_LAYER_TAP_TOGGLE+d,r._QK_LAYER_TAP_TOGGLE_MAX);case"CUSTOM":return Math.min(r._QK_KB+d,r._QK_KB_MAX);case"MACRO":return Math.min(r._QK_MACRO+d,r._QK_MACRO_MAX);case"TD":return Math.min(r._QK_TAP_DANCE+d,r._QK_TAP_DANCE_MAX);default:throw new Error("Incorrect code")}}throw new Error("No match found")}function getCodeForLayerByte(e,r){if(r._QK_TO<=e&&r._QK_TO_MAX>=e)return`TO(${e-r._QK_TO})`;if(r._QK_MOMENTARY<=e&&r._QK_MOMENTARY_MAX>=e)return`MO(${e-r._QK_MOMENTARY})`;if(r._QK_DEF_LAYER<=e&&r._QK_DEF_LAYER_MAX>=e)return`DF(${e-r._QK_DEF_LAYER})`;if(r._QK_TOGGLE_LAYER<=e&&r._QK_TOGGLE_LAYER_MAX>=e)return`TG(${e-r._QK_TOGGLE_LAYER})`;if(r._QK_ONE_SHOT_LAYER<=e&&r._QK_ONE_SHOT_LAYER_MAX>=e)return`OSL(${e-r._QK_ONE_SHOT_LAYER})`;if(r._QK_LAYER_TAP_TOGGLE<=e&&r._QK_LAYER_TAP_TOGGLE_MAX>=e)return`TT(${e-r._QK_LAYER_TAP_TOGGLE})`;if(r._QK_KB<=e&&r._QK_KB_MAX>=e)return`CUSTOM(${e-r._QK_KB})`;if(r._QK_MACRO<=e&&r._QK_MACRO_MAX>=e)return`MACRO(${e-r._QK_MACRO})`}const keycodesList=getKeycodes().reduce((e,r)=>e.concat(r.keycodes),[]),getByteToKey=e=>Object.keys(e).reduce((r,o)=>{const i=e[o];if(i in r){const a=keycodesList.find(({code:d})=>d===o);return a?{...r,[i]:a.code}:r}return{...r,[i]:o}},{});function isLayerKey(e,r){return[[r._QK_TO,r._QK_TO_MAX],[r._QK_MOMENTARY,r._QK_MOMENTARY_MAX],[r._QK_DEF_LAYER,r._QK_DEF_LAYER_MAX],[r._QK_TOGGLE_LAYER,r._QK_TOGGLE_LAYER_MAX],[r._QK_ONE_SHOT_LAYER,r._QK_ONE_SHOT_LAYER_MAX],[r._QK_LAYER_TAP_TOGGLE,r._QK_LAYER_TAP_TOGGLE_MAX],[r._QK_KB,r._QK_KB_MAX],[r._QK_MACRO,r._QK_MACRO_MAX]].some(o=>e>=o[0]&&e<=o[1])}function getCodeForByte(e,r,o){const i=o[e];return i&&!i.startsWith("_QK")?i:isLayerKey(e,r)?getCodeForLayerByte(e,r):advancedKeycodeToString(e,r,o)!==null?advancedKeycodeToString(e,r,o):"0x"+Number(e).toString(16)}function keycodeInMaster(e,r){return e in r||isLayerCode(e)||advancedStringToKeycode(e,r)!==null}function shorten(e){return e.split(" ").map(r=>r.slice(0,1)+r.slice(1).replace(/[aeiou ]/gi,"")).join("")}function isCustomKeycodeByte(e,r){return e>=r._QK_KB&&e<=r._QK_KB_MAX}function getCustomKeycodeIndex(e,r){return e-r._QK_KB}function isTapDanceByte(e,r){return e>=r._QK_TAP_DANCE&&e<=r._QK_TAP_DANCE_MAX}function getTapDanceIndex(e,r){return e-r._QK_TAP_DANCE}function isMacroKeycodeByte(e,r){return e>=r._QK_MACRO&&e<=r._QK_MACRO_MAX}function getMacroKeycodeIndex(e,r){return e-r._QK_MACRO}function getLabelForByte(e,r=100,o,i){const a=getCodeForByte(e,o,i),d=keycodesList.find(({code:l})=>l===a);return d?getShortNameForKeycode(d,r):a}function getShortNameForKeycode(e,r=100){const{code:o,name:i,shortName:a}=e;if(r<=150&&a)return a;if(r===100&&i.length>5){const d=shorten(i);if(o){const l=o.replace("KC_","").replace("_"," ");return d.length>4&&l.length<d.length?l:d}return d}return i}function getOtherMenu(e){return{id:"other",label:"Other",keycodes:Object.keys(e).filter(o=>!o.startsWith("_QK")).filter(o=>!keycodesList.map(({code:i})=>i).includes(o)).map(o=>({name:o.replace("KC_","").replace(/_/g," "),code:o}))}}function buildLayerMenu(){const e=[{name:`Fn1
(Fn3)`,code:"FN_MO13",title:"Hold = Layer 1, Hold with Fn2 = Layer 3",shortName:"Fn1(3)"},{name:`Fn2
(Fn3)`,code:"FN_MO23",title:"Hold = Layer 2, Hold with Fn1 = Layer 3",shortName:"Fn2(3)"},{name:"Space Fn1",code:"LT(1,KC_SPC)",title:"Hold = Layer 1, Tap = Space",shortName:"Spc Fn1"},{name:"Space Fn2",code:"LT(2,KC_SPC)",title:"Hold = Layer 2, Tap = Space",shortName:"Spc Fn2"},{name:"Space Fn3",code:"LT(3,KC_SPC)",title:"Hold = Layer 3, Tap = Space",shortName:"Spc Fn3"}],r={id:"layers",label:"Layers",width:"label",keycodes:[{name:"MO",code:"MO(layer)",type:"layer",layer:0,title:"Momentary turn layer on"},{name:"TG",code:"TG(layer)",type:"layer",layer:0,title:"Toggle layer on/off"},{name:"TT",code:"TT(layer)",type:"layer",layer:0,title:"Normally acts like MO unless it's tapped multple times which toggles layer on"},{name:"OSL",code:"OSL(layer)",type:"layer",layer:0,title:"Switch to layer for one keypress"},{name:"TO",code:"TO(layer)",type:"layer",layer:0,title:"Turn on layer when pressed"},{name:"DF",code:"DF(layer)",type:"layer",layer:0,title:"Sets the default layer"}]};return{...r,keycodes:[...e,...r.keycodes.flatMap(o=>{let i=[];for(let a=0;a<10;a++){const d=(o.title||"").replace("layer",`layer ${a}`),l=o.code.replace("layer",`${a}`),p=o.name+`(${a})`;i=[...i,{...o,name:p,title:d,code:l}]}return i})]}}function generateMacros(e=16){let r=[];for(let o=0;o<e;o++){const i=`M${o}`,a=`MACRO(${o})`,d=`Macro ${o}`;r=[...r,{name:i,title:d,code:a}]}return r}function getKeycodes(e=16){return[{id:"basic",label:"Basic",keycodes:[{name:"",code:"KC_NO",title:"Nothing"},{name:"▽",code:"KC_TRNS",title:"Pass-through"},{name:"Esc",code:"KC_ESC",keys:"esc"},{name:"A",code:"KC_A",keys:"a"},{name:"B",code:"KC_B",keys:"b"},{name:"C",code:"KC_C",keys:"c"},{name:"D",code:"KC_D",keys:"d"},{name:"E",code:"KC_E",keys:"e"},{name:"F",code:"KC_F",keys:"f"},{name:"G",code:"KC_G",keys:"g"},{name:"H",code:"KC_H",keys:"h"},{name:"I",code:"KC_I",keys:"i"},{name:"J",code:"KC_J",keys:"j"},{name:"K",code:"KC_K",keys:"k"},{name:"L",code:"KC_L",keys:"l"},{name:"M",code:"KC_M",keys:"m"},{name:"N",code:"KC_N",keys:"n"},{name:"O",code:"KC_O",keys:"o"},{name:"P",code:"KC_P",keys:"p"},{name:"Q",code:"KC_Q",keys:"q"},{name:"R",code:"KC_R",keys:"r"},{name:"S",code:"KC_S",keys:"s"},{name:"T",code:"KC_T",keys:"t"},{name:"U",code:"KC_U",keys:"u"},{name:"V",code:"KC_V",keys:"v"},{name:"W",code:"KC_W",keys:"w"},{name:"X",code:"KC_X",keys:"x"},{name:"Y",code:"KC_Y",keys:"y"},{name:"Z",code:"KC_Z",keys:"z"},{name:`!
1`,code:"KC_1",keys:"1"},{name:`@
2`,code:"KC_2",keys:"2"},{name:`#
3`,code:"KC_3",keys:"3"},{name:`$
4`,code:"KC_4",keys:"4"},{name:`%
5`,code:"KC_5",keys:"5"},{name:`^
6`,code:"KC_6",keys:"6"},{name:`&
7`,code:"KC_7",keys:"7"},{name:`*
8`,code:"KC_8",keys:"8"},{name:`(
9`,code:"KC_9",keys:"9"},{name:`)
0`,code:"KC_0",keys:"0"},{name:`_
-`,code:"KC_MINS",keys:"-"},{name:`+
=`,code:"KC_EQL",keys:"="},{name:"~\n`",code:"KC_GRV",keys:"`"},{name:`{
[`,code:"KC_LBRC",keys:"["},{name:`}
]`,code:"KC_RBRC",keys:"]"},{name:`|
\\`,code:"KC_BSLS",keys:"\\",width:1500},{name:`:
;`,code:"KC_SCLN",keys:";"},{name:`"
'`,code:"KC_QUOT",keys:"'"},{name:`<
,`,code:"KC_COMM",keys:","},{name:`>
.`,code:"KC_DOT",keys:"."},{name:`?
/`,code:"KC_SLSH",keys:"/"},{name:"=",code:"KC_PEQL"},{name:",",code:"KC_PCMM"},{name:"F1",code:"KC_F1"},{name:"F2",code:"KC_F2"},{name:"F3",code:"KC_F3"},{name:"F4",code:"KC_F4"},{name:"F5",code:"KC_F5"},{name:"F6",code:"KC_F6"},{name:"F7",code:"KC_F7"},{name:"F8",code:"KC_F8"},{name:"F9",code:"KC_F9"},{name:"F10",code:"KC_F10"},{name:"F11",code:"KC_F11"},{name:"F12",code:"KC_F12"},{name:"Print Screen",code:"KC_PSCR",shortName:"Print"},{name:"Scroll Lock",code:"KC_SLCK",shortName:"Scroll"},{name:"Pause",code:"KC_PAUS"},{name:"Tab",code:"KC_TAB",keys:"tab",width:1500},{name:"Backspace",code:"KC_BSPC",keys:"backspace",width:2e3,shortName:"Bksp"},{name:"Insert",code:"KC_INS",keys:"insert",shortName:"Ins"},{name:"Del",code:"KC_DEL",keys:"delete"},{name:"Home",code:"KC_HOME",keys:"home"},{name:"End",code:"KC_END",keys:"end"},{name:"Page Up",code:"KC_PGUP",keys:"pageup",shortName:"PgUp"},{name:"Page Down",code:"KC_PGDN",keys:"pagedown",shortName:"PgDn"},{name:`Num
Lock`,code:"KC_NLCK",keys:"num",shortName:"N.Lck"},{name:"Caps Lock",code:"KC_CAPS",keys:"caps_lock",width:1750},{name:"Enter",code:"KC_ENT",keys:"enter",width:2250},{name:"1",code:"KC_P1",keys:"num_1",title:"Numpad 1"},{name:"2",code:"KC_P2",keys:"num_2",title:"Numpad 2"},{name:"3",code:"KC_P3",keys:"num_3",title:"Numpad 3"},{name:"4",code:"KC_P4",keys:"num_4",title:"Numpad 4"},{name:"5",code:"KC_P5",keys:"num_5",title:"Numpad 5"},{name:"6",code:"KC_P6",keys:"num_6",title:"Numpad 6"},{name:"7",code:"KC_P7",keys:"num_7",title:"Numpad 7"},{name:"8",code:"KC_P8",keys:"num_8",title:"Numpad 8"},{name:"9",code:"KC_P9",keys:"num_9",title:"Numpad 9"},{name:"0",code:"KC_P0",width:2e3,keys:"num_0",title:"Numpad 0"},{name:"÷",code:"KC_PSLS",keys:"num_divide",title:"Numpad ÷"},{name:"×",code:"KC_PAST",keys:"num_multiply",title:"Numpad ×"},{name:"-",code:"KC_PMNS",keys:"num_subtract",title:"Numpad -"},{name:"+",code:"KC_PPLS",keys:"num_add",title:"Numpad +"},{name:".",code:"KC_PDOT",keys:"num_decimal",title:"Numpad ."},{name:`Num
Enter`,code:"KC_PENT",shortName:"N.Ent",title:"Numpad Enter"},{name:"Left Shift",code:"KC_LSFT",keys:"shift",width:2250,shortName:"LShft"},{name:"Right Shift",code:"KC_RSFT",width:2750,shortName:"RShft"},{name:"Left Ctrl",code:"KC_LCTL",keys:"ctrl",width:1250},{name:"Right Ctrl",code:"KC_RCTL",width:1250,shortName:"RCtl"},{name:"Left Win",code:"KC_LGUI",keys:"cmd",width:1250,shortName:"LWin"},{name:"Right Win",code:"KC_RGUI",width:1250,shortName:"RWin"},{name:"Left Alt",code:"KC_LALT",keys:"alt",width:1250,shortName:"LAlt"},{name:"Right Alt",code:"KC_RALT",width:1250,shortName:"RAlt"},{name:"Space",code:"KC_SPC",keys:"space",width:6250},{name:"Menu",code:"KC_APP",width:1250,shortName:"RApp"},{name:"Left",code:"KC_LEFT",keys:"left",shortName:"←"},{name:"Down",code:"KC_DOWN",keys:"down",shortName:"↓"},{name:"Up",code:"KC_UP",keys:"up",shortName:"↑"},{name:"Right",code:"KC_RGHT",keys:"right",shortName:"→"}]},{id:"wt_lighting",label:"Lighting",width:"label",keycodes:[{name:"Bright -",code:"BR_DEC",title:"Brightness -",shortName:"BR -"},{name:"Bright +",code:"BR_INC",title:"Brightness +",shortName:"BR +"},{name:"Effect -",code:"EF_DEC",title:"Effect -",shortName:"EF -"},{name:"Effect +",code:"EF_INC",title:"Effect +",shortName:"EF +"},{name:"Effect Speed -",code:"ES_DEC",title:"Effect Speed -",shortName:"ES -"},{name:"Effect Speed +",code:"ES_INC",title:"Effect Speed +",shortName:"ES +"},{name:"Color1 Hue -",code:"H1_DEC",title:"Color1 Hue -",shortName:"H1 -"},{name:"Color1 Hue +",code:"H1_INC",title:"Color1 Hue +",shortName:"H1 +"},{name:"Color2 Hue -",code:"H2_DEC",title:"Color2 Hue -",shortName:"H2 -"},{name:"Color2 Hue +",code:"H2_INC",title:"Color2 Hue +",shortName:"H2 +"},{name:"Color1 Sat -",code:"S1_DEC",title:"Color1 Sat -",shortName:"S1 -"},{name:"Color1 Sat +",code:"S1_INC",title:"Color1 Sat +",shortName:"S1 +"},{name:"Color2 Sat -",code:"S2_DEC",title:"Color2 Sat -",shortName:"S2 -"},{name:"Color2 Sat +",code:"S2_INC",title:"Color2 Sat +",shortName:"S2 +"}]},{id:"media",label:"Media",width:"label",keycodes:[{name:"Vol -",code:"KC_VOLD",title:"Volume Down"},{name:"Vol +",code:"KC_VOLU",title:"Volume Up"},{name:"Mute",code:"KC_MUTE",title:"Mute Audio"},{name:"Play",code:"KC_MPLY",title:"Play/Pause"},{name:"Media Stop",code:"KC_MSTP",title:"Media Stop"},{name:"Previous",code:"KC_MPRV",title:"Media Previous"},{name:"Next",code:"KC_MNXT",title:"Media Next"},{name:"Rewind",code:"KC_MRWD",title:"Rewind"},{name:"Fast Forward",code:"KC_MFFD",title:"Fast Forward"},{name:"Select",code:"KC_MSEL",title:"Media Select"},{name:"Eject",code:"KC_EJCT",title:"Media Eject"}]},{id:"macro",label:"Macro",width:"label",keycodes:generateMacros(e)},buildLayerMenu(),{id:"special",label:"Special",width:"label",keycodes:[{name:"~",code:"S(KC_GRV)",keys:"`",title:"Shift + `"},{name:"!",code:"S(KC_1)",keys:"!",title:"Shift + 1"},{name:"@",code:"S(KC_2)",keys:"@",title:"Shift + 2"},{name:"#",code:"S(KC_3)",keys:"#",title:"Shift + 3"},{name:"$",code:"S(KC_4)",keys:"$",title:"Shift + 4"},{name:"%",code:"S(KC_5)",keys:"%",title:"Shift + 5"},{name:"^",code:"S(KC_6)",keys:"^",title:"Shift + 6"},{name:"&",code:"S(KC_7)",keys:"&",title:"Shift + 7"},{name:"*",code:"S(KC_8)",keys:"*",title:"Shift + 8"},{name:"(",code:"S(KC_9)",keys:"(",title:"Shift + 9"},{name:")",code:"S(KC_0)",keys:")",title:"Shift + 0"},{name:"_",code:"S(KC_MINS)",keys:"_",title:"Shift + -"},{name:"+",code:"S(KC_EQL)",keys:"+",title:"Shift + ="},{name:"{",code:"S(KC_LBRC)",keys:"{",title:"Shift + ["},{name:"}",code:"S(KC_RBRC)",keys:"}",title:"Shift + ]"},{name:"|",code:"S(KC_BSLS)",keys:"|",title:"Shift + \\"},{name:":",code:"S(KC_SCLN)",keys:":",title:"Shift + /"},{name:'"',code:"S(KC_QUOT)",keys:'"',title:"Shift + '"},{name:"<",code:"S(KC_COMM)",keys:"<",title:"Shift + ,"},{name:">",code:"S(KC_DOT)",keys:">",title:"Shift + ."},{name:"?",code:"S(KC_SLSH)",keys:"?",title:"Shift + /"},{name:"NUHS",code:"KC_NUHS",title:"Non-US # and ~"},{name:"NUBS",code:"KC_NUBS",title:"Non-US \\ and |"},{name:"Ro",code:"KC_RO",title:"JIS \\ and |"},{name:"¥",code:"KC_JYEN",title:"JPN Yen"},{name:"無変換",code:"KC_MHEN",title:"JIS Muhenkan"},{name:"漢字",code:"KC_HANJ",title:"Hanja"},{name:"한영",code:"KC_HAEN",title:"HanYeong"},{name:"変換",code:"KC_HENK",title:"JIS Henkan"},{name:"かな",code:"KC_KANA",title:"JIS Katakana/Hiragana"},{name:"Esc `",code:"KC_GESC",title:"Esc normally, but ` when Shift or Win is pressed"},{name:"LS (",code:"KC_LSPO",title:"Left Shift when held, ( when tapped"},{name:"RS )",code:"KC_RSPC",title:"Right Shift when held, ) when tapped"},{name:"LC (",code:"KC_LCPO",title:"Left Control when held, ( when tapped"},{name:"RC )",code:"KC_RCPC",title:"Right Control when held, ) when tapped"},{name:"LA (",code:"KC_LAPO",title:"Left Alt when held, ( when tapped"},{name:"RA )",code:"KC_RAPC",title:"Right Alt when held, ) when tapped"},{name:"SftEnt",code:"KC_SFTENT",title:"Right Shift when held, Enter when tapped"},{name:"Reset",code:"RESET",title:"Reset the keyboard"},{name:"Debug",code:"DEBUG",title:"Toggle debug mode"},{name:"Toggle NKRO",code:"MAGIC_TOGGLE_NKRO",shortName:"NKRO",title:"Toggle NKRO"},{name:"Locking Num Lock",code:"KC_LNUM"},{name:"Locking Caps Lock",code:"KC_LCAP"},{name:"Locking Scroll Lock",code:"KC_LSCR"},{name:"Power",code:"KC_PWR"},{name:"Power OSX",code:"KC_POWER"},{name:"Sleep",code:"KC_SLEP"},{name:"Wake",code:"KC_WAKE"},{name:"Calc",code:"KC_CALC"},{name:"Mail",code:"KC_MAIL"},{name:"Help",code:"KC_HELP"},{name:"Stop",code:"KC_STOP"},{name:"Alt Erase",code:"KC_ERAS"},{name:"Again",code:"KC_AGAIN"},{name:"Menu",code:"KC_MENU"},{name:"Undo",code:"KC_UNDO"},{name:"Select",code:"KC_SELECT"},{name:"Exec",code:"KC_EXECUTE"},{name:"Cut",code:"KC_CUT"},{name:"Copy",code:"KC_COPY"},{name:"Paste",code:"KC_PASTE"},{name:"Find",code:"KC_FIND"},{name:"My Comp",code:"KC_MYCM"},{name:"Home",code:"KC_WWW_HOME"},{name:"Back",code:"KC_WWW_BACK"},{name:"Forward",code:"KC_WWW_FORWARD"},{name:"Stop",code:"KC_WWW_STOP"},{name:"Refresh",code:"KC_WWW_REFRESH"},{name:"Favorites",code:"KC_WWW_FAVORITES"},{name:"Search",code:"KC_WWW_SEARCH"},{name:"Screen +",code:"KC_BRIU",shortName:"Scr +",title:"Screen Brightness Up"},{name:"Screen -",code:"KC_BRID",shortName:"Scr -",title:"Screen Brightness Down"},{name:"F13",code:"KC_F13"},{name:"F14",code:"KC_F14"},{name:"F15",code:"KC_F15"},{name:"F16",code:"KC_F16"},{name:"F17",code:"KC_F17"},{name:"F18",code:"KC_F18"},{name:"F19",code:"KC_F19"},{name:"F20",code:"KC_F20"},{name:"F21",code:"KC_F21"},{name:"F22",code:"KC_F22"},{name:"F23",code:"KC_F23"},{name:"F24",code:"KC_F24"},{name:"Mouse ↑",code:"KC_MS_UP"},{name:"Mouse ↓",code:"KC_MS_DOWN"},{name:"Mouse ←",code:"KC_MS_LEFT"},{name:"Mouse →",code:"KC_MS_RIGHT"},{name:"Mouse Btn1",code:"KC_MS_BTN1"},{name:"Mouse Btn2",code:"KC_MS_BTN2"},{name:"Mouse Btn3",code:"KC_MS_BTN3"},{name:"Mouse Btn4",code:"KC_MS_BTN4"},{name:"Mouse Btn5",code:"KC_MS_BTN5"},{name:"Mouse Btn6",code:"KC_MS_BTN6"},{name:"Mouse Btn7",code:"KC_MS_BTN7"},{name:"Mouse Btn8",code:"KC_MS_BTN8"},{name:"Mouse Wh ↑",code:"KC_MS_WH_UP"},{name:"Mouse Wh ↓",code:"KC_MS_WH_DOWN"},{name:"Mouse Wh ←",code:"KC_MS_WH_LEFT"},{name:"Mouse Wh →",code:"KC_MS_WH_RIGHT"},{name:"Mouse Acc0",code:"KC_MS_ACCEL0"},{name:"Mouse Acc1",code:"KC_MS_ACCEL1"},{name:"Mouse Acc2",code:"KC_MS_ACCEL2"},{name:"Audio On",code:"AU_ON"},{name:"Audio Off",code:"AU_OFF"},{name:"Audio Toggle",code:"AU_TOG"},{name:"Clicky Toggle",code:"CLICKY_TOGGLE"},{name:"Clicky Enable",code:"CLICKY_ENABLE"},{name:"Clicky Disable",code:"CLICKY_DISABLE"},{name:"Clicky Up",code:"CLICKY_UP"},{name:"Clicky Down",code:"CLICKY_DOWN"},{name:"Clicky Reset",code:"CLICKY_RESET"},{name:"Music On",code:"MU_ON"},{name:"Music Off",code:"MU_OFF"},{name:"Music Toggle",code:"MU_TOG"},{name:"Music Mode",code:"MU_MOD"}]},{id:"qmk_lighting",label:"Lighting",width:"label",keycodes:[{name:"BL Toggle",code:"BL_TOGG"},{name:"BL On",code:"BL_ON"},{name:"BL Off",code:"BL_OFF",shortName:"BL Off"},{name:"BL -",code:"BL_DEC"},{name:"BL +",code:"BL_INC"},{name:"BL Cycle",code:"BL_STEP"},{name:"BR Toggle",code:"BL_BRTG"},{name:"RGB Toggle",code:"RGB_TOG"},{name:"RGB Mode -",code:"RGB_RMOD"},{name:"RGB Mode +",code:"RGB_MOD"},{name:"Hue -",code:"RGB_HUD"},{name:"Hue +",code:"RGB_HUI"},{name:"Sat -",code:"RGB_SAD"},{name:"Sat +",code:"RGB_SAI"},{name:"Bright -",code:"RGB_VAD"},{name:"Bright +",code:"RGB_VAI"},{name:"Effect Speed-",code:"RGB_SPD"},{name:"Effect Speed+",code:"RGB_SPI"},{name:"RGB Mode P",code:"RGB_M_P",title:"Plain"},{name:"RGB Mode B",code:"RGB_M_B",title:"Breathe"},{name:"RGB Mode R",code:"RGB_M_R",title:"Rainbow"},{name:"RGB Mode SW",code:"RGB_M_SW",title:"Swirl"},{name:"RGB Mode SN",code:"RGB_M_SN",title:"Snake"},{name:"RGB Mode K",code:"RGB_M_K",title:"Knight"},{name:"RGB Mode X",code:"RGB_M_X",title:"Xmas"},{name:"RGB Mode G",code:"RGB_M_G",title:"Gradient"}]},{id:"custom",label:"Custom",width:"label",keycodes:[{name:"CUSTOM(0)",code:"CUSTOM(0)",title:"Custom Keycode 0"},{name:"CUSTOM(1)",code:"CUSTOM(1)",title:"Custom Keycode 1"},{name:"CUSTOM(2)",code:"CUSTOM(2)",title:"Custom Keycode 2"},{name:"CUSTOM(3)",code:"CUSTOM(3)",title:"Custom Keycode 3"},{name:"CUSTOM(4)",code:"CUSTOM(4)",title:"Custom Keycode 4"},{name:"CUSTOM(5)",code:"CUSTOM(5)",title:"Custom Keycode 5"},{name:"CUSTOM(6)",code:"CUSTOM(6)",title:"Custom Keycode 6"},{name:"CUSTOM(7)",code:"CUSTOM(7)",title:"Custom Keycode 7"},{name:"CUSTOM(8)",code:"CUSTOM(8)",title:"Custom Keycode 8"},{name:"CUSTOM(9)",code:"CUSTOM(9)",title:"Custom Keycode 9"},{name:"CUSTOM(10)",code:"CUSTOM(10)",title:"Custom Keycode 10"},{name:"CUSTOM(11)",code:"CUSTOM(11)",title:"Custom Keycode 11"},{name:"CUSTOM(12)",code:"CUSTOM(12)",title:"Custom Keycode 12"},{name:"CUSTOM(13)",code:"CUSTOM(13)",title:"Custom Keycode 13"},{name:"CUSTOM(14)",code:"CUSTOM(14)",title:"Custom Keycode 14"},{name:"CUSTOM(15)",code:"CUSTOM(15)",title:"Custom Keycode 15"}]}]}const categoriesForKeycodeModule=e=>({default:["basic","media","macro","layers","special"],[distExports.BuiltInKeycodeModule.WTLighting]:["wt_lighting"],[distExports.BuiltInKeycodeModule.QMKLighting]:["qmk_lighting"]})[e],getKeycodesForKeyboard=e=>{let r=[];if("lighting"in e){const{keycodes:o}=distExports.getLightingDefinition(e.lighting);r=categoriesForKeycodeModule("default").concat(o===distExports.KeycodeType.None?[]:o===distExports.KeycodeType.QMK?categoriesForKeycodeModule(distExports.BuiltInKeycodeModule.QMKLighting):categoriesForKeycodeModule(distExports.BuiltInKeycodeModule.WTLighting))}else{const{keycodes:o}=e;r=o.flatMap(categoriesForKeycodeModule)}return getKeycodes().flatMap(o=>r.includes(o.id)?o.keycodes:[]).sort((o,i)=>o.code<=i.code?-1:1)},getNameForByte=(e,r,o,i)=>{const a=getCustomKeycodeIndex(e,r);if(i!=null&&i[a])return i[a].name;const d=getCodeForByte(e,r,o),l=keycodesList.find(({code:p})=>p===d);return l?l.name:""},CSSVarObject={keyWidth:52,keyXSpacing:2,keyHeight:54,keyYSpacing:2,keyXPos:54,keyYPos:56,faceXPadding:[6,6],faceYPadding:[2,10],insideBorder:10},KeycapMetric={keyWidth:18.1,keyXSpacing:1.05,keyHeight:18.1,keyYSpacing:1.05,keyXPos:19.15,keyYPos:19.15},getComboKeyProps=e=>{if(e.w2===void 0||e.h2===void 0)return{clipPath:null,normalizedRects:null};const{x:r,y:o,x2:i=0,y2:a=0,w:d,w2:l,h:p,h2:m}=e,_=Math.max(e.w,e.w2),C=Math.max(e.h,e.h2),y=Math.min(r,r+i),b=Math.min(o,o+a),[K,v,j,w,L,T,P,k]=d===_?[r+i-y,r-y,o+a-b,o-b,l,d,m,p]:[r-y,r+i-y,o-b,o+a-b,d,l,p,m],G=W=>`polygon(${W.map(X=>`${100*X[0]}% ${100*X[1]}%`).join(",")})`,U=[[v/_,w/C],[K/_,w/C],[K/_,j/C],[(K+L)/_,j/C],[(K+L)/_,w/C],[(v+T)/_,w/C],[(v+T)/_,(w+k)/C],[(K+L)/_,(w+k)/C],[(K+L)/_,(j+P)/C],[K/_,(j+P)/C],[K/_,(w+k)/C],[v/_,(w+k)/C]];return{clipPath:G(U),normalizedRects:[[K,j,L,P],[v,w,T,k]]}};function calculatePointPosition({x:e=0,x2:r=0,y:o=0,r:i=0,rx:a=0,ry:d=0,w:l=0,w2:p=0,h:m=0}){const _=i*(2*Math.PI)/360,C=Math.cos(_),y=Math.sin(_),b=CSSVarObject.keyXPos*a,K=CSSVarObject.keyYPos*d,v=CSSVarObject.keyXPos*(e+r)+Math.max(p,l)*CSSVarObject.keyWidth/2+(Math.max(p,l)-1)*CSSVarObject.keyXSpacing/2,j=CSSVarObject.keyYPos*o+m*CSSVarObject.keyHeight/2+(m-1)*CSSVarObject.keyYSpacing/2,w=v*C-j*y-b*C+K*y+b,L=v*y+j*C-b*y-K*C+K;return[w,L]}const sortByX=(e,r)=>{const o=calculatePointPosition(e),i=calculatePointPosition(r);return o[0]-i[0]},sortByYX=(e,r)=>{const o=calculatePointPosition(e),i=calculatePointPosition(r);return o[1]-i[1]===0?o[0]-i[0]:o[1]-i[1]},withinChain=(e,r)=>{const o=calculatePointPosition(e),i=calculatePointPosition(r);return Math.abs(o[1]-i[1])<CSSVarObject.keyYPos*.9},getTraversalOrder=e=>{const[r,...o]=[...e].sort(sortByYX);if(r===void 0)return o;{const[i,a]=partition([...e],d=>withinChain(r,d));return[...i.sort(sortByX),...getTraversalOrder(a)]}},widthProfiles={1:[1,2,3,4],1.25:[4],1.5:[2,4],1.75:[3,4],2:[1,4],2.25:[3,4],2.75:[4],3:[4],6.25:[4],7:[4]},getRowForKey=(e,r)=>e.h!==1?r:widthProfiles[e.w]?widthProfiles[e.w].includes(r)?r:widthProfiles[e.w][0]:4,getRowProfiles=e=>{switch(!e.some(o=>o.some(i=>i.w!==1||i.h!==1))||e.length){case 8:return[1,1,1,1,2,3,4,4];case 7:return[1,1,1,2,3,4,4];case 6:return[1,1,2,3,4,4];case 5:return[1,2,3,4,4];case 4:return[2,3,4,4];case 3:return[2,3,4];default:return Array(e.length).fill(1)}},getKeyId=e=>`${e.w}-${e.h}-${e.col}-${e.row}-${e.w2}-${e.h2}`,getKeyboardRowPartitions=e=>{const{partitionedKeys:r}=getTraversalOrder(e).reduce(({prevX:i,partitionedKeys:a},d)=>{const[l]=calculatePointPosition(d);return i>=l&&a.push([]),a[a.length-1].push(d),{partitionedKeys:a,prevX:l}},{partitionedKeys:[],prevX:1/0}),o=getRowProfiles(r);return{rowMap:r.reduce((i,a,d)=>a.reduce((l,p)=>({...l,[getKeyId(p)]:getRowForKey(p,o[d])}),i),{}),partitionedKeys:r}},getNextKey=(e,r)=>{const o=r.filter(l=>!l.d),i=r[e],a=getTraversalOrder([...o]),d=a.indexOf(i);return d===a.length-1?null:r.indexOf(a[(d+1)%a.length])},makeSRGBTheme=e=>Object.entries(e).reduce((r,[o,i])=>{const a=`#${new Color(i.c).convertSRGBToLinear().getHexString()}`,d=`#${new Color(i.t).convertSRGBToLinear().getHexString()}`;return{...r,[o]:{c:a,t:d}}},{}),calculateKeyboardFrameDimensions=e=>{const r=e.map(distExports.getBoundingBox),o=Math.min(...r.map(l=>l.xStart)),i=Math.min(...r.map(l=>l.yStart)),a=Math.max(...r.map(l=>l.xEnd))-o,d=Math.max(...r.map(l=>l.yEnd))-i;return{width:a,height:d}},getMeshName=(e,r,o)=>{if(e.ei!==void 0)return"E-100";if(e.h===2&&e.w===1)return`K-R${r}V-200`;if(e.w===1.25&&e.w2===1.5)return"K-R2-ISO";if(e.w===1.5&&e.w2===2.25)return"K-R2-BAE";if(e.h>1)return o?"K-R4C-100":"K-R4-100";switch(e.w){case 1.25:case 1.5:case 1.75:case 1:case 2:case 2.25:case 2.75:return`K-R${r}-${e.w*100}`;case 3:case 6:case 6.25:case 6.5:case 7:return`K-R4C-${e.w*100}`;default:return"K-R4C-100"}switch(e.w){case 1:case 1.25:case 1.5:case 1.75:return`K-R${r}-${e.w*100}`;case 2:case 2.25:case 2.75:case 3:case 6:case 6.25:case 6.5:case 7:return`K-R4C-${e.w*100}`;default:return"K-R4C-100"}},getScale=(e,r)=>{if(e.ei!==void 0)return r;if(e.h===2&&e.w===1)return[1,1,1];if(e.w===1.25&&e.w2===1.5)return[1,1,1];if(e.w===1.5&&e.w2===2.25)return[1,1,1];if(e.h>1)return r;if(e.h==1)switch(e.w){case 1.25:case 1.5:case 1.75:case 2:case 2.25:case 2.75:case 3:case 6:case 6.25:case 6.5:case 7:return[1,1,1];case 1:return[1,1,1];default:return r}return r},getLabelOffsets=(e,r)=>{let o=0,i=0;return e.length==1&&'^*"'.split("").includes(e[0])&&(o=.2),r.length==1&&(",.".split("").includes(r[0])?i=.4:"/\\;'[]".split("").includes(r[0])?i=.3:"-".split("").includes(r[0])&&(i=.1)),[o,i]},getLabel=(e,r,o,i,a,d,l)=>{let p="",m=1,_=[0,0],C="";if(isCustomKeycodeByte(e,a)&&(i!=null&&i.customKeycodes)&&i.customKeycodes[getCustomKeycodeIndex(e,a)]!==void 0){const b=getCustomKeycodeIndex(e,a);p=getShortNameForKeycode(i.customKeycodes[b]),C=getShortNameForKeycode(i.customKeycodes[b],700)}else if(isTapDanceByte(e,a)&&l[getTapDanceIndex(e,a)]!==void 0){const b=getTapDanceIndex(e,a);p=getShortNameForKeycode(l[b]),C=getShortNameForKeycode(l[b],700)}else e&&(p=getLabelForByte(e,r*100,a,d)??"",C=getLabelForByte(e,700,a,d)??"");let y;if(isMacroKeycodeByte(e,a)){const b=getMacroKeycodeIndex(e,a);y=o[b],C=y||""}if(isAlpha(p)||isNumpadNumber(p))return p&&{label:p.toUpperCase(),macroExpression:y,key:(p||"")+(y||""),size:m,offset:_};if(isMultiLegend(p)){const b=p[0],K=p[p.length-1];return K&&{topLabel:b,bottomLabel:K,macroExpression:y,key:(p||"")+(y||""),size:m,offset:getLabelOffsets(b,K)}}else return isNumpadSymbol(p)&&(m=2),isArrowKey(p)&&(m=1.5),{label:p,centerLabel:p,tooltipLabel:C,macroExpression:y,key:(p||"")+(y||""),size:m,offset:_}},updateCSSVariables=e=>{const r=THEMES[e]||THEMES.OLIVIA_DARK;document.documentElement.style.setProperty("--color_accent",r.accent.c),document.documentElement.style.setProperty("--color_inside-accent",r.accent.t)};function getRGBPrime(e,r,o){if(e>=0&&e<60)return[r,o,0];if(e>=60&&e<120)return[o,r,0];if(e>=120&&e<180)return[0,r,o];if(e>=180&&e<240)return[0,o,r];if(e>=240&&e<300)return[o,0,r];if(e>=300&&e<360)return[r,0,o];if(e===360)return[r,o,0];throw new Error("Invalid hue")}const getColorByte=e=>{const r=e.replace("#",""),o=parseInt(r[0],16)*16+parseInt(r[1],16),i=parseInt(r[2],16)*16+parseInt(r[3],16),a=parseInt(r[4],16)*16+parseInt(r[5],16);return[o,i,a]},getDarkenedColor=(e,r=.8)=>{const[o,i,a]=getColorByte(e),d=Math.round(o*r).toString(16),l=Math.round(i*r).toString(16),p=Math.round(a*r).toString(16);return`#${d.padStart(2,"0")}${l.padStart(2,"0")}${p.padStart(2,"0")}`},get256HSV=e=>{const[r,o,i]=getHSV(e);return[Math.round(255*r/360),Math.round(255*o),Math.round(255*i)]},getHSV=e=>{const[r,o,i]=(typeof e=="string"?getColorByte(e):e).map(C=>C/255),[a,d]=[Math.max(r,o,i),Math.min(r,o,i)],l=a-d;let p=60,m=0,_=a;return l===0?p=p*0:a===r?p=p*((o-i)/l%6):a===o?p=p*((i-r)/l+2):a===i&&(p=p*((r-o)/l+4)),a!==0&&(m=l/a),[(p+360)%360,m,_]},getHSVFrom256=e=>[Math.round(360*e[0]/255),Math.round(e[1]/255),1];function getRGB({hue:e,sat:r}){r=r/255,e=Math.round(360*e)/255;const o=r,i=o*(1-Math.abs(e/60%2-1)),a=1-o,[d,l,p]=getRGBPrime(e,o,i).map(m=>Math.round(255*(a+m)));return`rgba(${d},${l},${p},1)`}function toDegrees(e){return e*(180/Math.PI)}function calcRadialHue(e,r){if(e<200&&r<200){const o=200-e,i=200-r;return 2*Math.PI-Math.atan(o/i)}else if(e>200&&r<200){const o=e-200,i=200-r;return Math.atan(o/i)}else if(e<200&&r>200){const o=200-e,i=r-200;return Math.PI+Math.atan(o/i)}else if(e>200&&r>200){const o=e-200,i=r-200;return .5*Math.PI+Math.atan(i/o)}else{if(e===200)return r>200?Math.PI:0;if(r===200)return e>=200?.5*Math.PI:1.5*Math.PI}}function calcRadialMagnitude(e,r){if(e<200&&r<200){const o=200-e,i=200-r;return Math.sqrt(o*o+i*i)/200}else if(e>200&&r<200){const o=e-200,i=200-r;return Math.sqrt(o*o+i*i)/200}else if(e<200&&r>200){const o=200-e,i=r-200;return Math.sqrt(o*o+i*i)/200}else if(e>200&&r>200){const o=e-200,i=r-200;return Math.sqrt(o*o+i*i)/200}else{if(e===200)return r>200?(r-200)/200:(200-r)/200;if(r===200)return e>200?(e-200)/200:(200-e)/200}}function hsToRgb({hue:e,sat:r}){r=r/255,e=Math.round(360*e)/255;const o=r,i=o*(1-Math.abs(e/60%2-1)),a=1-o,[d,l,p]=getRGBPrime(e,o,i).map(m=>Math.round(255*(a+m)));return[d,l,p]}function getHex({hue:e,sat:r}){let[o,i,a]=hsToRgb({hue:e,sat:r}).map(d=>d.toString(16));return o.length==1&&(o="0"+o),i.length==1&&(i="0"+i),a.length==1&&(a="0"+a),"#"+o+i+a}function isWebGLAvailable(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}const webGLIsAvailable=isWebGLAvailable(),initialState$b={...getSettings(),isTestMatrixEnabled:!1,restartRequired:!1,allowGlobalHotKeys:!1},toggleBool=(e,r)=>{e[r]=!e[r],setSettings(e)},settingsSlice=createSlice({name:"settings",initialState:initialState$b,reducers:{toggleFastRemap:e=>{toggleBool(e,"disableFastRemap")},toggleCreatorMode:e=>{toggleBool(e,"showDesignTab")},toggleThemeMode:e=>{const r=e.themeMode==="light"?"dark":"light";document.documentElement.dataset.themeMode=r,e.themeMode=r,setSettings(e)},updateRenderMode:(e,r)=>{e.renderMode=r.payload,setSettings(e)},updateDesignDefinitionVersion:(e,r)=>{e.designDefinitionVersion=r.payload,setSettings(e)},updateThemeName:(e,r)=>{e.themeName=r.payload,updateCSSVariables(e.themeName),setSettings(e)},setTestMatrixEnabled:(e,r)=>{e.isTestMatrixEnabled=r.payload},setMacroEditorSettings:(e,r)=>{const o={...e.macroEditor,...r.payload};e.macroEditor=o,setSettings(e)},setTestKeyboardSoundsSettings:(e,r)=>{const o={...e.testKeyboardSoundsSettings,...r.payload};e.testKeyboardSoundsSettings=o,setSettings(e)},disableGlobalHotKeys:e=>{e.allowGlobalHotKeys=!1},enableGlobalHotKeys:e=>{e.allowGlobalHotKeys=!0}}}),{toggleFastRemap,toggleCreatorMode,setTestMatrixEnabled,setTestKeyboardSoundsSettings,setMacroEditorSettings,toggleThemeMode,disableGlobalHotKeys,enableGlobalHotKeys,updateRenderMode,updateThemeName,updateDesignDefinitionVersion}=settingsSlice.actions,settingsReducer=settingsSlice.reducer,getDesignDefinitionVersion=e=>e.settings.designDefinitionVersion,getDisableFastRemap=e=>e.settings.disableFastRemap,getShowDesignTab=e=>e.settings.showDesignTab,getIsTestMatrixEnabled=e=>e.settings.isTestMatrixEnabled,getMacroEditorSettings=e=>e.settings.macroEditor,getTestKeyboardSoundsSettings=e=>e.settings.testKeyboardSoundsSettings,getRenderMode=e=>webGLIsAvailable?e.settings.renderMode:"2D",getThemeMode=e=>e.settings.themeMode,getThemeName=e=>e.settings.themeName,getSelectedTheme=createSelector(getThemeName,e=>THEMES[e]),getSelectedSRGBTheme=createSelector(getSelectedTheme,e=>makeSRGBTheme(e)),basicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:24576,_QK_MOD_TAP_MAX:32767,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:22784,_QK_LAYER_MOD_MAX:23039,_QK_TO:20496,_QK_TO_MAX:20511,_QK_MOMENTARY:20736,_QK_MOMENTARY_MAX:20767,_QK_DEF_LAYER:20992,_QK_DEF_LAYER_MAX:21023,_QK_TOGGLE_LAYER:21248,_QK_TOGGLE_LAYER_MAX:21279,_QK_ONE_SHOT_LAYER:21504,_QK_ONE_SHOT_LAYER_MAX:21535,_QK_ONE_SHOT_MOD:21760,_QK_ONE_SHOT_MOD_MAX:22015,_QK_LAYER_TAP_TOGGLE:22528,_QK_LAYER_TAP_TOGGLE_MAX:22559,_QK_LAYER_MOD_MASK:15,_QK_MACRO:24338,_QK_MACRO_MAX:24353,_QK_KB:24448,_QK_KB_MAX:24463,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,KC_MS_UP:240,KC_MS_DOWN:241,KC_MS_LEFT:242,KC_MS_RIGHT:243,KC_MS_BTN1:244,KC_MS_BTN2:245,KC_MS_BTN3:246,KC_MS_BTN4:247,KC_MS_BTN5:248,KC_MS_WH_UP:249,KC_MS_WH_DOWN:250,KC_MS_WH_LEFT:251,KC_MS_WH_RIGHT:252,KC_MS_ACCEL0:253,KC_MS_ACCEL1:254,KC_MS_ACCEL2:255,RESET:23552,DEBUG:23553,MAGIC_TOGGLE_NKRO:23572,KC_GESC:23574,AU_ON:23581,AU_OFF:23582,AU_TOG:23583,CLICKY_TOGGLE:23584,CLICKY_ENABLE:23585,CLICKY_DISABLE:23586,CLICKY_UP:23587,CLICKY_DOWN:23588,CLICKY_RESET:23589,MU_ON:23590,MU_OFF:23591,MU_TOG:23592,MU_MOD:23593,BL_ON:23739,BL_OFF:23740,BL_DEC:23741,BL_INC:23742,BL_TOGG:23743,BL_STEP:23744,BL_BRTG:23745,RGB_TOG:23746,RGB_MOD:23747,RGB_RMOD:23748,RGB_HUI:23749,RGB_HUD:23750,RGB_SAI:23751,RGB_SAD:23752,RGB_VAI:23753,RGB_VAD:23754,RGB_SPI:23755,RGB_SPD:23756,RGB_M_P:23757,RGB_M_B:23758,RGB_M_R:23759,RGB_M_SW:23760,RGB_M_SN:23761,RGB_M_K:23762,RGB_M_X:23763,RGB_M_G:23764,KC_LSPO:23767,KC_RSPC:23768,KC_SFTENT:23769,KC_LCPO:23795,KC_RCPC:23796,KC_LAPO:23797,KC_RAPC:23798,BR_INC:24320,BR_DEC:24321,EF_INC:24322,EF_DEC:24323,ES_INC:24324,ES_DEC:24325,H1_INC:24326,H1_DEC:24327,S1_INC:24328,S1_DEC:24329,H2_INC:24330,H2_DEC:24331,S2_INC:24332,S2_DEC:24333,FN_MO13:24336,FN_MO23:24337},v10BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:24576,_QK_MOD_TAP_MAX:32767,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:22784,_QK_LAYER_MOD_MAX:23039,_QK_TO:20480,_QK_TO_MAX:20511,_QK_MOMENTARY:20736,_QK_MOMENTARY_MAX:20767,_QK_DEF_LAYER:20992,_QK_DEF_LAYER_MAX:21023,_QK_TOGGLE_LAYER:21248,_QK_TOGGLE_LAYER_MAX:21279,_QK_ONE_SHOT_LAYER:21504,_QK_ONE_SHOT_LAYER_MAX:21535,_QK_ONE_SHOT_MOD:21760,_QK_ONE_SHOT_MOD_MAX:22015,_QK_LAYER_TAP_TOGGLE:22528,_QK_LAYER_TAP_TOGGLE_MAX:22559,_QK_LAYER_MOD_MASK:15,_QK_MACRO:24338,_QK_MACRO_MAX:24353,_QK_KB:24448,_QK_KB_MAX:24463,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,KC_MS_UP:240,KC_MS_DOWN:241,KC_MS_LEFT:242,KC_MS_RIGHT:243,KC_MS_BTN1:244,KC_MS_BTN2:245,KC_MS_BTN3:246,KC_MS_BTN4:247,KC_MS_BTN5:248,KC_MS_WH_UP:249,KC_MS_WH_DOWN:250,KC_MS_WH_LEFT:251,KC_MS_WH_RIGHT:252,KC_MS_ACCEL0:253,KC_MS_ACCEL1:254,KC_MS_ACCEL2:255,RESET:23552,DEBUG:23553,MAGIC_TOGGLE_NKRO:23572,KC_GESC:23574,AU_ON:23581,AU_OFF:23582,AU_TOG:23583,CLICKY_TOGGLE:23584,CLICKY_ENABLE:23585,CLICKY_DISABLE:23586,CLICKY_UP:23587,CLICKY_DOWN:23588,CLICKY_RESET:23589,MU_ON:23590,MU_OFF:23591,MU_TOG:23592,MU_MOD:23593,BL_ON:23739,BL_OFF:23740,BL_DEC:23741,BL_INC:23742,BL_TOGG:23743,BL_STEP:23744,BL_BRTG:23745,RGB_TOG:23746,RGB_MOD:23747,RGB_RMOD:23748,RGB_HUI:23749,RGB_HUD:23750,RGB_SAI:23751,RGB_SAD:23752,RGB_VAI:23753,RGB_VAD:23754,RGB_SPI:23755,RGB_SPD:23756,RGB_M_P:23757,RGB_M_B:23758,RGB_M_R:23759,RGB_M_SW:23760,RGB_M_SN:23761,RGB_M_K:23762,RGB_M_X:23763,RGB_M_G:23764,KC_LSPO:23767,KC_RSPC:23768,KC_SFTENT:23769,KC_LCPO:23795,KC_RCPC:23796,KC_LAPO:23797,KC_RAPC:23798,BR_INC:24320,BR_DEC:24321,EF_INC:24322,EF_DEC:24323,ES_INC:24324,ES_DEC:24325,H1_INC:24326,H1_DEC:24327,S1_INC:24328,S1_DEC:24329,H2_INC:24330,H2_DEC:24331,S2_INC:24332,S2_DEC:24333,FN_MO13:24336,FN_MO23:24337},v11BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:8192,_QK_MOD_TAP_MAX:16383,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:20480,_QK_LAYER_MOD_MAX:20991,_QK_TO:20992,_QK_TO_MAX:21023,_QK_MOMENTARY:21024,_QK_MOMENTARY_MAX:21055,_QK_DEF_LAYER:21056,_QK_DEF_LAYER_MAX:21087,_QK_TOGGLE_LAYER:21088,_QK_TOGGLE_LAYER_MAX:21119,_QK_ONE_SHOT_LAYER:21120,_QK_ONE_SHOT_LAYER_MAX:21151,_QK_ONE_SHOT_MOD:21152,_QK_ONE_SHOT_MOD_MAX:21183,_QK_LAYER_TAP_TOGGLE:21184,_QK_LAYER_TAP_TOGGLE_MAX:21215,_QK_LAYER_MOD_MASK:31,_QK_MACRO:30466,_QK_MACRO_MAX:30481,_QK_KB:32512,_QK_KB_MAX:32767,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_MS_UP:205,KC_MS_DOWN:206,KC_MS_LEFT:207,KC_MS_RIGHT:208,KC_MS_BTN1:209,KC_MS_BTN2:210,KC_MS_BTN3:211,KC_MS_BTN4:212,KC_MS_BTN5:213,KC_MS_BTN6:214,KC_MS_BTN7:215,KC_MS_BTN8:216,KC_MS_WH_UP:217,KC_MS_WH_DOWN:218,KC_MS_WH_LEFT:219,KC_MS_WH_RIGHT:220,KC_MS_ACCEL0:221,KC_MS_ACCEL1:222,KC_MS_ACCEL2:223,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,RESET:31744,DEBUG:31746,MAGIC_TOGGLE_NKRO:28691,KC_GESC:31766,KC_ASUP:31761,KC_ASDN:31760,KC_ASRP:31762,KC_ASTG:31765,KC_ASON:31763,KC_ASOFF:31764,AU_ON:29824,AU_OFF:29825,AU_TOG:29826,CLICKY_TOGGLE:29834,CLICKY_ENABLE:29835,CLICKY_DISABLE:29836,CLICKY_UP:29837,CLICKY_DOWN:29838,CLICKY_RESET:29839,MU_ON:29840,MU_OFF:29841,MU_TOG:29842,MU_MOD:29843,MI_ON:28928,MI_OFF:28929,MI_TOG:28930,MI_C:28944,MI_Cs:28945,MI_D:28946,MI_Ds:28947,MI_E:28948,MI_F:28949,MI_Fs:28950,MI_G:28951,MI_Gs:28952,MI_A:28953,MI_As:28954,MI_B:28955,MI_C_1:28960,MI_Cs_1:28961,MI_D_1:28962,MI_Ds_1:28963,MI_E_1:28964,MI_F_1:28965,MI_Fs_1:28966,MI_G_1:28967,MI_Gs_1:28968,MI_A_1:28969,MI_As_1:28970,MI_B_1:28971,MI_C_2:28976,MI_Cs_2:28977,MI_D_2:28978,MI_Ds_2:28979,MI_E_2:28980,MI_F_2:28981,MI_Fs_2:28982,MI_G_2:28983,MI_Gs_2:28984,MI_A_2:28985,MI_As_2:28986,MI_B_2:28987,MI_C_3:28992,MI_Cs_3:28993,MI_D_3:28994,MI_Ds_3:28995,MI_E_3:28996,MI_F_3:28997,MI_Fs_3:28998,MI_G_3:28999,MI_Gs_3:29e3,MI_A_3:29001,MI_As_3:29002,MI_B_3:29003,MI_C_4:29008,MI_Cs_4:29009,MI_D_4:29010,MI_Ds_4:29011,MI_E_4:29012,MI_F_4:29013,MI_Fs_4:29014,MI_G_4:29015,MI_Gs_4:29016,MI_A_4:29017,MI_As_4:29018,MI_B_4:29019,MI_C_5:29024,MI_Cs_5:29025,MI_D_5:29026,MI_Ds_5:29027,MI_E_5:29028,MI_F_5:29029,MI_Fs_5:29030,MI_G_5:29031,MI_Gs_5:29032,MI_A_5:29033,MI_As_5:29034,MI_B_5:29035,MI_OCT_N2:29040,MI_OCT_N1:29041,MI_OCT_0:29042,MI_OCT_1:29043,MI_OCT_2:29044,MI_OCT_3:29045,MI_OCT_4:29046,MI_OCT_5:29047,MI_OCT_6:29048,MI_OCT_7:29049,MI_OCTD:29050,MI_OCTU:29051,MI_TRNS_N6:29056,MI_TRNS_N5:29057,MI_TRNS_N4:29058,MI_TRNS_N3:29059,MI_TRNS_N2:29060,MI_TRNS_N1:29061,MI_TRNS_0:29062,MI_TRNS_1:29063,MI_TRNS_2:29064,MI_TRNS_3:29065,MI_TRNS_4:29066,MI_TRNS_5:29067,MI_TRNS_6:29068,MI_TRNSD:29069,MI_TRNSU:29070,MI_VEL_0:29072,MI_VEL_1:29073,MI_VEL_2:29074,MI_VEL_3:29075,MI_VEL_4:29076,MI_VEL_5:29077,MI_VEL_6:29078,MI_VEL_7:29079,MI_VEL_8:29080,MI_VEL_9:29081,MI_VEL_10:29082,MI_VELD:29083,MI_VELU:29084,MI_CH1:29088,MI_CH2:29089,MI_CH3:29090,MI_CH4:29091,MI_CH5:29092,MI_CH6:29093,MI_CH7:29094,MI_CH8:29095,MI_CH9:29096,MI_CH10:29097,MI_CH11:29098,MI_CH12:29099,MI_CH13:29100,MI_CH14:29101,MI_CH15:29102,MI_CH16:29103,MI_CHD:29104,MI_CHU:29105,MI_ALLOFF:29120,MI_SUST:29121,MI_PORT:29122,MI_SOST:29123,MI_SOFT:29124,MI_LEG:29125,MI_MOD:29126,MI_MODSD:29127,MI_MODSU:29128,MI_BENDD:29129,MI_BENDU:29130,BL_ON:30720,BL_OFF:30721,BL_DEC:30723,BL_INC:30724,BL_TOGG:30722,BL_STEP:30725,BL_BRTG:30726,RGB_TOG:30752,RGB_MOD:30753,RGB_RMOD:30754,RGB_HUI:30755,RGB_HUD:30756,RGB_SAI:30757,RGB_SAD:30758,RGB_VAI:30759,RGB_VAD:30760,RGB_SPI:30761,RGB_SPD:30762,RGB_M_P:30763,RGB_M_B:30764,RGB_M_R:30765,RGB_M_SW:30766,RGB_M_SN:30767,RGB_M_K:30768,RGB_M_X:30769,RGB_M_G:30770,RGB_MODE_RGBTEST:30771,VLK_TOG:31767,KC_LSPO:31770,KC_RSPC:31771,KC_SFTENT:31774,OUT_AUTO:31776,OUT_USB:31777,QK_CLEAR_EEPROM:31747,HPT_ON:31808,HPT_OFF:31809,HPT_TOG:31810,HPT_RST:31811,HPT_FBK:31812,HPT_BUZ:31813,HPT_MODI:31814,HPT_MODD:31815,HPT_CONT:31816,HPT_CONI:31817,HPT_COND:31818,HPT_DWLI:31819,HPT_DWLD:31820,KC_LCPO:31768,KC_RCPC:31769,KC_LAPO:31772,KC_RAPC:31773,CMB_ON:31824,CMB_OFF:31825,CMB_TOG:31826,MAGIC_SWAP_LCTL_LGUI:28695,MAGIC_SWAP_RCTL_RGUI:28697,MAGIC_UNSWAP_LCTL_LGUI:28696,MAGIC_UNSWAP_RCTL_RGUI:28698,MAGIC_SWAP_CTL_GUI:28699,MAGIC_UNSWAP_CTL_GUI:28700,MAGIC_TOGGLE_CTL_GUI:28701,MAGIC_EE_HANDS_LEFT:28702,MAGIC_EE_HANDS_RIGHT:28703,DYN_REC_START1:31827,DYN_REC_START2:31828,DYN_REC_STOP:31829,DYN_MACRO_PLAY1:31830,DYN_MACRO_PLAY2:31831,FN_MO13:30464,FN_MO23:30465},v12BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:8192,_QK_MOD_TAP_MAX:16383,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:20480,_QK_LAYER_MOD_MAX:20991,_QK_TO:20992,_QK_TO_MAX:21023,_QK_MOMENTARY:21024,_QK_MOMENTARY_MAX:21055,_QK_DEF_LAYER:21056,_QK_DEF_LAYER_MAX:21087,_QK_TOGGLE_LAYER:21088,_QK_TOGGLE_LAYER_MAX:21119,_QK_ONE_SHOT_LAYER:21120,_QK_ONE_SHOT_LAYER_MAX:21151,_QK_ONE_SHOT_MOD:21152,_QK_ONE_SHOT_MOD_MAX:21183,_QK_LAYER_TAP_TOGGLE:21184,_QK_LAYER_TAP_TOGGLE_MAX:21215,_QK_LAYER_MOD_MASK:31,_QK_TAP_DANCE:22272,_QK_TAP_DANCE_MAX:22527,_QK_MACRO:30464,_QK_MACRO_MAX:30591,_QK_KB:32256,_QK_KB_MAX:32511,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_MS_UP:205,KC_MS_DOWN:206,KC_MS_LEFT:207,KC_MS_RIGHT:208,KC_MS_BTN1:209,KC_MS_BTN2:210,KC_MS_BTN3:211,KC_MS_BTN4:212,KC_MS_BTN5:213,KC_MS_BTN6:214,KC_MS_BTN7:215,KC_MS_BTN8:216,KC_MS_WH_UP:217,KC_MS_WH_DOWN:218,KC_MS_WH_LEFT:219,KC_MS_WH_RIGHT:220,KC_MS_ACCEL0:221,KC_MS_ACCEL1:222,KC_MS_ACCEL2:223,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,RESET:31744,DEBUG:31746,MAGIC_TOGGLE_NKRO:28691,KC_GESC:31766,KC_ASUP:31761,KC_ASDN:31760,KC_ASRP:31762,KC_ASTG:31765,KC_ASON:31763,KC_ASOFF:31764,AU_ON:29824,AU_OFF:29825,AU_TOG:29826,CLICKY_TOGGLE:29834,CLICKY_ENABLE:29835,CLICKY_DISABLE:29836,CLICKY_UP:29837,CLICKY_DOWN:29838,CLICKY_RESET:29839,MU_ON:29840,MU_OFF:29841,MU_TOG:29842,MU_MOD:29843,MI_ON:28928,MI_OFF:28929,MI_TOG:28930,MI_C:28944,MI_Cs:28945,MI_D:28946,MI_Ds:28947,MI_E:28948,MI_F:28949,MI_Fs:28950,MI_G:28951,MI_Gs:28952,MI_A:28953,MI_As:28954,MI_B:28955,MI_C_1:28960,MI_Cs_1:28961,MI_D_1:28962,MI_Ds_1:28963,MI_E_1:28964,MI_F_1:28965,MI_Fs_1:28966,MI_G_1:28967,MI_Gs_1:28968,MI_A_1:28969,MI_As_1:28970,MI_B_1:28971,MI_C_2:28976,MI_Cs_2:28977,MI_D_2:28978,MI_Ds_2:28979,MI_E_2:28980,MI_F_2:28981,MI_Fs_2:28982,MI_G_2:28983,MI_Gs_2:28984,MI_A_2:28985,MI_As_2:28986,MI_B_2:28987,MI_C_3:28992,MI_Cs_3:28993,MI_D_3:28994,MI_Ds_3:28995,MI_E_3:28996,MI_F_3:28997,MI_Fs_3:28998,MI_G_3:28999,MI_Gs_3:29e3,MI_A_3:29001,MI_As_3:29002,MI_B_3:29003,MI_C_4:29008,MI_Cs_4:29009,MI_D_4:29010,MI_Ds_4:29011,MI_E_4:29012,MI_F_4:29013,MI_Fs_4:29014,MI_G_4:29015,MI_Gs_4:29016,MI_A_4:29017,MI_As_4:29018,MI_B_4:29019,MI_C_5:29024,MI_Cs_5:29025,MI_D_5:29026,MI_Ds_5:29027,MI_E_5:29028,MI_F_5:29029,MI_Fs_5:29030,MI_G_5:29031,MI_Gs_5:29032,MI_A_5:29033,MI_As_5:29034,MI_B_5:29035,MI_OCT_N2:29040,MI_OCT_N1:29041,MI_OCT_0:29042,MI_OCT_1:29043,MI_OCT_2:29044,MI_OCT_3:29045,MI_OCT_4:29046,MI_OCT_5:29047,MI_OCT_6:29048,MI_OCT_7:29049,MI_OCTD:29050,MI_OCTU:29051,MI_TRNS_N6:29056,MI_TRNS_N5:29057,MI_TRNS_N4:29058,MI_TRNS_N3:29059,MI_TRNS_N2:29060,MI_TRNS_N1:29061,MI_TRNS_0:29062,MI_TRNS_1:29063,MI_TRNS_2:29064,MI_TRNS_3:29065,MI_TRNS_4:29066,MI_TRNS_5:29067,MI_TRNS_6:29068,MI_TRNSD:29069,MI_TRNSU:29070,MI_VEL_0:29072,MI_VEL_1:29073,MI_VEL_2:29074,MI_VEL_3:29075,MI_VEL_4:29076,MI_VEL_5:29077,MI_VEL_6:29078,MI_VEL_7:29079,MI_VEL_8:29080,MI_VEL_9:29081,MI_VEL_10:29082,MI_VELD:29083,MI_VELU:29084,MI_CH1:29088,MI_CH2:29089,MI_CH3:29090,MI_CH4:29091,MI_CH5:29092,MI_CH6:29093,MI_CH7:29094,MI_CH8:29095,MI_CH9:29096,MI_CH10:29097,MI_CH11:29098,MI_CH12:29099,MI_CH13:29100,MI_CH14:29101,MI_CH15:29102,MI_CH16:29103,MI_CHD:29104,MI_CHU:29105,MI_ALLOFF:29120,MI_SUST:29121,MI_PORT:29122,MI_SOST:29123,MI_SOFT:29124,MI_LEG:29125,MI_MOD:29126,MI_MODSD:29127,MI_MODSU:29128,MI_BENDD:29129,MI_BENDU:29130,BL_ON:30720,BL_OFF:30721,BL_DEC:30723,BL_INC:30724,BL_TOGG:30722,BL_STEP:30725,BL_BRTG:30726,RGB_TOG:30752,RGB_MOD:30753,RGB_RMOD:30754,RGB_HUI:30755,RGB_HUD:30756,RGB_SAI:30757,RGB_SAD:30758,RGB_VAI:30759,RGB_VAD:30760,RGB_SPI:30761,RGB_SPD:30762,RGB_M_P:30763,RGB_M_B:30764,RGB_M_R:30765,RGB_M_SW:30766,RGB_M_SN:30767,RGB_M_K:30768,RGB_M_X:30769,RGB_M_G:30770,RGB_MODE_RGBTEST:30771,VLK_TOG:31767,KC_LSPO:31770,KC_RSPC:31771,KC_SFTENT:31774,OUT_AUTO:31776,OUT_USB:31777,QK_CLEAR_EEPROM:31747,HPT_ON:31808,HPT_OFF:31809,HPT_TOG:31810,HPT_RST:31811,HPT_FBK:31812,HPT_BUZ:31813,HPT_MODI:31814,HPT_MODD:31815,HPT_CONT:31816,HPT_CONI:31817,HPT_COND:31818,HPT_DWLI:31819,HPT_DWLD:31820,KC_LCPO:31768,KC_RCPC:31769,KC_LAPO:31772,KC_RAPC:31773,CMB_ON:31824,CMB_OFF:31825,CMB_TOG:31826,MAGIC_SWAP_LCTL_LGUI:28695,MAGIC_SWAP_RCTL_RGUI:28697,MAGIC_UNSWAP_LCTL_LGUI:28696,MAGIC_UNSWAP_RCTL_RGUI:28698,MAGIC_SWAP_CTL_GUI:28699,MAGIC_UNSWAP_CTL_GUI:28700,MAGIC_TOGGLE_CTL_GUI:28701,MAGIC_EE_HANDS_LEFT:28702,MAGIC_EE_HANDS_RIGHT:28703,DYN_REC_START1:31827,DYN_REC_START2:31828,DYN_REC_STOP:31829,DYN_MACRO_PLAY1:31830,DYN_MACRO_PLAY2:31831,FN_MO13:31863,FN_MO23:31864};function getBasicKeyDict(e){switch(e){case 13:case 12:return v12BasicKeyToByte;case 11:return v11BasicKeyToByte;case 10:return v10BasicKeyToByte;default:return basicKeyToByte}}const autocompleteKeycodes={KC_NO:!0,KC_A:!0,KC_B:!0,KC_C:!0,KC_D:!0,KC_E:!0,KC_F:!0,KC_G:!0,KC_H:!0,KC_I:!0,KC_J:!0,KC_K:!0,KC_L:!0,KC_M:!0,KC_N:!0,KC_O:!0,KC_P:!0,KC_Q:!0,KC_R:!0,KC_S:!0,KC_T:!0,KC_U:!0,KC_V:!0,KC_W:!0,KC_X:!0,KC_Y:!0,KC_Z:!0,KC_1:!0,KC_2:!0,KC_3:!0,KC_4:!0,KC_5:!0,KC_6:!0,KC_7:!0,KC_8:!0,KC_9:!0,KC_0:!0,KC_ENT:!0,KC_ESC:!0,KC_BSPC:!0,KC_TAB:!0,KC_SPC:!0,KC_MINS:!0,KC_EQL:!0,KC_LBRC:!0,KC_RBRC:!0,KC_BSLS:!0,KC_NUHS:!0,KC_SCLN:!0,KC_QUOT:!0,KC_GRV:!0,KC_COMM:!0,KC_DOT:!0,KC_SLSH:!0,KC_CAPS:!0,KC_F1:!0,KC_F2:!0,KC_F3:!0,KC_F4:!0,KC_F5:!0,KC_F6:!0,KC_F7:!0,KC_F8:!0,KC_F9:!0,KC_F10:!0,KC_F11:!0,KC_F12:!0,KC_PSCR:!0,KC_SLCK:!0,KC_PAUS:!0,KC_INS:!0,KC_HOME:!0,KC_PGUP:!0,KC_DEL:!0,KC_END:!0,KC_PGDN:!0,KC_RGHT:!0,KC_LEFT:!0,KC_DOWN:!0,KC_UP:!0,KC_NLCK:!0,KC_PSLS:!0,KC_KP_ASTERISK:!0,KC_PAST:!0,KC_PPLS:!0,KC_PMNS:!0,KC_PENT:!0,KC_P1:!0,KC_P2:!0,KC_P3:!0,KC_P4:!0,KC_P5:!0,KC_P6:!0,KC_P7:!0,KC_P8:!0,KC_P9:!0,KC_P0:!0,KC_PDOT:!0,KC_NUBS:!0,KC_APP:!0,KC_POWER:!0,KC_PEQL:!0,KC_F13:!0,KC_F14:!0,KC_F15:!0,KC_F16:!0,KC_F17:!0,KC_F18:!0,KC_F19:!0,KC_F20:!0,KC_F21:!0,KC_F22:!0,KC_F23:!0,KC_F24:!0,KC_EXECUTE:!0,KC_HELP:!0,KC_MENU:!0,KC_SELECT:!0,KC_STOP:!0,KC_AGAIN:!0,KC_UNDO:!0,KC_CUT:!0,KC_COPY:!0,KC_PASTE:!0,KC_FIND:!0,KC_LCAP:!0,KC_LNUM:!0,KC_LSCR:!0,KC_PCMM:!0,KC_KP_EQUAL_AS400:!0,KC_RO:!0,KC_KANA:!0,KC_JYEN:!0,KC_HENK:!0,KC_MHEN:!0,KC_INT6:!0,KC_INT7:!0,KC_INT8:!0,KC_INT9:!0,KC_HAEN:!0,KC_HANJ:!0,KC_LANG3:!0,KC_LANG4:!0,KC_LANG5:!0,KC_LANG6:!0,KC_LANG7:!0,KC_LANG8:!0,KC_LANG9:!0,KC_SYSREQ:!0,KC_CANCEL:!0,KC_CLEAR:!0,KC_PRIOR:!0,KC_OUT:!0,KC_OPER:!0,KC_CLEAR_AGAIN:!0,KC_CRSEL:!0,KC_EXSEL:!0,KC_LCTL:!0,KC_LSFT:!0,KC_LALT:!0,KC_LGUI:!0,KC_RCTL:!0,KC_RSFT:!0,KC_RALT:!0,KC_RGUI:!0,KC_PWR:!0,KC_SLEP:!0,KC_WAKE:!0,KC_MUTE:!0,KC_VOLU:!0,KC_VOLD:!0,KC_MNXT:!0,KC_MPRV:!0,KC_MSTP:!0,KC_MPLY:!0,KC_MSEL:!0,KC_EJCT:!0,KC_MAIL:!0,KC_CALC:!0,KC_MYCM:!0,KC_WWW_SEARCH:!0,KC_WWW_HOME:!0,KC_WWW_BACK:!0,KC_WWW_FORWARD:!0,KC_WWW_STOP:!0,KC_WWW_REFRESH:!0,KC_WWW_FAVORITES:!0,KC_MFFD:!0,KC_MRWD:!0},getAutocompleteKeycodes=()=>keycodesList.filter(e=>!!autocompleteKeycodes[e.code]);function isAutocompleteKeycode(e){const r=e.toUpperCase();return!!autocompleteKeycodes[r]}var RawKeycodeSequenceAction=(e=>(e[e.Tap=1]="Tap",e[e.Down=2]="Down",e[e.Up=3]="Up",e[e.Delay=4]="Delay",e[e.CharacterStream=5]="CharacterStream",e))(RawKeycodeSequenceAction||{}),GroupedKeycodeSequenceAction=(e=>(e[e.Chord=6]="Chord",e))(GroupedKeycodeSequenceAction||{}),KeyAction=(e=>(e[e.Tap=1]="Tap",e[e.Down=2]="Down",e[e.Up=3]="Up",e[e.Delay=4]="Delay",e))(KeyAction||{});const KeyActionPrefix=1,DelayTerminator=124,MacroTerminator=0;function splitExpression(expression){let regex;try{return regex=eval("/(?<!\\\\)({.*?})/g"),expression.split(regex).filter(e=>e.length)}catch(e){return console.error("Lookbehind is not supported in this browser."),[]}}function optimizedSequenceToRawSequence(e){return e.flatMap(r=>{if(r[0]==GroupedKeycodeSequenceAction.Chord){const o=i=>a=>[i,a];return[...r[1]].map(o(RawKeycodeSequenceAction.Down)).concat([...r[1]].reverse().map(o(RawKeycodeSequenceAction.Up)))}else return[r]})}function rawSequenceToOptimizedSequence(e){let r=[];return r=convertToTapsAndChords(e),r}function convertToTapsAndChords(e){let r=[],o=[],i=0;const a=e.reduce((p,m)=>m[0]===RawKeycodeSequenceAction.Tap?[...p,[RawKeycodeSequenceAction.Down,m[1]],[RawKeycodeSequenceAction.Up,m[1]]]:[...p,m],[]);let d=[];a.forEach((p,m)=>{let _=!1;if(r.push(p),p[0]===RawKeycodeSequenceAction.Down)i==o.length&&(o.push(p[1]),i++,_=!0);else if(p[0]===RawKeycodeSequenceAction.Up){const C=p[1];o.length>0&&C===o[i-1]&&(i--,i==0?(o.length===1?d.push([RawKeycodeSequenceAction.Tap,o[0]]):d.push([GroupedKeycodeSequenceAction.Chord,o]),r=[]):_=!0)}m===a.length-1&&(_=!1),_||(d.push(...r),r=[],o=[],i=0)});let l=[];for(let p=0;p<d.length;p++)p+1<d.length&&d[p][0]==RawKeycodeSequenceAction.Down&&d[p+1][0]==RawKeycodeSequenceAction.Up&&d[p][1]===d[p+1][1]?(l.push([RawKeycodeSequenceAction.Tap,d[p][1]]),p++):l.push(d[p]);return l}const mapKeycodeToCharacterStream={KC_A:["a","A"],KC_B:["b","B"],KC_C:["c","C"],KC_D:["d","D"],KC_E:["e","E"],KC_F:["f","F"],KC_G:["g","G"],KC_H:["h","H"],KC_I:["i","I"],KC_J:["j","J"],KC_K:["k","K"],KC_L:["l","L"],KC_M:["m","M"],KC_N:["n","N"],KC_O:["o","O"],KC_P:["p","P"],KC_Q:["q","Q"],KC_R:["r","R"],KC_S:["s","S"],KC_T:["t","T"],KC_U:["u","U"],KC_V:["v","V"],KC_W:["w","W"],KC_X:["x","X"],KC_Y:["y","Y"],KC_Z:["z","Z"],KC_1:["1","!"],KC_2:["2","@"],KC_3:["3","#"],KC_4:["4","$"],KC_5:["5","%"],KC_6:["6","^"],KC_7:["7","&"],KC_8:["8","*"],KC_9:["9","("],KC_0:["0",")"],KC_SPC:[" "," "],KC_MINS:["-","_"],KC_EQL:["=","+"],KC_LBRC:["[","{"],KC_RBRC:["]","}"],KC_BSLS:["\\","|"],KC_SCLN:[";",":"],KC_QUOT:["'",'"'],KC_GRV:["`","~"],KC_COMM:[",","<"],KC_DOT:[".",">"],KC_SLSH:["/","?"]},mapCharToShiftedChar=Object.values(mapKeycodeToCharacterStream).reduce((e,[r,o])=>({...e,[r]:o}),{});function convertCharacterTaps(e){return e.reduce((o,i)=>i[0]==RawKeycodeSequenceAction.Down&&i[1]in mapKeycodeToCharacterStream?[...o,[RawKeycodeSequenceAction.Tap,i[1]]]:i[0]==RawKeycodeSequenceAction.Up&&i[1]in mapKeycodeToCharacterStream?o:[...o,i],[])}function trimLastWait(e){return e[e.length-1]&&e[e.length-1][0]===RawKeycodeSequenceAction.Delay?e.slice(0,-1):e}function mergeConsecutiveWaits(e){return e.reduce((r,o)=>(r[r.length-1]&&r[r.length-1][0]===RawKeycodeSequenceAction.Delay&&o[0]===RawKeycodeSequenceAction.Delay?r.splice(-1,1,[RawKeycodeSequenceAction.Delay,Number(r[r.length-1][1])+Number(o[1])]):r.push(o),r),[])}function foldKeydownKeyupKeys(e){return e.reduce((r,o)=>(r[r.length-1]&&r[r.length-1][0]===RawKeycodeSequenceAction.Down&&o[0]===RawKeycodeSequenceAction.Up&&r[r.length-1][1]===o[1]?r.splice(-1,1,[RawKeycodeSequenceAction.Tap,o[1]]):r.push(o),r),[])}function convertToCharacterStreams(e){let r=e.reduce((a,d)=>{if(d[0]==RawKeycodeSequenceAction.Tap&&d[1]in mapKeycodeToCharacterStream){const l=mapKeycodeToCharacterStream[d[1]][0];return a[a.length-1]!==void 0&&a[a.length-1][0]===RawKeycodeSequenceAction.CharacterStream?[...a.slice(0,-1),[RawKeycodeSequenceAction.CharacterStream,a[a.length-1][1]+l]]:[...a,[RawKeycodeSequenceAction.CharacterStream,l]]}else return[...a,d]},[]),o=[];for(let a=0;a<r.length;a++)if(a+2<r.length&&r[a][0]===RawKeycodeSequenceAction.Down&&r[a+1][0]===RawKeycodeSequenceAction.CharacterStream&&r[a+2][0]===RawKeycodeSequenceAction.Up&&r[a][1]===r[a+2][1]&&(r[a][1]==="KC_LSFT"||r[a][1]==="KC_RSFT")){const d=r[a+1][1].split("").map(l=>mapCharToShiftedChar[l]).join("");o.push([RawKeycodeSequenceAction.CharacterStream,d]),a+=2}else o.push(r[a]);return o.reduce((a,d)=>d[0]===RawKeycodeSequenceAction.CharacterStream&&a[a.length-1]!==void 0&&a[a.length-1][0]===RawKeycodeSequenceAction.CharacterStream?(a[a.length-1][1]=a[a.length-1][1].concat(d[1]),a):[...a,d],[])}function sequenceToExpression(e){let r=[];return e.forEach(o=>{switch(o[0]){case RawKeycodeSequenceAction.Tap:r.push("{"+o[1]+"}");break;case RawKeycodeSequenceAction.Down:r.push("{+"+o[1]+"}");break;case RawKeycodeSequenceAction.Up:r.push("{-"+o[1]+"}");break;case RawKeycodeSequenceAction.Delay:r.push("{"+o[1]+"}");break;case GroupedKeycodeSequenceAction.Chord:r.push("{"+o[1].join(",")+"}");break;case RawKeycodeSequenceAction.CharacterStream:r.push(o[1].replace(/{/g,"\\{"))}}),r.join("")}function expressionToSequence(e){let r=splitExpression(e),o=[];return r.forEach(i=>{if(/^{.*}$/.test(i))if(i=i.slice(1,-1),/^\d+$/.test(i))o.push([RawKeycodeSequenceAction.Delay,parseInt(i)]);else{const a=/^[+-]/.test(i)?i.slice(0,1):null,d=i.replace(/^[+-]/,"").split(",").map(l=>l.trim().toUpperCase()).filter(l=>l.length);if(d.length>0)if(a==null)d.length==1?o.push([RawKeycodeSequenceAction.Tap,d[0]]):o.push([GroupedKeycodeSequenceAction.Chord,d]);else{const l=a=="+"?RawKeycodeSequenceAction.Down:RawKeycodeSequenceAction.Up;o.push([l,d[0]])}}else i=i.replace(/\\{/g,"{"),o.push([RawKeycodeSequenceAction.CharacterStream,i])}),o}function validateMacroExpression(expression){let unclosedBlockRegex,keycodeBlockRegex;try{unclosedBlockRegex=eval("/(?<!\\\\){(?![^{]*})/"),keycodeBlockRegex=eval("/(?<!\\\\){(.*?)}/g")}catch(e){return console.error("Lookbehind is not supported in this browser."),{isValid:!1,errorMessage:"Lookbehind is not supported in this browser."}}if(expression.match(unclosedBlockRegex))return{isValid:!1,errorMessage:"Looks like a keycode block - {} - is unclosed! Are you missing an '}'?"};let groups=null;for(;groups=keycodeBlockRegex.exec(expression);){const e=groups[1].replace(/\s+/g,"");if(!e.length)return{isValid:!1,errorMessage:"Sorry, I can't handle empty {}. Fill them up with keycodes or use \\{} to tell the macro to literally type {}"};const r=e.split(",").filter(o=>o.trim().length&&!isAutocompleteKeycode(o));if(r.length)return{isValid:!1,errorMessage:`Whoops! Invalid keycodes detected inside {}: ${r.join(", ")}`}}return{isValid:!0,errorMessage:void 0}}class MacroAPI{constructor(r,o,i){this.keyboardApi=r,this.basicKeyToByte=o,this.byteToKey=i}async readRawKeycodeSequences(){const r=await this.keyboardApi.getMacroBytes(),o=await this.keyboardApi.getMacroCount();let i=0,a=0;const d=[];let l=[];if(o===0)throw Error("Macros are disabled");for(;a<r.length&&i<o;){let p=r[a];switch(p){case MacroTerminator:d[i]=l,i++,l=[];break;case KeyAction.Tap:p=r[++a],l.push([RawKeycodeSequenceAction.Tap,this.byteToKey[p]]);break;case KeyAction.Down:p=r[++a],l.push([RawKeycodeSequenceAction.Down,this.byteToKey[p]]);break;case KeyAction.Up:p=r[++a],l.push([RawKeycodeSequenceAction.Up,this.byteToKey[p]]);break;default:{const m=String.fromCharCode(p);l.length&&l[l.length-1][0]===RawKeycodeSequenceAction.CharacterStream?l[l.length-1]=[RawKeycodeSequenceAction.CharacterStream,l[l.length-1][1]+m]:l.push([RawKeycodeSequenceAction.CharacterStream,m]);break}}a++}return d}rawKeycodeSequencesToMacroBytes(r){return r.flatMap(o=>{const i=[];return o.forEach(a=>{switch(a[0]){case RawKeycodeSequenceAction.Tap:i.push(KeyAction.Tap,this.basicKeyToByte[a[1]]);break;case RawKeycodeSequenceAction.Up:i.push(KeyAction.Up,this.basicKeyToByte[a[1]]);break;case RawKeycodeSequenceAction.Down:i.push(KeyAction.Down,this.basicKeyToByte[a[1]]);break;case RawKeycodeSequenceAction.Delay:break;case RawKeycodeSequenceAction.CharacterStream:i.push(...a[1].split("").map(d=>d.charCodeAt(0)));break}}),i.push(MacroTerminator),i})}async writeRawKeycodeSequences(r){const o=this.rawKeycodeSequencesToMacroBytes(r);await this.keyboardApi.setMacroBytes(o)}}function validateMacroExpressionV11(expression){let unclosedBlockRegex,keycodeBlockRegex;try{unclosedBlockRegex=eval("/(?<!\\\\){(?![^{]*})/"),keycodeBlockRegex=eval("/(?<!\\\\){(.*?)}/g")}catch(e){return console.error("Lookbehind is not supported in this browser."),{isValid:!1,errorMessage:"Lookbehind is not supported in this browser."}}if(expression.match(unclosedBlockRegex))return{isValid:!1,errorMessage:"Looks like a keycode block - {} - is unclosed! Are you missing an '}'?"};let groups=null;for(;groups=keycodeBlockRegex.exec(expression);){const e=groups[1].replace(/\s+/g,"");if(!e.length)return{isValid:!1,errorMessage:"Sorry, I can't handle empty {}. Fill them up with keycodes or use \\{} to tell the macro to literally type {}"};if(/^\d+$/.test(e)){if(/\d{5,}/.test(e))return{isValid:!1,errorMessage:`Invalid delay: ${e}. Please use a delay value of 9999 or less.`}}else{const r=e.replace(/^[-+]/,"").split(",").filter(o=>o.trim().length&&!isAutocompleteKeycode(o));if(r.length)return{isValid:!1,errorMessage:`Whoops! Invalid keycodes detected inside {}: ${r.join(", ")}`}}}return{isValid:!0,errorMessage:void 0}}class MacroAPIV11{constructor(r,o,i){this.keyboardApi=r,this.basicKeyToByte=o,this.byteToKey=i}async readRawKeycodeSequences(){const r=await this.keyboardApi.getMacroBytes(),o=await this.keyboardApi.getMacroCount();let i=0,a=0;const d=[];let l=[];if(o===0)throw Error("Macros are disabled");for(;a<r.length&&i<o;){let p=r[a];switch(p){case MacroTerminator:d[i]=l,i++,l=[];break;case KeyActionPrefix:switch(p=r[++a],p){case KeyAction.Tap:p=r[++a],l.push([RawKeycodeSequenceAction.Tap,this.byteToKey[p]]);break;case KeyAction.Down:p=r[++a],l.push([RawKeycodeSequenceAction.Down,this.byteToKey[p]]);break;case KeyAction.Up:p=r[++a],l.push([RawKeycodeSequenceAction.Up,this.byteToKey[p]]);break;case KeyAction.Delay:let m=[];for(p=r[++a];p!==DelayTerminator&&a<r.length;)m.push(p),p=r[++a];const _=m.reduce((C,y)=>(C+=String.fromCharCode(y),C),"");l.push([RawKeycodeSequenceAction.Delay,parseInt(_)]);break;default:throw`Expected a KeyAction to follow the KeyActionPrefix. Received ${p} instead.`}break;default:{const m=String.fromCharCode(p);l.length&&l[l.length-1][0]===RawKeycodeSequenceAction.CharacterStream?l[l.length-1]=[RawKeycodeSequenceAction.CharacterStream,l[l.length-1][1]+m]:l.push([RawKeycodeSequenceAction.CharacterStream,m]);break}}a++}return d}rawKeycodeSequencesToMacroBytes(r){return r.flatMap(o=>{const i=[];return o.forEach(a=>{switch(a[0]){case RawKeycodeSequenceAction.Tap:i.push(KeyActionPrefix,KeyAction.Tap,this.basicKeyToByte[a[1]]);break;case RawKeycodeSequenceAction.Down:i.push(KeyActionPrefix,KeyAction.Down,this.basicKeyToByte[a[1]]);break;case RawKeycodeSequenceAction.Up:i.push(KeyActionPrefix,KeyAction.Up,this.basicKeyToByte[a[1]]);break;case RawKeycodeSequenceAction.Delay:let d=`${a[1]}`;i.push(KeyActionPrefix,KeyAction.Delay,...d.split("").map(l=>l.charCodeAt(0)),DelayTerminator);break;case RawKeycodeSequenceAction.CharacterStream:i.push(...a[1].split("").map(l=>l.charCodeAt(0)));break}}),i.push(MacroTerminator),i})}async writeRawKeycodeSequences(r){const o=this.rawKeycodeSequencesToMacroBytes(r);await this.keyboardApi.setMacroBytes(o)}}const getMacroAPI=(e,r)=>{const o=getBasicKeyDict(e),i=getByteToKey(getBasicKeyDict(e));return e>=11?new MacroAPIV11(r,o,i):new MacroAPI(r,o,i)},getMacroValidator=e=>e>=11?validateMacroExpressionV11:validateMacroExpression,isDelaySupported=e=>e>=11,initialState$a={selectedDevicePath:null,connectedDevicePaths:{},supportedIds:{},forceAuthorize:!1},deviceSlice=createSlice({name:"devices",initialState:initialState$a,reducers:{selectDevice:(e,r)=>{r.payload?e.selectedDevicePath=r.payload.path:e.selectedDevicePath=null},setForceAuthorize:(e,r)=>{e.forceAuthorize=r.payload},updateConnectedDevices:(e,r)=>{e.connectedDevicePaths=r.payload},clearAllDevices:e=>{e.selectedDevicePath=null,e.connectedDevicePaths={}},updateSupportedIds:(e,r)=>{e.supportedIds=r.payload},ensureSupportedIds:(e,r)=>{const{productIds:o,version:i}=r.payload;o.forEach(a=>{e.supportedIds[a]=e.supportedIds[a]??{},e.supportedIds[a][i]=!0})}}}),{clearAllDevices,selectDevice,updateConnectedDevices,updateSupportedIds,ensureSupportedIds}=deviceSlice.actions,devicesReducer=deviceSlice.reducer,getForceAuthorize=e=>e.devices.forceAuthorize,getConnectedDevices=e=>e.devices.connectedDevicePaths,getSelectedDevicePath=e=>e.devices.selectedDevicePath,getSupportedIds=e=>e.devices.supportedIds,getSelectedConnectedDevice=createSelector(getConnectedDevices,getSelectedDevicePath,(e,r)=>r&&e[r]),getSelectedKeyboardAPI=createSelector(getSelectedDevicePath,e=>e&&new KeyboardAPI(e)),macrosInitialState={ast:[],macroBufferSize:0,macroCount:0,isFeatureSupported:!0},macrosSlice=createSlice({name:"macros",initialState:macrosInitialState,reducers:{loadMacrosSuccess:(e,r)=>{e.ast=r.payload.ast,e.macroBufferSize=r.payload.macroBufferSize,e.macroCount=r.payload.macroCount},saveMacrosSuccess:(e,r)=>{e.ast=r.payload.ast},setMacrosNotSupported:e=>{e.isFeatureSupported=!1}}}),{loadMacrosSuccess,saveMacrosSuccess,setMacrosNotSupported}=macrosSlice.actions,macrosReducer=macrosSlice.reducer,loadMacros=e=>async(r,o)=>{const{protocol:i}=e;if(i<8)r(setMacrosNotSupported());else try{const a=o(),d=getSelectedKeyboardAPI(a),l=getMacroAPI(i,d);if(l){const p=await l.readRawKeycodeSequences(),m=await d.getMacroBufferSize(),_=await d.getMacroCount();r(loadMacrosSuccess({ast:p,macroBufferSize:m,macroCount:_}))}}catch{r(setMacrosNotSupported())}},saveMacros=(e,r)=>async(o,i)=>{const a=i(),d=getSelectedKeyboardAPI(a),{protocol:l}=e,p=getMacroAPI(l,d);if(p){const m=r.map(_=>{const C=expressionToSequence(_);return optimizedSequenceToRawSequence(C)});await p.writeRawKeycodeSequences(m),o(saveMacrosSuccess({ast:m}))}},getIsMacroFeatureSupported=e=>e.macros.isFeatureSupported,getAST=e=>e.macros.ast,getMacroBufferSize=e=>e.macros.macroBufferSize,getMacroCount=e=>e.macros.macroCount,getExpressions=createSelector(getAST,e=>e.map(r=>{const o=rawSequenceToOptimizedSequence(r);return sequenceToExpression(o)})),getIsDelaySupported=createSelector(getSelectedConnectedDevice,e=>!!e&&isDelaySupported(e.protocol));function isFulfilledPromise(e){return e.status==="fulfilled"}function isAuthorizedDeviceConnected(e,r){return r&&r[e.vendorProductId]&&r[e.vendorProductId][e.requiredDefinitionVersion]}const initialState$9={definitions:{},customDefinitions:{},layoutOptionsMap:{}},definitionsSlice=createSlice({name:"definitions",initialState:initialState$9,reducers:{updateDefinitions:(e,r)=>{e.definitions={...e.definitions,...r.payload}},loadInitialCustomDefinitions:(e,r)=>{e.customDefinitions=r.payload},unloadCustomDefinition:(e,r)=>{const{version:o,id:i}=r.payload,a=e.customDefinitions[i];Object.keys(a).length===1?(delete e.customDefinitions[i],del(i)):(delete a[o],update(i,d=>(delete d[o],d))),e.customDefinitions={...e.customDefinitions}},loadCustomDefinitions:(e,r)=>{const{version:o,definitions:i}=r.payload;i.forEach(a=>{const d=e.customDefinitions[a.vendorProductId]??{};d[o]=a,e.customDefinitions[a.vendorProductId]=d})},updateLayoutOptions:(e,r)=>{e.layoutOptionsMap={...e.layoutOptionsMap,...r.payload}}}}),{loadCustomDefinitions,loadInitialCustomDefinitions,updateDefinitions,unloadCustomDefinition,updateLayoutOptions}=definitionsSlice.actions,definitionsReducer=definitionsSlice.reducer,getBaseDefinitions=e=>e.definitions.definitions,getCustomDefinitions=e=>e.definitions.customDefinitions,getLayoutOptionsMap=e=>e.definitions.layoutOptionsMap,getDefinitions=createSelector(getBaseDefinitions,getCustomDefinitions,(e,r)=>Object.entries(r).reduce((o,[i,a])=>({...o,[i]:{...o[i],...a}}),e)),getSelectedDefinition=createSelector(getDefinitions,getSelectedConnectedDevice,(e,r)=>r&&e&&e[r.vendorProductId]&&e[r.vendorProductId][r.requiredDefinitionVersion]),getBasicKeyToByte=createSelector(getSelectedConnectedDevice,e=>{const r=getBasicKeyDict(e?e.protocol:0);return{basicKeyToByte:r,byteToKey:getByteToKey(r)}}),getSelectedLayoutOptions=createSelector(getSelectedDefinition,getLayoutOptionsMap,getSelectedDevicePath,(e,r,o)=>o&&r[o]||e&&e.layouts.labels&&e.layouts.labels.map(i=>0)||[]),getSelectedOptionKeys=createSelector(getSelectedLayoutOptions,getSelectedDefinition,(e,r)=>r?e.flatMap((o,i)=>r.layouts.optionKeys[i]&&r.layouts.optionKeys[i][o]||[]):[]),getSelectedKeyDefinitions=createSelector(getSelectedDefinition,getSelectedOptionKeys,(e,r)=>e&&r?e.layouts.keys.concat(r):[]),getLightingSupport=createSelector(getSelectedDefinition,e=>e?!!("keycodes"in e&&typeof e.keycodes=="object"&&e.keycodes.find(r=>r.toLowerCase().includes("lighting"))||"menus"in e&&typeof e.menus=="object"&&e.menus.find(r=>r==null?void 0:r.label.toLowerCase().includes("lighting"))):!1),updateLayoutOption=(e,r)=>async(o,i)=>{const a=i(),d=getSelectedDefinition(a),l=getSelectedKeyboardAPI(a),p=getSelectedDevicePath(a);if(!d||!l||!p||!d.layouts.labels)return;const m=d.layouts.labels.map(y=>Array.isArray(y)?y.slice(1).length:2),_=[...getSelectedLayoutOptions(a)];_[e]=r;const C=numIntoBytes(packBits(_.map((y,b)=>[y,m[b]])));try{await l.setKeyboardValue(KeyboardValue.LAYOUT_OPTIONS,...C)}catch{console.warn("Setting layout option command not working")}o(updateLayoutOptions({[p]:_}))},storeCustomDefinitions=({definitions:e,version:r})=>async(o,i)=>{try{const a=getCustomDefinitions(i()),d=e.map(l=>[l.vendorProductId,{...a[l.vendorProductId],[r]:l}]);return setMany(d)}catch(a){throw console.error(a),a}},loadTabkbIds=()=>async(e,r)=>{const i=await(await fetch("/tabkb/supported_kbs.json",{cache:"reload"})).json();e(ensureSupportedIds({productIds:i.v2,version:"v2"})),e(ensureSupportedIds({productIds:i.v3,version:"v3"}))},loadStoredCustomDefinitions=()=>async(e,r)=>{try{const o=await entries(),i=o.filter(([l])=>["string","number"].includes(typeof l)).reduce((l,p)=>({...l,[p[0]]:p[1]}),{});e(loadInitialCustomDefinitions(i));const[a,d]=o.reduce(([l,p],[m,_])=>[_.v2?[...l,Number(m)]:l,_.v3?[...p,Number(m)]:p],[[],[]]);e(ensureSupportedIds({productIds:a,version:"v2"})),e(ensureSupportedIds({productIds:d,version:"v3"}))}catch(o){console.error(o)}},loadLayoutOptions=()=>async(e,r)=>{const o=r(),i=getSelectedDefinition(o),a=getSelectedConnectedDevice(o),d=getSelectedKeyboardAPI(o);if(!a||!i||!i.layouts.labels||!d)return;const{path:l}=a;try{const p=await d.getKeyboardValue(KeyboardValue.LAYOUT_OPTIONS,[],4),m=unpackBits(bytesIntoNum(p),i.layouts.labels.map(_=>Array.isArray(_)?_.slice(1).length:2));e(updateLayoutOptions({[l]:m}))}catch{console.warn("Getting layout options command not working")}},reloadDefinitions=e=>async(r,o)=>{const i=o(),a=getBaseDefinitions(i),d=getDefinitions(i),l=e.filter(({vendorProductId:_,requiredDefinitionVersion:C})=>!d||!d[_]||!d[_][C]),p=await Promise.allSettled(l.map(_=>getMissingDefinition(_,_.requiredDefinitionVersion)));p.forEach((_,C)=>{const y=l[C];if(_.status==="rejected"){const b=extractDeviceInfo(y);r(logAppError({message:`Fetching ${y.requiredDefinitionVersion} definition failed`,deviceInfo:b}))}});const m=p.filter(isFulfilledPromise).map(_=>_.value);m.length&&r(updateDefinitions(m.reduce((_,[C,y])=>({..._,[C.vendorProductId]:{..._[C.vendorProductId],[y]:C}}),a)))},initialState$8={rawDeviceMap:{},numberOfLayers:4,selectedLayerIndex:0,selectedKey:null,selectedKeys:null,configureKeyboardIsSelectable:!1,selectedPaletteColor:[0,0],multiSelectAble:!1,showLabelControl:!0},keymapSlice=createSlice({name:"keymap",initialState:initialState$8,reducers:{setSelectedPaletteColor:(e,r)=>{e.selectedPaletteColor=r.payload},setNumberOfLayers:(e,r)=>{e.numberOfLayers=r.payload},setConfigureKeyboardIsSelectable:(e,r)=>{e.configureKeyboardIsSelectable=r.payload},loadLayerSuccess:(e,r)=>{const{layerIndex:o,keymap:i,devicePath:a}=r.payload;e.rawDeviceMap[a]=e.rawDeviceMap[a]||Array(e.numberOfLayers).fill({keymap:[],isLoaded:!1}),e.rawDeviceMap[a][o]={keymap:i,isLoaded:!0}},setLayer:(e,r)=>{e.selectedLayerIndex=r.payload},clearSelectedKey:e=>{e.selectedKey=null},updateSelectedKey:(e,r)=>{e.selectedKey=r.payload},clearSelectedKeys:e=>{e.selectedKeys=null},toggleSelectedKey:(e,r)=>{e.selectedKeys=e.selectedKeys||[],e.selectedKeys.includes(r.payload)?e.selectedKeys=e.selectedKeys.filter(o=>o!==r.payload):e.selectedKeys=[...e.selectedKeys,r.payload]},updateSelectedKeys:(e,r)=>{e.selectedKeys=[...r.payload]},addSelectedKey:(e,r)=>{e.selectedKeys=e.selectedKeys||[],!e.selectedKeys.includes(r.payload)&&(e.selectedKeys=[...e.selectedKeys,r.payload])},removeSelectedKey:(e,r)=>{e.selectedKeys=e.selectedKeys||[],e.selectedKeys=e.selectedKeys.filter(o=>o!==r.payload)},saveKeymapSuccess:(e,r)=>{const{layers:o,devicePath:i}=r.payload;e.rawDeviceMap[i]=o},setKey:(e,r)=>{const{keymapIndex:o,value:i,devicePath:a}=r.payload,{selectedLayerIndex:d}=e;e.rawDeviceMap[a][d].keymap[o]=i},updateMultiSelectAble:(e,r)=>{e.multiSelectAble=r.payload},updateShowLayerControl:(e,r)=>{e.showLabelControl=r.payload}},extraReducers:e=>{e.addCase(selectDevice,r=>{r.selectedKey=null,r.selectedKeys=[],r.multiSelectAble=!1})}}),{setNumberOfLayers,setLayer,loadLayerSuccess,clearSelectedKey,setKey,updateSelectedKey,saveKeymapSuccess,setConfigureKeyboardIsSelectable,setSelectedPaletteColor,toggleSelectedKey,clearSelectedKeys,addSelectedKey,updateSelectedKeys,updateMultiSelectAble,updateShowLayerControl}=keymapSlice.actions,keymapReducer=keymapSlice.reducer,loadKeymapFromDevice=e=>async(r,o)=>{const i=o();if(getLoadProgress(i)===1)return;const{path:a,vendorProductId:d,requiredDefinitionVersion:l}=e,p=getSelectedKeyboardAPI(i),m=await p.getLayerCount();r(setNumberOfLayers(m));const{matrix:_}=getDefinitions(i)[d][l];for(var C=0;C<m;C++){const y=await p.readRawMatrix(_,C);r(loadLayerSuccess({layerIndex:C,keymap:y,devicePath:a}))}},saveRawKeymapToDevice=(e,r)=>async(o,i)=>{const a=i(),{path:d}=r,l=getSelectedKeyboardAPI(a),p=getSelectedDefinition(a);if(!d||!p||!l)return;const{matrix:m}=p;await l.writeRawMatrix(m,e);const _=e.map(C=>({keymap:C,isLoaded:!0}));o(saveKeymapSuccess({layers:_,devicePath:d}))},updateKey=(e,r)=>async(o,i)=>{const a=i(),d=getSelectedKeyDefinitions(a),l=getSelectedConnectedDevice(a),p=getSelectedKeyboardAPI(a),m=getSelectedDefinition(a);if(!l||!d||!m||!p)return;const _=getSelectedLayerIndex(a),{path:C}=l,{row:y,col:b}=d[e];await p.setKey(_,y,b,r);const{matrix:K}=m,v=y*K.cols+b;o(setKey({keymapIndex:v,value:r,devicePath:C}))},getConfigureKeyboardIsSelectable=e=>e.keymap.configureKeyboardIsSelectable,getSelectedKey=e=>e.keymap.selectedKey,getRawDeviceMap=e=>e.keymap.rawDeviceMap,getNumberOfLayers=e=>e.keymap.numberOfLayers,getSelectedLayerIndex=e=>e.keymap.selectedLayerIndex,getSelected256PaletteColor=e=>e.keymap.selectedPaletteColor,getSelectedPaletteColor=createSelector(getSelected256PaletteColor,([e,r])=>[360*e/255,r/255]),getSelectedKeys=e=>e.keymap.selectedKeys,getMultiSelectAble=e=>e.keymap.multiSelectAble,getShowLayerControl=e=>e.keymap.showLabelControl,getSelectedRawLayers=createSelector(getRawDeviceMap,getSelectedDevicePath,(e,r)=>r&&e[r]||[]),getLoadProgress=createSelector(getSelectedRawLayers,getNumberOfLayers,(e,r)=>e&&e.filter(o=>o.isLoaded).length/r);createSelector(getSelectedRawLayers,getSelectedLayerIndex,(e,r)=>e&&e[r]);const getSelectedKeymaps=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedRawLayers,(e,r,o)=>{if(r&&o){const i=o.map(d=>d.keymap),{matrix:{cols:a}}=r;return i.map(d=>e.map(({row:l,col:p})=>d[l*a+p]))}}),getSelectedKeymap=createSelector(getSelectedKeymaps,getSelectedLayerIndex,(e,r)=>e&&e[r]),getSelectedKeymapIndexes=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,(e,r)=>{if(e&&r){const{matrix:{cols:o}}=r;return e.map(({row:i,col:a})=>i*o+a)}return[]}),commandParamLengths={[distExports.LightingValue.BACKLIGHT_COLOR_1]:2,[distExports.LightingValue.BACKLIGHT_COLOR_2]:2,[distExports.LightingValue.QMK_RGBLIGHT_COLOR]:2,[distExports.LightingValue.BACKLIGHT_CUSTOM_COLOR]:2,[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_EFFECT_SPEED]:1,[distExports.LightingValue.BACKLIGHT_USE_7U_SPACEBAR]:1,[distExports.LightingValue.BACKLIGHT_USE_ISO_ENTER]:1,[distExports.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE]:1,[distExports.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT]:1,[distExports.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT]:1,[distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT]:1,[distExports.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS]:1,[distExports.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED]:1},initialState$7={lightingMap:{}},lightingSlice$1=createSlice({name:"lighting",initialState:initialState$7,reducers:{updateSelectedLightingData:(e,r)=>{const{lightingData:o,devicePath:i}=r.payload;e.lightingMap[i]=o},updateLighting:(e,r)=>{e.lightingMap={...e.lightingMap,...r.payload}}}}),{updateLighting,updateSelectedLightingData}=lightingSlice$1.actions,lightingReducer=lightingSlice$1.reducer,updateBacklightValue=(e,...r)=>async(o,i)=>{const a=i(),d=getSelectedConnectedDevice(a);if(!d)return;const p={...getSelectedLightingData(a),[e]:[...r]},{path:m}=d;o(updateSelectedLightingData({lightingData:p,devicePath:m}));const _=getSelectedKeyboardAPI(a);await _.setBacklightValue(e,...r),await _.saveLighting()},updateCustomColor=(e,r,o)=>async(i,a)=>{const d=a(),l=getSelectedConnectedDevice(d),p=getSelectedKeyboardAPI(d),m=getSelectedLightingData(d);if(!l||!m||!p)return;const _=[...m.customColors||[]];_[e]={hue:r,sat:o};const C={...m,customColors:_},{path:y}=l;i(updateSelectedLightingData({lightingData:C,devicePath:y})),p.setCustomColor(e,r,o),await p.saveLighting()},updateLightingData=e=>async(r,o)=>{const i=o(),a=getSelectedDefinition(i),d=getSelectedKeyboardAPI(i);if(!a||!d)return;const{path:l}=e;if(!distExports.isVIADefinitionV2(a))throw new Error("This method is only compatible with v2 definitions");const{lighting:p}=a,{supportedLightingValues:m,effects:_}=distExports.getLightingDefinition(p);if(m.length!==0){let C={};if(m.indexOf(distExports.LightingValue.BACKLIGHT_CUSTOM_COLOR)!==-1){const K=await Array(Math.max(..._.map(([j,w])=>w))).fill(0).map((j,w)=>d.getCustomColor(w));C={customColors:await Promise.all(K)}}const y=m.map(K=>({command:K,promise:d.getBacklightValue(+K,commandParamLengths[K])})),b=await Promise.all(y.map(K=>K.promise));C=y.reduce(({res:K,ref:v},j,w)=>({ref:v,res:{...K,[j.command]:v[w]}}),{res:C,ref:b}).res,r(updateLighting({[l]:{...C}}))}},getLightingMap=e=>e.lighting.lightingMap,getSelectedLightingData=createSelector(getLightingMap,getSelectedDevicePath,(e,r)=>r&&e[r]);function getIconColor(e){return{style:{color:e?"var(--bg_icon-highlighted)":"var(--bg_control)"}}}const Grid=styled.div`
  height: 100%;
  width: 100%;
  display: grid;
  grid-template-columns: min-content min-content minmax(0, 1fr);
  > div {
    pointer-events: all;
  }
`,Cell=styled.div`
  border-right: 1px solid var(--border_color_cell);
`,MenuCell=styled(Cell)`
  background: var(--bg_menu);
  border-top: 1px solid var(--border_color_cell);
`,OverflowCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  overflow: auto;
`,SpanOverflowCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  overflow: auto;
  grid-column: span 2;
`,SubmenuCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  background: var(--bg_control);
`,SubmenuOverflowCell=styled(SubmenuCell)`
  min-width: 80px;
  overflow: auto;
`,SinglePaneFlexCell=styled(Cell)`
  display: flex;
  overflow: hidden;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
`,ConfigureFlexCell=styled(SinglePaneFlexCell)`
  pointer-events: none;
  height: 500px;
`,CategoryIconContainer=styled.span`
  position: relative;
  color: var(--color_inside-accent);
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background: ${e=>e.$selected?"var(--color_accent)":"transparent"};
  border-radius: 10px;
  width: 40px;
  &:hover {
    color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--color_accent)"};
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,IconContainer=styled.span`
  display: inline-block;
  text-align: center;
  width: 35px;
  position: relative;
  &:hover > span > div {
    background-color: red;
  }
`,ControlRow=styled.div`
  position: relative;
  width: 100%;
  max-width: 960px;
  border-bottom: 1px solid var(--border_color_cell);
  font-size: 20px;
  justify-content: space-between;
  display: flex;
  line-height: 50px;
  min-height: 50px;
  box-sizing: border-box;
  padding-left: 5px;
  padding-right: 5px;
`,IndentedControlRow=styled(ControlRow)`
  padding-left: 17px;
`,Label$1=styled.label`
  color: var(--color_label);
  font-weight: 400;
`,SubLabel=styled(Label$1)`
  font-size: 18px;
  font-style: italic;
  font-weight: 400;
`,Detail=styled.span`
  color: var(--color_accent);
  display: flex;
  align-items: center;
`,Row$1=styled.div`
  cursor: pointer;
  white-space: nowrap;
  margin-bottom: 15px;
  font-size: 20px;
  line-height: 20px;
  text-transform: uppercase;
  color: ${e=>getIconColor(e.$selected).style.color};
  border-left: 2px solid transparent;

  svg {
    height: 20px;
    vertical-align: middle;
  }

  &:hover {
    color: var(--color_label-highlighted);
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,SubmenuRow=styled(Row$1)`
  background: ${e=>e.$selected?"var(--bg_icon)":"inherit"};
  padding: 4px 8px;
  font-weight: 400;
  min-width: min-content;
  border-color: transparent;
  margin-bottom: 11px;
  color: ${e=>e.$selected?"var(--color_label-highlighted)":"var(--color_label)"};
  border-radius: 12px;
`,Pane$e=styled.div`
  background: var(--gradient);
  display: flex;
  flex: 1;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--gradient);
`,CenterPane=styled(Pane$e)`
  overflow: auto;
  display: block;
`,ConfigureBasePane=styled(Pane$e)`
  flex-direction: column;
  align-items: center;
  justify-content: space-evenly;
  background: transparent;
  pointer-events: none;
  z-index: 3;
`,SvgIcLightbulbOutline24Px=e=>jsxRuntimeExports.jsx("svg",{width:11.9,height:17,...e,children:jsxRuntimeExports.jsx("path",{d:"M3.4 16.15a.853.853 0 00.85.85h3.4a.852.852 0 00.85-.85v-.85H3.4zM5.95 0a5.947 5.947 0 00-3.4 10.829v1.921a.852.852 0 00.85.85h5.1a.852.852 0 00.85-.85v-1.921A5.947 5.947 0 005.95 0zm2.422 9.435l-.722.51V11.9h-3.4V9.945l-.722-.51a4.25 4.25 0 114.845 0z",fill:"currentColor"})}),title$7="Lighting",component$4=SvgIcLightbulbOutline24Px,AccentButtonBase=styled.button`
  height: 40px;
  padding: 0 15px;
  line-height: 40px;
  min-width: 100px;
  text-align: center;
  outline: none;
  font-size: 20px;
  border-radius: 5px;
  color: var(--color_accent);
  border: 1px solid var(--color_accent);
  display: inline-block;
  box-sizing: border-box;
  pointer-events: ${e=>e.disabled?"none":"auto"};
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};

  &:hover {
    border: 1px solid var(--color_accent);
  }
`,AccentButton=styled(AccentButtonBase)`
  background-color: ${e=>e.disabled?"var(--bg_control-disabled)":"var(--bg_outside-accent)"};
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};

  &:hover {
    filter: brightness(0.7);
  }
`,AccentButtonLarge=styled(AccentButton)`
  font-size: 24px;
  line-height: 60px;
  height: 60px;
`,PrimaryAccentButton=styled(AccentButtonBase)`
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  background-color: ${e=>e.disabled?"transparent":"var(--color_accent)"};
  &:hover {
    filter: brightness(0.7);
  }
`,Keycode$3=styled.span`
  color: var(--color_accent);
  display: flex;
  padding-left: 10px;
`,KeycodeLabel=styled.span`
  color: var(--color_label);
  display: flex;
`,Item=styled.div`
  box-sizing: border-box;
  min-width: 200px;
  padding: 5px 10px;
  display: flex;
  justify-content: space-between;
  background-color: ${e=>e.$selected?"var(--bg_control)":"var(--bg_menu)"};

  &:hover {
    background-color: var(--bg_control);
  }
`,AutocompleteItem=({selected:e,entity:{label:r,code:o}})=>jsxRuntimeExports.jsxs(Item,{$selected:e,children:[jsxRuntimeExports.jsx(KeycodeLabel,{children:r})," ",jsxRuntimeExports.jsx(Keycode$3,{children:o})]}),AutocompleteLoading=()=>jsxRuntimeExports.jsx("div",{children:"Loading"}),findKeycodes=e=>{const r=e.toUpperCase();return getAutocompleteKeycodes().filter(({name:o,title:i,code:a})=>i?i.toUpperCase().indexOf(r)>-1:o.toUpperCase().indexOf(r)>-1||a.toUpperCase().indexOf(r)>-1).slice(0,10).map(({name:o,code:i,title:a})=>({label:a||o,code:i}))},TextInput=styled.input`
  background: none;
  border: none;
  border-bottom: 1px solid var(--color_accent);
  filter: brightness(0.7);
  color: var(--color_accent);
  font-size: 1.2rem;
  margin-bottom: 1.5rem;
  padding: 0.5rem;
  transition: all 0.2s ease-out;

  &:focus {
    filter: brightness(1);
    color: var(--color_accent);
    outline: none;
  }

  &::placeholder {
    color: var(--color_control);
  }
`,ModalBackground=styled.div`
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0, 0, 0, 0.75);
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
`,ModalContainer=styled.div`
  border: 2px solid var(--color_accent);
  min-width: 460px;
  max-width: 550px;
  min-height: 170px;
  gap: 20px;
  background-color: var(--bg_menu);
  border-radius: 6px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
`,PromptText=styled.div`
  font-weight: 500;
  user-select: none;
  color: var(--color_label);
  font-size: 20px;
  text-align: center;
`,RowDiv$1=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  width: 220px;
  gap: 20px;
`,AutocompleteContainer=styled.ul`
  position: fixed;
  background-color: var(--bg_menu);
  max-height: 210px;
  overflow: auto;
  border: 1px solid var(--bg_control);
  margin: 0;
  padding: 0;
  width: auto;
  margin-top: -24px;
  line-height: normal;
`,AutocompleteItemRow=styled.li`
  &:not(:last-child) {
    border-bottom: 1px solid var(--bg_control);
  }
`;function isHex(e){const r=e.toLowerCase();return`0x${parseInt(r,16).toString(16).toLowerCase()}`===r}function inputIsBasicByte(e,r){return e.trim().toUpperCase()in r}function basicByteFromInput(e,r){const o=e.trim().toUpperCase();return r[o]}function inputIsAdvancedKeyCode(e,r){const o=e.trim().toUpperCase();return advancedStringToKeycode(o,r)!==0}function advancedKeyCodeFromInput(e,r){const o=e.trim().toUpperCase();return advancedStringToKeycode(o,r)}function inputIsHex(e){return isHex(e.trim())}function hexFromInput(e){const r=e.toLowerCase();return parseInt(r,16)}function inputIsValid(e,r){return inputIsBasicByte(e,r)||inputIsAdvancedKeyCode(e,r)||inputIsHex(e)}function keycodeFromInput(e,r){return inputIsBasicByte(e,r)?basicByteFromInput(e,r):inputIsAdvancedKeyCode(e,r)?advancedKeyCodeFromInput(e,r):inputIsHex(e)?hexFromInput(e):null}const getInputItems=e=>e.map(r=>({code:r.code,label:r.title??r.name})),KeycodeModal=e=>{const r=useAppSelector(getSelectedDefinition),{basicKeyToByte:o,byteToKey:i}=useAppSelector(getBasicKeyToByte);if(!r)return null;const a=getInputItems(getKeycodesForKeyboard(r)),[d,l]=reactExports.useState(a),p=anyKeycodeToString(e.defaultValue,o,i),{getMenuProps:m,getInputProps:_,highlightedIndex:C,inputValue:y,getItemProps:b,isOpen:K}=useCombobox({items:d,initialIsOpen:p==="",defaultInputValue:p,itemToString:j=>(j==null?void 0:j.code)??"",onInputValueChange:({inputValue:j})=>{l(a.filter(({label:w,code:L})=>[w,L].flatMap(T=>T.split(/\s+/)).map(T=>T.toLowerCase()).some(T=>T.startsWith((j??"").toLowerCase()))))}}),v=inputIsValid(y,o);return jsxRuntimeExports.jsx(ModalBackground,{children:jsxRuntimeExports.jsxs(ModalContainer,{children:[jsxRuntimeExports.jsx(PromptText,{children:"Please enter your desired QMK keycode or hex code:"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(TextInput,{..._(),type:"text",placeholder:p||"KC_NO, 0xFF, etc."})}),jsxRuntimeExports.jsx(AutocompleteContainer,{...m(),style:{display:K&&d.length?"block":"none"},children:K&&d.map((j,w)=>reactExports.createElement(AutocompleteItemRow,{...b({item:j,index:w}),key:j.code},jsxRuntimeExports.jsx(AutocompleteItem,{selected:C===w,entity:j},j.code)))})]}),jsxRuntimeExports.jsxs(RowDiv$1,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:e.onExit,children:"Cancel"}),jsxRuntimeExports.jsx(PrimaryAccentButton,{disabled:!v,onClick:()=>{e.onConfirm(keycodeFromInput(y,o))},children:"Confirm"})]})]})})},PelpiKeycodeInput=e=>{const[r,o]=React.useState(!1),{basicKeyToByte:i,byteToKey:a}=useAppSelector(getBasicKeyToByte);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:()=>o(!0),children:anyKeycodeToString(e.value,i,a)}),r&&jsxRuntimeExports.jsx(KeycodeModal,{defaultValue:e.value,onChange:e.setValue,onConfirm:d=>{e.setValue(d),o(!1)},onExit:()=>o(!1)})]})},HiddenInput$3=styled.input`
  opacity: 0;
  width: 0;
  height: 0;
`,Switch=styled.label`
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
`,Slider$1=styled.span`
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: ${e=>e.$ischecked?"var(--color_accent)":"var(--bg_control)"};
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 4px;
  &:before {
    position: absolute;
    content: '';
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    border-radius: 4px;
    background-color: ${e=>e.$ischecked?"var(--color_inside-accent)":"var(--bg_icon)"};
    -webkit-transition: 0.4s;
    transition: 0.4s;
    ${e=>e.$ischecked?"transform: translateX(26px)":""};
  }
`;function AccentSlider(e){const{isChecked:r,onChange:o}=e,[i,a]=React.useState(r),d=reactExports.useRef(null);React.useEffect(()=>{a(r)},[r]);const l=()=>{const p=!r;a(p),o(p),d.current&&d.current.blur()};return jsxRuntimeExports.jsxs(Switch,{children:[jsxRuntimeExports.jsx(HiddenInput$3,{ref:d,type:"checkbox",checked:i,onChange:l}),jsxRuntimeExports.jsx(Slider$1,{$ischecked:i})]})}const customStyles={option:(e,r)=>({...e,"&:hover":{backgroundColor:r.isSelected?"var(--color_accent)":"var(--bg_control)"},":active":{backgroundColor:"var(--bg_control)"},background:r.isSelected?"var(--color_accent)":r.isFocused?"var(--bg_control)":"var(--bg_menu)",color:r.isSelected?"var(--color_inside-accent)":(r.isFocused,"var(--color_accent)")}),container:e=>({...e,lineHeight:"initial",flex:1}),input:e=>({...e,color:"var(--color_accent)",opacity:.5}),singleValue:e=>({...e,color:"var(--color_accent)"}),dropdownIndicator:e=>({...e,color:"var(--color_accent)"}),indicatorSeparator:e=>({...e,backgroundColor:"var(--color_accent)"}),menuList:e=>({...e,borderColor:"var(--color_accent)",backgroundColor:"var(--bg_menu)"}),placeholder:e=>({...e,color:"var(--color_accent)"}),valueContainer:e=>({...e,":active":{backgroundColor:"var(--bg_control)",borderColor:"var(--color_accent)"},"&:hover":{borderColor:"var(--color_accent)"},color:"var(--color_accent)",background:"var(--bg_menu)"}),control:(e,r)=>({...e,boxShadow:"none",":active":{backgroundColor:"transparent",borderColor:"var(--color_accent)"},"&:hover":{borderColor:"var(--color_accent)"},color:"var(--color_accent)",borderColor:"1px solid var(--color_accent)",background:"var(--bg_menu)",overflow:"hidden",width:r.selectProps.width||250})},AccentSelect=e=>jsxRuntimeExports.jsx(StateManagedSelect,{...e,styles:customStyles}),Container$l=styled.span`
  display: inline-flex;
  align-items: center;
  line-height: initial;
  column-gap: 5px;
  min-width: 200px;
`,SliderInput=styled.input.attrs({type:"range"})`
  accent-color: var(--color_accent);
  width: 200px;
`,AccentRange=e=>{const{showLabel:r,...o}=e;return jsxRuntimeExports.jsxs(Container$l,{children:[e.showLabel&&jsxRuntimeExports.jsx("span",{children:e.value??e.defaultValue}),jsxRuntimeExports.jsx(SliderInput,{...o,onChange:i=>{e.onChange&&e.onChange(+i.target.value)}})]})},ColorPickerContainer=styled.div`
  display: flex;
  align-items: center;
`,ColorLens=styled.div`
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid black;
  opacity: 0.7;
  background: rgba(255, 255, 255, 0.2);
  pointer-events: none;
  box-sizing: border-box;
  transform: translate3d(195px, 195px, 0);
`,ColorInner=styled.div`
  width: 100%;
  height: 100%;
  background: linear-gradient(to top, white, rgba(0, 0, 0, 0));
`,ColorOuter=styled.div`
  width: 100%;
  height: 100%;
  background: linear-gradient(
    to right,
    red,
    yellow,
    lime,
    aqua,
    blue,
    magenta,
    red
  );
`,ColorThumbnail=styled.div`
  display: inline-block;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  border: 4px solid var(--border_color_cell);
  cursor: pointer;
  &:hover {
    opacity: 0.8;
  }
`,Container$k=styled.div`
  border: 4px solid var(--border_color_cell);
  width: 180px;
  height: 180px;
  position: relative;
`,PickerContainer=styled.div`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 1;
  box-shadow: rgba(0, 0, 0, 0.11) 0 1px 1px 1px;
  position: absolute;
  transform: translate3d(-205px, 50px, 0);

  &::after {
    content: '';
    position: absolute;
    width: 0px;
    height: 0px;
    border: 11px solid var(--border_color_cell);
    border-top-color: transparent;
    border-bottom-color: transparent;
    border-right-color: transparent;
    right: -22px;
    top: 66px;
  }
`,ColorPreview$1=styled.div`
  width: 180px;
  height: 24px;
  border: 4px solid var(--border_color_cell);
  border-bottom: none;
`,ColorHexContainer=styled.div`
  border: 4px solid var(--border_color_cell);
  border-bottom: none;
  width: 180px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  background: var(--bg_menu);
`,ColorHexInput=styled.input`
  text-align: center;
  border: none;
  color: var(--color_accent);
  background: var(--bg_menu);
  font-size: 20px;
  font-weight: 300;
  padding: 0;
  width: 100%;
  &:focus {
    outline: none;
    color: var(--color_accent);
    border-color: var(--color_accent);
  }
`;let ColorPicker$1=class extends reactExports.Component{constructor(){super(...arguments);se(this,"ref",null);se(this,"refWidth",0);se(this,"refHeight",0);se(this,"mouseDown",!1);se(this,"state",{lensTransform:"",showPicker:!1,offset:[5,5],hexColorCode:getHex(this.props.color)});se(this,"onMouseMove",o=>{if(this.mouseDown){const{offsetX:i,offsetY:a}=o.nativeEvent,d=`translate3d(${i-5}px, ${a-5}px, 0)`,l=[i,a],{hue:p,sat:m}=this.getLinearHueSat(l),_=getHex(this.props.color);this.props.setColor(Math.round(255*(p/360)),Math.round(255*m)),this.setState({lensTransform:d,offset:l,hexColorCode:_})}});se(this,"onMouseDown",o=>{this.mouseDown=!0,this.onMouseMove(o),this.ref&&(this.ref.style.cursor="pointer")});se(this,"onMouseUp",()=>{if(this.mouseDown=!1,this.ref&&(this.ref.style.cursor="auto"),this.props.onMouseUp){const{hue:o,sat:i}=this.getLinearHueSat(this.state.offset);this.props.onMouseUp(o,i)}});se(this,"onThumbnailClick",()=>{this.props.onOpen&&this.props.onOpen(),this.setState({showPicker:!0})});se(this,"pickerContainer",React.createRef());se(this,"colorThumbnail",React.createRef());se(this,"onDocumentClick",o=>{if(this.state.showPicker&&this.pickerContainer.current&&!this.pickerContainer.current.contains(o.target)&&this.colorThumbnail.current&&!this.colorThumbnail.current.contains(o.target)&&!this.mouseDown){if(this.props.onClose){const{hue:i,sat:a}=this.getLinearHueSat(this.state.offset);this.props.onClose(i,a)}this.mouseDown=!1,this.setState({showPicker:!1,hexColorCode:getHex(this.props.color)})}else this.mouseDown&&this.state.showPicker&&this.pickerContainer.current&&!this.pickerContainer.current.contains(o.target)&&this.colorThumbnail.current&&!this.colorThumbnail.current.contains(o.target)&&this.onMouseUp()});se(this,"handleHexChange",o=>{let i=o.target.value;i=i.replace(/[^A-Fa-f0-9]/g,""),i.length>0&&i[0]!=="#"&&(i=`#${i}`),i.length>7&&(i=i.substring(0,7)),this.setState({hexColorCode:i})});se(this,"handleHexBlur",o=>{this.setState({hexColorCode:getHex(this.props.color)})});se(this,"handleHexSubmit",o=>{if(o.key==="Enter"){if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(this.state.hexColorCode)){var i=this.state.hexColorCode.replace("#","");i.length==3&&(i=`${i.split("").map(p=>p+p).join("")}`);const[d,l]=getHSV(i);this.props.setColor(Math.round(255*(d/360)),Math.round(255*l))}this.setState({hexColorCode:getHex(this.props.color)})}})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocumentClick),document.removeEventListener("click",this.onDocumentClick)}componentDidUpdate({color:o},i){if(this.ref&&this.state.showPicker&&(!i.showPicker||o!==this.props.color)){const{width:a,height:d}=this.ref.getBoundingClientRect();this.refWidth=a,this.refHeight=d;const{hue:l,sat:p}=this.props.color,m=a*l/255,_=d*(1-p/255),C=`translate3d(${m-5}px, ${_-5}px, 0)`;this.setState({lensTransform:C,offset:[m,_]})}}componentDidMount(){document.addEventListener("click",this.onDocumentClick),document.addEventListener("mousedown",this.onDocumentClick)}getRadialHueSat(o){const{offsetX:i,offsetY:a}=o.nativeEvent,d=toDegrees(calcRadialHue(i,a)??0),l=Math.min(1,calcRadialMagnitude(i,a)??0);return{hue:d,sat:l}}getLinearHueSat([o,i]){const a=this.refWidth,d=this.refHeight,[l,p]=[Math.max(0,o),Math.max(0,i)],m=360*Math.min(1,l/a),_=1-Math.min(1,p/d);return{hue:m,sat:_}}render(){const o=getRGB(this.props.color),{isSelected:i=!1}=this.props,{offset:a}=this.state,d=`translate3d(${a[0]-5}px, ${a[1]-5}px, 0)`;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(ColorPickerContainer,{children:[jsxRuntimeExports.jsx(ColorThumbnail,{ref:this.colorThumbnail,onClick:this.onThumbnailClick,style:{background:o,borderColor:i?"var(--color_accent)":"var(--border_color_cell)"}}),this.state.showPicker&&jsxRuntimeExports.jsxs(PickerContainer,{ref:this.pickerContainer,onMouseUp:this.onMouseUp,children:[jsxRuntimeExports.jsx(ColorHexContainer,{children:jsxRuntimeExports.jsx(ColorHexInput,{type:"text",value:this.state.hexColorCode,onChange:this.handleHexChange,onBlur:this.handleHexBlur,onKeyDown:this.handleHexSubmit})}),jsxRuntimeExports.jsx(ColorPreview$1,{style:{background:getRGB(this.props.color)}}),jsxRuntimeExports.jsx(Container$k,{children:jsxRuntimeExports.jsx(ColorOuter,{onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,ref:l=>this.ref=l,children:jsxRuntimeExports.jsx(ColorInner,{children:jsxRuntimeExports.jsx(ColorLens,{style:{transform:d}})})})})]})]})})}};const ArrayColorPicker=e=>{const{color:r,setColor:o}=e;return jsxRuntimeExports.jsx(ColorPicker$1,{color:{hue:r[0],sat:r[1]},setColor:o})},ColorPalettePickerContainer=styled.div`
  display: flex;
  align-items: center;
  column-gap: 10px;
`,PreviousColorContainer=styled.div`
  display: flex;
  background: var(--bg_control);
  border-radius: 15px;
`,PreviousColorOption=styled.div`
  display: inline-block;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  border: 4px solid var(--border_color_cell);
  cursor: pointer;
  transition: transform 0.2s ease-out;
  &:hover {
    opacity: 0.8;
  }
  transform: ${e=>e.$selected?"scale(0.8)":"scale(0.6)"};
  border-color: ${e=>e.$selected?"var(--color_accent)":"var(--border_color_cell)"};
`,ConnectedColorPalettePicker=()=>{const e=useDispatch(),r=reactExports.useCallback((o,i)=>e(setSelectedPaletteColor([o,i])),[e]);return reactExports.useEffect(()=>(e(updateShowKeyPainter(!0)),()=>{e(updateShowKeyPainter(!1))})),jsxRuntimeExports.jsx(ColorPalettePicker,{color:[0,0],setColor:r})},ColorPalettePicker=e=>{const{color:r,setColor:o}=e,[i,a]=reactExports.useState(r),[d,l]=reactExports.useState(r),p=reactExports.useMemo(()=>Array(9).fill(0).map((m,_)=>[Math.round(_*255/10),255,255]),[]);return jsxRuntimeExports.jsxs(ColorPalettePickerContainer,{children:[jsxRuntimeExports.jsx(PreviousColorContainer,{children:p.map((m,_)=>{const C=i[0]===m[0]&&i[1]===m[1];return jsxRuntimeExports.jsx(PreviousColorOption,{$selected:C,style:{background:getRGB({hue:m[0]??0,sat:m[1]??0})},onClick:()=>{a(m),o(m[0],m[1])}},_)})}),jsxRuntimeExports.jsx(ColorPicker$1,{isSelected:d[0]===i[0]&&d[1]===i[1],color:{hue:d[0],sat:d[1]},setColor:(m,_)=>{a([m,_]),l([m,_])},onOpen:()=>{a([d[0],d[1]]),o(d[0],d[1])},onMouseUp:()=>{a([d[0],d[1]]),o(d[0],d[1])}})]})},VIACustomItem=React.memo(e=>{const{t:r}=useTranslation();return jsxRuntimeExports.jsxs(ControlRow,{id:e._id,children:[jsxRuntimeExports.jsx(Label$1,{children:r(e.label)}),jsxRuntimeExports.jsx(Detail,{children:"type"in e?jsxRuntimeExports.jsx(VIACustomControl,{...e,value:e.value&&Array.from(e.value)}):e.content})]})}),boxOrArr=e=>Array.isArray(e)?e:[e],valueIsChecked=(e,r)=>boxOrArr(e).every((o,i)=>o==r[i]),getRangeValue=(e,r)=>r>255?shiftTo16Bit([e[0],e[1]]):e[0],getRangeBytes=(e,r)=>r>255?shiftFrom16Bit(e):[e],VIACustomControl=e=>{const{t:r}=useTranslation(),{content:o,type:i,options:a,value:d}=e,[l,...p]=o;switch(i){case"button":{const m=a||[1];return jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.updateValue(l,...p,m[0]),children:r("Click")})}case"range":return jsxRuntimeExports.jsx(AccentRange,{showLabel:!0,min:a[0],max:a[1],defaultValue:getRangeValue(e.value,a[1]),onChange:m=>e.updateValue(l,...p,...getRangeBytes(m,a[1]))});case"keycode":return jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:shiftTo16Bit([e.value[0],e.value[1]]),meta:{},setValue:m=>e.updateValue(l,...p,...shiftFrom16Bit(m))});case"toggle":{const m=a||[0,1];return jsxRuntimeExports.jsx(AccentSlider,{isChecked:valueIsChecked(m[1],e.value),onChange:_=>e.updateValue(l,...p,...boxOrArr(m[+_]))})}case"dropdown":{const m=a.map((_,C)=>{const[y,b]=typeof _=="string"?[_,C]:_;return{value:b||C,label:y}});return jsxRuntimeExports.jsx(AccentSelect,{onChange:_=>_&&e.updateValue(l,...p,+_.value),options:m,defaultValue:m.find(_=>d[0]===_.value),value:m.find(_=>d[0]===_.value)})}case"color":return jsxRuntimeExports.jsx(ArrayColorPicker,{color:e.value,setColor:(m,_)=>e.updateValue(l,...p,m,_)});case"color-palette":return jsxRuntimeExports.jsx(ConnectedColorPalettePicker,{})}return null},CustomPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$j=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`;function categoryGenerator(e){return e.viaMenu.content.flatMap(r=>submenuGenerator(r,e))}function itemGenerator(e,r){return"showIf"in e&&!distExports$1.evalExpr(e.showIf,r.selectedCustomMenuData)?[]:"label"in e?{...e,key:e._id}:e.content.flatMap(o=>itemGenerator(o,r))}const TimeSyncItem=()=>{const{t:r}=useTranslation(),o=useAppSelector(getSelectedKeyboardAPI),i=reactExports.useRef(),[a,d]=reactExports.useState(new Date),l=a.toLocaleDateString(void 0,{hour:"2-digit",hour12:!1,minute:"2-digit",second:"2-digit"});reactExports.useEffect(()=>(i.current=setInterval(()=>{d(new Date)},1e3),()=>{clearInterval(i.current)}),[]);const p=()=>{if(!o)return;const m=~~(a.getTime()/1e3)-a.getTimezoneOffset()*60;o.setCustomMenuValue(25,...numIntoBytes(m)),o.commitCustomMenu(25)};return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:l}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:p,children:r("Time Sync")})})]})},MenuComponent=React.memo(e=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[e.elem.content.flatMap(r=>itemGenerator(r,e)).map(r=>jsxRuntimeExports.jsx(VIACustomItem,{...r,updateValue:e.updateCustomMenuValue,value:e.selectedCustomMenuData[r.content[0]]})),e.elem.label=="Date Time"&&jsxRuntimeExports.jsx(TimeSyncItem,{})]})),MenuBuilder=e=>r=>reactExports.createElement(MenuComponent,{...r,key:e._id,elem:e});function submenuGenerator(e,r){return"showIf"in e&&!distExports$1.evalExpr(e.showIf,r.selectedCustomMenuData)?[]:"label"in e?{label:e.label,Menu:MenuBuilder(e)}:e.content.flatMap(o=>submenuGenerator(o,r))}const Pane$d=e=>{const{t:r}=useTranslation(),o=useAppDispatch(),i=categoryGenerator(e),[a,d]=reactExports.useState(i[0]||{label:"",Menu:()=>jsxRuntimeExports.jsx("div",{})}),l=a.Menu,p=useAppSelector(getSelectedDefinition),m=useAppSelector(getSelectedCustomMenuData),_={...e,selectedDefinition:p,selectedCustomMenuData:m,updateCustomMenuValue:(C,...y)=>o(updateCustomMenuValue(C,...y))};return!p||!m?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuCell,{children:jsxRuntimeExports.jsx(MenuContainer$8,{children:i.map(C=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:a.label===C.label,onClick:()=>d(C),children:r(C.label)},C.label))})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(CustomPane,{children:jsxRuntimeExports.jsx(Container$j,{children:l(_)})})})]})},MenuContainer$8=styled.div`
  padding: 15px 10px 20px 10px;
`,iconKeywords=[{icon:faLightbulb,keywords:["light","rgb"]},{icon:faHeadphones,keywords:["audio","sound"]},{icon:faDisplay,keywords:["display","oled","lcd"]}],getIconFromLabel=e=>{const r=e.label.toLowerCase(),o={icon:faGear};return(iconKeywords.find(i=>i.keywords.some(a=>r.includes(a)))||o).icon},makeCustomMenu=(e,r)=>({Title:e.label,Icon:()=>jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:getIconFromLabel(e)}),Pane:o=>reactExports.createElement(Pane$d,{...o,key:`${e.label}-${r}`,viaMenu:e})}),makeCustomMenus=e=>e.map(makeCustomMenu),initialState$6={customMenuDataMap:{},commonMenusMap:{},showKeyPainter:!1,selectedRowTitle:void 0},menusSlice=createSlice({name:"menus",initialState:initialState$6,reducers:{updateShowKeyPainter:(e,r)=>{e.showKeyPainter=r.payload},updateSelectedCustomMenuData:(e,r)=>{const{devicePath:o,menuData:i}=r.payload;e.customMenuDataMap[o]=i},updateCommonMenus:(e,r)=>{const{commonMenuMap:o}=r.payload;e.commonMenusMap=o},updateCustomMenuData:(e,r)=>{e.customMenuDataMap={...e.customMenuDataMap,...r.payload}},updateSelectedRowTitle:(e,r)=>{e.selectedRowTitle=r.payload}}}),{updateShowKeyPainter,updateSelectedCustomMenuData,updateSelectedRowTitle}=menusSlice.actions,menusReducer=menusSlice.reducer,updateCustomMenuValue=(e,...r)=>async(o,i)=>{const a=i(),d=getSelectedConnectedDevice(a);if(!d)return;const l=getSelectedCustomMenuData(a),p=getCustomCommands(a),m={...l,[e]:[...r.slice(p[e].length)]},{path:_}=d;o(updateSelectedCustomMenuData({menuData:m,devicePath:_}));const C=getSelectedKeyboardAPI(a);C.setCustomMenuValue(...r.slice(0));const y=r[0];C.commitCustomMenu(y)},tryResolveCommonMenu=e=>typeof e=="string"?distExports.commonMenus[e]:e,updateV3MenuData=e=>async(r,o)=>{const i=o(),a=getSelectedDefinition(i),d=getSelectedKeyboardAPI(i);if(!distExports.isVIADefinitionV3(a))throw new Error("V3 menus are only compatible with V3 VIA definitions.");const p=getV3Menus(i).flatMap(extractCommands),{protocol:m,path:_}=e;if(p.length!==0&&m>=11){let C={};const y=p.map(([v,j,...w])=>({command:v,promise:d.getCustomMenuValue([j].concat(w))})),b=await Promise.all(y.map(v=>v.promise));C=y.reduce(({res:v,ref:j},w,L)=>({ref:j,res:{...v,[w.command]:j[L].slice(1)}}),{res:C,ref:b}).res;const K=Math.max(...a.layouts.keys.map(v=>v.li??-1));if(console.debug(K,"maxLedIndex"),K>=0){const v=await d.getPerKeyRGBMatrix(Array(K+1).fill(0).map((j,w)=>w));C.__perKeyRGB=v}r(updateSelectedCustomMenuData({devicePath:_,menuData:{...C}}))}},extractCommands=e=>typeof e=="string"?[]:"type"in e?[e.content]:"content"in e&&typeof e.content!="string"?e.content.flatMap(extractCommands):[],getShowKeyPainter=e=>e.menus.showKeyPainter,getCustomMenuDataMap=e=>e.menus.customMenuDataMap,getSelectedCustomMenuData=createSelector(getCustomMenuDataMap,getSelectedDevicePath,(e,r)=>r&&e[r]),getSelectedRowTitle=e=>e.menus.selectedRowTitle,getV3Menus=createSelector(getSelectedDefinition,e=>!e||!distExports.isVIADefinitionV3(e)?[]:(e.menus||[]).flatMap(tryResolveCommonMenu).map((r,o)=>distExports.isVIAMenu(r)?compileMenu("custom_menu",3,r,o):r)),getV3MenuComponents=createSelector(getSelectedDefinition,e=>!e||!distExports.isVIADefinitionV3(e)?[]:(e.menus||[]).flatMap(tryResolveCommonMenu).map((r,o)=>distExports.isVIAMenu(r)?makeCustomMenu(compileMenu("custom_menu",3,r,o),o):r)),getCustomCommands=createSelector(getSelectedDefinition,getV3Menus,(e,r)=>{if(!e)return[];const o=distExports.isVIADefinitionV2(e)?e.customMenus:r;return o===void 0?[]:o.flatMap(extractCommands).reduce((i,a)=>({...i,[a[0]]:a.slice(1)}),{})}),compileMenu=(e,r=0,o,i)=>r===0?o:{...o,_id:`${e}_${i}`,content:o.label!==void 0?typeof o.content=="string"?o.content:o.content.map((a,d)=>compileMenu(`${e}_${d}`,r-1,a,i)):o.content.map((a,d)=>compileMenu(`${e}_${d}`,r,a,i))},initialState$5={showMatrix:!1,selectedOptionKeys:[],selectedDefinitionIndex:0},designSlice=createSlice({name:"design",initialState:initialState$5,reducers:{updateSelectedDefinitionIndex:(e,r)=>{e.selectedDefinitionIndex=r.payload},updateSelectedOptionKeys:(e,r)=>{e.selectedOptionKeys=r.payload},updateShowMatrix:(e,r)=>{e.showMatrix=r.payload}}}),{updateSelectedDefinitionIndex,updateSelectedOptionKeys,updateShowMatrix}=designSlice.actions,designReducer=designSlice.reducer,getSelectedDefinitionIndex=e=>e.design.selectedDefinitionIndex,getDesignSelectedOptionKeys=e=>e.design.selectedOptionKeys,getShowMatrix=e=>e.design.showMatrix,BAUD=115200,BUFFER_SIZE=64,getSerialPort=async e=>{let r=await getFilteredPort(e);if(r||(r=await navigator.serial.requestPort({filters:[{usbVendorId:e.vendorId,usbProductId:e.productId}]})),!r)throw new Error("no serial port");return r},getFilteredPort=async e=>(await navigator.serial.getPorts()).find(i=>{const a=i.getInfo();return a.usbVendorId===e.vendorId&&a.usbProductId===e.productId}),cache={};class TabKeyboardAPI{constructor(r){se(this,"device");se(this,"getPort",async()=>{if(this.device.path in cache)return cache[this.device.path];const r=await getSerialPort(this.device);return await r.open({baudRate:BAUD,bufferSize:1024}),cache[this.device.path]=r,r});this.device=r}async setMatrixLighting(r,o,i,a,d){const l=await this.seriaCommandWithResponse(192,[r,o,i,a]);if(l&&l[5]===238){const m=new Error("Error: "+l[5]);throw m.cause=l[5],m}const p=BUFFER_SIZE-8;for(let m=0;m<d.length;m+=p){const _=d.slice(m,m+p);await this.seriaCommand(193,[...numIntoBytes(m),_.length,..._])}}async setTabFile(r,o,i){const a=await this.seriaCommandWithResponse(224,r.slice(0,20));if(a&&a[21]===238){const d=new Error("Error: "+a[21]);throw d.cause=a[21],d}return this.setTabBuffer(225,r,o,i)}async setTabFirmwareBuffer(r,o,i){return this.setTabBuffer(241,r,o,i)}async setTabFirmwareInfo(r,o){const i=[...numIntoBytes(r),...o],a=await this.seriaCommandWithResponse(240,i);return!(a&&a[i.length+1]===238)}async setTabBuffer(r,o,i,a){const d=BUFFER_SIZE-8;for(let l=0;l<o.length;l+=d){const p=o.slice(l,l+d);if(await this.seriaCommand(r,[...numIntoBytes(l),p.length,...p]),a&&a()){await this.seriaCommand(226);return}i&&i(l+p.length)}}async seriaCommand(r,o=[]){const i=[r,...o],a=new Array(BUFFER_SIZE).fill(0);i.forEach((l,p)=>{a[p]=l});const d=await this.getPort();if(d.writable){const l=d.writable.getWriter();console.debug("CDC",a),await l.write(new Uint8Array(a)),l.releaseLock()}}async seriaCommandWithResponse(r,o=[]){await this.seriaCommand(r,o);const i=await this.getPort();let a=[];if(i.readable){const d=i.readable.getReader();try{for(;;){const{value:l,done:p}=await d.read();if(console.debug("CDC read",l,p),l&&(a=[...a,...Array.from(l)],a.length===BUFFER_SIZE)){console.debug("done...");break}if(p){console.debug("done");break}}}catch(l){throw console.log(l),l}finally{d.releaseLock()}if(!lodashExports.isEqual(o,a.slice(1,o.length+1)))throw console.error("Command for CDC:",o,"Bad Resp:",a),new Error("Receiving incorrect response for command")}return a}}const tabkbConfigSlice=createSlice({name:"tabkbconfig",initialState:{configs:{}},reducers:{setTabkbConfigs(e,r){e.configs=r.payload}}}),{setTabkbConfigs}=tabkbConfigSlice.actions,tabkbconfigReducer=tabkbConfigSlice.reducer,loadTabkbConfigs=()=>async(e,r)=>{const i=await(await fetch("/tabkb/configs.json",{cache:"reload"})).json();let a={};for(const d of i){if(!d.vendorId||!d.productId)continue;const l=getVendorProductId(parseInt(d.vendorId),parseInt(d.productId));a[l]=d}e(setTabkbConfigs(a))},getConfigs=e=>e.tabkbconfig.configs,getSelectedTabkbConfig=createSelector([getConfigs,getSelectedDefinition],(e,r)=>{if(!(!r||!e[r.vendorProductId]))return e[r.vendorProductId]}),getTabFileAPI=createSelector(getSelectedConnectedDevice,getSelectedDevicePath,getSelectedTabkbConfig,(e,r,o)=>{if(!r||!o||!e)return;const i=new KeyboardAPI(r);return o.cdc?new TabKeyboardAPI(e):i}),getMatrixLightingAPI=createSelector(getSelectedConnectedDevice,getSelectedDevicePath,getSelectedTabkbConfig,(e,r,o)=>{if(!r||!o||!e)return;const i=new KeyboardAPI(r);return o.matrixLighting.cdc?new TabKeyboardAPI(e):i}),getTapDanceKeycodes=createSelector(getSelectedTabkbConfig,e=>!e||!e.tapDance?[]:e.tapDance),mlHeader=[...new TextEncoder().encode("tabml")],mlHeaderSize=32,DefaultMaxFrame=200,initMatrix=(e,r,o={r:0,g:0,b:0})=>Array(e).fill("").map(()=>Array(r).fill(o)),initialState$4={color:{r:255,g:255,b:255},rows:0,cols:0,fps:10,matrixIdx:0,matrixList:[],saving:!1},lightingSlice=createSlice({name:"matrixlighting",initialState:initialState$4,reducers:{updateColor(e,r){e.color=r.payload},updateMatrix(e,r){const{row:o,col:i}=r.payload;o>e.rows-1||i>e.cols-1||(e.matrixList[e.matrixIdx][o][i]=e.color)},setMatrix(e,r){e.matrixList[e.matrixIdx]=r.payload},updateMatrixIndex(e,r){r.payload!==void 0&&(e.matrixIdx=r.payload)},resetMatrix(e){e.matrixIdx=0,e.matrixList=[initMatrix(e.rows,e.cols)]},addMatrix(e){e.matrixList=[...e.matrixList.slice(0,e.matrixIdx+1),initMatrix(e.rows,e.cols),...e.matrixList.slice(e.matrixIdx+1)],e.matrixIdx+=1},deleteMatrix(e){if(e.matrixList.length===1){e.matrixList[0]=initMatrix(e.rows,e.cols);return}e.matrixList.splice(e.matrixIdx,1),e.matrixIdx>=e.matrixList.length&&(e.matrixIdx-=1)},nextMatrix(e){let r=e.matrixIdx+1;r>=e.matrixList.length&&(r=0),e.matrixIdx=r},copyMatrix(e){e.matrixList=[...e.matrixList.slice(0,e.matrixIdx+1),e.matrixList[e.matrixIdx],...e.matrixList.slice(e.matrixIdx+1)],e.matrixIdx+=1},setMatrixList(e,r){e.matrixList=r.payload,e.matrixIdx=0},fillMatrix(e){e.matrixList[e.matrixIdx]=initMatrix(e.rows,e.cols)},sortMatrixByIndex(e,r){const{newIndex:o}=r.payload;if(e.matrixIdx===o)return;const[i]=e.matrixList.splice(e.matrixIdx,1);e.matrixList.splice(o,0,i),e.matrixIdx=o},setRows:(e,r)=>{e.rows=r.payload},setCols:(e,r)=>{e.cols=r.payload},setFps:(e,r)=>{e.fps=r.payload},setSaving:(e,r)=>{e.saving=r.payload},loadFile:(e,r)=>{const o=e.rows,i=e.cols,{frames:a,fps:d,data:l}=r.payload,p=i*o*3,m=Array(a).fill(0).map(()=>Array(o).fill(0).map(()=>Array(i).fill({r:0,g:0,b:0})));for(let _=0;_<l.length;_+=3){const C=~~(_/p),y=_%p/3,b=~~(y/i),K=y%i,v={r:l[_],g:l[_+1],b:l[_+2]};m[C][b][K]=v}e.fps=d,e.matrixIdx=0,e.matrixList=m}},extraReducers(e){e.addCase(selectDevice,r=>{r.saving=!1})}}),{updateColor,updateMatrix,resetMatrix,addMatrix,deleteMatrix,updateMatrixIndex,nextMatrix,copyMatrix,setMatrix,setMatrixList,fillMatrix,sortMatrixByIndex,setRows,setCols,setFps,setSaving,loadFile}=lightingSlice.actions,matrixlightingReducer=lightingSlice.reducer,saveToKeyboard=()=>async(e,r)=>{const o=r(),i=getMatrixLightingAPI(o),a=getSaving(o);if(!i||a)return;const d=getRows(o),l=getCols(o),p=getFrames(o),m=getFps(o),_=getKBMatrixData(o);e(setSaving(!0)),await i.setMatrixLighting(p,m,d,l,_).finally(()=>{e(setSaving(!1))})},loadMatrixLighintConfig=()=>async(e,r)=>{const o=r(),i=getSelectedTabkbConfig(o);if(!(i!=null&&i.matrixLighting))return;const{cols:a,rows:d}=i.matrixLighting;e(setCols(a)),e(setRows(d)),e(setMatrixList([initMatrix(d,a)]))},getActiveColor=e=>e.matrixlighting.color,getRows=e=>e.matrixlighting.rows,getCols=e=>e.matrixlighting.cols,getMatrixList=e=>e.matrixlighting.matrixList,getMatrixIdx=e=>e.matrixlighting.matrixIdx,getFps=e=>e.matrixlighting.fps,getSaving=e=>e.matrixlighting.saving,getFrames=e=>e.matrixlighting.matrixList.length,getMaxFrame=createSelector(getSelectedTabkbConfig,e=>e?(e==null?void 0:e.matrixLighting.maxFrame)??DefaultMaxFrame:DefaultMaxFrame),getImportEnable=createSelector(getSelectedTabkbConfig,e=>e?!!(e!=null&&e.matrixLighting.importEnable):!1),getActiveMatrix=createSelector(getMatrixList,getMatrixIdx,(e,r)=>e[r]?e[r]:[]),getKBMatrixData=createSelector(getMatrixList,e=>e.flatMap(r=>r.flatMap(o=>o.flatMap(i=>get256HSV([i.r,i.g,i.b]))))),getMatrixData$1=createSelector(getMatrixList,e=>e.flatMap(r=>r.flatMap(o=>o.flatMap(i=>[i.r,i.g,i.b])))),getFileContent=createSelector(getFrames,getRows,getCols,getFps,getMatrixData$1,(e,r,o,i,a)=>{const d=Array(mlHeaderSize).fill(0);return[...mlHeader,e,i,r,o].forEach((p,m)=>{d[m]=p}),[...d,...a]}),MIN_KB_ACTUATION=0,MAX_KB_ACTUATION=200,MIN_ACTUATION=0,MAX_ACTUATION=4,ACTUATION_MULTIPLE=(MAX_KB_ACTUATION-MIN_KB_ACTUATION)/(MAX_ACTUATION-MIN_ACTUATION),actuationFromKeyboard=e=>e===void 0?0:e/ACTUATION_MULTIPLE,actuationToKeyboard=e=>e===void 0?0:~~(e*ACTUATION_MULTIPLE);class ActuationApi{constructor(r){this.keyboardApi=r}async getSelfCheckResult(){const[,,r]=await this.keyboardApi.actuationCommand(1);return!!r}async selfCheck(){await this.keyboardApi.actuationCommand(2)}async getAPEnabled(){const[,,r]=await this.keyboardApi.actuationCommand(3);return!!r}async setAPEnabled(r){await this.keyboardApi.actuationCommand(4,[Number(r)])}async getAPGlobalValue(){const[,,r]=await this.keyboardApi.actuationCommand(5);return actuationFromKeyboard(r)}async setAPGlobalValue(r){await this.keyboardApi.actuationCommand(6,[actuationToKeyboard(r)])}async getAPBufferSize(){const[,,r,o]=await this.keyboardApi.actuationCommand(7);return shiftTo16Bit([r,o])}async getAPBytes(){const r=await this.getAPBufferSize(),o=27,i=[];for(let d=0;d<r;d+=o)i.push(this.keyboardApi.actuationCommand(8,[...shiftFrom16Bit(d),Math.min(r-d,o)]));return(await Promise.all(i)).flatMap(d=>d.slice(5))}async getAPData(r){const o=await this.getAPBytes(),i=[];for(let a=0;a<r;a++)i[a]=o[a]?actuationFromKeyboard(o[a]):0;return i}async setAPValue(r,o,i){await this.keyboardApi.actuationCommand(9,[r,o,actuationToKeyboard(i)])}async getRTEnabled(){const[,,r]=await this.keyboardApi.actuationCommand(10);return!!r}async setRTEnabled(r){await this.keyboardApi.actuationCommand(11,[Number(r)])}async getRTContinuousEnabled(){const[,,r]=await this.keyboardApi.actuationCommand(12);return!!r}async setRTContinuousEnabled(r){await this.keyboardApi.actuationCommand(13,[Number(r)])}async getRTBufferSize(){const[,,r,o]=await this.keyboardApi.actuationCommand(14);return shiftTo16Bit([r,o])}async getRTBytes(){const r=await this.getRTBufferSize(),o=26,i=[];for(let d=0;d<r;d+=o)i.push(this.keyboardApi.actuationCommand(15,[...shiftFrom16Bit(d),Math.min(r-d,o)]));return(await Promise.all(i)).flatMap(d=>d.slice(5,31))}async getRTData(r){const o=await this.getRTBytes(),i=[];for(let a=0;a<r;a++){const d=o[a*2]?actuationFromKeyboard(o[a*2]):0,l=o[a*2+1]?actuationFromKeyboard(o[a*2+1]):0;i[a]=[d,l]}return i}async setRTValue(r,o,i,a){await this.keyboardApi.actuationCommand(16,[r,o,actuationToKeyboard(i),actuationToKeyboard(a)])}async getDKSActuation(){const[,,r,o]=await this.keyboardApi.actuationCommand(32);return[actuationFromKeyboard(r),actuationFromKeyboard(o)]}async getDKSCount(){const[,,r,o]=await this.keyboardApi.actuationCommand(33);return shiftTo16Bit([r,o])}async getDKSValues(){const r=await this.getDKSCount();if(r===0)return[];const o=[];for(let a=0;a<r;a++)o.push(this.keyboardApi.actuationCommand(34,shiftFrom16Bit(a)));return(await Promise.all(o)).map(a=>{const[,,,,d,l,p,m,..._]=a,C=[];for(let b=0;b<4;b++){const[K,v,j]=_.slice(b*3,b*3+3);C.push({key:shiftTo16Bit([K,v]),points:[j>>6&3,j>>4&3,j>>2&3,j&3]})}const y={actuation:actuationFromKeyboard(m),actions:C};return console.log(JSON.stringify({layer:d,row:l,col:p,dks:y})),{layer:d,row:l,col:p,dks:y}})}async setDksValue(r,o,i,a){if(a===null){await this.keyboardApi.actuationCommand(36,[r,o,i]);return}const d=a.actions.flatMap(p=>[...shiftFrom16Bit(p.key),p.points.map((m,_)=>m<<(3-_)*2).reduce((m,_)=>_|=m,0)]);console.log(JSON.stringify({layer:r,row:o,col:i,actuation:a.actuation,keyActionBytes:d}));const l=[r,o,i,actuationToKeyboard(a.actuation),...d];console.log(l),await this.keyboardApi.actuationCommand(35,l)}}const getActuationApi=e=>new ActuationApi(e),defaultActuationPoint=2,defaultRtSensitivity=.2,defaultRt2ndSensitivity=.55,defaultDKSActuation=.7,defaultDKS2ndActuation=3.5,initialState$3={enableAP:!1,actuationPoint:defaultActuationPoint,actuationMap:{},actuationMenu:"AP",enableRT:!1,continuousRT:!1,selfChecked:!1,selfCheckStartTimeout:0,dksActionIndex:null,dksmap:{},dksActuations:[defaultDKSActuation,defaultDKS2ndActuation]},actuationSlice=createSlice({name:"actuation",initialState:initialState$3,reducers:{setActuationPoint:(e,r)=>{e.actuationPoint=r.payload},setActuation:(e,r)=>{const{devicePath:o,keymapIdxes:i,actuation:a}=r.payload;e.actuationMap[o]=e.actuationMap[o]||[],i.map(d=>{e.actuationMap[o][d]=e.actuationMap[o][d]||{},e.actuationMap[o][d]={...e.actuationMap[o][d],...a}})},resetActuation:(e,r)=>{e.actuationMap[r.payload]=[]},updateMenu:(e,r)=>{e.actuationMenu=r.payload},setEnableAP:(e,r)=>{e.enableAP=r.payload},setEnableRT:(e,r)=>{e.enableRT=r.payload},setContinuousRT:(e,r)=>{e.continuousRT=r.payload},updateSelfChecked:(e,r)=>{e.selfChecked=r.payload},updateSelfCheckTimeout:(e,r)=>{e.selfCheckStartTimeout=r.payload},updateDksAction:(e,r)=>{e.dksActionIndex=r.payload},setDksData:(e,r)=>{const{keymapIndex:o,value:i,devicePath:a,selectedLayerIndex:d}=r.payload;e.dksmap[a]=e.dksmap[a]||[],e.dksmap[a][d]=e.dksmap[a][d]||[],e.dksmap[a][d][o]=i},resetDksData:(e,r)=>{e.dksmap[r.payload]=[]},deleteDksBaseLayerData:(e,r)=>{var a;const{path:o,keymapIndexes:i}=r.payload;(a=e.dksmap[o])!=null&&a[0]&&i.forEach(d=>{e.dksmap[o][0][d]=null})},setDKSActuations:(e,r)=>{e.dksActuations=r.payload}},extraReducers(e){e.addCase(selectDevice,r=>{r.selfChecked=!1})}}),{setActuationPoint,setActuation,updateMenu,setEnableRT,setEnableAP,setContinuousRT,updateSelfChecked,updateSelfCheckTimeout,updateDksAction,deleteDksBaseLayerData,setDksData,setDKSActuations,resetActuation,resetDksData}=actuationSlice.actions,actuationReducer=actuationSlice.reducer,updatePerKeyActuation=(e,r)=>async(o,i)=>{const a=i(),d=getSelectedKeyDefinitions(a),l=getSelectedConnectedDevice(a),p=getSelectedDefinition(a),m=getSelectedKeyboardAPI(a);if(!l||!d||!p||!m)return;const _=getActuationApi(m),{matrix:C}=p,{path:y}=l,b=[],K=[];for(const v of e){const{row:j,col:w}=d[v],L=j*C.cols+w;b.push(L),K.push(_.setAPValue(j,w,r))}await Promise.all(K),o(setActuation({devicePath:y,keymapIdxes:b,actuation:{actuationPoint:r}})),o(deleteDksData(b))},deletePerKeyActuation=(e,r=!1)=>async(o,i)=>{const a=i(),d=getValidAPKeys(a);o(deleteActuation(e,d,"AP",r))},deleteActuation=(e,r,o,i=!1)=>async(a,d)=>{if(e.length===0||r.length===0)return;const l=d(),p=getSelectedKeyDefinitions(l),m=getSelectedConnectedDevice(l),_=getSelectedDefinition(l),C=getSelectedKeyboardAPI(l);if(!m||!p||!_||!C)return;let y;o==="AP"?y={actuationPoint:0}:o==="RT"?y={rtSensitivity:0,rt2ndSensitivity:0}:y={actuationPoint:0,rtSensitivity:0,rt2ndSensitivity:0};const b=getActuationApi(C),{matrix:K}=_,{path:v}=m,j=[],w=[];for(const L of e){if(!r.includes(L))continue;const{row:T,col:P}=p[L],k=T*K.cols+P;j.push(k),i||(o==="AP"?w.push(b.setAPValue(T,P,0)):o==="RT"&&w.push(b.setRTValue(T,P,0,0)))}await Promise.all(w),a(setActuation({devicePath:v,keymapIdxes:j,actuation:y}))},updatePerKeyRT=(e,r,o)=>async(i,a)=>{const d=a(),l=getSelectedKeyDefinitions(d),p=getSelectedConnectedDevice(d),m=getSelectedDefinition(d),_=getSelectedKeyboardAPI(d);if(!p||!l||!m||!_)return;const C=getActuationApi(_),{matrix:y}=m,{path:b}=p,K=[],v=[];for(const j of e){const{row:w,col:L}=l[j],T=w*y.cols+L;K.push(T),v.push(C.setRTValue(w,L,r,o))}await Promise.all(v),i(setActuation({devicePath:b,keymapIdxes:K,actuation:{rtSensitivity:r,rt2ndSensitivity:o}})),i(deleteDksData(K))},deletePerKeyRT=(e,r=!1)=>async(o,i)=>{const a=i(),d=getValidRTKeys(a);o(deleteActuation(e,d,"RT",r))},selfCheck=()=>async(e,r)=>{const o=r();if(getSelfCheckTimeout(o)>0)return;const i=getSelectedKeyboardAPI(o);if(!i)return;const a=getActuationApi(i);e(updateSelfChecked(!1)),e(updateSelfCheckTimeout(4));let d;try{a.selfCheck(),await new Promise(l=>{d=setInterval(async()=>{const p=await a.getSelfCheckResult(),m=getSelfCheckTimeout(r());if(p){clearInterval(d),e(updateSelfChecked(!0)),e(updateSelfCheckTimeout(0)),l(!0);return}if(m===1){clearInterval(d),e(updateSelfCheckTimeout(-1)),l(!0);return}e(updateSelfCheckTimeout(m-1))},1e3)})}catch{e(updateSelfCheckTimeout(-1)),clearInterval(d)}},loadActuation=()=>async(e,r)=>{const o=r(),i=getSelectedTabkbConfig(o);if(!(i!=null&&i.actuation))return;const a=getSelectedKeyboardAPI(o),d=getSelectedDevicePath(o),l=getSelectedDefinition(o);if(!l||!a||!d)return;const{matrix:{cols:p,rows:m}}=l,_=getActuationApi(a);try{const[C,y,b,K,v,j,w,L,T]=await Promise.all([_.getSelfCheckResult(),_.getAPEnabled(),_.getAPGlobalValue(),_.getAPData(p*m),_.getRTEnabled(),_.getRTContinuousEnabled(),_.getRTData(p*m),_.getDKSActuation(),_.getDKSValues()]);e(updateSelfChecked(C)),e(setEnableAP(y)),e(setActuationPoint(b)),K.map((P,k)=>{e(setActuation({devicePath:d,keymapIdxes:[k],actuation:{actuationPoint:P}}))}),e(setEnableRT(v)),e(setContinuousRT(j)),w.map(([P,k],G)=>{e(setActuation({devicePath:d,keymapIdxes:[G],actuation:{rtSensitivity:P,rt2ndSensitivity:k}}))}),e(setDKSActuations(L)),T.map(({layer:P,row:k,col:G,dks:U})=>{const W=k*p+G;e(setDksData({devicePath:d,selectedLayerIndex:P,keymapIndex:W,value:U}))})}catch(C){console.log(C)}},updateEnableAP=e=>async(r,o)=>{const i=o(),a=getSelectedKeyboardAPI(i);if(!a)return;await getActuationApi(a).setAPEnabled(e),r(setEnableAP(e))},updateAP=lodashExports.debounce((e,r)=>{e.setAPGlobalValue(r)},300),updateActuationPoint=e=>async(r,o)=>{const i=o(),a=getSelectedKeyboardAPI(i);if(!a)return;const d=getActuationApi(a);updateAP(d,e),r(setActuationPoint(e))},updateEnableRT=e=>async(r,o)=>{const i=o(),a=getSelectedKeyboardAPI(i);if(!a)return;await getActuationApi(a).setRTEnabled(e),r(setEnableRT(e))},updateContinuousRT=e=>async(r,o)=>{const i=o(),a=getSelectedKeyboardAPI(i);if(!a)return;await getActuationApi(a).setRTContinuousEnabled(e),r(setContinuousRT(e))},updateDksData=(e,r,o)=>async(i,a)=>{const d=a(),l=getSelectedKeyDefinitions(d),p=getSelectedConnectedDevice(d),m=getSelectedKeyboardAPI(d),_=getSelectedDefinition(d);if(!p||!l||!_||!m)return;const C=getActuationApi(m),{path:y}=p,{row:b,col:K}=l[r];await C.setDksValue(e,b,K,o);const{matrix:v}=_,j=b*v.cols+K;i(setDksData({keymapIndex:j,value:o,devicePath:y,selectedLayerIndex:e})),e===0&&i(deleteActuation([r],[r],"ALL",!0))},deleteDksData=e=>async(r,o)=>{const i=o(),a=getSelectedConnectedDevice(i);if(!a)return;const{path:d}=a;r(deleteDksBaseLayerData({path:d,keymapIndexes:e}))},saveConfigToDevice=e=>async(r,o)=>{const i=o(),a=getSelectedKeyboardAPI(i),d=getSelectedDevicePath(i),l=getSelectedDefinition(i),p=getNumberOfLayers(i);if(!l||!a||!d)return;const m=getActuationApi(a);r(updateEnableAP(!!e.apEnabled)),r(updateEnableRT(!!e.rtEnabled)),r(updateActuationPoint(e.apGlobal||defaultActuationPoint)),r(updateContinuousRT(!!e.rtContinuous));const{matrix:{cols:_,rows:C}}=l,y=_*C,b=[],K=[],v=[],j=[],w=[],L=[];e.ap&&e.ap.map(([T,P])=>{b[T]=m.setAPValue(~~(T/_),T%_,P),j.push({devicePath:d,keymapIdxes:[T],actuation:{actuationPoint:P}})}),e.rt&&e.rt.map(([T,P,k])=>{K[T]=m.setRTValue(~~(T/_),T%_,P,k),w.push({devicePath:d,keymapIdxes:[T],actuation:{rtSensitivity:P,rt2ndSensitivity:k}})}),e.dks&&e.dks.map(([T,P,k,...G])=>{const U=[];for(let X=0;X<4;X++){const[Z,I,z,Q,re]=G.slice(X*5,(X+1)*5);U.push({key:Z,points:[I,z,Q,re]})}const W={actuation:k,actions:U};v[T*P+P]=m.setDksValue(T,~~(P/_),P%_,W),L.push({devicePath:d,selectedLayerIndex:T,keymapIndex:P,value:W})});for(let T=0;T<p;T++)for(let P=0;P<y;P++)T===0&&(b[P]||(b[P]=m.setAPValue(~~(P/_),P%_,0)),K[P]||(K[P]=m.setRTValue(~~(P/_),P%_,0,0))),v[T*P+P]=m.setDksValue(T,~~(P/_),P%_,null);await Promise.all([Promise.all(b),Promise.all(K),Promise.all(v)]),r(resetActuation(d)),j.map(T=>r(setActuation(T))),w.map(T=>r(setActuation(T))),r(resetDksData(d)),L.map(T=>r(setDksData(T)))},getActuationPoint=e=>e.actuation.actuationPoint,getActuationMap=e=>e.actuation.actuationMap,getMenu=e=>e.actuation.actuationMenu,getEnableAP=e=>e.actuation.enableAP,getEnableRT=e=>e.actuation.enableRT,getContinuousRT=e=>e.actuation.continuousRT,getSelfChecked=e=>e.actuation.selfChecked,getSelfCheckTimeout=e=>e.actuation.selfCheckStartTimeout,getDksAction=e=>e.actuation.dksActionIndex,getDksmap=e=>e.actuation.dksmap,getDKSActuations=e=>e.actuation.dksActuations,getSelectedPerKeyActuation=createSelector(getActuationMap,getSelectedDevicePath,(e,r)=>{if(r&&e[r])return e[r]}),getSelectedActuationMap=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedPerKeyActuation,getSelectedLayerIndex,(e,r,o,i)=>{if(i===0&&r&&o){const{matrix:{cols:a}}=r;return e.map(({col:d,row:l})=>o[l*a+d])}}),getValidAPKeys=createSelector(getSelectedActuationMap,e=>{if(!e)return[];const r=[];return e.map((o,i)=>{o!=null&&o.actuationPoint&&r.push(i)}),r}),getValidRTKeys=createSelector(getSelectedActuationMap,e=>{if(!e)return[];const r=[];return e.map((o,i)=>{o!=null&&o.rtSensitivity&&(o!=null&&o.rt2ndSensitivity)&&r.push(i)}),r}),getSelectedDksmap=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedDevicePath,getSelectedLayerIndex,getDksmap,(e,r,o,i,a)=>{var d;if(r&&o&&((d=a[o])!=null&&d[i])){const{matrix:{cols:l}}=r;return e.map(({row:p,col:m})=>a[o][i][p*l+m])}}),getSelectedDksRawMap=createSelector(getDksmap,getSelectedDevicePath,(e,r)=>{if(r&&e[r])return e[r]}),getDefaultDksData=createSelector(getSelectedKey,getSelectedKeymap,getDKSActuations,(e,r,o)=>({actuation:o[0],actions:Array(4).fill(0).map((a,d)=>({key:0,points:[DKSPoint.Hold,DKSPoint.Hold,DKSPoint.Hold,DKSPoint.Hold]}))})),getSelectDksData=createSelector(getSelectedKey,getSelectedDksmap,getDefaultDksData,(e,r,o)=>e!==null&&r&&r[e]||o),getActiveMenu=createSelector(getSelfChecked,getMenu,(e,r)=>e?r:"SELF CHECK"),getConfiguredDksData=createSelector(getSelectedDksRawMap,e=>{if(!e)return[];const r=[];return e.forEach((o,i)=>{o.forEach((a,d)=>{a!==null&&r.push({layerIdx:i,key:d,data:a})})}),r}),KBRE_FLAGS_SWAP_BIT=1,initialState$2={selectedTool:"video",toolConfigs:{},state:"waiting",bytesSended:0,bufferSize:0,started:0,lastUpdate:0,sendSpeed:0},screenSlice=createSlice({name:"screen",initialState:initialState$2,reducers:{updateTool:(e,r)=>{e.selectedTool=r.payload},updateState(e,r){e.bytesSended=0,e.state=r.payload},updateBytesSended:(e,r)=>{const o=r.payload-e.bytesSended;e.bytesSended=r.payload;const i=Date.now();e.sendSpeed=~~(o/((i-e.lastUpdate)/1e3)),e.lastUpdate=i},updateStarted:e=>{const r=Date.now();e.started=r,e.lastUpdate=r,e.sendSpeed=0,e.state="saving"},initSendState:(e,r)=>{const{size:o}=r.payload;e.bufferSize=o,e.state="waiting",e.bytesSended=0}},extraReducers(e){e.addCase(selectDevice,r=>{r.state="waiting",r.bytesSended=0})}}),{updateTool,updateBytesSended:updateBytesSended$2,updateStarted:updateStarted$2,updateState:updateState$2,initSendState}=screenSlice.actions,screenReducer=screenSlice.reducer,saveTabFile=(e,r)=>async(o,i)=>{const a=i();if(!getSelectedConnectedDevice(a)||getSavingState$2(a)==="saving")return;const l=getTabFileAPI(a);if(!l)return;const p=lodashExports.throttle(m=>{o(updateBytesSended$2(m))},1e3);try{o(updateStarted$2()),await l.setTabFile(Array.from(e),m=>{p(m)},()=>getSavingState$2(i())==="canceled"),getSavingState$2(i())!=="canceled"&&o(updateState$2("completed"))}catch(m){console.log(m),r(!1),o(updateState$2("failed"))}finally{p.cancel()}},getSelectedTool=e=>e.screen.selectedTool,getBytesSended$2=e=>e.screen.bytesSended,getBufferSize$2=e=>e.screen.bufferSize,getSendSpeed$2=e=>e.screen.sendSpeed,getSavingState$2=e=>e.screen.state,getDeviceConfig=createSelector(getSelectedTabkbConfig,e=>{if(!(!e||!e.screen))return e.screen}),getExportOptions=createSelector(getDeviceConfig,getSelectedTool,(e,r)=>{if(e&&e.fileTypes){const o=e.fileTypes;switch(r){case"image":return o.filter(i=>i.type==="image");case"video":return o.filter(i=>i.type==="video");case"slider":return o.filter(i=>i.type==="slider")}}}),getDefaultArea=createSelector(getSelectedTool,getExportOptions,(e,r)=>{if(r!==void 0)return r[0]}),getScreenMenus=createSelector(getDeviceConfig,e=>e&&e.menus?e.menus:[]),getKbresFlags=createSelector(getDeviceConfig,e=>{if(!e)return 0;let r=0;return e.swapBit&&(r|=KBRE_FLAGS_SWAP_BIT),r}),initialState$1={bytesSended:0,bufferSize:0,started:0,lastUpdate:0,sendSpeed:0,state:"waiting"},firmwareSlice=createSlice({name:"firmware",initialState:initialState$1,reducers:{updateState(e,r){e.bytesSended=0,e.state=r.payload},updateBytesSended:(e,r)=>{const o=r.payload-e.bytesSended;e.bytesSended=r.payload;const i=Date.now();e.sendSpeed=~~(o/((i-e.lastUpdate)/1e3)),e.lastUpdate=i},updateStarted:(e,r)=>{const{size:o}=r.payload,i=Date.now();e.started=i,e.lastUpdate=i,e.sendSpeed=0,e.state="saving",e.bytesSended=0,e.bufferSize=o}},extraReducers(e){e.addCase(selectDevice,r=>{r.state="waiting",r.bytesSended=0})}}),{updateState:updateState$1,updateBytesSended:updateBytesSended$1,updateStarted:updateStarted$1}=firmwareSlice.actions,firmwareReducer=firmwareSlice.reducer,saveTabFirmware$1=e=>async(r,o)=>{const i=o();if(getSavingState$1(i)==="saving")return;const a=getSelectedConnectedDevice(i);if(!a)return;const d=new TabKeyboardAPI(a);if(!d)return;const l=lodashExports.throttle(m=>{r(updateBytesSended$1(m))},1e3),p=Array.from(e);try{if(r(updateStarted$1({size:e.length})),!await d.setTabFirmwareInfo(e.length,p.slice(0,32))){r(updateState$1("failed"));return}await d.setTabFirmwareBuffer(p,_=>{l(_)},()=>getSavingState$1(o())==="canceled"),getSavingState$1(o())!=="canceled"&&r(updateState$1("completed"))}catch(m){console.log(m),r(updateState$1("failed"))}finally{l.cancel()}},getBytesSended$1=e=>e.firmware.bytesSended,getBufferSize$1=e=>e.firmware.bufferSize,getSendSpeed$1=e=>e.firmware.sendSpeed,getSavingState$1=e=>e.firmware.state,getSelectedDeviceFirmwareVersion=createSelector(getSelectedConnectedDevice,e=>e&&e.firmware?`${e.firmware>>8&255}.${e.firmware>>4&15}.${e.firmware&15}`:""),getCfgFirmwareVersion=createSelector(getSelectedTabkbConfig,e=>!e||!e.firmware?"0.0.0":e.firmware),getCfgFirmwareVerNum=createSelector(getCfgFirmwareVersion,e=>{const r=e.split(".");return r.length!==3?0:parseInt(r[0])<<8|parseInt(r[1])<<4|parseInt(r[2])}),getCfgFirmwareFile=createSelector(getSelectedTabkbConfig,e=>e&&e.firmwareFile?e.firmwareFile:""),getFirmwareNeedUpdate=createSelector(getSelectedConnectedDevice,getCfgFirmwareVerNum,getCfgFirmwareFile,(e,r,o)=>!e||!o||!r||!e.firmware?!1:e.firmware<r),initialState={bytesSended:0,bufferSize:0,started:0,lastUpdate:0,sendSpeed:0,state:"waiting"},bootSlice=createSlice({name:"boot",initialState,reducers:{updateState(e,r){e.bytesSended=0,e.state=r.payload},updateBytesSended:(e,r)=>{const o=r.payload-e.bytesSended;e.bytesSended=r.payload;const i=Date.now();e.sendSpeed=~~(o/((i-e.lastUpdate)/1e3)),e.lastUpdate=i},updateStarted:(e,r)=>{const{size:o}=r.payload,i=Date.now();e.started=i,e.lastUpdate=i,e.sendSpeed=0,e.state="saving",e.bytesSended=0,e.bufferSize=o}},extraReducers(e){e.addCase(selectDevice,r=>{r.state="waiting",r.bytesSended=0})}}),{updateState,updateBytesSended,updateStarted}=bootSlice.actions,bootReducer=bootSlice.reducer,saveTabFirmware=e=>async(r,o)=>{const i=o();if(getSavingState(i)==="saving")return;const a={path:"boot",vendorId:21675,productId:16980},d=new TabKeyboardAPI(a);if(!d)return;const l=lodashExports.throttle(m=>{r(updateBytesSended(m))},1e3),p=Array.from(e);try{if(r(updateStarted({size:e.length})),!await d.setTabFirmwareInfo(e.length,p.slice(0,32))){r(updateState("failed"));return}await d.setTabFirmwareBuffer(p,_=>{l(_)},()=>getSavingState(o())==="canceled"),getSavingState(o())!=="canceled"&&r(updateState("completed"))}catch(m){console.log(m),r(updateState("failed"))}finally{l.cancel()}},getBytesSended=e=>e.boot.bytesSended,getBufferSize=e=>e.boot.bufferSize,getSendSpeed=e=>e.boot.sendSpeed,getSavingState=e=>e.boot.state,formatNumberAsHex=(e,r)=>`0x${e.toString(16).padStart(r,"0").toUpperCase()}`,errorsListenerMiddleware=createListenerMiddleware(),captureError=(e,r)=>{captureException(new Error(e),{tags:{productName:r.productName,vendorId:formatNumberAsHex(r.vendorId,4),protocol:r.protocol},extra:{deviceInfo:r}})};errorsListenerMiddleware.startListening({actionCreator:logAppError,effect:async({payload:{message:e,deviceInfo:r}},o)=>{captureError(e,r)}});errorsListenerMiddleware.startListening({actionCreator:logKeyboardAPIError,effect:async({payload:e},r)=>{captureError(extractMessageFromKeyboardAPIError(e),e.deviceInfo)}});const sentryEnhancer=createReduxEnhancer({}),store=configureStore({reducer:{settings:settingsReducer,macros:macrosReducer,devices:devicesReducer,keymap:keymapReducer,definitions:definitionsReducer,lighting:lightingReducer,menus:menusReducer,design:designReducer,errors:errorsReducer,matrixlighting:matrixlightingReducer,actuation:actuationReducer,screen:screenReducer,tabkbconfig:tabkbconfigReducer,firmware:firmwareReducer,boot:bootReducer},enhancers:[sentryEnhancer],middleware:e=>e().prepend(errorsListenerMiddleware.middleware)}),defaultChippy={width:300,height:300},LoaderContainer=styled.div`
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
`,CircleContainer=styled.div`
  border-radius: 50%;
  background-color: var(--bg_icon);
  height: ${e=>e.$containerHeight}px;
  width: ${e=>e.$containerWidth}px;
  position: relative;
  overflow: hidden;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: center;

  animation-duration: 1.5s;
  animation-name: roll;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;

  &::after {
    height: ${e=>e.$containerHeight}px;
    width: ${e=>e.$containerWidth}px;
    position: absolute;
    content: '';
    background-color: ${e=>e.$progressColor};
    top: ${e=>e.$containerHeight+1}px;
    left: 0;
    right: 0;
    transition: transform 0.4s ease-out;
    transform: translate3d(
      0,
      ${e=>-(e.$progress||0)*e.$containerHeight}px,
      0
    );
  }
`,SvgComponent=e=>{const{theme:r}=e,o=getDarkenedColor(r.accent.c,.8),i={"upper-body":r.mod.t,"lower-body":r.mod.c,accent:o,bowtie:o};return jsxRuntimeExports.jsxs("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",x:0,y:0,viewBox:"0 0 600 600",style:{enableBackground:"new 0 0 600 600"},xmlSpace:"preserve",...e,children:[jsxRuntimeExports.jsx("style",{children:`.st3{fill:#fdfefe}.st4{fill:${i.bowtie}}.st5{fill-rule:evenodd;clip-rule:evenodd;fill:${i.accent}}.st7,.st9{fill-rule:evenodd;clip-rule:evenodd}.st10,.st9{fill:#fff}`}),jsxRuntimeExports.jsxs("g",{id:"Layer_2_00000088814685506851870240000015950599998114990989_",children:[jsxRuntimeExports.jsx("g",{id:"Feet",children:jsxRuntimeExports.jsx("path",{d:"M169.7 432.1c28.3 0 51.5 23.3 51.5 51.5s-23.3 51.5-51.5 51.5-51.5-23.3-51.5-51.5 23.2-51.5 51.5-51.5zM425.8 432.1c28.3 0 51.5 23.3 51.5 51.5s-23.3 51.5-51.5 51.5-51.5-23.3-51.5-51.5 23.2-51.5 51.5-51.5z"})}),jsxRuntimeExports.jsxs("g",{id:"Body",children:[jsxRuntimeExports.jsx("path",{d:"M26.7 66.8h546.2c9.8 0 17.7 7.9 17.7 17.7v273.3H9V84.6c0-9.8 7.9-17.8 17.7-17.8z",style:{fill:i["upper-body"]}}),jsxRuntimeExports.jsx("path",{d:"M9 357.4h581.6v113.7c0 8.4-6.9 15.3-15.3 15.3h-551c-8.4 0-15.3-6.9-15.3-15.3V357.4z",style:{fill:i["lower-body"]}})]}),jsxRuntimeExports.jsx("path",{d:"M229.4 262.8s33.5 19.4 66.3 19.4c33.5 0 66.3-19.4 66.3-19.4",style:{fill:"none",stroke:"#000",strokeWidth:6.8265,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:2.0408},id:"Smile"}),jsxRuntimeExports.jsxs("g",{id:"Eyes",children:[jsxRuntimeExports.jsx("path",{d:"M417.1 132.4c26.5 0 48 26.4 48 59.1s-21.4 59.1-48 59.1-48-26.4-48-59.1 21.5-59.1 48-59.1zM175.3 132.4c26.5 0 48 26.4 48 59.1s-21.4 59.1-48 59.1-48-26.4-48-59.1 21.5-59.1 48-59.1z"}),jsxRuntimeExports.jsx("path",{className:"st3",d:"M422.7 210.7c4.2 0 7.7 3.5 7.7 7.7s-3.5 7.7-7.7 7.7-7.7-3.5-7.7-7.7 3.5-7.7 7.7-7.7zM418.2 159.7c9.5 0 17.3 7.8 17.3 17.3s-7.8 17.3-17.3 17.3-17.3-7.8-17.3-17.3c-.1-9.5 7.7-17.3 17.3-17.3zM179.9 210.7c4.2 0 7.7 3.5 7.7 7.7s-3.5 7.7-7.7 7.7-7.7-3.5-7.7-7.7 3.5-7.7 7.7-7.7zM175.3 159.7c9.5 0 17.3 7.8 17.3 17.3s-7.8 17.3-17.3 17.3S158 186.5 158 177c-.1-9.5 7.8-17.3 17.3-17.3z"})]}),jsxRuntimeExports.jsx("g",{id:"Pins",children:jsxRuntimeExports.jsx("path",{className:"st4",d:"M12.6 276h17.5c5.8 0 10.5 6.9 10.5 15.3V324c0 8.4-4.7 15.3-10.5 15.3H12.6C6.7 339.3 2 332.4 2 324v-32.7c0-8.4 4.7-15.3 10.6-15.3zM12.6 190.3h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3H12.6c-5.8 0-10.5-6.9-10.5-15.3v-32.7c-.1-8.4 4.6-15.3 10.5-15.3zM12.6 102.6h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3H12.6C6.7 165.8 2 159 2 150.5v-32.7c0-8.4 4.7-15.2 10.6-15.2zM569.6 276h17.5c5.8 0 10.5 6.9 10.5 15.3V324c0 8.4-4.7 15.3-10.5 15.3h-17.5c-5.8 0-10.5-6.9-10.5-15.3v-32.7c0-8.4 4.7-15.3 10.5-15.3zM569.6 190.3h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3h-17.5c-5.8 0-10.5-6.9-10.5-15.3v-32.7c0-8.4 4.7-15.3 10.5-15.3zM569.6 102.6h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3h-17.5c-5.8 0-10.5-6.9-10.5-15.3v-32.7c0-8.5 4.7-15.3 10.5-15.3z"})}),jsxRuntimeExports.jsx("g",{id:"Cheeks",children:jsxRuntimeExports.jsxs("g",{id:"Layer_8",children:[jsxRuntimeExports.jsx("ellipse",{transform:"rotate(120 89.724 277.697)",className:"st5",cx:68.5,cy:243.9,rx:12.9,ry:29.3}),jsxRuntimeExports.jsx("ellipse",{transform:"rotate(150 447.814 278.705)",className:"st5",cx:430.5,cy:271.6,rx:29.3,ry:12.9})]})}),jsxRuntimeExports.jsx("g",{id:"Bowties",children:jsxRuntimeExports.jsx("path",{className:"st4",d:"m293.7 356.6 73.5-33.7v67.3l-73.5-33.6zM293.7 356.6l-73.5 33.7V323l73.5 33.6z"})})]}),jsxRuntimeExports.jsxs("g",{id:"Layer2",style:{opacity:.15},children:[jsxRuntimeExports.jsx("path",{className:"st7",d:"M6.7 105.2c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsxRuntimeExports.jsx("path",{d:"M112.4 486.3H24c-13 0-14.8-14.5-14.8-14.5S9 332.7 9 353.4c0 20.8 79.5 132.9 103.4 132.9z",style:{fillRule:"evenodd",clipRule:"evenodd",fill:"#180000"}}),jsxRuntimeExports.jsx("path",{className:"st9",d:"M35.9 105.1c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.8-11-4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st7",d:"M6.7 192.9c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st9",d:"M35.9 192.8c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.8-11-4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st7",d:"M6.7 278.6c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-6.9 2.7-10.9 4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st9",d:"M35.9 278.5c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.8-11-4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st7",d:"M563.7 105.2c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st9",d:"M592.9 105.1c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.7-11-4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st7",d:"M563.7 192.9c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st9",d:"M592.9 192.8c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.7-11-4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st7",d:"M563.7 278.6c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-6.9 2.7-10.9 4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st9",d:"M592.9 278.5c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.7-11-4.7-13z"}),jsxRuntimeExports.jsx("path",{className:"st10",d:"M220.2 323.1v34.2l73.4-.6zM293.7 356.6l73.5-33.6v34.3"})]})]})};function ChippyLoader(e){const r=e.width||defaultChippy.width,o=e.width||defaultChippy.height,i=r*.25,[a,d]=[o+i*2,r+i*2],l=useAppSelector(getSelectedTheme);return jsxRuntimeExports.jsx(LoaderContainer,{children:jsxRuntimeExports.jsx(CircleContainer,{$progress:e.progress,$progressColor:getDarkenedColor(l.accent.c,.9),$containerHeight:a,$containerWidth:d,children:jsxRuntimeExports.jsx("div",{style:{zIndex:1,width:r},children:jsxRuntimeExports.jsx(SvgComponent,{theme:e.theme})})})})}const LoadingText=styled.div`
  font-size: 30px;
  color: var(--color_label-highlighted);
`;function LoadingText$1(e){const{t:r}=useTranslation();return jsxRuntimeExports.jsx(LoadingText,{"data-tid":"loading-message",children:r(e.isSearching?"Searching for devices...":"Loading...")})}const Button=styled.div`
  display: flex;
  transition: transform 0.2s ease-out;
  user-select: none;
  color: #717070;
  border: 1px #717070 solid;
  width: 45px;
  height: 45px;
  padding: 2px;
  margin: 2px;
  text-overflow: ellipsis;
  overflow: hidden;
  cursor: pointer;
  font-size: 12px;
  text-align: center;
  border-radius: 4px;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  box-shadow: #8c8c8c 0 1px 0 0;
  &:hover {
    transform: translate3d(0, -2px, 0);
  }
`,title$6="Keymap",component$3=e=>jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faBook}),Message$1=styled.span`
  font-size: 18px;
  margin: 8px;
  text-align: center;
`,ErrorMessage=styled(Message$1)`
  color: #d15e5e;
`,SuccessMessage=styled(Message$1)`
  color: #9ab46a;
`,Encoder=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$i=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,renderEncoderError=()=>jsxRuntimeExports.jsx(ErrorMessage,{children:"Your current firmware does not support rotary encoders. Install the latest firmware for your device."}),Pane$c=()=>{const[e,r]=reactExports.useState(),[o,i]=reactExports.useState(),a=useAppSelector(getSelectedKey),d=useAppDispatch(),l=useAppSelector(getSelectedKeyDefinitions),p=useAppSelector(w=>getSelectedKeymap(w)||[]),m=useAppSelector(getSelectedLayerIndex),_=useAppSelector(getSelectedConnectedDevice),C=useAppSelector(getSelectedKeyboardAPI),y=p[a??-1],b=l[a??-1],K=!!b&&b.col!==-1&&b.row!==-1,v=(w,L)=>{if(C&&a!==null&&b&&b.ei!==void 0){const T=+b.ei;switch(w){case"ccw":{C.setEncoderValue(m,T,!1,L),i(L);break}case"cw":{C.setEncoderValue(m,T,!0,L),r(L);break}case"click":{d(updateKey(a,L));break}}}},j=async(w,L,T)=>{const P=await T.getEncoderValue(w,L,!0),k=await T.getEncoderValue(w,L,!1);r(P),i(k)};return reactExports.useEffect(()=>{if(_&&_.protocol>=10&&b!==void 0&&b.ei!==void 0&&C){const w=+b.ei;j(m,w,C)}},[b,_,m]),b===void 0||_&&_.protocol<10||o===void 0||e===void 0?jsxRuntimeExports.jsx(SpanOverflowCell,{children:renderEncoderError()}):jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsx(Encoder,{children:jsxRuntimeExports.jsxs(Container$i,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Rotate Counterclockwise"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:o,meta:{},setValue:w=>v("ccw",w)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Rotate Clockwise"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:e,meta:{},setValue:w=>v("cw",w)})})]}),K&&jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Press Encoder"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:y,meta:{},setValue:w=>v("click",w)})})]})]})})})},KeycodeList$1=styled.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, 64px);
  grid-auto-rows: 64px;
  justify-content: center;
  grid-gap: 10px;
`,MenuContainer$7=styled.div`
  padding: 15px 20px 20px 10px;
`,Keycode$1=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 64px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 10px;
  &:hover {
    border-color: var(--color_accent);
    transform: translate3d(0, -2px, 0);
  }
  ${e=>e.disabled&&"cursor:not-allowed;filter:opacity(50%);"}
`,KeycodeContent$1=styled.div`
  text-overflow: ellipsis;
  overflow: hidden;
`,CustomKeycode=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 10px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--color_accent);
  border-color: var(--color_inside_accent);
  color: var(--color_inside_accent);
  margin: 0;
`,KeycodeContainer$2=styled.div`
  padding: 12px;
  padding-bottom: 30px;
`,KeycodeDesc$1=styled.div`
  position: fixed;
  bottom: 0;
  background: #d9d9d97a;
  box-sizing: border-box;
  transition: opacity 0.4s ease-out;
  height: 25px;
  width: 100%;
  line-height: 14px;
  padding: 5px;
  font-size: 14px;
  opacity: 1;
  pointer-events: none;
  &:empty {
    opacity: 0;
  }
`,generateKeycodeCategories$1=(e,r=16)=>getKeycodes(r).concat(getOtherMenu(e)),maybeFilter$1=(e,r)=>e?()=>!0:r,Pane$b=()=>{const e=useAppSelector(getSelectedKey),r=useAppDispatch(),o=useAppSelector(getSelectedKeyDefinitions);return reactExports.useEffect(()=>()=>{r(updateSelectedKey(null))},[]),e!==null&&o[e].ei!==void 0?jsxRuntimeExports.jsx(Pane$c,{}):jsxRuntimeExports.jsx(KeycodePane$1,{})},KeycodePane$1=()=>{var V;const{t:e}=useTranslation(),r=useAppDispatch(),o=useAppSelector(A=>A.macros),i=useAppSelector(getSelectedDefinition),a=useAppSelector(getSelectedConnectedDevice),d=useAppSelector(getSelectedKeymap),l=useAppSelector(getSelectedKey),p=useAppSelector(getDisableFastRemap),m=useAppSelector(getSelectedKeyDefinitions),{basicKeyToByte:_}=useAppSelector(getBasicKeyToByte),C=useAppSelector(getMacroCount),y=useAppSelector(getTapDanceKeycodes),b=reactExports.useMemo(()=>generateKeycodeCategories$1(_,C),[_,C]);if(!i||!a||!d)return null;const[K,v]=reactExports.useState(b[0].id),[j,w]=reactExports.useState(null),[L,T]=reactExports.useState(!1),P=()=>{if(distExports.isVIADefinitionV3(i))return k(i);const{lighting:A,customKeycodes:B}=i,{keycodes:te}=distExports.getLightingDefinition(A);return b.filter(maybeFilter$1(te===distExports.KeycodeType.QMK,({id:ce})=>ce!=="qmk_lighting")).filter(maybeFilter$1(te===distExports.KeycodeType.WT,({id:ce})=>ce!=="lighting")).filter(maybeFilter$1(typeof B<"u",({id:ce})=>ce!=="custom"))},k=A=>{const te=["default",...A.keycodes||[]].flatMap(ce=>categoriesForKeycodeModule(ce));return(i.customKeycodes||[]).length!==0&&te.push("custom"),b.filter(ce=>te.includes(ce.id))},G=()=>jsxRuntimeExports.jsx(ErrorMessage,{children:e("Your current firmware does not support macros. Install the latest firmware for your device.")}),U=()=>{const{t:A}=useTranslation();return jsxRuntimeExports.jsx(MenuContainer$7,{children:P().map(({id:B,label:te})=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:B===K,onClick:()=>v(B),children:A(te)},B))})},W=()=>(r(disableGlobalHotKeys()),jsxRuntimeExports.jsx(KeycodeModal,{defaultValue:l!==null?d[l]:void 0,onExit:()=>{r(enableGlobalHotKeys()),T(!1)},onConfirm:A=>{r(enableGlobalHotKeys()),X(A),T(!1)}})),X=A=>{l!==null&&(r(updateKey(l,A)),r(updateSelectedKey(p||!m?null:getNextKey(l,m))))},Z=(A,B)=>{if(A=="text")T(!0);else return keycodeInMaster(A,_)&&X(getByteForCode(A,_))},I=(A,B)=>{const{code:te,title:ce,name:le}=A;return jsxRuntimeExports.jsx(Keycode$1,{disabled:!keycodeInMaster(te,_)&&te!="text",onClick:()=>Z(te),onMouseOver:()=>w(ce?`${te}: ${ce}`:te),onMouseOut:()=>w(null),children:jsxRuntimeExports.jsx(KeycodeContent$1,{children:le})},te)},z=()=>jsxRuntimeExports.jsx(CustomKeycode,{onClick:()=>l!==null&&Z("text"),onMouseOver:()=>w("Enter any QMK Keycode"),onMouseOut:()=>w(null),children:"Any"},"customKeycode"),Q=(A,B)=>{const te=A.map((ce,le)=>I(ce));switch(B){case"macro":return o.isFeatureSupported?jsxRuntimeExports.jsx(KeycodeList$1,{children:te}):G();case"special":return jsxRuntimeExports.jsx(KeycodeList$1,{children:te.concat(z())});case"custom":return!distExports.isVIADefinitionV2(i)&&!distExports.isVIADefinitionV3(i)||!i.customKeycodes&&y.length==0?null:jsxRuntimeExports.jsxs(KeycodeList$1,{children:[i.customKeycodes&&i.customKeycodes.map((ce,le)=>I({...ce,code:`CUSTOM(${le})`})),y.map((ce,le)=>I({...ce,code:`TD(${le})`}))]});default:return jsxRuntimeExports.jsx(KeycodeList$1,{children:te})}},re=(V=b.find(({id:A})=>A===K))==null?void 0:V.keycodes;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{children:U()}),jsxRuntimeExports.jsxs(OverflowCell,{children:[jsxRuntimeExports.jsx(KeycodeContainer$2,{children:Q(re,K)}),jsxRuntimeExports.jsx(KeycodeDesc$1,{children:j}),L&&W()]})]})},Icon$9=component$3,Title$9=title$6,Keycode$2=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$9,KeycodePane:KeycodePane$1,Pane:Pane$b,Title:Title$9},Symbol.toStringTag,{value:"Module"})),LightingControl=e=>{const r=useAppDispatch(),o=useAppSelector(getSelectedLightingData),i=useAppSelector(getSelectedDefinition),[a,d,l]=e.meta,p=o&&o[a];if(!p||!i)return null;const m=typeof d=="string"?d:d(e);switch(l.type){case"slider":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:m}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!p[0],onChange:_=>r(updateBacklightValue(a,+_))})})]});case"range":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:m}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:l.max,min:l.min,defaultValue:p[0],onChange:_=>r(updateBacklightValue(a,_))})})]});case"color":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:m}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ArrayColorPicker,{color:p,setColor:(_,C)=>r(updateBacklightValue(a,_,C))})})]});case"select":{const _=l.getOptions(i).map((C,y)=>({value:y,label:C}));return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:m}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:C=>{C&&r(updateBacklightValue(a,+C.value))},options:_,defaultValue:_.find(C=>p[0]===C.value)})})]})}case"row_col":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:m}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:p[0]!==255,onChange:_=>{r(updateBacklightValue(a,..._?[254,254]:[255,255]))}})})]})}return null},BacklightControls=[[distExports.LightingValue.BACKLIGHT_BRIGHTNESS,"Brightness",{type:"range",min:0,max:255}],[distExports.LightingValue.BACKLIGHT_EFFECT,"Effect",{type:"select",getOptions:e=>distExports.isVIADefinitionV2(e)&&distExports.getLightingDefinition(e.lighting).effects.map(([r])=>r)}],[distExports.LightingValue.BACKLIGHT_EFFECT_SPEED,"Effect Speed",{type:"range",min:0,max:3}]],UnderglowControls=[[distExports.LightingValue.QMK_RGBLIGHT_BRIGHTNESS,"Underglow Brightness",{type:"range",min:0,max:255}],[distExports.LightingValue.QMK_RGBLIGHT_EFFECT,"Underglow Effect",{type:"select",getOptions:e=>distExports.isVIADefinitionV2(e)&&distExports.getLightingDefinition(e.lighting).underglowEffects.map(([r])=>r)}],[distExports.LightingValue.QMK_RGBLIGHT_EFFECT_SPEED,"Underglow Effect Speed",{type:"range",min:0,max:3}]],GeneralPane=()=>{const e=useAppDispatch(),r=useAppSelector(getSelectedLightingData),o=useAppSelector(getSelectedDefinition);if(!r)return null;if(!distExports.isVIADefinitionV2(o))throw new Error("This lighting component is only compatible with v2 definitions");const i=distExports.getLightingDefinition(o.lighting),{supportedLightingValues:a}=i;if(i.supportedLightingValues.length!==0){const d=i.effects.map(([K,v])=>v),l=i.underglowEffects.map(([K,v])=>v),p=r[distExports.LightingValue.BACKLIGHT_EFFECT],m=r[distExports.LightingValue.QMK_RGBLIGHT_EFFECT],_=p&&d[p[0]]||0,C=m&&l[m[0]]===1,b=!!r.customColors&&_>2;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[BacklightControls.filter(K=>a.indexOf(K[0])!==-1).map(K=>jsxRuntimeExports.jsx(LightingControl,{meta:K})),UnderglowControls.filter(K=>a.indexOf(K[0])!==-1).map(K=>jsxRuntimeExports.jsx(LightingControl,{meta:K})),new Array(_).fill(1).map((K,v)=>K+v).map(K=>{let v,j;const w=K===1?distExports.LightingValue.BACKLIGHT_COLOR_1:distExports.LightingValue.BACKLIGHT_COLOR_2,L=r[w];if(b&&r.customColors)[v,j]=[r.customColors[K-1],(T,P)=>e(updateCustomColor(K-1,T,P))];else if(L)[v,j]=[{hue:L[0],sat:L[1]},(T,P)=>e(updateBacklightValue(w,T,P))];else return null;return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:["Color ",K]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ColorPicker$1,{color:v,setColor:j})})]},K)}),C&&jsxRuntimeExports.jsx(LightingControl,{meta:[distExports.LightingValue.QMK_RGBLIGHT_COLOR,"Underglow Color",{type:"color"}]})]})}return null},LayoutConfigValues=[distExports.LightingValue.BACKLIGHT_USE_7U_SPACEBAR,distExports.LightingValue.BACKLIGHT_USE_ISO_ENTER,distExports.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE,distExports.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT,distExports.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT,distExports.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS],BooleanControls=[[distExports.LightingValue.BACKLIGHT_USE_7U_SPACEBAR,"Use 7U Spacebar LEDs"],[distExports.LightingValue.BACKLIGHT_USE_ISO_ENTER,"Use ISO Enter LEDs"],[distExports.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE,"Use Split Backspace LEDs"],[distExports.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT,"Use Split Left Shift LEDs"],[distExports.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT,"Use Split Right Shift LEDs"],[distExports.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS,"Disable HHKB Blocker LEDs"]],Pane$a=()=>{const e=useAppDispatch(),r=useAppSelector(getSelectedLightingData),o=useAppSelector(getSelectedDefinition);if(!r)return null;if(!distExports.isVIADefinitionV2(o))throw new Error("This lighting component is only compatible with v2 definitions");const i=distExports.getLightingDefinition(o.lighting);if(i.supportedLightingValues.length!==0){const a=BooleanControls.filter(d=>i.supportedLightingValues.indexOf(d[0])!==-1);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:a.map(([d,l])=>{const p=r&&r[d],m=p&&p[0];return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:l}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!m,onChange:_=>e(updateBacklightValue(d,+_))})})]},d)})})}return null},AdvancedLightingValues=[distExports.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED,distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT,distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL,distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL,distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL,distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL],AccentText=styled.span`
  color: var(--color_accent);
`,RGBControls=[[distExports.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED,"Disable LEDs when USB is suspended",{type:"slider"}],[distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT,()=>{const e=useAppSelector(getSelectedLightingData),r=e&&e[distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT];return r?jsxRuntimeExports.jsxs("span",{children:["LED Sleep Timeout:"," ",jsxRuntimeExports.jsx(AccentText,{children:r[0]?`After ${r[0]} mins`:"Never"})]}):null},{type:"range",min:0,max:255}],[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR,"Caps Lock indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL,"Caps Lock indicator",{type:"row_col"}],[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR,"Layer 1 indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL,"Layer 1 indicator",{type:"row_col"}],[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR,"Layer 2 indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL,"Layer 2 indicator",{type:"row_col"}],[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR,"Layer 3 indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL,"Layer 3 indicator",{type:"row_col"}]],AdvancedPane=()=>{const e=useAppSelector(getSelectedLightingData),r=useAppSelector(getSelectedDefinition);if(distExports.isVIADefinitionV2(r)&&e){const{supportedLightingValues:o}=distExports.getLightingDefinition(r.lighting);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:RGBControls.filter(i=>o.indexOf(i[0])!==-1).map(i=>jsxRuntimeExports.jsx(LightingControl,{meta:i}))})}return null},Category={General:{label:"General",Menu:GeneralPane},Layout:{label:"Layout",Menu:Pane$a},Advanced:{label:"Advanced",Menu:AdvancedPane}},LightingPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$h=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,MenuContainer$6=styled.div`
  padding: 15px 20px 20px 10px;
`,Pane$9=()=>{const e=useAppSelector(getSelectedDefinition),[r,o]=reactExports.useState(Category.General),i=()=>{if(!distExports.isVIADefinitionV2(e))throw new Error("This lighting component is only compatible with v2 definitions");const a=LayoutConfigValues.some(l=>distExports.getLightingDefinition(e.lighting).supportedLightingValues.indexOf(l)!==-1),d=AdvancedLightingValues.some(l=>distExports.getLightingDefinition(e.lighting).supportedLightingValues.indexOf(l)!==-1);return[Category.General,...a?[Category.Layout]:[],...d?[Category.Advanced]:[]].filter(({Menu:l})=>!!l)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuCell,{children:jsxRuntimeExports.jsx(MenuContainer$6,{children:i().map(a=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:r===a,onClick:()=>o(a),children:a.label},a.label))})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(LightingPane,{children:jsxRuntimeExports.jsx(Container$h,{children:jsxRuntimeExports.jsx(r.Menu,{})})})})]})},Icon$8=component$4,Title$8=title$7,Lighting$1=Object.freeze(Object.defineProperty({__proto__:null,Category,Icon:Icon$8,Pane:Pane$9,Title:Title$8},Symbol.toStringTag,{value:"Module"})),SvgIcAdjust24Px=e=>jsxRuntimeExports.jsx("svg",{width:16.571,height:16.571,...e,children:jsxRuntimeExports.jsx("path",{d:"M8.285 0a8.285 8.285 0 108.285 8.285A8.3 8.3 0 008.285 0zm0 14.914a6.628 6.628 0 116.628-6.628 6.637 6.637 0 01-6.628 6.628zm2.486-6.628A2.486 2.486 0 118.285 5.8a2.482 2.482 0 012.486 2.485z",fill:"currentColor"})}),title$5="Macros",component$2=SvgIcAdjust24Px,matrixKeycodes=[basicKeyToByte.KC_ESC,basicKeyToByte.KC_F1,basicKeyToByte.KC_F2,basicKeyToByte.KC_F3,basicKeyToByte.KC_F4,basicKeyToByte.KC_F5,basicKeyToByte.KC_F6,basicKeyToByte.KC_F7,basicKeyToByte.KC_F8,basicKeyToByte.KC_F9,basicKeyToByte.KC_F10,basicKeyToByte.KC_F11,basicKeyToByte.KC_F12,basicKeyToByte.KC_PSCR,basicKeyToByte.KC_SLCK,basicKeyToByte.KC_PAUS,basicKeyToByte.KC_SLEP,basicKeyToByte.KC_MUTE,basicKeyToByte.KC_VOLD,basicKeyToByte.KC_VOLU,basicKeyToByte.KC_GRV,basicKeyToByte.KC_1,basicKeyToByte.KC_2,basicKeyToByte.KC_3,basicKeyToByte.KC_4,basicKeyToByte.KC_5,basicKeyToByte.KC_6,basicKeyToByte.KC_7,basicKeyToByte.KC_8,basicKeyToByte.KC_9,basicKeyToByte.KC_0,basicKeyToByte.KC_MINS,basicKeyToByte.KC_EQL,basicKeyToByte.KC_BSPC,basicKeyToByte.KC_INS,basicKeyToByte.KC_HOME,basicKeyToByte.KC_PGUP,basicKeyToByte.KC_NLCK,basicKeyToByte.KC_PSLS,basicKeyToByte.KC_PAST,basicKeyToByte.KC_PMNS,basicKeyToByte.KC_TAB,basicKeyToByte.KC_Q,basicKeyToByte.KC_W,basicKeyToByte.KC_E,basicKeyToByte.KC_R,basicKeyToByte.KC_T,basicKeyToByte.KC_Y,basicKeyToByte.KC_U,basicKeyToByte.KC_I,basicKeyToByte.KC_O,basicKeyToByte.KC_P,basicKeyToByte.KC_LBRC,basicKeyToByte.KC_RBRC,basicKeyToByte.KC_BSLS,basicKeyToByte.KC_DEL,basicKeyToByte.KC_END,basicKeyToByte.KC_PGDN,basicKeyToByte.KC_P7,basicKeyToByte.KC_P8,basicKeyToByte.KC_P9,basicKeyToByte.KC_PPLS,basicKeyToByte.KC_CAPS,basicKeyToByte.KC_A,basicKeyToByte.KC_S,basicKeyToByte.KC_D,basicKeyToByte.KC_F,basicKeyToByte.KC_G,basicKeyToByte.KC_H,basicKeyToByte.KC_J,basicKeyToByte.KC_K,basicKeyToByte.KC_L,basicKeyToByte.KC_SCLN,basicKeyToByte.KC_QUOT,basicKeyToByte.KC_ENT,basicKeyToByte.KC_P4,basicKeyToByte.KC_P5,basicKeyToByte.KC_P6,basicKeyToByte.KC_LSFT,basicKeyToByte.KC_Z,basicKeyToByte.KC_X,basicKeyToByte.KC_C,basicKeyToByte.KC_V,basicKeyToByte.KC_B,basicKeyToByte.KC_N,basicKeyToByte.KC_M,basicKeyToByte.KC_COMM,basicKeyToByte.KC_DOT,basicKeyToByte.KC_SLSH,basicKeyToByte.KC_RSFT,basicKeyToByte.KC_UP,basicKeyToByte.KC_P1,basicKeyToByte.KC_P2,basicKeyToByte.KC_P3,basicKeyToByte.KC_PENT,basicKeyToByte.KC_LCTL,basicKeyToByte.KC_LGUI,basicKeyToByte.KC_LALT,basicKeyToByte.KC_SPC,basicKeyToByte.KC_RALT,basicKeyToByte.KC_RGUI,basicKeyToByte.KC_MENU,basicKeyToByte.KC_RCTL,basicKeyToByte.KC_LEFT,basicKeyToByte.KC_DOWN,basicKeyToByte.KC_RGHT,basicKeyToByte.KC_P0,basicKeyToByte.KC_PDOT],evtToKeyByte={Digit1:basicKeyToByte.KC_1,Digit2:basicKeyToByte.KC_2,Digit3:basicKeyToByte.KC_3,Digit4:basicKeyToByte.KC_4,Digit5:basicKeyToByte.KC_5,Digit6:basicKeyToByte.KC_6,Digit7:basicKeyToByte.KC_7,Digit8:basicKeyToByte.KC_8,Digit9:basicKeyToByte.KC_9,Digit0:basicKeyToByte.KC_0,KeyA:basicKeyToByte.KC_A,KeyB:basicKeyToByte.KC_B,KeyC:basicKeyToByte.KC_C,KeyD:basicKeyToByte.KC_D,KeyE:basicKeyToByte.KC_E,KeyF:basicKeyToByte.KC_F,KeyG:basicKeyToByte.KC_G,KeyH:basicKeyToByte.KC_H,KeyI:basicKeyToByte.KC_I,KeyJ:basicKeyToByte.KC_J,KeyK:basicKeyToByte.KC_K,KeyL:basicKeyToByte.KC_L,KeyM:basicKeyToByte.KC_M,KeyN:basicKeyToByte.KC_N,KeyO:basicKeyToByte.KC_O,KeyP:basicKeyToByte.KC_P,KeyQ:basicKeyToByte.KC_Q,KeyR:basicKeyToByte.KC_R,KeyS:basicKeyToByte.KC_S,KeyT:basicKeyToByte.KC_T,KeyU:basicKeyToByte.KC_U,KeyV:basicKeyToByte.KC_V,KeyW:basicKeyToByte.KC_W,KeyX:basicKeyToByte.KC_X,KeyY:basicKeyToByte.KC_Y,KeyZ:basicKeyToByte.KC_Z,Comma:basicKeyToByte.KC_COMM,Period:basicKeyToByte.KC_DOT,Semicolon:basicKeyToByte.KC_SCLN,Quote:basicKeyToByte.KC_QUOT,BracketLeft:basicKeyToByte.KC_LBRC,BracketRight:basicKeyToByte.KC_RBRC,Backspace:basicKeyToByte.KC_BSPC,Backquote:basicKeyToByte.KC_GRV,Slash:basicKeyToByte.KC_SLSH,Backslash:basicKeyToByte.KC_BSLS,Minus:basicKeyToByte.KC_MINS,Equal:basicKeyToByte.KC_EQL,IntlRo:basicKeyToByte.KC_RO,IntlYen:basicKeyToByte.KC_JYEN,AltLeft:basicKeyToByte.KC_LALT,AltRight:basicKeyToByte.KC_RALT,CapsLock:basicKeyToByte.KC_CAPS,ControlLeft:basicKeyToByte.KC_LCTL,ControlRight:basicKeyToByte.KC_RCTL,MetaLeft:basicKeyToByte.KC_LGUI,MetaRight:basicKeyToByte.KC_RGUI,OSLeft:basicKeyToByte.KC_LGUI,OSRight:basicKeyToByte.KC_RGUI,ShiftLeft:basicKeyToByte.KC_LSFT,ShiftRight:basicKeyToByte.KC_RSFT,ContextMenu:basicKeyToByte.KC_APP,Enter:basicKeyToByte.KC_ENT,Space:basicKeyToByte.KC_SPC,Tab:basicKeyToByte.KC_TAB,Delete:basicKeyToByte.KC_DEL,End:basicKeyToByte.KC_END,Help:basicKeyToByte.KC_HELP,Home:basicKeyToByte.KC_HOME,Insert:basicKeyToByte.KC_INS,PageDown:basicKeyToByte.KC_PGDN,PageUp:basicKeyToByte.KC_PGUP,ArrowDown:basicKeyToByte.KC_DOWN,ArrowLeft:basicKeyToByte.KC_LEFT,ArrowRight:basicKeyToByte.KC_RGHT,ArrowUp:basicKeyToByte.KC_UP,Escape:basicKeyToByte.KC_ESC,PrintScreen:basicKeyToByte.KC_PSCR,ScrollLock:basicKeyToByte.KC_SLCK,AudioVolumeUp:basicKeyToByte.KC_VOLU,AudioVolumeDown:basicKeyToByte.KC_VOLD,AudioVolumeMute:basicKeyToByte.KC_MUTE,Pause:basicKeyToByte.KC_PAUS,F1:basicKeyToByte.KC_F1,F2:basicKeyToByte.KC_F2,F3:basicKeyToByte.KC_F3,F4:basicKeyToByte.KC_F4,F5:basicKeyToByte.KC_F5,F6:basicKeyToByte.KC_F6,F7:basicKeyToByte.KC_F7,F8:basicKeyToByte.KC_F8,F9:basicKeyToByte.KC_F9,F10:basicKeyToByte.KC_F10,F11:basicKeyToByte.KC_F11,F12:basicKeyToByte.KC_F12,F13:basicKeyToByte.KC_F13,F14:basicKeyToByte.KC_F14,F15:basicKeyToByte.KC_F15,F16:basicKeyToByte.KC_F16,F17:basicKeyToByte.KC_F17,F18:basicKeyToByte.KC_F18,F19:basicKeyToByte.KC_F19,F20:basicKeyToByte.KC_F20,F21:basicKeyToByte.KC_F21,F22:basicKeyToByte.KC_F22,F23:basicKeyToByte.KC_F23,F24:basicKeyToByte.KC_F24,NumLock:basicKeyToByte.KC_NLCK,Numpad0:basicKeyToByte.KC_P0,Numpad1:basicKeyToByte.KC_P1,Numpad2:basicKeyToByte.KC_P2,Numpad3:basicKeyToByte.KC_P3,Numpad4:basicKeyToByte.KC_P4,Numpad5:basicKeyToByte.KC_P5,Numpad6:basicKeyToByte.KC_P6,Numpad7:basicKeyToByte.KC_P7,Numpad8:basicKeyToByte.KC_P8,Numpad9:basicKeyToByte.KC_P9,NumpadAdd:basicKeyToByte.KC_PPLS,NumpadComma:basicKeyToByte.KC_COMM,NumpadDecimal:basicKeyToByte.KC_PDOT,NumpadDivide:basicKeyToByte.KC_PSLS,NumpadEnter:basicKeyToByte.KC_PENT,NumpadEqual:basicKeyToByte.KC_PEQL,NumpadMultiply:basicKeyToByte.KC_PAST,NumpadSubtract:basicKeyToByte.KC_PMNS};function getIndexByEvent(e){const r=e.code,o=evtToKeyByte[r]||evtToKeyByte[e.key];return o?matrixKeycodes.indexOf(o):-1}function mapEvtToKeycode(e){switch(e.code){case"Digit1":return"KC_1";case"Digit2":return"KC_2";case"Digit3":return"KC_3";case"Digit4":return"KC_4";case"Digit5":return"KC_5";case"Digit6":return"KC_6";case"Digit7":return"KC_7";case"Digit8":return"KC_8";case"Digit9":return"KC_9";case"Digit0":return"KC_0";case"KeyA":return"KC_A";case"KeyB":return"KC_B";case"KeyC":return"KC_C";case"KeyD":return"KC_D";case"KeyE":return"KC_E";case"KeyF":return"KC_F";case"KeyG":return"KC_G";case"KeyH":return"KC_H";case"KeyI":return"KC_I";case"KeyJ":return"KC_J";case"KeyK":return"KC_K";case"KeyL":return"KC_L";case"KeyM":return"KC_M";case"KeyN":return"KC_N";case"KeyO":return"KC_O";case"KeyP":return"KC_P";case"KeyQ":return"KC_Q";case"KeyR":return"KC_R";case"KeyS":return"KC_S";case"KeyT":return"KC_T";case"KeyU":return"KC_U";case"KeyV":return"KC_V";case"KeyW":return"KC_W";case"KeyX":return"KC_X";case"KeyY":return"KC_Y";case"KeyZ":return"KC_Z";case"Comma":return"KC_COMM";case"Period":return"KC_DOT";case"Semicolon":return"KC_SCLN";case"Quote":return"KC_QUOT";case"BracketLeft":return"KC_LBRC";case"BracketRight":return"KC_RBRC";case"Backquote":return"KC_GRV";case"Slash":return"KC_SLSH";case"Backspace":return"KC_BSPC";case"Backslash":return"KC_BSLS";case"Minus":return"KC_MINS";case"Equal":return"KC_EQL";case"IntlRo":return"KC_RO";case"IntlYen":return"KC_JYEN";case"AltLeft":return"KC_LALT";case"AltRight":return"KC_RALT";case"CapsLock":return"KC_CAPS";case"ControlLeft":return"KC_LCTL";case"ControlRight":return"KC_RCTL";case"MetaLeft":return"KC_LGUI";case"MetaRight":return"KC_RGUI";case"OSLeft":return"KC_LGUI";case"OSRight":return"KC_RGUI";case"ShiftLeft":return"KC_LSFT";case"ShiftRight":return"KC_RSFT";case"ContextMenu":return"KC_APP";case"Apps":return"KC_APP";case"Enter":return"KC_ENT";case"Space":return"KC_SPC";case"Tab":return"KC_TAB";case"Delete":return"KC_DEL";case"End":return"KC_END";case"Help":return"KC_HELP";case"Home":return"KC_HOME";case"Insert":return"KC_INS";case"PageDown":return"KC_PGDN";case"PageUp":return"KC_PGUP";case"ArrowDown":return"KC_DOWN";case"ArrowLeft":return"KC_LEFT";case"ArrowRight":return"KC_RGHT";case"ArrowUp":return"KC_UP";case"Escape":return"KC_ESC";case"PrintScreen":return"KC_PSCR";case"ScrollLock":return"KC_SLCK";case"Pause":return"KC_PAUS";case"F1":return"KC_F1";case"F2":return"KC_F2";case"F3":return"KC_F3";case"F4":return"KC_F4";case"F5":return"KC_F5";case"F6":return"KC_F6";case"F7":return"KC_F7";case"F8":return"KC_F8";case"F9":return"KC_F9";case"F10":return"KC_F10";case"F11":return"KC_F11";case"F12":return"KC_F12";case"F13":return"KC_F13";case"F14":return"KC_F14";case"F15":return"KC_F15";case"F16":return"KC_F16";case"F17":return"KC_F17";case"F18":return"KC_F18";case"F19":return"KC_F19";case"F20":return"KC_F20";case"F21":return"KC_F21";case"F22":return"KC_F22";case"F23":return"KC_F23";case"F24":return"KC_F24";case"NumLock":return"KC_NLCK";case"Numpad0":return"KC_P0";case"Numpad1":return"KC_P1";case"Numpad2":return"KC_P2";case"Numpad3":return"KC_P3";case"Numpad4":return"KC_P4";case"Numpad5":return"KC_P5";case"Numpad6":return"KC_P6";case"Numpad7":return"KC_P7";case"Numpad8":return"KC_P8";case"Numpad9":return"KC_P9";case"NumpadAdd":return"KC_PPLS";case"NumpadComma":return"KC_COMM";case"NumpadDecimal":return"KC_PDOT";case"NumpadDivide":return"KC_PSLS";case"NumpadEnter":return"KC_PENT";case"NumpadEqual":return"KC_PEQL";case"NumpadMultiply":return"KC_PAST";case"NumpadSubtract":return"KC_PMNS";case"AudioVolumeUp":return"KC_VOLU";case"AudioVolumeDown":return"KC_VOLD";case"AudioVolumeMute":return"KC_MUTE";default:console.error("Unreacheable keydown code",e)}}let heldKeys={},lastEvtTime=0;const useKeycodeRecorder=(e,r)=>{const o=reactExports.useState([]),[,i]=o,a=reactExports.useMemo(()=>getKeycodes().flatMap(m=>m.keycodes),[]),d=reactExports.useCallback((m,_)=>{m.preventDefault(),e&&!m.repeat&&i(C=>{const y=a.find(v=>v.code===mapEvtToKeycode(m)),b=Date.now(),K=y==null?void 0:y.code;return C.length&&r&&C.push([RawKeycodeSequenceAction.Delay,b-lastEvtTime]),K&&C.push([_,K]),lastEvtTime=b,[...C]})},[e,r]),l=reactExports.useCallback(m=>{m.repeat||(heldKeys[m.code]=!0,d(m,RawKeycodeSequenceAction.Down))},[e]),p=reactExports.useCallback(m=>{heldKeys[m.code]=!1,d(m,RawKeycodeSequenceAction.Up)},[e]);return reactExports.useEffect(()=>(heldKeys={},e&&(window.addEventListener("keydown",l),window.addEventListener("keyup",p)),()=>{heldKeys={},window.removeEventListener("keydown",l),window.removeEventListener("keyup",p)}),[e]),o};styled.div`
  border: 2px solid var(--bg_control);
  transition: border-color 0.2s ease-in-out;
  margin: 15px 0px;
  display: inline-block;
  &:focus-within {
    border-color: var(--color_accent);
  }
  border-radius: 4px;
  font-size: 16px;
`;const KeycodeSequenceLabel=styled.div`
  display: inline-flex;
  user-select: none;
  color: #717070;
  padding: 6px 4px;
  text-overflow: ellipsis;
  min-width: 30px;
  font-size: 12px;
  text-align: center;
  border-radius: 4px;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  font-size: 16px;
  border: 2px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 2px;
  white-space: nowrap;
  position: relative;
  margin: 15px 0px;
`,KeycodeDownLabel=styled(KeycodeSequenceLabel)`
  &::after {
    border-style: solid;
    border-color: transparent;
    content: '';
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--color_accent);
    position: absolute;
    margin-top: 55px;
    width: 0;
  }
`,SequenceLabelSeparator=styled.div`
  width: 20px;
  display: inline-flex;
  vertical-align: middle;
  border: 1px solid var(--color_accent);
`,CharacterStreamLabel=styled(KeycodeSequenceLabel)`
  border-color: var(--border_color_cell);
  background: var(--bg_menu);
  white-space: pre-wrap;
  min-height: 1.25em;
  letter-spacing: 2px;
`,KeycodePressLabel=styled(KeycodeSequenceLabel)`
  border-color: var(--color_accent);
`,KeycodeUpLabel=styled(KeycodeSequenceLabel)`
  &::after {
    content: '';
    border-style: solid;
    margin-top: -55px;
    border-color: transparent;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid var(--color_accent);
    position: absolute;
    width: 0;
  }
`,KeycodeSequenceWait=styled.div`
  display: inline-flex;
  font-weight: bold;
  user-select: none;
  color: #717070;
  text-overflow: ellipsis;
  min-width: 30px;
  text-align: center;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  font-size: 16px;
  color: var(--color_label-highlighted);
  box-shadow: none;
  position: relative;
  white-space: nowrap;
  position: relative;
  margin: 15px 0px;
  box-sizing: border-box;
  border: 2px solid;
  padding: 4px 4px;
  border-color: var(--color_accent);
  border-radius: 2px;
`,NumberInput=styled.input.attrs({type:"number",placeholder:"XXXXX"})`
  appearance: none;
  background: none;
  border: none;
  border-bottom: 1px solid;
  color: var(--color_label);
  width: 45px;
  text-align: center;
  font-family: inherit;
  font-size: inherit;
  color: var(--color_label-highlighted);
  margin: 0 5px 0 0;
  &:focus {
    color: var(--color_accent);
  }
  &::-webkit-inner-spin-button {
    appearance: none;
    display: none;
  }
  &:invalid {
    color: red;
  }
  &:placeholder-shown {
    color: red;
  }
`,WaitInput=e=>{const r=reactExports.useRef(null),o=a=>{(!a.data||!/^\d$/.test(a.data))&&a.preventDefault()},i=a=>{+a.target.value>0&&+a.target.value<1e5&&e.updateValue(e.index,+a.target.value)};return jsxRuntimeExports.jsxs(KeycodeSequenceWait,{children:[jsxRuntimeExports.jsx(NumberInput,{ref:r,onBeforeInput:o,value:e.value,onChange:i}),"ms"]})},getSequenceItemComponent=e=>e===RawKeycodeSequenceAction.Down?KeycodeDownLabel:e===RawKeycodeSequenceAction.Up?KeycodeUpLabel:e===RawKeycodeSequenceAction.CharacterStream?CharacterStreamLabel:KeycodePressLabel;function capitalize(e){return e[0].toUpperCase()+e.slice(1)}const getSequenceLabel=e=>{const r=(e==null?void 0:e.keys)??(e==null?void 0:e.shortName)??(e==null?void 0:e.name)??"";return r.length>1?capitalize(r):r},SimpleIconButton=styled.button`
  appearance: none;
  position: relative;
  display: inline-block;
  background: transparent;
  border: none;
  cursor: pointer;
  line-height: initial;
  font-size: initial;
  padding: 0;
  &:disabled {
    cursor: not-allowed;
    cursor: not-allowed;
  }
  svg {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--border_color_icon);"};
  }
  &:hover {
    svg {
      color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
    }
  }
`,IconButton=styled.button`
  appearance: none;
  width: 40px;
  position: relative;
  display: inline-block;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 10px 10px;
  line-height: initial;
  font-size: initial;
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  &:disabled {
    cursor: not-allowed;
    border-right: 1px solid var(--border_color_icon);
    cursor: not-allowed;
    background: var(--bg_menu);
  }
  &:hover {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
    border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
    border-right: 1px solid var(--border_color_icon);
    background-color: ${e=>e.disabled?"var(--bg_menu)":"var(--color_accent)"};
  }

  svg {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  }
  &:hover {
    svg {
      color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
    }

    color: var(--color_label-highlighted);
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,IconButtonUnfilledContainer=styled(IconButton)`
  cursor: pointer;
  background: inherit;
  border: 1px solid var(--color_accent);
  width: 30px;
  height: 30px;
  justify-content: center;
  display: inline-flex;
  align-items: center;
`,IconButtonContainer=styled(IconButton)`
  cursor: pointer;
  background: var(--bg_control);
  border-right: 1px solid var(--border_color_icon);
`,IconToggleContainer=styled(IconButton)`
  cursor: pointer;
  transition: all 0.4s ease;
  background: ${e=>e.$selected?"var(--color_accent)":"var(--bg_menu)"};
  svg {
    color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--bg_icon)"};
  }
  &:hover {
    background: ${e=>e.$selected?"var(--color_accent)":"var(--bg_menu)"};
    svg {
      color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--bg_icon)"};
    }
  }
  border-right: 1px solid var(--border_color_icon);
`,Keycap2DTooltip=e=>{const r=reactExports.useMemo(()=>({containerStyles:{position:"absolute",left:"50%",transformOrigin:"left",transition:"all 0.1s ease-in-out",top:0,marginTop:-40,zIndex:4,pointerEvents:"none",filter:"drop-shadow(0px 0px 1px white)"},contentStyles:{padding:"5px 8px",borderRadius:10,background:"var(--color_accent)",color:"var(--color_inside-accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:16,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)"},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--color_accent)",position:"absolute",marginLeft:-6,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:r.containerStyles,contentStyles:r.contentStyles,pointerStyles:r.pointerStyles})},KeycapTooltip=e=>{const r=reactExports.useMemo(()=>({containerStyles:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",marginTop:-800},contentStyles:{padding:"70px 70px",background:"var(--color_accent)",color:"var(--color_inside-accent)",borderRadius:100,fontSize:200,fontFamily:"'Fira Sans', Helvetica, Helvetica Neue, Arial, serif",whiteSpace:"nowrap",letterSpacing:1,display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"bold"},pointerStyles:{height:150,width:150,marginTop:-100,transform:"rotate(45deg)",background:"var(--color_accent)"}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:r.containerStyles,contentStyles:r.contentStyles,pointerStyles:r.pointerStyles})},CategoryMenuTooltip=e=>{const r=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:45,left:0,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:0,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_accent)",color:"var(--color_inside-accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)",marginLeft:18},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--color_accent)",position:"absolute",marginLeft:15,marginTop:-41,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:r.containerStyles,contentStyles:r.contentStyles,pointerStyles:r.pointerStyles})},ProgressBarTooltip=e=>{const r=reactExports.useMemo(()=>({containerStyles:{position:"absolute",left:"50%",transformOrigin:"left",transition:"all 0.1s ease-in-out",top:0,marginTop:-40,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_inside-accent)",color:"var(--color_accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)"},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:-6,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:r.containerStyles,contentStyles:r.contentStyles,pointerStyles:r.pointerStyles})},IconButtonTooltip=e=>{const r=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:50,left:0,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:0,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_inside-accent)",color:"var(--color_accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)",marginLeft:18},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:15,marginTop:-41,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:r.containerStyles,contentStyles:r.contentStyles,pointerStyles:r.pointerStyles})},MenuTooltip=e=>{const r=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:0,left:45,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:-5,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 5px",background:"var(--color_inside-accent)",color:"var(--color_accent)",borderRadius:10,fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontWeight:400,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",zIndex:5},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderTop:"6px solid transparent",borderBottom:"6px solid transparent",borderRight:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:-9,marginTop:-21,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:r.containerStyles,contentStyles:r.contentStyles,pointerStyles:r.pointerStyles})},Tooltip=e=>{const{containerStyles:r,contentStyles:o,pointerStyles:i}=e;return jsxRuntimeExports.jsxs("div",{style:r,className:"tooltip",children:[jsxRuntimeExports.jsx("div",{style:o,children:e.children}),jsxRuntimeExports.jsx("div",{style:i})]})},MacroEditControlsContainer=styled.div`
  background: var(--bg_menu);
  display: inline-flex;
  align-items: center;
  padding: 0 10px;
`,MacroControlGroupContainer=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,MacroControlGroupDivider=styled.div`
  background: var(--border_color_icon);
  width: 1px;
  height: 80%;
  margin: 0 10px;
`,MacroEditControls=({isFullscreen:e,isRecording:r,recordingToggleChange:o,hasUnsavedChanges:i,undoChanges:a,saveChanges:d,recordDelays:l,toggleRecordDelays:p,optimizeRecording:m,toggleOptimizeRecording:_,isEmpty:C,deleteMacro:y,toggleFullscreen:b,isDelaySupported:K})=>{const{t:v}=useTranslation(),j=jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>{o(!r)},disabled:!e,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:r?faSquare:faCircle}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v(e?r?"Stop Recording":"Record Keystrokes":"Can only record when fullscreen")})]});return jsxRuntimeExports.jsxs(MacroEditControlsContainer,{children:[i?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:r?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(MacroControlGroupContainer,{children:[jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:!i||r,onClick:a,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faUndo}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v("Undo Changes")})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:!i||r,onClick:()=>d(),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faSave}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v("Save Changes")})]})]}),jsxRuntimeExports.jsx(MacroControlGroupDivider,{})]})}):C?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MacroControlGroupContainer,{children:jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:i||r,onClick:y,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faTrash}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v("Delete Macro")})]})}),jsxRuntimeExports.jsx(MacroControlGroupDivider,{})]}),jsxRuntimeExports.jsxs(MacroControlGroupContainer,{children:[j,jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:b,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:e?faCompress:faExpand}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v(e?"Exit Fullscreen":"Fullscreen")})]})]}),r?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MacroControlGroupDivider,{}),jsxRuntimeExports.jsxs(MacroControlGroupContainer,{children:[jsxRuntimeExports.jsxs(IconToggleContainer,{$selected:m,onClick:_,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faMagicWandSparkles}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v(m?"Skip Smart Optimization":"Use Smart Optimization")})]}),jsxRuntimeExports.jsxs(IconToggleContainer,{disabled:!K,$selected:l,onClick:p,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faStopwatch,className:"fa-stack-1x"}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:v(K?l?"Skip Recording Delays":"Record Delays":"Upgrade firmware to use delays")})]})]})]})]})},DeletableContainer=styled.div`
  display: inline-flex;
  vertical-align: middle;
  position: relative;
  svg {
    color: var(--bg_icon-highlighted);
    position: absolute;
    right: -5px;
    top: 6px;
    opacity: 0;
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
    background: var(--bg_icon);
    border-radius: 50%;
    transform: scale(0.8);
  }
  &:hover svg {
    opacity: 1;
    transform: scale(1);
  }
`,Deletable=e=>jsxRuntimeExports.jsxs(DeletableContainer,{style:{pointerEvents:e.disabled?"none":"all"},children:[e.children,jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faXmarkCircle,size:"lg",onClick:()=>e.deleteItem(e.index)})]}),pipeline=(e,...r)=>r.reduce((o,i)=>i(o),e),NoMacroRecorded=styled.div`
  font-style: italic;
  color: var(--color_label-highlighted);
`,MacroSequenceContainer=styled.div`
  max-width: 960px;
  width: 100%;
  display: block;
  border: 1px solid var(--border_color_cell);
  border-style: ${e=>e.$isModified?"dashed":"solid"};
  padding: 30px 20px;
  border-radius: 15px;
  margin-top: 10px;
  box-sizing: border-box;
}
`,componentJoin=(e,r)=>e.reduce((o,i,a)=>(a&&o.push({...r,key:a}),o.push(i),o),[]),KeycodeMap=getKeycodes().flatMap(e=>e.keycodes).reduce((e,r)=>({...e,[r.code]:r}),{}),optimizeKeycodeSequence=e=>pipeline(e,convertCharacterTaps,trimLastWait,mergeConsecutiveWaits,foldKeydownKeyupKeys,convertToCharacterStreams),cleanKeycodeSequence=e=>pipeline(e,mergeConsecutiveWaits),MacroRecorder=({selectedMacro:e,setUnsavedMacro:r,saveMacro:o,undoMacro:i,isDelaySupported:a})=>{const{t:d}=useTranslation(),[l,p]=reactExports.useState(!0),[m,_]=reactExports.useState(!1),[C,y]=reactExports.useState(!1),[b,K]=reactExports.useState(!!document.fullscreenElement),{smartOptimizeEnabled:v,recordDelaysEnabled:j}=useAppSelector(getMacroEditorSettings),w=useDispatch(),[L,T]=useKeycodeRecorder(m,j),P=reactExports.useRef(null),k=reactExports.useCallback(async V=>{_(V),V?(await navigator.keyboard.lock(),T([]),p(!1),y(!0)):(navigator.keyboard.unlock(),v&&T(optimizeKeycodeSequence(L)),y(!1))},[L,_]),G=reactExports.useCallback(()=>{o(""),p(!0),y(!1)},[T,o]),U=reactExports.useCallback(()=>{i(),T([]),p(!0),y(!1)},[i]);reactExports.useEffect(()=>{p(!0),y(!1),T([])},[e]);const W=()=>[...l?e??[]:L],X=reactExports.useMemo(()=>{let V,A=W();return l||!C||!v?V=A:V=optimizeKeycodeSequence(A),V},[L,l,v,C,e]);reactExports.useEffect(()=>{X&&r(sequenceToExpression(X))},[X]);const Z=reactExports.useCallback(()=>{l&&p(!1)},[l]),I=reactExports.useCallback(V=>{const A=W();A.splice(V,1),T(cleanKeycodeSequence(A)),Z()},[X,e,L,l]),z=reactExports.useCallback((V,A)=>{const B=W();B.splice(V,1,[RawKeycodeSequenceAction.Delay,A]),T(cleanKeycodeSequence(B)),Z()},[X,e,L,l]),Q=reactExports.useMemo(()=>componentJoin(X.map(([V,A],B)=>{const te=getSequenceItemComponent(V);return jsxRuntimeExports.jsx(Deletable,{index:B,deleteItem:I,disabled:m,children:RawKeycodeSequenceAction.Delay!==V?jsxRuntimeExports.jsx(te,{children:V===RawKeycodeSequenceAction.CharacterStream?componentJoin(String(A).split(" ").map((ce,le)=>jsxRuntimeExports.jsx("span",{children:ce},le)),jsxRuntimeExports.jsx("span",{style:{fontFamily:"fantasy, cursive, monospace"},children:"␣"})):Array.isArray(A)?A.map(ce=>getSequenceLabel(KeycodeMap[ce])??ce).join(" + "):getSequenceLabel(KeycodeMap[A])}):jsxRuntimeExports.jsx(WaitInput,{index:B,value:Number(A),updateValue:z})},`${B}-${V}`)}),jsxRuntimeExports.jsx(SequenceLabelSeparator,{})),[X]);reactExports.useEffect(()=>{const V=()=>{K(!!document.fullscreenElement)};return document.documentElement.addEventListener("fullscreenchange",V),()=>{k(!1),document.documentElement.removeEventListener("fullscreenchange",V)}},[K]);const re=reactExports.useCallback(()=>{document.fullscreenElement?document.exitFullscreen&&(k(!1),document.exitFullscreen()):document.documentElement.requestFullscreen()},[k]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MacroSequenceContainer,{ref:P,$isModified:!l,children:Q.length?Q:jsxRuntimeExports.jsx(NoMacroRecorded,{children:d("No macro recorded yet...")})}),jsxRuntimeExports.jsx("div",{style:{border:"none",maxWidth:960,width:"100%",display:"flex",justifyContent:"center",transform:"translate(-0px, -21px)"},children:jsxRuntimeExports.jsx(MacroEditControls,{isFullscreen:b,isEmpty:!e||!e.length,optimizeRecording:v,recordDelays:j,isRecording:m,addText:()=>{},deleteMacro:G,toggleOptimizeRecording:()=>{w(setMacroEditorSettings({smartOptimizeEnabled:!v}))},toggleRecordDelays:()=>{w(setMacroEditorSettings({recordDelaysEnabled:!j}))},toggleFullscreen:re,undoChanges:U,saveChanges:()=>o(),hasUnsavedChanges:!l,recordingToggleChange:k,isDelaySupported:a})})]})},TextArea=styled.textarea`
  box-sizing: border-box;
  background: var(--bg_control);
  padding: 5px 10px;
  border-color: var(--border_color_icon);
  color: var(--color_label);
  width: 100%;
  height: 200px;
  font-size: 16px;
  line-height: 18px;
  resize: none;
  font-family: 'Source Code Pro';
  font-weight: 500;
  &::placeholder {
    color: var(--color_label);
  }
  &:focus {
    color: var(--color_accent);
    outline-color: var(--color_accent);
  }
`,ToastErrorMessage=styled(ErrorMessage)`
  margin: 0;
  width: 100%;
  font-size: 14px;
  display: block;
  &:empty {
    display: none;
  }
`,Message=styled.div`
  color: var(--color_accent);
`,Link=styled.a`
  font-size: 18x !important;
  color: var(--color_accent);
  text-decoration: underline;
`,DescriptionLabel=styled(Label$1)`
  margin: 1em 0;
  font-size: 14px;
  line-height: 18px;
  font-style: oblique;
  padding-left: 5px;
`,AutoHeightRow=styled(ControlRow)`
  height: auto;
`,ScriptMode=({macro:e,protocol:r,setUnsavedMacro:o,saveMacros:i,macroIndex:a,isDelaySupported:d})=>{const{t:l}=useTranslation(),p=e.trimEnd(),[m,_]=React.useState(p),[C,y]=React.useState(void 0);reactExports.useEffect(()=>{o(m)},[m]);const b=()=>{const j=getMacroValidator(r)(m);j.isValid?(i(m),y(void 0)):y(j.errorMessage)},K=C!==void 0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AutoHeightRow,{children:jsxRuntimeExports.jsx(ReactTextareaAutocomplete,{value:m,onChange:v=>_(v.target.value),loadingComponent:AutocompleteLoading,style:{fontSize:"16px",lineHeight:"18px",width:"100%",height:"140px",fontFamily:"monospace",resize:"none",borderColor:K?"var(--color_error)":"var(--border_color_icon)"},containerStyle:{border:"none",lineHeight:"20px"},itemStyle:{borderColor:"var(--border_color_cell)",backgroundColor:"var(--bg_menu)"},dropdownStyle:{zIndex:999,backgroundColor:"var(--bg_menu)"},listStyle:{position:"fixed",backgroundColor:"var(--bg_menu)",maxHeight:"210px",overflow:"auto",border:"1px solid var(--border_color_cell)"},minChar:0,textAreaComponent:TextArea,movePopupAsYouType:!0,placeholder:`Enter the macro you want M${a} to execute...`,trigger:{"?":{dataProvider:findKeycodes,component:AutocompleteItem,output:v=>({text:v.code,caretPosition:"end"})},"{":{dataProvider:findKeycodes,component:AutocompleteItem,output:v=>({text:`{${v.code},`,caretPosition:"end"})},",":{dataProvider:findKeycodes,component:AutocompleteItem,output:v=>({text:`,${v.code},`,caretPosition:"end"})}}})}),jsxRuntimeExports.jsxs(AutoHeightRow,{children:[jsxRuntimeExports.jsxs(DescriptionLabel,{children:[jsxRuntimeExports.jsx(ToastErrorMessage,{children:C}),jsxRuntimeExports.jsxs(Message,{children:[l("Enter text directly, or wrap")," ",jsxRuntimeExports.jsx(Link,{href:"https://docs.qmk.fm/#/keycodes_basic",target:"_blank",children:l("Basic Keycodes")})," ",l("in")," ","{}"]}),jsxRuntimeExports.jsxs(Message,{children:[l("Single tap"),": ","{KC_XXX}"]}),jsxRuntimeExports.jsxs(Message,{children:[l("Chord"),": ","{KC_XXX, KC_YYY, KC_ZZZ}"]}),jsxRuntimeExports.jsxs(Message,{children:[l("Keydown"),": ","{+KC_XXX}"]}),jsxRuntimeExports.jsxs(Message,{children:[l("Keyup"),": ","{-KC_XXX}"]}),d?jsxRuntimeExports.jsxs(Message,{children:[l("Delay")," (ms): ","{NNNN}"," "]}):"Upgrade firmware to use delays",jsxRuntimeExports.jsx(Message,{children:l("Type ? to search for keycodes")})]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{disabled:e===m,onClick:b,children:"Save"})})]})]})},ProgressBarContainer$1=styled.div`
  position: relative;
  margin-top: 10px;
  &:hover {
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,ProgressBar$1=styled.div`
  background: var(--bg_control);
  position: relative;
  padding: 5px;
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 10px;
  cursor: pointer;
  width: 250px;

  > span {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    background: var(--color_accent);
    height: 10px;
    width: 100%;
    transform: scaleX(0.1);
    transform-origin: left;
    transition: transform 0.4s ease-in-out;
  }
`,MacroTab=styled.span`
  display: inline-flex;
  border: 1px solid;
  line-height: initial;
  border-top: none;
  padding: 8px;
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  min-width: 38px;
  justify-content: center;
  box-sizing: border-box;
  color: ${e=>e.$selected?"var(--color_accent)":"var(--bg_icon)"};
  cursor: pointer;
  &:hover {
    color: ${e=>e.$selected?"var(--color_accent)":"var(--bg_icon-highlighted)"};
  }
`,TabBar=styled.div`
  display: flex;
  column-gap: 10px;
`,TabContainer=styled.div`
  display: flex;
  margin-bottom: 10px;
  width: 100%;
  max-width: 960px;
`,CenterTabContainer=styled(TabContainer)`
  justify-content: center;
`,printBytesUsed=(e,r)=>{const{t:o}=useTranslation(),i=["Bytes","kB","MB","GB"],a=Math.floor(Math.log10(r)/3),d=i[a],l=a===0?1:Math.pow(1e3,a),p=e/l,m=r/l;return`${p.toFixed(a)} / ${m.toFixed(a)} ${d} ${o("space used")}`},BufferSizeUsage=()=>{const e=useAppSelector(p=>p.macros.ast),r=useAppSelector(getMacroBufferSize),o=useAppSelector(getSelectedConnectedDevice),i=useAppSelector(getSelectedKeyboardAPI);if(!o||!i)return null;const{protocol:a}=o,l=getMacroAPI(a,i).rawKeycodeSequencesToMacroBytes(e).length;return jsxRuntimeExports.jsxs(ProgressBarContainer$1,{children:[jsxRuntimeExports.jsx(ProgressBar$1,{children:jsxRuntimeExports.jsx("span",{style:{transform:`scaleX(${l/r})`}})}),jsxRuntimeExports.jsx(ProgressBarTooltip,{children:printBytesUsed(l,r)})]})},MacroDetailPane=e=>{const r=e.macroExpressions[e.selectedMacro]||"",[o,i]=React.useState(!1),a=useAppSelector(C=>C.macros.ast),d=useAppSelector(getIsDelaySupported),[l,p]=reactExports.useState(r);reactExports.useEffect(()=>{p(r)},[r]);const m=reactExports.useCallback(()=>{p(r)},[r]),_=reactExports.useCallback(C=>{C!==void 0?(e.saveMacros(""),p("")):l!==r&&(e.saveMacros(l),p(l))},[l]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CenterTabContainer,{children:jsxRuntimeExports.jsxs(TabBar,{children:[jsxRuntimeExports.jsx(MacroTab,{$selected:!o,onClick:()=>i(!1),children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faClapperboard})}),jsxRuntimeExports.jsx(MacroTab,{$selected:o,onClick:()=>i(!0),children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faCode})})]})}),jsxRuntimeExports.jsx(BufferSizeUsage,{}),o?jsxRuntimeExports.jsx(ScriptMode,{macro:r,macroIndex:e.selectedMacro,protocol:e.protocol,isDelaySupported:d,setUnsavedMacro:p,saveMacros:e.saveMacros},e.selectedMacro):jsxRuntimeExports.jsx(MacroRecorder,{selectedMacro:a[e.selectedMacro],setUnsavedMacro:p,undoMacro:m,saveMacro:_,isDelaySupported:d})]})},MacroPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$g=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
  padding-top: 0;
`,MenuContainer$5=styled.div`
  padding: 15px 10px 20px 10px;
`,Pane$8=()=>{const e=useAppDispatch(),r=useAppSelector(getSelectedConnectedDevice),o=useAppSelector(getExpressions),i=useAppSelector(getMacroCount),[a,d]=reactExports.useState(0),l=reactExports.useCallback(async m=>{if(!r)return;const _=o.map((C,y)=>y===a?m:C);e(saveMacros(r,_))},[o,saveMacros,e,r,a]),p=reactExports.useMemo(()=>Array(i).fill(0).map((m,_)=>_).map(m=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:a===m,onClick:()=>d(m),style:{borderWidth:0,textAlign:"center"},children:`M${m}`},m)),[a,i]);return r?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{children:jsxRuntimeExports.jsx(MenuContainer$5,{children:p})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(MacroPane,{children:jsxRuntimeExports.jsx(Container$g,{children:jsxRuntimeExports.jsx(MacroDetailPane,{macroExpressions:o,selectedMacro:a,saveMacros:l,protocol:r?r.protocol:-1})})})})]}):null},Icon$7=component$2,Title$7=title$5,Macros=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$7,Pane:Pane$8,Title:Title$7},Symbol.toStringTag,{value:"Module"}));function AccentUploadButton(e){const r=e.inputRef||React.useRef();function o(i){e.onLoad(i.target.files),r.current.value=null}return jsxRuntimeExports.jsxs(AccentButton,{onClick:()=>r.current&&r.current.click(),children:[e.children,jsxRuntimeExports.jsx("input",{ref:r,type:"file",multiple:e.multiple,accept:"application/json",style:{display:"none"},onChange:o})]})}const deprecatedKeycodes={KC_TILD:"S(KC_GRV)",KC_EXLM:"S(KC_1)",KC_AT:"S(KC_2)",KC_HASH:"S(KC_3)",KC_DLR:"S(KC_4)",KC_PERC:"S(KC_5)",KC_CIRC:"S(KC_6)",KC_AMPR:"S(KC_7)",KC_ASTR:"S(KC_8)",KC_LPRN:"S(KC_9)",KC_RPRN:"S(KC_0)",KC_UNDS:"S(KC_MINS)",KC_PLUS:"S(KC_EQL)",KC_LCBR:"S(KC_LBRC)",KC_RCBR:"S(KC_RBRC)",KC_PIPE:"S(KC_BSLS)",KC_COLN:"S(KC_SCLN)",KC_DQUO:"S(KC_QUOT)",KC_LT:"S(KC_COMM)",KC_GT:"S(KC_DOT)",KC_QUES:"S(KC_SLSH)",SPC_FN1:"LT(1,KC_SPC)",SPC_FN2:"LT(2,KC_SPC)",SPC_FN3:"LT(3,KC_SPC)",MACRO00:"MACRO(0)",MACRO01:"MACRO(1)",MACRO02:"MACRO(2)",MACRO03:"MACRO(3)",MACRO04:"MACRO(4)",MACRO05:"MACRO(5)",MACRO06:"MACRO(6)",MACRO07:"MACRO(7)",MACRO08:"MACRO(8)",MACRO09:"MACRO(9)",MACRO10:"MACRO(10)",MACRO11:"MACRO(11)",MACRO12:"MACRO(12)",MACRO13:"MACRO(13)",MACRO14:"MACRO(14)",MACRO15:"MACRO(15)",USER00:"CUSTOM(0)",USER01:"CUSTOM(1)",USER02:"CUSTOM(2)",USER03:"CUSTOM(3)",USER04:"CUSTOM(4)",USER05:"CUSTOM(5)",USER06:"CUSTOM(6)",USER07:"CUSTOM(7)",USER08:"CUSTOM(8)",USER09:"CUSTOM(9)",USER10:"CUSTOM(10)",USER11:"CUSTOM(11)",USER12:"CUSTOM(12)",USER13:"CUSTOM(13)",USER14:"CUSTOM(14)",USER15:"CUSTOM(15)"},title$4="Save + Load",component$1=()=>jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faFloppyDisk}),isViaSaveFile=e=>e&&e.name&&e.layers&&e.vendorProductId,SaveLoadPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$f=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,Pane$7=()=>{var Z;const{t:e}=useTranslation(),r=useAppDispatch(),o=useAppSelector(getSelectedDefinition),i=useAppSelector(getSelectedConnectedDevice),a=useAppSelector(getSelectedKeyboardAPI),d=useAppSelector(getSelectedRawLayers),l=useAppSelector(I=>I.macros),p=useAppSelector(getExpressions),{basicKeyToByte:m,byteToKey:_}=useAppSelector(getBasicKeyToByte),C=useAppSelector(getSelectedDevicePath),y=(Z=useAppSelector(getSelectedTabkbConfig))==null?void 0:Z.screen,b=useAppSelector(getActuationMap),K=useAppSelector(getDksmap),v=useAppSelector(getEnableAP),j=useAppSelector(getActuationPoint),w=useAppSelector(getEnableRT),L=useAppSelector(getContinuousRT);if(!o||!i||!a||!C)return null;const[T,P]=reactExports.useState(null),[k,G]=reactExports.useState(null),U=async()=>{const{layouts:I}=o,{keys:z,optionKeys:Q}=I,re=[...z,...Object.values(Q).flatMap(V=>Object.values(V)).flat()].filter(V=>"ei"in V).map(V=>V.ei);if(re.length>0){const V=Math.max(...re)+1,A=d.length;return await Promise.all(Array(V).fill(0).map((te,ce)=>Promise.all(Array(A).fill(0).map((le,Ce)=>Promise.all([a.getEncoderValue(Ce,ce,!1),a.getEncoderValue(Ce,ce,!0)]).then(ye=>ye.map(Oe=>getCodeForByte(Oe,m,_)||""))))))}else return[]},W=async()=>{const{name:I,vendorProductId:z}=o,Q=I.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase()+".layout.json";try{const re=await window.showSaveFilePicker({suggestedName:Q}),V=await U(),A={name:I,vendorProductId:z,macros:[...p],layers:d.map(le=>le.keymap.map(Ce=>getCodeForByte(Ce,m,_)||"")),encoders:V};y&&(A.actuation={apEnabled:v,apGlobal:j,rtEnabled:w,rtContinuous:L,ap:b[C]?b[C].map((le,Ce)=>le.actuationPoint?[Ce,le.actuationPoint]:null).filter(le=>le!==null):[],rt:b[C]?b[C].map((le,Ce)=>le.rtSensitivity&&le.rt2ndSensitivity?[Ce,le.rtSensitivity,le.rt2ndSensitivity]:null).filter(le=>le!==null):[],dks:K[C]?K[C].flatMap((le,Ce)=>le===null?null:le.map((ye,Oe)=>ye===null?null:[Ce,Oe,ye.actuation,...ye.actions.flatMap(Ne=>[Ne.key,...Ne.points.map(Ye=>Ye)])]).filter(ye=>ye!==null)).filter(le=>le!==null):[]});const B=stringify(A),te=new Blob([B],{type:"application/json"}),ce=await re.createWritable();await ce.write(te),await ce.close()}catch{console.log("User cancelled save file request")}},X=([I])=>{P(null),G(null);const z=new FileReader;z.onabort=()=>P(e("File reading was cancelled.")),z.onerror=()=>P(e("Failed to read file.")),z.onload=async()=>{const Q=JSON.parse(z.result.toString());if(!isViaSaveFile(Q)){P(e("Could not load file: invalid data."));return}if(Q.vendorProductId!==o.vendorProductId){P(`${e("Could not import layout. This file was created for a different keyboard")}: ${Q.name}`);return}if(Q.layers.findIndex((V,A)=>V.length!==d[A].keymap.length)>-1){P(e("Could not import layout: incorrect number of keys in one or more layers."));return}if(l.isFeatureSupported&&Q.macros){if(Q.macros.length!==p.length){P(e("Could not import layout: incorrect number of macros."));return}r(saveMacros(i,Q.macros))}y&&Q.actuation&&await r(saveConfigToDevice(Q.actuation));const re=Q.layers.map(V=>V.map(A=>getByteForCode(`${deprecatedKeycodes[A]??A}`,m)));await r(saveRawKeymapToDevice(re,i)),Q.encoders&&await Promise.all(Q.encoders.map((V,A)=>Promise.all(V.map((B,te)=>Promise.all([a.setEncoderValue(te,A,!1,getByteForCode(`${deprecatedKeycodes[B[0]]??B[0]}`,m)),a.setEncoderValue(te,A,!0,getByteForCode(`${deprecatedKeycodes[B[1]]??B[1]}`,m))]))))),G(e("Successfully updated layout!"))},z.readAsBinaryString(I)};return jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsx(SaveLoadPane,{children:jsxRuntimeExports.jsxs(Container$f,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Save Current Layout")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:W,children:e("Save")})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Load Saved Layout")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentUploadButton,{onLoad:X,children:e("Load")})})]}),T?jsxRuntimeExports.jsx(ErrorMessage,{children:T}):null,k?jsxRuntimeExports.jsx(SuccessMessage,{children:k}):null]})})})},Icon$6=component$1,Title$6=title$4,SaveLoad=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$6,Pane:Pane$7,Title:Title$6},Symbol.toStringTag,{value:"Module"})),SvgIcKeyboard24Px=e=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",fill:"currentColor"})]}),title$3="Layouts",component=SvgIcKeyboard24Px,LayoutControl=e=>{const{t:r}=useTranslation(),{onChange:o,meta:i}=e,{labels:a,selectedOption:d}=i;if(Array.isArray(a)){const[l,...p]=a,m=p.map((_,C)=>({label:r(_),value:`${C}`}));return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:r(l)}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:m[d],options:m,onChange:_=>{_&&o(+_.value)}})})]})}else return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:r(a)}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!d,onChange:l=>o(+l)})})]})},ContainerPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$e=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,Pane$6=()=>{const e=useAppDispatch(),r=useAppSelector(getSelectedDefinition),o=useAppSelector(getSelectedLayoutOptions);if(!r||!o)return null;const{layouts:i}=r,a=i.labels||[];return jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsx(ContainerPane,{children:jsxRuntimeExports.jsx(Container$e,{children:a.map((d,l)=>jsxRuntimeExports.jsx(LayoutControl,{onChange:p=>e(updateLayoutOption(l,p)),meta:{labels:d,selectedOption:o[l]}},l))})})})},Title$5=title$3,Icon$5=component,Layouts$1=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$5,Pane:Pane$6,Title:Title$5},Symbol.toStringTag,{value:"Module"})),GET_KEYBOARD_VALUE=2,SET_KEYBOARD_VALUE=3,KB_VALUES={ENABLED_ENCODER_MODES:128,OLED_DEFAULT_MODE:129,ENCODER_CUSTOM:130,OLED_MODE:131},getEncoderModes=async e=>{const r=[KB_VALUES.ENABLED_ENCODER_MODES],[,,o]=await e.hidCommand(GET_KEYBOARD_VALUE,r);return o},setEncoderModes=async(e,r)=>{const o=[KB_VALUES.ENABLED_ENCODER_MODES,r];await e.hidCommand(SET_KEYBOARD_VALUE,o)},getDefaultOLED=async e=>{const r=[KB_VALUES.OLED_DEFAULT_MODE],[,,o]=await e.hidCommand(GET_KEYBOARD_VALUE,r);return o},setDefaultOLED=async(e,r)=>{const o=[KB_VALUES.OLED_DEFAULT_MODE,r];await e.hidCommand(SET_KEYBOARD_VALUE,o)},getOLEDMode=async e=>{const r=[KB_VALUES.OLED_MODE],[,,o]=await e.hidCommand(GET_KEYBOARD_VALUE,r);return o},setOLEDMode=async(e,r)=>{const o=[KB_VALUES.OLED_MODE,r];await e.hidCommand(SET_KEYBOARD_VALUE,o)},getCustomEncoderConfig=async(e,r)=>{const o=[KB_VALUES.ENCODER_CUSTOM,r],i=await e.hidCommand(GET_KEYBOARD_VALUE,o),[,,,a,d,l,p,m,_]=i;return[a<<8|d,l<<8|p,m<<8|_]},setCustomEncoderConfig=async(e,r,o,i)=>{const a=(i&65280)>>8,d=i&255,l=[KB_VALUES.ENCODER_CUSTOM,r,o,a,d];await e.hidCommand(SET_KEYBOARD_VALUE,l)},MODES={ENC_MODE_VOLUME:0,ENC_MODE_MEDIA:1,ENC_MODE_SCROLL:2,ENC_MODE_BRIGHTNESS:3,ENC_MODE_BACKLIGHT:4,ENC_MODE_CUSTOM0:5,ENC_MODE_CUSTOM1:6,ENC_MODE_CUSTOM2:7},MODE_LABELS={ENC_MODE_VOLUME:"Volume",ENC_MODE_MEDIA:"Media",ENC_MODE_SCROLL:"Scroll",ENC_MODE_BRIGHTNESS:"Brightness",ENC_MODE_BACKLIGHT:"Backlight",ENC_MODE_CUSTOM0:"Custom 0",ENC_MODE_CUSTOM1:"Custom 1",ENC_MODE_CUSTOM2:"Custom 2"},CenteredColumnDiv=styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
`,ColumnDiv=styled.div`
  display: flex;
  flex-direction: column;
`;class EncoderModeToggle extends React.Component{constructor(){super(...arguments);se(this,"handleInputChange",o=>{const{enabledModes:i,onChange:a}=this.props,{target:{checked:d,name:l}}=o,p=1<<MODES[l],m=d?i|p:i&~p;a(m)});se(this,"isChecked",o=>(1<<o&this.props.enabledModes)>0)}render(){return jsxRuntimeExports.jsxs(CenteredColumnDiv,{children:[jsxRuntimeExports.jsx("h3",{children:"Enabled Encoder Modes:"}),jsxRuntimeExports.jsx("p",{children:"Only the selected encoder modes will be available on the keyboard"}),jsxRuntimeExports.jsx(ColumnDiv,{children:Object.entries(MODES).map(([o,i])=>jsxRuntimeExports.jsxs("label",{htmlFor:MODE_LABELS[o],children:[jsxRuntimeExports.jsx("input",{name:o,id:MODE_LABELS[o],type:"checkbox",checked:this.isChecked(i),onChange:this.handleInputChange},i),MODE_LABELS[o]]},i))})]})}}const NormalInput=styled.input`
  border: none;
  border-bottom: 1px solid var(--bg_control);
  color: var(--color_accent);
  background: var(--bg_menu);
  transition: all 0.4s ease-out;
  font-size: 18px;
  margin-bottom: 25px;
  height: 30px;
  padding: 0 5px;
  &:focus {
    outline: none;
    color: var(--color_accent);
    border-color: var(--color_accent);
  }
  &::placeholder {
    color: var(--bg_control);
  }
`,ErrorInput=styled(NormalInput)`
  border-color: #d15e5e;
  color: #d15e5e;
`;class KeycodeTextInput extends React.Component{constructor(o){super(o);se(this,"handleChange",o=>{const i=o.target.value;this.setState({currentValue:i})});se(this,"handleBlur",o=>{const{onBlur:i,basicKeyToByte:a}=this.props,{lastDefault:d}=this.state,l=o.target.value.trim().toUpperCase(),p=advancedStringToKeycode(l,a);Object.keys(a).includes(l)?(d!==a[l]&&i(a[l]),this.setState({isError:!1})):p!==0?(d!==p&&i(p),this.setState({isError:!1})):new RegExp(/^0x[0-9A-Fa-f]{1,4}$/g).test(o.target.value.trim())?(i(parseInt(o.target.value.trim(),16)),this.setState({isError:!1})):this.setState({isError:!0})});const{defaultValue:i,basicKeyToByte:a,byteToKey:d}=o;let l=anyKeycodeToString(i,a,d);this.state={lastDefault:i,defaultValueAsString:l,currentParsed:i,currentValue:l,isError:!1}}static getDerivedStateFromProps(o,i){return i.lastDefault!==o.defaultValue&&i.currentParsed!==o.defaultValue?{...i,currentValue:anyKeycodeToString(o.defaultValue,o.basicKeyToByte,o.byteToKey),currentParsed:o.defaultValue,lastDefault:o.defaultValue}:i}render(){const{currentValue:o,isError:i}=this.state,a=i?ErrorInput:NormalInput;return jsxRuntimeExports.jsx(a,{type:"text",placeholder:this.props.defaultValue?this.state.defaultValueAsString:"KC_NO, 0xFF, etc.",value:o,onChange:this.handleChange,onBlur:this.handleBlur,className:this.props.className})}}const RowDiv=styled.div`
  display: flex;
  flex-direction: row;
  margin-top: 4px;
`,LabelText$1=styled.span`
  font-weight: 650;
  margin-right: 8px;
  width: 80px;
`,KeyInput=styled(KeycodeTextInput)`
  width: 64px;
  margin-right: 8px;
`,EncoderCustomConfig=e=>{const{encoderIdx:r,onChange:o,title:i,behaviors:[a,d,l]}=e,{basicKeyToByte:p,byteToKey:m}=useAppSelector(getBasicKeyToByte),_=(C,y)=>{o(r,y,C)};return jsxRuntimeExports.jsxs(RowDiv,{children:[jsxRuntimeExports.jsx(LabelText$1,{children:i}),jsxRuntimeExports.jsx(KeyInput,{defaultValue:a,basicKeyToByte:p,byteToKey:m,onBlur:C=>_(C,0)}),jsxRuntimeExports.jsx(KeyInput,{defaultValue:d,basicKeyToByte:p,byteToKey:m,onBlur:C=>_(C,1)}),jsxRuntimeExports.jsx(KeyInput,{defaultValue:l,basicKeyToByte:p,byteToKey:m,onBlur:C=>_(C,2)})]})},MenuContainer$4=styled.div`
  display: flex;
  color: #717070;
  padding: 24px;
  font-family: GothamRounded;
  h3 {
    margin: 4px 0;
  }
  p {
    margin: 4px 0 8px 0;
    width: 288px;
    font-size: 13px;
    text-align: center;
  }
`,SectionContainer=styled.div`
  display: flex;
  flex: 1;
  flex-direction: column;
  align-items: center;
`,OLEDSelectContainer=styled.div`
  width: 156px;
  margin-bottom: 12px;
`,CustomEncoderContainer=styled.div`
  padding-left: 112px;
  display: flex;
  flex-direction: row;
`,LabelText=styled.span`
  font-weight: 650;
  margin-right: 8px;
  width: 64px;
`,OLED_OPTIONS=[{value:0,label:"Default"},{value:1,label:"Time"},{value:2,label:"Off"}],SatisfactionMenu=()=>{const e=useAppSelector(getSelectedKeyboardAPI);return e?jsxRuntimeExports.jsx(BaseSatisfactionMenu,{api:e}):null};class BaseSatisfactionMenu extends reactExports.Component{constructor(){super(...arguments);se(this,"state",{enabledModes:31,defaultOLEDMode:0,currOLEDMode:0,encoderBehaviors:[[0,0,0],[0,0,0],[0,0,0]]});se(this,"fetchDataAndSet",async()=>{const{api:o}=this.props,i=[getEncoderModes(o),getDefaultOLED(o),getOLEDMode(o),getCustomEncoderConfig(o,0),getCustomEncoderConfig(o,1),getCustomEncoderConfig(o,2)],[a,d,l,p,m,_]=await Promise.all(i);this.setState({enabledModes:a,defaultOLEDMode:d,currOLEDMode:l,encoderBehaviors:[p,m,_]})});se(this,"onEncoderModeChange",o=>{const{api:i}=this.props,{enabledModes:a}=this.state;a!==o&&(this.setState({enabledModes:o}),setEncoderModes(i,o))});se(this,"onEncoderCustomConfigChange",(o,i,a)=>{const{api:d}=this.props,l=[...this.state.encoderBehaviors];l[o][i]=a,this.setState({encoderBehaviors:l}),setCustomEncoderConfig(d,o,i,a)});se(this,"onOLEDDefaultChange",o=>{const{value:i}=o,{api:a}=this.props,{defaultOLEDMode:d}=this.state;d!==i&&(this.setState({defaultOLEDMode:i}),setDefaultOLED(a,i))});se(this,"onOLEDChange",o=>{const{value:i}=o,{api:a}=this.props,{currOLEDMode:d}=this.state;d!==i&&(this.setState({currOLEDMode:i}),setOLEDMode(a,i))})}componentDidMount(){this.fetchDataAndSet()}render(){const{api:o}=this.props,{enabledModes:i,defaultOLEDMode:a,currOLEDMode:d,encoderBehaviors:l}=this.state;return o?jsxRuntimeExports.jsxs(MenuContainer$4,{children:[jsxRuntimeExports.jsx(SectionContainer,{children:jsxRuntimeExports.jsx(EncoderModeToggle,{onChange:this.onEncoderModeChange,enabledModes:i})}),jsxRuntimeExports.jsxs(SectionContainer,{children:[jsxRuntimeExports.jsx("h3",{children:"Default OLED Mode:"}),jsxRuntimeExports.jsx("p",{children:"This is the OLED mode that will be selected by default when you plug in your keyboard."}),jsxRuntimeExports.jsx(OLEDSelectContainer,{children:jsxRuntimeExports.jsx(StateManagedSelect,{value:OLED_OPTIONS.find(p=>p.value===a),onChange:this.onOLEDDefaultChange,options:OLED_OPTIONS})}),jsxRuntimeExports.jsx("h3",{children:"Current OLED Mode:"}),jsxRuntimeExports.jsxs("p",{children:["Change your ","keyboard's"," current OLED mode"]}),jsxRuntimeExports.jsx(OLEDSelectContainer,{children:jsxRuntimeExports.jsx(StateManagedSelect,{value:OLED_OPTIONS.find(p=>p.value===d),onChange:this.onOLEDChange,options:OLED_OPTIONS,menuPlacement:"top"})})]}),jsxRuntimeExports.jsxs(SectionContainer,{children:[jsxRuntimeExports.jsx("h3",{children:"Custom Encoder Configuration:"}),jsxRuntimeExports.jsx("p",{children:"Configure the behavior of encoder custom modes"}),jsxRuntimeExports.jsxs(CustomEncoderContainer,{children:[jsxRuntimeExports.jsx(LabelText,{children:"CW"}),jsxRuntimeExports.jsx(LabelText,{children:"CCW"}),jsxRuntimeExports.jsx(LabelText,{children:"Press"})]}),jsxRuntimeExports.jsx(EncoderCustomConfig,{title:"Custom 0",encoderIdx:0,behaviors:l[0],onChange:this.onEncoderCustomConfigChange}),jsxRuntimeExports.jsx(EncoderCustomConfig,{title:"Custom 1",encoderIdx:1,behaviors:l[1],onChange:this.onEncoderCustomConfigChange}),jsxRuntimeExports.jsx(EncoderCustomConfig,{title:"Custom 2",encoderIdx:2,behaviors:l[2],onChange:this.onEncoderCustomConfigChange})]})]}):null}}const size$1=16.187,SvgIcMemory24Px=e=>jsxRuntimeExports.jsx("svg",{width:size$1,height:size$1,...e,children:jsxRuntimeExports.jsx("path",{d:"M10.791 5.4H5.4v5.4h5.4zM8.991 9h-1.8V7.2h1.8zm7.194-1.8V5.4h-1.8V3.6a1.8 1.8 0 00-1.8-1.8h-1.8V0h-1.8v1.8h-1.8V0H5.4v1.8H3.6a1.8 1.8 0 00-1.8 1.8v1.8H0v1.8h1.8V9H0v1.8h1.8v1.8a1.8 1.8 0 001.8 1.8h1.8v1.8h1.8v-1.8H9v1.8h1.8v-1.8h1.8a1.8 1.8 0 001.8-1.8v-1.8h1.8V9h-1.8V7.2zm-3.6 5.4H3.6v-9h8.99z",fill:"currentColor"})}),Pane$5=SatisfactionMenu,Title$4="Custom Features",Icon$4=SvgIcMemory24Px,RotaryEncoder=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$4,Pane:Pane$5,Title:Title$4},Symbol.toStringTag,{value:"Module"})),pixleImg=(e,r,o)=>{const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const a=e.width*.2,d=e.height*.2,l=i.getContext("2d");l.drawImage(e,0,0,a,d),l.imageSmoothingEnabled=!1;const p=document.createElement("canvas");p.width=r,p.height=o;const m=p.getContext("2d",{willReadFrequently:!0});m.imageSmoothingEnabled=!1;const _=r/o;let C,y,b,K,v;return v=a/d,v<=_?(b=a,K=b/_,C=0,y=(d-K)/2):(K=d,b=K*_,C=(a-b)/2,y=0),m.drawImage(i,C,y,b,K,0,0,p.width,p.height),Uint8Array.from(m.getImageData(0,0,r,o,{colorSpace:"srgb"}).data)};var createModule=(()=>{var e=import.meta.url;return async function(r={}){var o=r,i,a;o.ready=new Promise((n,s)=>{i=n,a=s}),["_memory","___indirect_function_table","_ff_h264_cabac_tables","___set_stack_limits","onRuntimeInitialized"].forEach(n=>{Object.getOwnPropertyDescriptor(o.ready,n)||Object.defineProperty(o.ready,n,{get:()=>_e("You are getting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>_e("You are setting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var d=Object.assign({},o),l="./this.program",p=typeof window=="object",m=typeof importScripts=="function",_=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",C=!p&&!_&&!m;if(o.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var y="";function b(n){return o.locateFile?o.locateFile(n,y):y+n}var K,v,j;if(_){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var w=process.versions.node,L=w.split(".").slice(0,3);if(L=L[0]*1e4+L[1]*100+L[2].split("-")[0]*1,L<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+w+")");const{createRequire:n}=await __vitePreload(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);var T=n(import.meta.url),P=T("fs"),k=T("path");m?y=k.dirname(y)+"/":y=T("url").fileURLToPath(new URL("./",import.meta.url)),K=(s,c)=>(s=ft(s)?new URL(s):k.normalize(s),P.readFileSync(s,c?void 0:"utf8")),j=s=>{var c=K(s,!0);return c.buffer||(c=new Uint8Array(c)),I(c.buffer),c},v=(s,c,u,x=!0)=>{s=ft(s)?new URL(s):k.normalize(s),P.readFile(s,x?void 0:"utf8",(f,g)=>{f?u(f):c(x?g.buffer:g)})},!o.thisProgram&&process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(C){if(typeof process=="object"&&typeof T=="function"||typeof window=="object"||typeof importScripts=="function")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");typeof read<"u"&&(K=read),j=n=>{if(typeof readbuffer=="function")return new Uint8Array(readbuffer(n));let s=read(n,"binary");return I(typeof s=="object"),s},v=(n,s,c)=>{setTimeout(()=>s(j(n)))},typeof clearTimeout>"u"&&(globalThis.clearTimeout=n=>{}),typeof setTimeout>"u"&&(globalThis.setTimeout=n=>typeof n=="function"?n():_e()),typeof scriptArgs<"u"&&scriptArgs,typeof print<"u"&&(typeof console>"u"&&(console={}),console.log=print,console.warn=console.error=typeof printErr<"u"?printErr:print)}else if(p||m){if(m?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),e&&(y=e),y.startsWith("blob:")?y="":y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof importScripts=="function"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");K=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(null),s.responseText},m&&(j=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),v=(n,s,c)=>{var u=new XMLHttpRequest;u.open("GET",n,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){s(u.response);return}c()},u.onerror=c,u.send(null)}}else throw new Error("environment detection error");var G=o.print||console.log.bind(console),U=o.printErr||console.error.bind(console);Object.assign(o,d),d=null,As(),o.arguments&&o.arguments,Ue("arguments","arguments_"),o.thisProgram&&(l=o.thisProgram),Ue("thisProgram","thisProgram"),o.quit&&o.quit,Ue("quit","quit_"),I(typeof o.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),I(typeof o.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),I(typeof o.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),I(typeof o.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),I(typeof o.read>"u","Module.read option was removed (modify read_ in JS)"),I(typeof o.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),I(typeof o.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),I(typeof o.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),I(typeof o.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),Ue("asm","wasmExports"),Ue("read","read_"),Ue("readAsync","readAsync"),Ue("readBinary","readBinary"),Ue("setWindowTitle","setWindowTitle"),I(!C,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var W;o.wasmBinary&&(W=o.wasmBinary),Ue("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&_e("no native wasm support detected");var X,Z=!1;function I(n,s){n||_e("Assertion failed"+(s?": "+s:""))}var z,Q,re,V,A,B,te,ce;function le(){var n=X.buffer;o.HEAP8=z=new Int8Array(n),o.HEAP16=re=new Int16Array(n),o.HEAPU8=Q=new Uint8Array(n),o.HEAPU16=V=new Uint16Array(n),o.HEAP32=A=new Int32Array(n),o.HEAPU32=B=new Uint32Array(n),o.HEAPF32=te=new Float32Array(n),o.HEAPF64=ce=new Float64Array(n)}I(!o.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),I(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),I(!o.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),I(!o.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Ce(){var n=wt();I((n&3)==0),n==0&&(n+=4),B[n>>2]=34821223,Y(34821223),B[n+4>>2]=2310721022,Y(2310721022),B[0]=1668509029,Y(1668509029)}function ye(){if(!Z){var n=wt();n==0&&(n+=4);var s=B[n>>2],c=B[n+4>>2];(s!=34821223||c!=2310721022)&&_e(`Stack overflow! Stack cookie has been overwritten at ${Ge(n)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Ge(c)} ${Ge(s)}`),B[0]!=1668509029&&_e("Runtime error: The application has corrupted its heap memory area (address zero)!")}}(function(){var n=new Int16Array(1),s=new Int8Array(n.buffer);if(n[0]=25459,s[0]!==115||s[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})();var Oe=[],Ne=[],Ye=[],Je=!1;function pt(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)ht(o.preRun.shift());Wt(Oe)}function xt(){I(!Je),Je=!0,ye(),fo(),Se.root=h.mount(Se,{},null),!o.noFSInit&&!h.init.initialized&&h.init(),h.ignorePermissions=!1,Wt(Ne)}function Ze(){if(ye(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)st(o.postRun.shift());Wt(Ye)}function ht(n){Oe.unshift(n)}function nt(n){Ne.unshift(n)}function st(n){Ye.unshift(n)}I(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),I(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),I(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),I(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var ne=0,de=null,ue=null,ve={};function ke(n){for(var s=n;;){if(!ve[n])return n;n=s+Math.random()}}function Pe(n){var s;ne++,(s=o.monitorRunDependencies)==null||s.call(o,ne),n?(I(!ve[n]),ve[n]=1,de===null&&typeof setInterval<"u"&&(de=setInterval(()=>{if(Z){clearInterval(de),de=null;return}var c=!1;for(var u in ve)c||(c=!0,U("still waiting on run dependencies:")),U(`dependency: ${u}`);c&&U("(end of list)")},1e4))):U("warning: run dependency added without ID")}function Te(n){var c;if(ne--,(c=o.monitorRunDependencies)==null||c.call(o,ne),n?(I(ve[n]),delete ve[n]):U("warning: run dependency removed without ID"),ne==0&&(de!==null&&(clearInterval(de),de=null),ue)){var s=ue;ue=null,s()}}function _e(n){var c;(c=o.onAbort)==null||c.call(o,n),n="Aborted("+n+")",U(n),Z=!0;var s=new WebAssembly.RuntimeError(n);throw a(s),s}var _t="data:application/octet-stream;base64,",Qe=n=>n.startsWith(_t),ft=n=>n.startsWith("file://");function Ee(n){return(...s)=>{I(Je,`native function \`${n}\` called before runtime initialization`);var c=ze[n];return I(c,`exported native function \`${n}\` not found`),c(...s)}}var $e;o.locateFile?($e="kbres.wasm",Qe($e)||($e=b($e))):$e=new URL("/assets/kbres-C4kBwtD3.wasm",import.meta.url).href;function hr(n){if(n==$e&&W)return new Uint8Array(W);if(j)return j(n);throw"both async and sync fetching of the wasm failed"}function ro(n){if(!W&&(p||m)){if(typeof fetch=="function"&&!ft(n))return fetch(n,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw`failed to load wasm binary file at '${n}'`;return s.arrayBuffer()}).catch(()=>hr(n));if(v)return new Promise((s,c)=>{v(n,u=>s(new Uint8Array(u)),c)})}return Promise.resolve().then(()=>hr(n))}function _r(n,s,c){return ro(n).then(u=>WebAssembly.instantiate(u,s)).then(c,u=>{U(`failed to asynchronously prepare wasm: ${u}`),ft($e)&&U(`warning: Loading from a file URI (${$e}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),_e(u)})}function oo(n,s,c,u){return!n&&typeof WebAssembly.instantiateStreaming=="function"&&!Qe(s)&&!ft(s)&&!_&&typeof fetch=="function"?fetch(s,{credentials:"same-origin"}).then(x=>{var f=WebAssembly.instantiateStreaming(x,c);return f.then(u,function(g){return U(`wasm streaming compile failed: ${g}`),U("falling back to ArrayBuffer instantiation"),_r(s,c,u)})}):_r(s,c,u)}function no(){var n={env:qr,wasi_snapshot_preview1:qr};function s(x,f){return ze=x.exports,X=ze.memory,I(X,"memory not found in wasm exports"),le(),$t=ze.__indirect_function_table,I($t,"table not found in wasm exports"),nt(ze.__wasm_call_ctors),Te("wasm-instantiate"),ze}Pe("wasm-instantiate");var c=o;function u(x){I(o===c,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),c=null,s(x.instance)}if(o.instantiateWasm)try{return o.instantiateWasm(n,s)}catch(x){U(`Module.instantiateWasm callback failed with error: ${x}`),a(x)}return oo(W,$e,n,u).catch(a),{}}var ee,he;function Ue(n,s,c=!0){Object.getOwnPropertyDescriptor(o,n)||Object.defineProperty(o,n,{configurable:!0,get(){let u=c?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";_e(`\`Module.${n}\` has been replaced by \`${s}\``+u)}})}function so(n){Object.getOwnPropertyDescriptor(o,n)&&_e(`\`Module.${n}\` was supplied but \`${n}\` not included in INCOMING_MODULE_JS_API`)}function fr(n){return n==="FS_createPath"||n==="FS_createDataFile"||n==="FS_createPreloadedFile"||n==="FS_unlink"||n==="addRunDependency"||n==="FS_createLazyFile"||n==="FS_createDevice"||n==="removeRunDependency"}function gr(n,s){typeof globalThis<"u"&&Object.defineProperty(globalThis,n,{configurable:!0,get(){Ve(`\`${n}\` is not longer defined by emscripten. ${s}`)}})}gr("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),gr("asm","Please use wasmExports instead");function io(n){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,n)&&Object.defineProperty(globalThis,n,{configurable:!0,get(){var s=`\`${n}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,c=n;c.startsWith("_")||(c="$"+n),s+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${c}')`,fr(n)&&(s+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ve(s)}}),Cr(n)}function Cr(n){Object.getOwnPropertyDescriptor(o,n)||Object.defineProperty(o,n,{configurable:!0,get(){var s=`'${n}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;fr(n)&&(s+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),_e(s)}})}var ao=2**8-1,co=2**16-1,lo=2**32-1,uo=2**64-1,po=-127,mo=-32767,xo=-2147483647,ho=-9223372036854776e3+1;function jt(n,s,c,u){I(Number.isInteger(Number(n)),`attempt to write non-integer (${n}) into integer heap`),I(n<=u,`value (${n}) too large to write as ${s}-bit value`),I(n>=c,`value (${n}) too small to write as ${s}-bit value`)}var et=n=>jt(n,8,po,ao),Ie=n=>jt(n,16,mo,co),Y=n=>jt(n,32,xo,lo),Be=n=>jt(n,64,ho,uo);function _o(...n){console.warn(...n)}var Wt=n=>{for(;n.length>0;)n.shift()(o)};o.noExitRuntime;var Ge=n=>(I(typeof n=="number"),n>>>=0,"0x"+n.toString(16).padStart(8,"0")),fo=()=>{var n=mr(),s=wt();Ps(n,s)},Ve=n=>{Ve.shown||(Ve.shown={}),Ve.shown[n]||(Ve.shown[n]=1,_&&(n="warning: "+n),U(n))},yr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,it=(n,s,c)=>{for(var u=s+c,x=s;n[x]&&!(x>=u);)++x;if(x-s>16&&n.buffer&&yr)return yr.decode(n.subarray(s,x));for(var f="";s<x;){var g=n[s++];if(!(g&128)){f+=String.fromCharCode(g);continue}var S=n[s++]&63;if((g&224)==192){f+=String.fromCharCode((g&31)<<6|S);continue}var R=n[s++]&63;if((g&240)==224?g=(g&15)<<12|S<<6|R:((g&248)!=240&&Ve("Invalid UTF-8 leading byte "+Ge(g)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),g=(g&7)<<18|S<<12|R<<6|n[s++]&63),g<65536)f+=String.fromCharCode(g);else{var M=g-65536;f+=String.fromCharCode(55296|M>>10,56320|M&1023)}}return f},Fe=(n,s)=>(I(typeof n=="number",`UTF8ToString expects a number (got ${typeof n})`),n?it(Q,n,s):""),go=(n,s,c,u)=>{_e(`Assertion failed: ${Fe(n)}, at: `+[s?Fe(s):"unknown filename",c,u?Fe(u):"unknown function"])};class Co{constructor(s){this.excPtr=s,this.ptr=s-24}set_type(s){B[this.ptr+4>>2]=s}get_type(){return B[this.ptr+4>>2]}set_destructor(s){B[this.ptr+8>>2]=s}get_destructor(){return B[this.ptr+8>>2]}set_caught(s){s=s?1:0,z[this.ptr+12]=s,et(s)}get_caught(){return z[this.ptr+12]!=0}set_rethrown(s){s=s?1:0,z[this.ptr+13]=s,et(s)}get_rethrown(){return z[this.ptr+13]!=0}init(s,c){this.set_adjusted_ptr(0),this.set_type(s),this.set_destructor(c)}set_adjusted_ptr(s){B[this.ptr+16>>2]=s}get_adjusted_ptr(){return B[this.ptr+16>>2]}get_exception_ptr(){var s=Ls(this.get_type());if(s)return B[this.excPtr>>2];var c=this.get_adjusted_ptr();return c!==0?c:this.excPtr}}var yo=(n,s,c)=>{var u=new Co(n);u.init(s,c),I(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},Eo=n=>{var s=mr(),c=wt();_e(`stack overflow (Attempt to set SP to ${Ge(n)}, with stack limits [${Ge(c)} - ${Ge(s)}]). If you require more stack space build with -sSTACK_SIZE=<bytes>`)},So=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(_)try{var n=T("crypto"),s=n.randomFillSync;if(s)return u=>n.randomFillSync(u);var c=n.randomBytes;return u=>(u.set(c(u.byteLength)),u)}catch{}_e("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},Er=n=>(Er=So())(n),fe={isAbs:n=>n.charAt(0)==="/",splitPath:n=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return s.exec(n).slice(1)},normalizeArray:(n,s)=>{for(var c=0,u=n.length-1;u>=0;u--){var x=n[u];x==="."?n.splice(u,1):x===".."?(n.splice(u,1),c++):c&&(n.splice(u,1),c--)}if(s)for(;c;c--)n.unshift("..");return n},normalize:n=>{var s=fe.isAbs(n),c=n.substr(-1)==="/";return n=fe.normalizeArray(n.split("/").filter(u=>!!u),!s).join("/"),!n&&!s&&(n="."),n&&c&&(n+="/"),(s?"/":"")+n},dirname:n=>{var s=fe.splitPath(n),c=s[0],u=s[1];return!c&&!u?".":(u&&(u=u.substr(0,u.length-1)),c+u)},basename:n=>{if(n==="/")return"/";n=fe.normalize(n),n=n.replace(/\/$/,"");var s=n.lastIndexOf("/");return s===-1?n:n.substr(s+1)},join:(...n)=>fe.normalize(n.join("/")),join2:(n,s)=>fe.normalize(n+"/"+s)},He={resolve:(...n)=>{for(var s="",c=!1,u=n.length-1;u>=-1&&!c;u--){var x=u>=0?n[u]:h.cwd();if(typeof x!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!x)return"";s=x+"/"+s,c=fe.isAbs(x)}return s=fe.normalizeArray(s.split("/").filter(f=>!!f),!c).join("/"),(c?"/":"")+s||"."},relative:(n,s)=>{n=He.resolve(n).substr(1),s=He.resolve(s).substr(1);function c(M){for(var O=0;O<M.length&&M[O]==="";O++);for(var F=M.length-1;F>=0&&M[F]==="";F--);return O>F?[]:M.slice(O,F-O+1)}for(var u=c(n.split("/")),x=c(s.split("/")),f=Math.min(u.length,x.length),g=f,S=0;S<f;S++)if(u[S]!==x[S]){g=S;break}for(var R=[],S=g;S<u.length;S++)R.push("..");return R=R.concat(x.slice(g)),R.join("/")}},zt=[],At=n=>{for(var s=0,c=0;c<n.length;++c){var u=n.charCodeAt(c);u<=127?s++:u<=2047?s+=2:u>=55296&&u<=57343?(s+=4,++c):s+=3}return s},Yt=(n,s,c,u)=>{if(I(typeof n=="string",`stringToUTF8Array expects a string (got ${typeof n})`),!(u>0))return 0;for(var x=c,f=c+u-1,g=0;g<n.length;++g){var S=n.charCodeAt(g);if(S>=55296&&S<=57343){var R=n.charCodeAt(++g);S=65536+((S&1023)<<10)|R&1023}if(S<=127){if(c>=f)break;s[c++]=S}else if(S<=2047){if(c+1>=f)break;s[c++]=192|S>>6,s[c++]=128|S&63}else if(S<=65535){if(c+2>=f)break;s[c++]=224|S>>12,s[c++]=128|S>>6&63,s[c++]=128|S&63}else{if(c+3>=f)break;S>1114111&&Ve("Invalid Unicode code point "+Ge(S)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),s[c++]=240|S>>18,s[c++]=128|S>>12&63,s[c++]=128|S>>6&63,s[c++]=128|S&63}}return s[c]=0,c-x};function Tt(n,s,c){var u=At(n)+1,x=new Array(u),f=Yt(n,x,0,x.length);return s&&(x.length=f),x}var Ko=()=>{if(!zt.length){var n=null;if(_){var s=256,c=Buffer.alloc(s),u=0,x=process.stdin.fd;try{u=P.readSync(x,c)}catch(f){if(f.toString().includes("EOF"))u=0;else throw f}u>0?n=c.slice(0,u).toString("utf-8"):n=null}else typeof window<"u"&&typeof window.prompt=="function"?(n=window.prompt("Input: "),n!==null&&(n+=`
`)):typeof readline=="function"&&(n=readline(),n!==null&&(n+=`
`));if(!n)return null;zt=Tt(n,!0)}return zt.shift()},tt={ttys:[],init(){},shutdown(){},register(n,s){tt.ttys[n]={input:[],output:[],ops:s},h.registerDevice(n,tt.stream_ops)},stream_ops:{open(n){var s=tt.ttys[n.node.rdev];if(!s)throw new h.ErrnoError(43);n.tty=s,n.seekable=!1},close(n){n.tty.ops.fsync(n.tty)},fsync(n){n.tty.ops.fsync(n.tty)},read(n,s,c,u,x){if(!n.tty||!n.tty.ops.get_char)throw new h.ErrnoError(60);for(var f=0,g=0;g<u;g++){var S;try{S=n.tty.ops.get_char(n.tty)}catch{throw new h.ErrnoError(29)}if(S===void 0&&f===0)throw new h.ErrnoError(6);if(S==null)break;f++,s[c+g]=S}return f&&(n.node.timestamp=Date.now()),f},write(n,s,c,u,x){if(!n.tty||!n.tty.ops.put_char)throw new h.ErrnoError(60);try{for(var f=0;f<u;f++)n.tty.ops.put_char(n.tty,s[c+f])}catch{throw new h.ErrnoError(29)}return u&&(n.node.timestamp=Date.now()),f}},default_tty_ops:{get_char(n){return Ko()},put_char(n,s){s===null||s===10?(G(it(n.output,0)),n.output=[]):s!=0&&n.output.push(s)},fsync(n){n.output&&n.output.length>0&&(G(it(n.output,0)),n.output=[])},ioctl_tcgets(n){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(n,s,c){return 0},ioctl_tiocgwinsz(n){return[24,80]}},default_tty1_ops:{put_char(n,s){s===null||s===10?(U(it(n.output,0)),n.output=[]):s!=0&&n.output.push(s)},fsync(n){n.output&&n.output.length>0&&(U(it(n.output,0)),n.output=[])}}},Sr=(n,s)=>(Q.fill(0,n,n+s),n),Kr=n=>{_e("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},ae={ops_table:null,mount(n){return ae.createNode(null,"/",16895,0)},createNode(n,s,c,u){if(h.isBlkdev(c)||h.isFIFO(c))throw new h.ErrnoError(63);ae.ops_table||(ae.ops_table={dir:{node:{getattr:ae.node_ops.getattr,setattr:ae.node_ops.setattr,lookup:ae.node_ops.lookup,mknod:ae.node_ops.mknod,rename:ae.node_ops.rename,unlink:ae.node_ops.unlink,rmdir:ae.node_ops.rmdir,readdir:ae.node_ops.readdir,symlink:ae.node_ops.symlink},stream:{llseek:ae.stream_ops.llseek}},file:{node:{getattr:ae.node_ops.getattr,setattr:ae.node_ops.setattr},stream:{llseek:ae.stream_ops.llseek,read:ae.stream_ops.read,write:ae.stream_ops.write,allocate:ae.stream_ops.allocate,mmap:ae.stream_ops.mmap,msync:ae.stream_ops.msync}},link:{node:{getattr:ae.node_ops.getattr,setattr:ae.node_ops.setattr,readlink:ae.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ae.node_ops.getattr,setattr:ae.node_ops.setattr},stream:h.chrdev_stream_ops}});var x=h.createNode(n,s,c,u);return h.isDir(x.mode)?(x.node_ops=ae.ops_table.dir.node,x.stream_ops=ae.ops_table.dir.stream,x.contents={}):h.isFile(x.mode)?(x.node_ops=ae.ops_table.file.node,x.stream_ops=ae.ops_table.file.stream,x.usedBytes=0,x.contents=null):h.isLink(x.mode)?(x.node_ops=ae.ops_table.link.node,x.stream_ops=ae.ops_table.link.stream):h.isChrdev(x.mode)&&(x.node_ops=ae.ops_table.chrdev.node,x.stream_ops=ae.ops_table.chrdev.stream),x.timestamp=Date.now(),n&&(n.contents[s]=x,n.timestamp=x.timestamp),x},getFileDataAsTypedArray(n){return n.contents?n.contents.subarray?n.contents.subarray(0,n.usedBytes):new Uint8Array(n.contents):new Uint8Array(0)},expandFileStorage(n,s){var c=n.contents?n.contents.length:0;if(!(c>=s)){var u=1024*1024;s=Math.max(s,c*(c<u?2:1.125)>>>0),c!=0&&(s=Math.max(s,256));var x=n.contents;n.contents=new Uint8Array(s),n.usedBytes>0&&n.contents.set(x.subarray(0,n.usedBytes),0)}},resizeFileStorage(n,s){if(n.usedBytes!=s)if(s==0)n.contents=null,n.usedBytes=0;else{var c=n.contents;n.contents=new Uint8Array(s),c&&n.contents.set(c.subarray(0,Math.min(s,n.usedBytes))),n.usedBytes=s}},node_ops:{getattr(n){var s={};return s.dev=h.isChrdev(n.mode)?n.id:1,s.ino=n.id,s.mode=n.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=n.rdev,h.isDir(n.mode)?s.size=4096:h.isFile(n.mode)?s.size=n.usedBytes:h.isLink(n.mode)?s.size=n.link.length:s.size=0,s.atime=new Date(n.timestamp),s.mtime=new Date(n.timestamp),s.ctime=new Date(n.timestamp),s.blksize=4096,s.blocks=Math.ceil(s.size/s.blksize),s},setattr(n,s){s.mode!==void 0&&(n.mode=s.mode),s.timestamp!==void 0&&(n.timestamp=s.timestamp),s.size!==void 0&&ae.resizeFileStorage(n,s.size)},lookup(n,s){throw h.genericErrors[44]},mknod(n,s,c,u){return ae.createNode(n,s,c,u)},rename(n,s,c){if(h.isDir(n.mode)){var u;try{u=h.lookupNode(s,c)}catch{}if(u)for(var x in u.contents)throw new h.ErrnoError(55)}delete n.parent.contents[n.name],n.parent.timestamp=Date.now(),n.name=c,s.contents[c]=n,s.timestamp=n.parent.timestamp,n.parent=s},unlink(n,s){delete n.contents[s],n.timestamp=Date.now()},rmdir(n,s){var c=h.lookupNode(n,s);for(var u in c.contents)throw new h.ErrnoError(55);delete n.contents[s],n.timestamp=Date.now()},readdir(n){var s=[".",".."];for(var c of Object.keys(n.contents))s.push(c);return s},symlink(n,s,c){var u=ae.createNode(n,s,41471,0);return u.link=c,u},readlink(n){if(!h.isLink(n.mode))throw new h.ErrnoError(28);return n.link}},stream_ops:{read(n,s,c,u,x){var f=n.node.contents;if(x>=n.node.usedBytes)return 0;var g=Math.min(n.node.usedBytes-x,u);if(I(g>=0),g>8&&f.subarray)s.set(f.subarray(x,x+g),c);else for(var S=0;S<g;S++)s[c+S]=f[x+S];return g},write(n,s,c,u,x,f){if(I(!(s instanceof ArrayBuffer)),s.buffer===z.buffer&&(f=!1),!u)return 0;var g=n.node;if(g.timestamp=Date.now(),s.subarray&&(!g.contents||g.contents.subarray)){if(f)return I(x===0,"canOwn must imply no weird position inside the file"),g.contents=s.subarray(c,c+u),g.usedBytes=u,u;if(g.usedBytes===0&&x===0)return g.contents=s.slice(c,c+u),g.usedBytes=u,u;if(x+u<=g.usedBytes)return g.contents.set(s.subarray(c,c+u),x),u}if(ae.expandFileStorage(g,x+u),g.contents.subarray&&s.subarray)g.contents.set(s.subarray(c,c+u),x);else for(var S=0;S<u;S++)g.contents[x+S]=s[c+S];return g.usedBytes=Math.max(g.usedBytes,x+u),u},llseek(n,s,c){var u=s;if(c===1?u+=n.position:c===2&&h.isFile(n.node.mode)&&(u+=n.node.usedBytes),u<0)throw new h.ErrnoError(28);return u},allocate(n,s,c){ae.expandFileStorage(n.node,s+c),n.node.usedBytes=Math.max(n.node.usedBytes,s+c)},mmap(n,s,c,u,x){if(!h.isFile(n.node.mode))throw new h.ErrnoError(43);var f,g,S=n.node.contents;if(!(x&2)&&S.buffer===z.buffer)g=!1,f=S.byteOffset;else{if((c>0||c+s<S.length)&&(S.subarray?S=S.subarray(c,c+s):S=Array.prototype.slice.call(S,c,c+s)),g=!0,f=Kr(),!f)throw new h.ErrnoError(48);z.set(S,f)}return{ptr:f,allocated:g}},msync(n,s,c,u,x){return ae.stream_ops.write(n,s,0,u,c,!1),0}}},bo=(n,s,c,u)=>{var x=ke(`al ${n}`);v(n,f=>{I(f,`Loading data file "${n}" failed (no arrayBuffer).`),s(new Uint8Array(f)),x&&Te(x)},f=>{if(c)c();else throw`Loading data file "${n}" failed.`}),x&&Pe(x)},vo=(n,s,c,u,x,f)=>{h.createDataFile(n,s,c,u,x,f)},Ro=o.preloadPlugins||[],wo=(n,s,c,u)=>{typeof Browser<"u"&&Browser.init();var x=!1;return Ro.forEach(f=>{x||f.canHandle(s)&&(f.handle(n,s,c,u),x=!0)}),x},jo=(n,s,c,u,x,f,g,S,R,M)=>{var O=s?He.resolve(fe.join2(n,s)):n,F=ke(`cp ${O}`);function $(H){function oe(ge){M==null||M(),S||vo(n,s,ge,u,x,R),f==null||f(),Te(F)}wo(H,O,oe,()=>{g==null||g(),Te(F)})||oe(H)}Pe(F),typeof c=="string"?bo(c,$,g):$(c)},Ao=n=>{var s={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},c=s[n];if(typeof c>"u")throw new Error(`Unknown file open mode: ${n}`);return c},Qt=(n,s)=>{var c=0;return n&&(c|=365),s&&(c|=146),c},be={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var n=null;return typeof window=="object"&&(n=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),I(n,"IDBFS used, but indexedDB not supported"),n},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:(...n)=>ae.mount(...n),syncfs:(n,s,c)=>{be.getLocalSet(n,(u,x)=>{if(u)return c(u);be.getRemoteSet(n,(f,g)=>{if(f)return c(f);var S=s?g:x,R=s?x:g;be.reconcile(S,R,c)})})},quit:()=>{Object.values(be.dbs).forEach(n=>n.close()),be.dbs={}},getDB:(n,s)=>{var c=be.dbs[n];if(c)return s(null,c);var u;try{u=be.indexedDB().open(n,be.DB_VERSION)}catch(x){return s(x)}if(!u)return s("Unable to connect to IndexedDB");u.onupgradeneeded=x=>{var f=x.target.result,g=x.target.transaction,S;f.objectStoreNames.contains(be.DB_STORE_NAME)?S=g.objectStore(be.DB_STORE_NAME):S=f.createObjectStore(be.DB_STORE_NAME),S.indexNames.contains("timestamp")||S.createIndex("timestamp","timestamp",{unique:!1})},u.onsuccess=()=>{c=u.result,be.dbs[n]=c,s(null,c)},u.onerror=x=>{s(x.target.error),x.preventDefault()}},getLocalSet:(n,s)=>{var c={};function u(R){return R!=="."&&R!==".."}function x(R){return M=>fe.join2(R,M)}for(var f=h.readdir(n.mountpoint).filter(u).map(x(n.mountpoint));f.length;){var g=f.pop(),S;try{S=h.stat(g)}catch(R){return s(R)}h.isDir(S.mode)&&f.push(...h.readdir(g).filter(u).map(x(g))),c[g]={timestamp:S.mtime}}return s(null,{type:"local",entries:c})},getRemoteSet:(n,s)=>{var c={};be.getDB(n.mountpoint,(u,x)=>{if(u)return s(u);try{var f=x.transaction([be.DB_STORE_NAME],"readonly");f.onerror=R=>{s(R.target.error),R.preventDefault()};var g=f.objectStore(be.DB_STORE_NAME),S=g.index("timestamp");S.openKeyCursor().onsuccess=R=>{var M=R.target.result;if(!M)return s(null,{type:"remote",db:x,entries:c});c[M.primaryKey]={timestamp:M.key},M.continue()}}catch(R){return s(R)}})},loadLocalEntry:(n,s)=>{var c,u;try{var x=h.lookupPath(n);u=x.node,c=h.stat(n)}catch(f){return s(f)}return h.isDir(c.mode)?s(null,{timestamp:c.mtime,mode:c.mode}):h.isFile(c.mode)?(u.contents=ae.getFileDataAsTypedArray(u),s(null,{timestamp:c.mtime,mode:c.mode,contents:u.contents})):s(new Error("node type not supported"))},storeLocalEntry:(n,s,c)=>{try{if(h.isDir(s.mode))h.mkdirTree(n,s.mode);else if(h.isFile(s.mode))h.writeFile(n,s.contents,{canOwn:!0});else return c(new Error("node type not supported"));h.chmod(n,s.mode),h.utime(n,s.timestamp,s.timestamp)}catch(u){return c(u)}c(null)},removeLocalEntry:(n,s)=>{try{var c=h.stat(n);h.isDir(c.mode)?h.rmdir(n):h.isFile(c.mode)&&h.unlink(n)}catch(u){return s(u)}s(null)},loadRemoteEntry:(n,s,c)=>{var u=n.get(s);u.onsuccess=x=>c(null,x.target.result),u.onerror=x=>{c(x.target.error),x.preventDefault()}},storeRemoteEntry:(n,s,c,u)=>{try{var x=n.put(c,s)}catch(f){u(f);return}x.onsuccess=f=>u(),x.onerror=f=>{u(f.target.error),f.preventDefault()}},removeRemoteEntry:(n,s,c)=>{var u=n.delete(s);u.onsuccess=x=>c(),u.onerror=x=>{c(x.target.error),x.preventDefault()}},reconcile:(n,s,c)=>{var u=0,x=[];Object.keys(n.entries).forEach(function(F){var $=n.entries[F],H=s.entries[F];(!H||$.timestamp.getTime()!=H.timestamp.getTime())&&(x.push(F),u++)});var f=[];if(Object.keys(s.entries).forEach(function(F){n.entries[F]||(f.push(F),u++)}),!u)return c(null);var g=!1,S=n.type==="remote"?n.db:s.db,R=S.transaction([be.DB_STORE_NAME],"readwrite"),M=R.objectStore(be.DB_STORE_NAME);function O(F){if(F&&!g)return g=!0,c(F)}R.onerror=R.onabort=F=>{O(F.target.error),F.preventDefault()},R.oncomplete=F=>{g||c(null)},x.sort().forEach(F=>{s.type==="local"?be.loadRemoteEntry(M,F,($,H)=>{if($)return O($);be.storeLocalEntry(F,H,O)}):be.loadLocalEntry(F,($,H)=>{if($)return O($);be.storeRemoteEntry(M,F,H,O)})}),f.sort().reverse().forEach(F=>{s.type==="local"?be.removeLocalEntry(F,O):be.removeRemoteEntry(M,F,O)})}},To={0:"Success",1:"Arg list too long",2:"Permission denied",3:"Address already in use",4:"Address not available",5:"Address family not supported by protocol family",6:"No more processes",7:"Socket already connected",8:"Bad file number",9:"Trying to read unreadable message",10:"Mount device busy",11:"Operation canceled",12:"No children",13:"Connection aborted",14:"Connection refused",15:"Connection reset by peer",16:"File locking deadlock error",17:"Destination address required",18:"Math arg out of domain of func",19:"Quota exceeded",20:"File exists",21:"Bad address",22:"File too large",23:"Host is unreachable",24:"Identifier removed",25:"Illegal byte sequence",26:"Connection already in progress",27:"Interrupted system call",28:"Invalid argument",29:"I/O error",30:"Socket is already connected",31:"Is a directory",32:"Too many symbolic links",33:"Too many open files",34:"Too many links",35:"Message too long",36:"Multihop attempted",37:"File or path name too long",38:"Network interface is not configured",39:"Connection reset by network",40:"Network is unreachable",41:"Too many open files in system",42:"No buffer space available",43:"No such device",44:"No such file or directory",45:"Exec format error",46:"No record locks available",47:"The link has been severed",48:"Not enough core",49:"No message of desired type",50:"Protocol not available",51:"No space left on device",52:"Function not implemented",53:"Socket is not connected",54:"Not a directory",55:"Directory not empty",56:"State not recoverable",57:"Socket operation on non-socket",59:"Not a typewriter",60:"No such device or address",61:"Value too large for defined data type",62:"Previous owner died",63:"Not super-user",64:"Broken pipe",65:"Protocol error",66:"Unknown protocol",67:"Protocol wrong type for socket",68:"Math result not representable",69:"Read only file system",70:"Illegal seek",71:"No such process",72:"Stale file handle",73:"Connection timed out",74:"Text file busy",75:"Cross-device link",100:"Device not a stream",101:"Bad font file fmt",102:"Invalid slot",103:"Invalid request code",104:"No anode",105:"Block device required",106:"Channel number out of range",107:"Level 3 halted",108:"Level 3 reset",109:"Link number out of range",110:"Protocol driver not attached",111:"No CSI structure available",112:"Level 2 halted",113:"Invalid exchange",114:"Invalid request descriptor",115:"Exchange full",116:"No data (for no delay io)",117:"Timer expired",118:"Out of streams resources",119:"Machine is not on the network",120:"Package not installed",121:"The object is remote",122:"Advertise error",123:"Srmount error",124:"Communication error on send",125:"Cross mount point (not really error)",126:"Given log. name not unique",127:"f.d. invalid for this operation",128:"Remote address changed",129:"Can   access a needed shared lib",130:"Accessing a corrupted shared lib",131:".lib section in a.out corrupted",132:"Attempting to link in too many libs",133:"Attempting to exec a shared library",135:"Streams pipe error",136:"Too many users",137:"Socket type not supported",138:"Not supported",139:"Protocol family not supported",140:"Can't send after socket shutdown",141:"Too many references",142:"Host is down",148:"No medium (in tape drive)",156:"Level 2 not synchronized"},br={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},h={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{constructor(n){super(To[n]),this.name="ErrnoError",this.errno=n;for(var s in br)if(br[s]===n){this.code=s;break}}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(n,s={}){if(n=He.resolve(n),!n)return{path:"",node:null};var c={follow_mount:!0,recurse_count:0};if(s=Object.assign(c,s),s.recurse_count>8)throw new h.ErrnoError(32);for(var u=n.split("/").filter(F=>!!F),x=h.root,f="/",g=0;g<u.length;g++){var S=g===u.length-1;if(S&&s.parent)break;if(x=h.lookupNode(x,u[g]),f=fe.join2(f,u[g]),h.isMountpoint(x)&&(!S||S&&s.follow_mount)&&(x=x.mounted.root),!S||s.follow)for(var R=0;h.isLink(x.mode);){var M=h.readlink(f);f=He.resolve(fe.dirname(f),M);var O=h.lookupPath(f,{recurse_count:s.recurse_count+1});if(x=O.node,R++>40)throw new h.ErrnoError(32)}}return{path:f,node:x}},getPath(n){for(var s;;){if(h.isRoot(n)){var c=n.mount.mountpoint;return s?c[c.length-1]!=="/"?`${c}/${s}`:c+s:c}s=s?`${n.name}/${s}`:n.name,n=n.parent}},hashName(n,s){for(var c=0,u=0;u<s.length;u++)c=(c<<5)-c+s.charCodeAt(u)|0;return(n+c>>>0)%h.nameTable.length},hashAddNode(n){var s=h.hashName(n.parent.id,n.name);n.name_next=h.nameTable[s],h.nameTable[s]=n},hashRemoveNode(n){var s=h.hashName(n.parent.id,n.name);if(h.nameTable[s]===n)h.nameTable[s]=n.name_next;else for(var c=h.nameTable[s];c;){if(c.name_next===n){c.name_next=n.name_next;break}c=c.name_next}},lookupNode(n,s){var c=h.mayLookup(n);if(c)throw new h.ErrnoError(c);for(var u=h.hashName(n.id,s),x=h.nameTable[u];x;x=x.name_next){var f=x.name;if(x.parent.id===n.id&&f===s)return x}return h.lookup(n,s)},createNode(n,s,c,u){I(typeof n=="object");var x=new h.FSNode(n,s,c,u);return h.hashAddNode(x),x},destroyNode(n){h.hashRemoveNode(n)},isRoot(n){return n===n.parent},isMountpoint(n){return!!n.mounted},isFile(n){return(n&61440)===32768},isDir(n){return(n&61440)===16384},isLink(n){return(n&61440)===40960},isChrdev(n){return(n&61440)===8192},isBlkdev(n){return(n&61440)===24576},isFIFO(n){return(n&61440)===4096},isSocket(n){return(n&49152)===49152},flagsToPermissionString(n){var s=["r","w","rw"][n&3];return n&512&&(s+="w"),s},nodePermissions(n,s){return h.ignorePermissions?0:s.includes("r")&&!(n.mode&292)||s.includes("w")&&!(n.mode&146)||s.includes("x")&&!(n.mode&73)?2:0},mayLookup(n){if(!h.isDir(n.mode))return 54;var s=h.nodePermissions(n,"x");return s||(n.node_ops.lookup?0:2)},mayCreate(n,s){try{var c=h.lookupNode(n,s);return 20}catch{}return h.nodePermissions(n,"wx")},mayDelete(n,s,c){var u;try{u=h.lookupNode(n,s)}catch(f){return f.errno}var x=h.nodePermissions(n,"wx");if(x)return x;if(c){if(!h.isDir(u.mode))return 54;if(h.isRoot(u)||h.getPath(u)===h.cwd())return 10}else if(h.isDir(u.mode))return 31;return 0},mayOpen(n,s){return n?h.isLink(n.mode)?32:h.isDir(n.mode)&&(h.flagsToPermissionString(s)!=="r"||s&512)?31:h.nodePermissions(n,h.flagsToPermissionString(s)):44},MAX_OPEN_FDS:4096,nextfd(){for(var n=0;n<=h.MAX_OPEN_FDS;n++)if(!h.streams[n])return n;throw new h.ErrnoError(33)},getStreamChecked(n){var s=h.getStream(n);if(!s)throw new h.ErrnoError(8);return s},getStream:n=>h.streams[n],createStream(n,s=-1){return h.FSStream||(h.FSStream=function(){this.shared={}},h.FSStream.prototype={},Object.defineProperties(h.FSStream.prototype,{object:{get(){return this.node},set(c){this.node=c}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(c){this.shared.flags=c}},position:{get(){return this.shared.position},set(c){this.shared.position=c}}})),n=Object.assign(new h.FSStream,n),s==-1&&(s=h.nextfd()),n.fd=s,h.streams[s]=n,n},closeStream(n){h.streams[n]=null},chrdev_stream_ops:{open(n){var c,u;var s=h.getDevice(n.node.rdev);n.stream_ops=s.stream_ops,(u=(c=n.stream_ops).open)==null||u.call(c,n)},llseek(){throw new h.ErrnoError(70)}},major:n=>n>>8,minor:n=>n&255,makedev:(n,s)=>n<<8|s,registerDevice(n,s){h.devices[n]={stream_ops:s}},getDevice:n=>h.devices[n],getMounts(n){for(var s=[],c=[n];c.length;){var u=c.pop();s.push(u),c.push(...u.mounts)}return s},syncfs(n,s){typeof n=="function"&&(s=n,n=!1),h.syncFSRequests++,h.syncFSRequests>1&&U(`warning: ${h.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var c=h.getMounts(h.root.mount),u=0;function x(g){return I(h.syncFSRequests>0),h.syncFSRequests--,s(g)}function f(g){if(g)return f.errored?void 0:(f.errored=!0,x(g));++u>=c.length&&x(null)}c.forEach(g=>{if(!g.type.syncfs)return f(null);g.type.syncfs(g,n,f)})},mount(n,s,c){if(typeof n=="string")throw n;var u=c==="/",x=!c,f;if(u&&h.root)throw new h.ErrnoError(10);if(!u&&!x){var g=h.lookupPath(c,{follow_mount:!1});if(c=g.path,f=g.node,h.isMountpoint(f))throw new h.ErrnoError(10);if(!h.isDir(f.mode))throw new h.ErrnoError(54)}var S={type:n,opts:s,mountpoint:c,mounts:[]},R=n.mount(S);return R.mount=S,S.root=R,u?h.root=R:f&&(f.mounted=S,f.mount&&f.mount.mounts.push(S)),R},unmount(n){var s=h.lookupPath(n,{follow_mount:!1});if(!h.isMountpoint(s.node))throw new h.ErrnoError(28);var c=s.node,u=c.mounted,x=h.getMounts(u);Object.keys(h.nameTable).forEach(g=>{for(var S=h.nameTable[g];S;){var R=S.name_next;x.includes(S.mount)&&h.destroyNode(S),S=R}}),c.mounted=null;var f=c.mount.mounts.indexOf(u);I(f!==-1),c.mount.mounts.splice(f,1)},lookup(n,s){return n.node_ops.lookup(n,s)},mknod(n,s,c){var u=h.lookupPath(n,{parent:!0}),x=u.node,f=fe.basename(n);if(!f||f==="."||f==="..")throw new h.ErrnoError(28);var g=h.mayCreate(x,f);if(g)throw new h.ErrnoError(g);if(!x.node_ops.mknod)throw new h.ErrnoError(63);return x.node_ops.mknod(x,f,s,c)},create(n,s){return s=s!==void 0?s:438,s&=4095,s|=32768,h.mknod(n,s,0)},mkdir(n,s){return s=s!==void 0?s:511,s&=1023,s|=16384,h.mknod(n,s,0)},mkdirTree(n,s){for(var c=n.split("/"),u="",x=0;x<c.length;++x)if(c[x]){u+="/"+c[x];try{h.mkdir(u,s)}catch(f){if(f.errno!=20)throw f}}},mkdev(n,s,c){return typeof c>"u"&&(c=s,s=438),s|=8192,h.mknod(n,s,c)},symlink(n,s){if(!He.resolve(n))throw new h.ErrnoError(44);var c=h.lookupPath(s,{parent:!0}),u=c.node;if(!u)throw new h.ErrnoError(44);var x=fe.basename(s),f=h.mayCreate(u,x);if(f)throw new h.ErrnoError(f);if(!u.node_ops.symlink)throw new h.ErrnoError(63);return u.node_ops.symlink(u,x,n)},rename(n,s){var c=fe.dirname(n),u=fe.dirname(s),x=fe.basename(n),f=fe.basename(s),g,S,R;if(g=h.lookupPath(n,{parent:!0}),S=g.node,g=h.lookupPath(s,{parent:!0}),R=g.node,!S||!R)throw new h.ErrnoError(44);if(S.mount!==R.mount)throw new h.ErrnoError(75);var M=h.lookupNode(S,x),O=He.relative(n,u);if(O.charAt(0)!==".")throw new h.ErrnoError(28);if(O=He.relative(s,c),O.charAt(0)!==".")throw new h.ErrnoError(55);var F;try{F=h.lookupNode(R,f)}catch{}if(M!==F){var $=h.isDir(M.mode),H=h.mayDelete(S,x,$);if(H)throw new h.ErrnoError(H);if(H=F?h.mayDelete(R,f,$):h.mayCreate(R,f),H)throw new h.ErrnoError(H);if(!S.node_ops.rename)throw new h.ErrnoError(63);if(h.isMountpoint(M)||F&&h.isMountpoint(F))throw new h.ErrnoError(10);if(R!==S&&(H=h.nodePermissions(S,"w"),H))throw new h.ErrnoError(H);h.hashRemoveNode(M);try{S.node_ops.rename(M,R,f)}catch(oe){throw oe}finally{h.hashAddNode(M)}}},rmdir(n){var s=h.lookupPath(n,{parent:!0}),c=s.node,u=fe.basename(n),x=h.lookupNode(c,u),f=h.mayDelete(c,u,!0);if(f)throw new h.ErrnoError(f);if(!c.node_ops.rmdir)throw new h.ErrnoError(63);if(h.isMountpoint(x))throw new h.ErrnoError(10);c.node_ops.rmdir(c,u),h.destroyNode(x)},readdir(n){var s=h.lookupPath(n,{follow:!0}),c=s.node;if(!c.node_ops.readdir)throw new h.ErrnoError(54);return c.node_ops.readdir(c)},unlink(n){var s=h.lookupPath(n,{parent:!0}),c=s.node;if(!c)throw new h.ErrnoError(44);var u=fe.basename(n),x=h.lookupNode(c,u),f=h.mayDelete(c,u,!1);if(f)throw new h.ErrnoError(f);if(!c.node_ops.unlink)throw new h.ErrnoError(63);if(h.isMountpoint(x))throw new h.ErrnoError(10);c.node_ops.unlink(c,u),h.destroyNode(x)},readlink(n){var s=h.lookupPath(n),c=s.node;if(!c)throw new h.ErrnoError(44);if(!c.node_ops.readlink)throw new h.ErrnoError(28);return He.resolve(h.getPath(c.parent),c.node_ops.readlink(c))},stat(n,s){var c=h.lookupPath(n,{follow:!s}),u=c.node;if(!u)throw new h.ErrnoError(44);if(!u.node_ops.getattr)throw new h.ErrnoError(63);return u.node_ops.getattr(u)},lstat(n){return h.stat(n,!0)},chmod(n,s,c){var u;if(typeof n=="string"){var x=h.lookupPath(n,{follow:!c});u=x.node}else u=n;if(!u.node_ops.setattr)throw new h.ErrnoError(63);u.node_ops.setattr(u,{mode:s&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(n,s){h.chmod(n,s,!0)},fchmod(n,s){var c=h.getStreamChecked(n);h.chmod(c.node,s)},chown(n,s,c,u){var x;if(typeof n=="string"){var f=h.lookupPath(n,{follow:!u});x=f.node}else x=n;if(!x.node_ops.setattr)throw new h.ErrnoError(63);x.node_ops.setattr(x,{timestamp:Date.now()})},lchown(n,s,c){h.chown(n,s,c,!0)},fchown(n,s,c){var u=h.getStreamChecked(n);h.chown(u.node,s,c)},truncate(n,s){if(s<0)throw new h.ErrnoError(28);var c;if(typeof n=="string"){var u=h.lookupPath(n,{follow:!0});c=u.node}else c=n;if(!c.node_ops.setattr)throw new h.ErrnoError(63);if(h.isDir(c.mode))throw new h.ErrnoError(31);if(!h.isFile(c.mode))throw new h.ErrnoError(28);var x=h.nodePermissions(c,"w");if(x)throw new h.ErrnoError(x);c.node_ops.setattr(c,{size:s,timestamp:Date.now()})},ftruncate(n,s){var c=h.getStreamChecked(n);if((c.flags&2097155)===0)throw new h.ErrnoError(28);h.truncate(c.node,s)},utime(n,s,c){var u=h.lookupPath(n,{follow:!0}),x=u.node;x.node_ops.setattr(x,{timestamp:Math.max(s,c)})},open(n,s,c){if(n==="")throw new h.ErrnoError(44);s=typeof s=="string"?Ao(s):s,c=typeof c>"u"?438:c,s&64?c=c&4095|32768:c=0;var u;if(typeof n=="object")u=n;else{n=fe.normalize(n);try{var x=h.lookupPath(n,{follow:!(s&131072)});u=x.node}catch{}}var f=!1;if(s&64)if(u){if(s&128)throw new h.ErrnoError(20)}else u=h.mknod(n,c,0),f=!0;if(!u)throw new h.ErrnoError(44);if(h.isChrdev(u.mode)&&(s&=-513),s&65536&&!h.isDir(u.mode))throw new h.ErrnoError(54);if(!f){var g=h.mayOpen(u,s);if(g)throw new h.ErrnoError(g)}s&512&&!f&&h.truncate(u,0),s&=-131713;var S=h.createStream({node:u,path:h.getPath(u),flags:s,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),o.logReadFiles&&!(s&1)&&(h.readFiles||(h.readFiles={}),n in h.readFiles||(h.readFiles[n]=1)),S},close(n){if(h.isClosed(n))throw new h.ErrnoError(8);n.getdents&&(n.getdents=null);try{n.stream_ops.close&&n.stream_ops.close(n)}catch(s){throw s}finally{h.closeStream(n.fd)}n.fd=null},isClosed(n){return n.fd===null},llseek(n,s,c){if(h.isClosed(n))throw new h.ErrnoError(8);if(!n.seekable||!n.stream_ops.llseek)throw new h.ErrnoError(70);if(c!=0&&c!=1&&c!=2)throw new h.ErrnoError(28);return n.position=n.stream_ops.llseek(n,s,c),n.ungotten=[],n.position},read(n,s,c,u,x){if(I(c>=0),u<0||x<0)throw new h.ErrnoError(28);if(h.isClosed(n))throw new h.ErrnoError(8);if((n.flags&2097155)===1)throw new h.ErrnoError(8);if(h.isDir(n.node.mode))throw new h.ErrnoError(31);if(!n.stream_ops.read)throw new h.ErrnoError(28);var f=typeof x<"u";if(!f)x=n.position;else if(!n.seekable)throw new h.ErrnoError(70);var g=n.stream_ops.read(n,s,c,u,x);return f||(n.position+=g),g},write(n,s,c,u,x,f){if(I(c>=0),u<0||x<0)throw new h.ErrnoError(28);if(h.isClosed(n))throw new h.ErrnoError(8);if((n.flags&2097155)===0)throw new h.ErrnoError(8);if(h.isDir(n.node.mode))throw new h.ErrnoError(31);if(!n.stream_ops.write)throw new h.ErrnoError(28);n.seekable&&n.flags&1024&&h.llseek(n,0,2);var g=typeof x<"u";if(!g)x=n.position;else if(!n.seekable)throw new h.ErrnoError(70);var S=n.stream_ops.write(n,s,c,u,x,f);return g||(n.position+=S),S},allocate(n,s,c){if(h.isClosed(n))throw new h.ErrnoError(8);if(s<0||c<=0)throw new h.ErrnoError(28);if((n.flags&2097155)===0)throw new h.ErrnoError(8);if(!h.isFile(n.node.mode)&&!h.isDir(n.node.mode))throw new h.ErrnoError(43);if(!n.stream_ops.allocate)throw new h.ErrnoError(138);n.stream_ops.allocate(n,s,c)},mmap(n,s,c,u,x){if((u&2)!==0&&(x&2)===0&&(n.flags&2097155)!==2)throw new h.ErrnoError(2);if((n.flags&2097155)===1)throw new h.ErrnoError(2);if(!n.stream_ops.mmap)throw new h.ErrnoError(43);return n.stream_ops.mmap(n,s,c,u,x)},msync(n,s,c,u,x){return I(c>=0),n.stream_ops.msync?n.stream_ops.msync(n,s,c,u,x):0},munmap:n=>0,ioctl(n,s,c){if(!n.stream_ops.ioctl)throw new h.ErrnoError(59);return n.stream_ops.ioctl(n,s,c)},readFile(n,s={}){if(s.flags=s.flags||0,s.encoding=s.encoding||"binary",s.encoding!=="utf8"&&s.encoding!=="binary")throw new Error(`Invalid encoding type "${s.encoding}"`);var c,u=h.open(n,s.flags),x=h.stat(n),f=x.size,g=new Uint8Array(f);return h.read(u,g,0,f,0),s.encoding==="utf8"?c=it(g,0):s.encoding==="binary"&&(c=g),h.close(u),c},writeFile(n,s,c={}){c.flags=c.flags||577;var u=h.open(n,c.flags,c.mode);if(typeof s=="string"){var x=new Uint8Array(At(s)+1),f=Yt(s,x,0,x.length);h.write(u,x,0,f,void 0,c.canOwn)}else if(ArrayBuffer.isView(s))h.write(u,s,0,s.byteLength,void 0,c.canOwn);else throw new Error("Unsupported data type");h.close(u)},cwd:()=>h.currentPath,chdir(n){var s=h.lookupPath(n,{follow:!0});if(s.node===null)throw new h.ErrnoError(44);if(!h.isDir(s.node.mode))throw new h.ErrnoError(54);var c=h.nodePermissions(s.node,"x");if(c)throw new h.ErrnoError(c);h.currentPath=s.path},createDefaultDirectories(){h.mkdir("/tmp"),h.mkdir("/home"),h.mkdir("/home/web_user")},createDefaultDevices(){h.mkdir("/dev"),h.registerDevice(h.makedev(1,3),{read:()=>0,write:(u,x,f,g,S)=>g}),h.mkdev("/dev/null",h.makedev(1,3)),tt.register(h.makedev(5,0),tt.default_tty_ops),tt.register(h.makedev(6,0),tt.default_tty1_ops),h.mkdev("/dev/tty",h.makedev(5,0)),h.mkdev("/dev/tty1",h.makedev(6,0));var n=new Uint8Array(1024),s=0,c=()=>(s===0&&(s=Er(n).byteLength),n[--s]);h.createDevice("/dev","random",c),h.createDevice("/dev","urandom",c),h.mkdir("/dev/shm"),h.mkdir("/dev/shm/tmp")},createSpecialDirectories(){h.mkdir("/proc");var n=h.mkdir("/proc/self");h.mkdir("/proc/self/fd"),h.mount({mount(){var s=h.createNode(n,"fd",16895,73);return s.node_ops={lookup(c,u){var x=+u,f=h.getStreamChecked(x),g={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>f.path}};return g.parent=g,g}},s}},{},"/proc/self/fd")},createStandardStreams(){o.stdin?h.createDevice("/dev","stdin",o.stdin):h.symlink("/dev/tty","/dev/stdin"),o.stdout?h.createDevice("/dev","stdout",null,o.stdout):h.symlink("/dev/tty","/dev/stdout"),o.stderr?h.createDevice("/dev","stderr",null,o.stderr):h.symlink("/dev/tty1","/dev/stderr");var n=h.open("/dev/stdin",0),s=h.open("/dev/stdout",1),c=h.open("/dev/stderr",1);I(n.fd===0,`invalid handle for stdin (${n.fd})`),I(s.fd===1,`invalid handle for stdout (${s.fd})`),I(c.fd===2,`invalid handle for stderr (${c.fd})`)},staticInit(){[44].forEach(n=>{h.genericErrors[n]=new h.ErrnoError(n),h.genericErrors[n].stack="<generic error, no stack>"}),h.nameTable=new Array(4096),h.mount(ae,{},"/"),h.createDefaultDirectories(),h.createDefaultDevices(),h.createSpecialDirectories(),h.filesystems={MEMFS:ae,IDBFS:be}},init(n,s,c){I(!h.init.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),h.init.initialized=!0,o.stdin=n||o.stdin,o.stdout=s||o.stdout,o.stderr=c||o.stderr,h.createStandardStreams()},quit(){h.init.initialized=!1,Ts(0);for(var n=0;n<h.streams.length;n++){var s=h.streams[n];s&&h.close(s)}},findObject(n,s){var c=h.analyzePath(n,s);return c.exists?c.object:null},analyzePath(n,s){try{var c=h.lookupPath(n,{follow:!s});n=c.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var c=h.lookupPath(n,{parent:!0});u.parentExists=!0,u.parentPath=c.path,u.parentObject=c.node,u.name=fe.basename(n),c=h.lookupPath(n,{follow:!s}),u.exists=!0,u.path=c.path,u.object=c.node,u.name=c.node.name,u.isRoot=c.path==="/"}catch(x){u.error=x.errno}return u},createPath(n,s,c,u){n=typeof n=="string"?n:h.getPath(n);for(var x=s.split("/").reverse();x.length;){var f=x.pop();if(f){var g=fe.join2(n,f);try{h.mkdir(g)}catch{}n=g}}return g},createFile(n,s,c,u,x){var f=fe.join2(typeof n=="string"?n:h.getPath(n),s),g=Qt(u,x);return h.create(f,g)},createDataFile(n,s,c,u,x,f){var g=s;n&&(n=typeof n=="string"?n:h.getPath(n),g=s?fe.join2(n,s):n);var S=Qt(u,x),R=h.create(g,S);if(c){if(typeof c=="string"){for(var M=new Array(c.length),O=0,F=c.length;O<F;++O)M[O]=c.charCodeAt(O);c=M}h.chmod(R,S|146);var $=h.open(R,577);h.write($,c,0,c.length,0,f),h.close($),h.chmod(R,S)}},createDevice(n,s,c,u){var x=fe.join2(typeof n=="string"?n:h.getPath(n),s),f=Qt(!!c,!!u);h.createDevice.major||(h.createDevice.major=64);var g=h.makedev(h.createDevice.major++,0);return h.registerDevice(g,{open(S){S.seekable=!1},close(S){var R;(R=u==null?void 0:u.buffer)!=null&&R.length&&u(10)},read(S,R,M,O,F){for(var $=0,H=0;H<O;H++){var oe;try{oe=c()}catch{throw new h.ErrnoError(29)}if(oe===void 0&&$===0)throw new h.ErrnoError(6);if(oe==null)break;$++,R[M+H]=oe}return $&&(S.node.timestamp=Date.now()),$},write(S,R,M,O,F){for(var $=0;$<O;$++)try{u(R[M+$])}catch{throw new h.ErrnoError(29)}return O&&(S.node.timestamp=Date.now()),$}}),h.mkdev(x,f,g)},forceLoadFile(n){if(n.isDevice||n.isFolder||n.link||n.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(K)try{n.contents=Tt(K(n.url),!0),n.usedBytes=n.contents.length}catch{throw new h.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(n,s,c,u,x){function f(){this.lengthKnown=!1,this.chunks=[]}if(f.prototype.get=function(H){if(!(H>this.length-1||H<0)){var oe=H%this.chunkSize,ge=H/this.chunkSize|0;return this.getter(ge)[oe]}},f.prototype.setDataGetter=function(H){this.getter=H},f.prototype.cacheLength=function(){var H=new XMLHttpRequest;if(H.open("HEAD",c,!1),H.send(null),!(H.status>=200&&H.status<300||H.status===304))throw new Error("Couldn't load "+c+". Status: "+H.status);var oe=Number(H.getResponseHeader("Content-length")),ge,Ke=(ge=H.getResponseHeader("Accept-Ranges"))&&ge==="bytes",Re=(ge=H.getResponseHeader("Content-Encoding"))&&ge==="gzip",N=1024*1024;Ke||(N=oe);var q=(xe,je)=>{if(xe>je)throw new Error("invalid range ("+xe+", "+je+") or no bytes requested!");if(je>oe-1)throw new Error("only "+oe+" bytes available! programmer error!");var we=new XMLHttpRequest;if(we.open("GET",c,!1),oe!==N&&we.setRequestHeader("Range","bytes="+xe+"-"+je),we.responseType="arraybuffer",we.overrideMimeType&&we.overrideMimeType("text/plain; charset=x-user-defined"),we.send(null),!(we.status>=200&&we.status<300||we.status===304))throw new Error("Couldn't load "+c+". Status: "+we.status);return we.response!==void 0?new Uint8Array(we.response||[]):Tt(we.responseText||"",!0)},me=this;me.setDataGetter(xe=>{var je=xe*N,we=(xe+1)*N-1;if(we=Math.min(we,oe-1),typeof me.chunks[xe]>"u"&&(me.chunks[xe]=q(je,we)),typeof me.chunks[xe]>"u")throw new Error("doXHR failed!");return me.chunks[xe]}),(Re||!oe)&&(N=oe=1,oe=this.getter(0).length,N=oe,G("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=oe,this._chunkSize=N,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!m)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var g=new f;Object.defineProperties(g,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:g}}else var S={isDevice:!1,url:c};var R=h.createFile(n,s,S,u,x);S.contents?R.contents=S.contents:S.url&&(R.contents=null,R.url=S.url),Object.defineProperties(R,{usedBytes:{get:function(){return this.contents.length}}});var M={},O=Object.keys(R.stream_ops);O.forEach($=>{var H=R.stream_ops[$];M[$]=(...oe)=>(h.forceLoadFile(R),H(...oe))});function F($,H,oe,ge,Ke){var Re=$.node.contents;if(Ke>=Re.length)return 0;var N=Math.min(Re.length-Ke,ge);if(I(N>=0),Re.slice)for(var q=0;q<N;q++)H[oe+q]=Re[Ke+q];else for(var q=0;q<N;q++)H[oe+q]=Re.get(Ke+q);return N}return M.read=($,H,oe,ge,Ke)=>(h.forceLoadFile(R),F($,H,oe,ge,Ke)),M.mmap=($,H,oe,ge,Ke)=>{h.forceLoadFile(R);var Re=Kr();if(!Re)throw new h.ErrnoError(48);return F($,z,Re,H,oe),{ptr:Re,allocated:!0}},R.stream_ops=M,R},absolutePath(){_e("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){_e("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){_e("FS.createLink has been removed; use FS.symlink instead")},joinPath(){_e("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){_e("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){_e("FS.standardizePath has been removed; use PATH.normalize instead")}},Se={mount(n){return o.websocket=o.websocket&&typeof o.websocket=="object"?o.websocket:{},o.websocket._callbacks={},o.websocket.on=function(s,c){return typeof c=="function"&&(this._callbacks[s]=c),this},o.websocket.emit=function(s,c){typeof this._callbacks[s]=="function"&&this._callbacks[s].call(this,c)},h.createNode(null,"/",16895,0)},createSocket(n,s,c){s&=-526337;var u=s==1;if(u&&c&&c!=6)throw new h.ErrnoError(66);var x={family:n,type:s,protocol:c,server:null,error:null,peers:{},pending:[],recv_queue:[],sock_ops:Se.websocket_sock_ops},f=Se.nextname(),g=h.createNode(Se.root,f,49152,0);g.sock=x;var S=h.createStream({path:f,node:g,flags:2,seekable:!1,stream_ops:Se.stream_ops});return x.stream=S,x},getSocket(n){var s=h.getStream(n);return!s||!h.isSocket(s.node.mode)?null:s.node.sock},stream_ops:{poll(n){var s=n.node.sock;return s.sock_ops.poll(s)},ioctl(n,s,c){var u=n.node.sock;return u.sock_ops.ioctl(u,s,c)},read(n,s,c,u,x){var f=n.node.sock,g=f.sock_ops.recvmsg(f,u);return g?(s.set(g.buffer,c),g.buffer.length):0},write(n,s,c,u,x){var f=n.node.sock;return f.sock_ops.sendmsg(f,s,c,u)},close(n){var s=n.node.sock;s.sock_ops.close(s)}},nextname(){return Se.nextname.current||(Se.nextname.current=0),"socket["+Se.nextname.current+++"]"},websocket_sock_ops:{createPeer(n,s,c){var u;if(typeof s=="object"&&(u=s,s=null,c=null),u)if(u._socket)s=u._socket.remoteAddress,c=u._socket.remotePort;else{var x=/ws[s]?:\/\/([^:]+):(\d+)/.exec(u.url);if(!x)throw new Error("WebSocket URL must be in the format ws(s)://address:port");s=x[1],c=parseInt(x[2],10)}else try{var f=o.websocket&&typeof o.websocket=="object",g="ws:#".replace("#","//");if(f&&typeof o.websocket.url=="string"&&(g=o.websocket.url),g==="ws://"||g==="wss://"){var S=s.split("/");g=g+S[0]+":"+c+"/"+S.slice(1).join("/")}var R="binary";f&&typeof o.websocket.subprotocol=="string"&&(R=o.websocket.subprotocol);var M=void 0;R!=="null"&&(R=R.replace(/^ +| +$/g,"").split(/ *, */),M=R),f&&o.websocket.subprotocol===null&&(R="null",M=void 0);var O;_?O=T("ws"):O=WebSocket,u=new O(g,M),u.binaryType="arraybuffer"}catch{throw new h.ErrnoError(23)}var F={addr:s,port:c,socket:u,dgram_send_queue:[]};return Se.websocket_sock_ops.addPeer(n,F),Se.websocket_sock_ops.handlePeerEvents(n,F),n.type===2&&typeof n.sport<"u"&&F.dgram_send_queue.push(new Uint8Array([255,255,255,255,112,111,114,116,(n.sport&65280)>>8,n.sport&255])),F},getPeer(n,s,c){return n.peers[s+":"+c]},addPeer(n,s){n.peers[s.addr+":"+s.port]=s},removePeer(n,s){delete n.peers[s.addr+":"+s.port]},handlePeerEvents(n,s){var c=!0,u=function(){o.websocket.emit("open",n.stream.fd);try{for(var f=s.dgram_send_queue.shift();f;)s.socket.send(f),f=s.dgram_send_queue.shift()}catch{s.socket.close()}};function x(f){if(typeof f=="string"){var g=new TextEncoder;f=g.encode(f)}else{if(I(f.byteLength!==void 0),f.byteLength==0)return;f=new Uint8Array(f)}var S=c;if(c=!1,S&&f.length===10&&f[0]===255&&f[1]===255&&f[2]===255&&f[3]===255&&f[4]===112&&f[5]===111&&f[6]===114&&f[7]===116){var R=f[8]<<8|f[9];Se.websocket_sock_ops.removePeer(n,s),s.port=R,Se.websocket_sock_ops.addPeer(n,s);return}n.recv_queue.push({addr:s.addr,port:s.port,data:f}),o.websocket.emit("message",n.stream.fd)}_?(s.socket.on("open",u),s.socket.on("message",function(f,g){g&&x(new Uint8Array(f).buffer)}),s.socket.on("close",function(){o.websocket.emit("close",n.stream.fd)}),s.socket.on("error",function(f){n.error=14,o.websocket.emit("error",[n.stream.fd,n.error,"ECONNREFUSED: Connection refused"])})):(s.socket.onopen=u,s.socket.onclose=function(){o.websocket.emit("close",n.stream.fd)},s.socket.onmessage=function(g){x(g.data)},s.socket.onerror=function(f){n.error=14,o.websocket.emit("error",[n.stream.fd,n.error,"ECONNREFUSED: Connection refused"])})},poll(n){if(n.type===1&&n.server)return n.pending.length?65:0;var s=0,c=n.type===1?Se.websocket_sock_ops.getPeer(n,n.daddr,n.dport):null;return(n.recv_queue.length||!c||c&&c.socket.readyState===c.socket.CLOSING||c&&c.socket.readyState===c.socket.CLOSED)&&(s|=65),(!c||c&&c.socket.readyState===c.socket.OPEN)&&(s|=4),(c&&c.socket.readyState===c.socket.CLOSING||c&&c.socket.readyState===c.socket.CLOSED)&&(s|=16),s},ioctl(n,s,c){switch(s){case 21531:var u=0;return n.recv_queue.length&&(u=n.recv_queue[0].data.length),A[c>>2]=u,Y(u),0;default:return 28}},close(n){if(n.server){try{n.server.close()}catch{}n.server=null}for(var s=Object.keys(n.peers),c=0;c<s.length;c++){var u=n.peers[s[c]];try{u.socket.close()}catch{}Se.websocket_sock_ops.removePeer(n,u)}return 0},bind(n,s,c){if(typeof n.saddr<"u"||typeof n.sport<"u")throw new h.ErrnoError(28);if(n.saddr=s,n.sport=c,n.type===2){n.server&&(n.server.close(),n.server=null);try{n.sock_ops.listen(n,0)}catch(u){if(u.name!=="ErrnoError"||u.errno!==138)throw u}}},connect(n,s,c){if(n.server)throw new h.ErrnoError(138);if(typeof n.daddr<"u"&&typeof n.dport<"u"){var u=Se.websocket_sock_ops.getPeer(n,n.daddr,n.dport);if(u)throw u.socket.readyState===u.socket.CONNECTING?new h.ErrnoError(7):new h.ErrnoError(30)}var x=Se.websocket_sock_ops.createPeer(n,s,c);throw n.daddr=x.addr,n.dport=x.port,new h.ErrnoError(26)},listen(n,s){if(!_)throw new h.ErrnoError(138);if(n.server)throw new h.ErrnoError(28);var c=T("ws").Server,u=n.saddr;n.server=new c({host:u,port:n.sport}),o.websocket.emit("listen",n.stream.fd),n.server.on("connection",function(x){if(n.type===1){var f=Se.createSocket(n.family,n.type,n.protocol),g=Se.websocket_sock_ops.createPeer(f,x);f.daddr=g.addr,f.dport=g.port,n.pending.push(f),o.websocket.emit("connection",f.stream.fd)}else Se.websocket_sock_ops.createPeer(n,x),o.websocket.emit("connection",n.stream.fd)}),n.server.on("close",function(){o.websocket.emit("close",n.stream.fd),n.server=null}),n.server.on("error",function(x){n.error=23,o.websocket.emit("error",[n.stream.fd,n.error,"EHOSTUNREACH: Host is unreachable"])})},accept(n){if(!n.server||!n.pending.length)throw new h.ErrnoError(28);var s=n.pending.shift();return s.stream.flags=n.stream.flags,s},getname(n,s){var c,u;if(s){if(n.daddr===void 0||n.dport===void 0)throw new h.ErrnoError(53);c=n.daddr,u=n.dport}else c=n.saddr||0,u=n.sport||0;return{addr:c,port:u}},sendmsg(n,s,c,u,x,f){if(n.type===2){if((x===void 0||f===void 0)&&(x=n.daddr,f=n.dport),x===void 0||f===void 0)throw new h.ErrnoError(17)}else x=n.daddr,f=n.dport;var g=Se.websocket_sock_ops.getPeer(n,x,f);if(n.type===1){if(!g||g.socket.readyState===g.socket.CLOSING||g.socket.readyState===g.socket.CLOSED)throw new h.ErrnoError(53);if(g.socket.readyState===g.socket.CONNECTING)throw new h.ErrnoError(6)}ArrayBuffer.isView(s)&&(c+=s.byteOffset,s=s.buffer);var S;if(S=s.slice(c,c+u),n.type===2&&(!g||g.socket.readyState!==g.socket.OPEN))return(!g||g.socket.readyState===g.socket.CLOSING||g.socket.readyState===g.socket.CLOSED)&&(g=Se.websocket_sock_ops.createPeer(n,x,f)),g.dgram_send_queue.push(S),u;try{return g.socket.send(S),u}catch{throw new h.ErrnoError(28)}},recvmsg(n,s){if(n.type===1&&n.server)throw new h.ErrnoError(53);var c=n.recv_queue.shift();if(!c){if(n.type===1){var u=Se.websocket_sock_ops.getPeer(n,n.daddr,n.dport);if(!u)throw new h.ErrnoError(53);if(u.socket.readyState===u.socket.CLOSING||u.socket.readyState===u.socket.CLOSED)return null;throw new h.ErrnoError(6)}throw new h.ErrnoError(6)}var x=c.data.byteLength||c.data.length,f=c.data.byteOffset||0,g=c.data.buffer||c.data,S=Math.min(s,x),R={buffer:new Uint8Array(g,f,S),addr:c.addr,port:c.port};if(n.type===1&&S<x){var M=x-S;c.data=new Uint8Array(g,f+S,M),n.recv_queue.unshift(c)}return R}}},at=n=>{var s=Se.getSocket(n);if(!s)throw new h.ErrnoError(8);return s},Xt=n=>(n&255)+"."+(n>>8&255)+"."+(n>>16&255)+"."+(n>>24&255),vr=n=>{var s="",c=0,u=0,x=0,f=0,g=0,S=0,R=[n[0]&65535,n[0]>>16,n[1]&65535,n[1]>>16,n[2]&65535,n[2]>>16,n[3]&65535,n[3]>>16],M=!0,O="";for(S=0;S<5;S++)if(R[S]!==0){M=!1;break}if(M){if(O=Xt(R[6]|R[7]<<16),R[5]===-1)return s="::ffff:",s+=O,s;if(R[5]===0)return s="::",O==="0.0.0.0"&&(O=""),O==="0.0.0.1"&&(O="1"),s+=O,s}for(c=0;c<8;c++)R[c]===0&&(c-x>1&&(g=0),x=c,g++),g>u&&(u=g,f=c-u+1);for(c=0;c<8;c++){if(u>1&&R[c]===0&&c>=f&&c<f+u){c===f&&(s+=":",f===0&&(s+=":"));continue}s+=Number(Jr(R[c]&65535)).toString(16),s+=c<7?":":""}return s},Rr=(n,s)=>{var c=re[n>>1],u=Jr(V[n+2>>1]),x;switch(c){case 2:if(s!==16)return{errno:28};x=A[n+4>>2],x=Xt(x);break;case 10:if(s!==28)return{errno:28};x=[A[n+8>>2],A[n+12>>2],A[n+16>>2],A[n+20>>2]],x=vr(x);break;default:return{errno:5}}return{family:c,addr:x,port:u}},Mt=n=>{for(var s=n.split("."),c=0;c<4;c++){var u=Number(s[c]);if(isNaN(u))return null;s[c]=u}return(s[0]|s[1]<<8|s[2]<<16|s[3]<<24)>>>0},Dt=n=>parseInt(n),qt=n=>{var s,c,u,x,f=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,g=[];if(!f.test(n))return null;if(n==="::")return[0,0,0,0,0,0,0,0];for(n.startsWith("::")?n=n.replace("::","Z:"):n=n.replace("::",":Z:"),n.indexOf(".")>0?(n=n.replace(new RegExp("[.]","g"),":"),s=n.split(":"),s[s.length-4]=Dt(s[s.length-4])+Dt(s[s.length-3])*256,s[s.length-3]=Dt(s[s.length-2])+Dt(s[s.length-1])*256,s=s.slice(0,s.length-2)):s=n.split(":"),u=0,x=0,c=0;c<s.length;c++)if(typeof s[c]=="string")if(s[c]==="Z"){for(x=0;x<8-s.length+1;x++)g[c+x]=0;u=x-1}else g[c+u]=Rt(parseInt(s[c],16));else g[c+u]=s[c];return[g[1]<<16|g[0],g[3]<<16|g[2],g[5]<<16|g[4],g[7]<<16|g[6]]},Me={address_map:{id:1,addrs:{},names:{}},lookup_name(n){var s=Mt(n);if(s!==null||(s=qt(n),s!==null))return n;var c;if(Me.address_map.addrs[n])c=Me.address_map.addrs[n];else{var u=Me.address_map.id++;I(u<65535,"exceeded max address mappings of 65535"),c="172.29."+(u&255)+"."+(u&65280),Me.address_map.names[c]=n,Me.address_map.addrs[n]=c}return c},lookup_addr(n){return Me.address_map.names[n]?Me.address_map.names[n]:null}},Jt=(n,s,c)=>{if(c&&n===0)return null;var u=Rr(n,s);if(u.errno)throw new h.ErrnoError(u.errno);return u.addr=Me.lookup_addr(u.addr)||u.addr,u};function Mo(n,s,c,u,x,f){try{var g=at(n),S=Jt(s,c);return g.sock_ops.bind(g,S.addr,S.port),0}catch(R){if(typeof h>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}function Do(n,s,c,u,x,f){try{var g=at(n),S=Jt(s,c);return g.sock_ops.connect(g,S.addr,S.port),0}catch(R){if(typeof h>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}var ie={DEFAULT_POLLMASK:5,calculateAt(n,s,c){if(fe.isAbs(s))return s;var u;if(n===-100)u=h.cwd();else{var x=ie.getStreamFromFD(n);u=x.path}if(s.length==0){if(!c)throw new h.ErrnoError(44);return u}return fe.join2(u,s)},doStat(n,s,c){var u=n(s);A[c>>2]=u.dev,Y(u.dev),A[c+4>>2]=u.mode,Y(u.mode),B[c+8>>2]=u.nlink,Y(u.nlink),A[c+12>>2]=u.uid,Y(u.uid),A[c+16>>2]=u.gid,Y(u.gid),A[c+20>>2]=u.rdev,Y(u.rdev),he=[u.size>>>0,(ee=u.size,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[c+24>>2]=he[0],A[c+28>>2]=he[1],Be(u.size),A[c+32>>2]=4096,Y(4096),A[c+36>>2]=u.blocks,Y(u.blocks);var x=u.atime.getTime(),f=u.mtime.getTime(),g=u.ctime.getTime();return he=[Math.floor(x/1e3)>>>0,(ee=Math.floor(x/1e3),+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[c+40>>2]=he[0],A[c+44>>2]=he[1],Be(Math.floor(x/1e3)),B[c+48>>2]=x%1e3*1e3,Y(x%1e3*1e3),he=[Math.floor(f/1e3)>>>0,(ee=Math.floor(f/1e3),+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[c+56>>2]=he[0],A[c+60>>2]=he[1],Be(Math.floor(f/1e3)),B[c+64>>2]=f%1e3*1e3,Y(f%1e3*1e3),he=[Math.floor(g/1e3)>>>0,(ee=Math.floor(g/1e3),+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[c+72>>2]=he[0],A[c+76>>2]=he[1],Be(Math.floor(g/1e3)),B[c+80>>2]=g%1e3*1e3,Y(g%1e3*1e3),he=[u.ino>>>0,(ee=u.ino,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[c+88>>2]=he[0],A[c+92>>2]=he[1],Be(u.ino),0},doMsync(n,s,c,u,x){if(!h.isFile(s.node.mode))throw new h.ErrnoError(43);if(u&2)return 0;var f=Q.slice(n,n+c);h.msync(s,f,x,c,u)},varargs:void 0,get(){I(ie.varargs!=null);var n=A[+ie.varargs>>2];return ie.varargs+=4,n},getp(){return ie.get()},getStr(n){var s=Fe(n);return s},getStreamFromFD(n){var s=h.getStreamChecked(n);return s}};function Lo(n,s,c,u){try{if(s=ie.getStr(s),I(u===0),s=ie.calculateAt(n,s),c&-8)return-28;var x=h.lookupPath(s,{follow:!0}),f=x.node;if(!f)return-44;var g="";return c&4&&(g+="r"),c&2&&(g+="w"),c&1&&(g+="x"),g&&h.nodePermissions(f,g)?-2:0}catch(S){if(typeof h>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function Po(n,s,c){ie.varargs=c;try{var u=ie.getStreamFromFD(n);switch(s){case 0:{var x=ie.get();if(x<0)return-28;for(;h.streams[x];)x++;var f;return f=h.createStream(u,x),f.fd}case 1:case 2:return 0;case 3:return u.flags;case 4:{var x=ie.get();return u.flags|=x,0}case 12:{var x=ie.getp(),g=0;return re[x+g>>1]=2,Ie(2),0}case 13:case 14:return 0}return-28}catch(S){if(typeof h>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function Io(n,s){try{var c=ie.getStreamFromFD(n);return ie.doStat(h.stat,c.path,s)}catch(u){if(typeof h>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}var gt=(n,s,c)=>(I(typeof c=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),Yt(n,Q,s,c));function Oo(n,s,c){try{var u=ie.getStreamFromFD(n);u.getdents||(u.getdents=h.readdir(u.path));for(var x=280,f=0,g=h.llseek(u,0,1),S=Math.floor(g/x);S<u.getdents.length&&f+x<=c;){var R,M,O=u.getdents[S];if(O===".")R=u.node.id,M=4;else if(O===".."){var F=h.lookupPath(u.path,{parent:!0});R=F.node.id,M=4}else{var $=h.lookupNode(u.node,O);R=$.id,M=h.isChrdev($.mode)?2:h.isDir($.mode)?4:h.isLink($.mode)?10:8}I(R),he=[R>>>0,(ee=R,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[s+f>>2]=he[0],A[s+f+4>>2]=he[1],Be(R),he=[(S+1)*x>>>0,(ee=(S+1)*x,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[s+f+8>>2]=he[0],A[s+f+12>>2]=he[1],Be((S+1)*x),re[s+f+16>>1]=280,Ie(280),z[s+f+18]=M,et(M),gt(O,s+f+19,256),f+=x,S+=1}return h.llseek(u,S*x,0),f}catch(H){if(typeof h>"u"||H.name!=="ErrnoError")throw H;return-H.errno}}var Zt=(n,s,c,u,x)=>{switch(s){case 2:c=Mt(c),Sr(n,16),x&&(A[x>>2]=16,Y(16)),re[n>>1]=s,Ie(s),A[n+4>>2]=c,Y(c),re[n+2>>1]=Rt(u),Ie(Rt(u));break;case 10:c=qt(c),Sr(n,28),x&&(A[x>>2]=28,Y(28)),A[n>>2]=s,Y(s),A[n+8>>2]=c[0],Y(c[0]),A[n+12>>2]=c[1],Y(c[1]),A[n+16>>2]=c[2],Y(c[2]),A[n+20>>2]=c[3],Y(c[3]),re[n+2>>1]=Rt(u),Ie(Rt(u));break;default:return 5}return 0};function ko(n,s,c,u,x,f){try{var g=at(n),S=Zt(s,g.family,Me.lookup_name(g.saddr||"0.0.0.0"),g.sport,c);return I(!S),0}catch(R){if(typeof h>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}function Bo(n,s,c,u,x,f){try{var g=at(n);return s===1&&c===4?(A[u>>2]=g.error,Y(g.error),A[x>>2]=4,Y(4),g.error=null,0):-50}catch(S){if(typeof h>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function Fo(n,s,c){ie.varargs=c;try{var u=ie.getStreamFromFD(n);switch(s){case 21509:return u.tty?0:-59;case 21505:{if(!u.tty)return-59;if(u.tty.ops.ioctl_tcgets){var x=u.tty.ops.ioctl_tcgets(u),f=ie.getp();A[f>>2]=x.c_iflag||0,Y(x.c_iflag||0),A[f+4>>2]=x.c_oflag||0,Y(x.c_oflag||0),A[f+8>>2]=x.c_cflag||0,Y(x.c_cflag||0),A[f+12>>2]=x.c_lflag||0,Y(x.c_lflag||0);for(var g=0;g<32;g++)z[f+g+17]=x.c_cc[g]||0,et(x.c_cc[g]||0);return 0}return 0}case 21510:case 21511:case 21512:return u.tty?0:-59;case 21506:case 21507:case 21508:{if(!u.tty)return-59;if(u.tty.ops.ioctl_tcsets){for(var f=ie.getp(),S=A[f>>2],R=A[f+4>>2],M=A[f+8>>2],O=A[f+12>>2],F=[],g=0;g<32;g++)F.push(z[f+g+17]);return u.tty.ops.ioctl_tcsets(u.tty,s,{c_iflag:S,c_oflag:R,c_cflag:M,c_lflag:O,c_cc:F})}return 0}case 21519:{if(!u.tty)return-59;var f=ie.getp();return A[f>>2]=0,Y(0),0}case 21520:return u.tty?-28:-59;case 21531:{var f=ie.getp();return h.ioctl(u,s,f)}case 21523:{if(!u.tty)return-59;if(u.tty.ops.ioctl_tiocgwinsz){var $=u.tty.ops.ioctl_tiocgwinsz(u.tty),f=ie.getp();re[f>>1]=$[0],Ie($[0]),re[f+2>>1]=$[1],Ie($[1])}return 0}case 21524:return u.tty?0:-59;case 21515:return u.tty?0:-59;default:return-28}}catch(H){if(typeof h>"u"||H.name!=="ErrnoError")throw H;return-H.errno}}function No(n,s){try{return n=ie.getStr(n),ie.doStat(h.lstat,n,s)}catch(c){if(typeof h>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function $o(n,s,c,u){try{s=ie.getStr(s);var x=u&256,f=u&4096;return u=u&-6401,I(!u,`unknown flags in __syscall_newfstatat: ${u}`),s=ie.calculateAt(n,s,f),ie.doStat(x?h.lstat:h.stat,s,c)}catch(g){if(typeof h>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function Uo(n,s,c,u){ie.varargs=u;try{s=ie.getStr(s),s=ie.calculateAt(n,s);var x=u?ie.get():0;return h.open(s,c,x).fd}catch(f){if(typeof h>"u"||f.name!=="ErrnoError")throw f;return-f.errno}}function Go(n,s,c){try{for(var u=0,x=0;x<s;x++){var f=n+8*x,g=A[f>>2],S=re[f+4>>1],R=32,M=h.getStream(g);M&&(R=ie.DEFAULT_POLLMASK,M.stream_ops.poll&&(R=M.stream_ops.poll(M,-1))),R&=S|8|16,R&&u++,re[f+6>>1]=R,Ie(R)}return u}catch(O){if(typeof h>"u"||O.name!=="ErrnoError")throw O;return-O.errno}}function Vo(n,s,c,u,x,f){try{var g=at(n),S=g.sock_ops.recvmsg(g,c);if(!S)return 0;if(x){var R=Zt(x,g.family,Me.lookup_name(S.addr),S.port,f);I(!R)}return Q.set(S.buffer,s),S.buffer.byteLength}catch(M){if(typeof h>"u"||M.name!=="ErrnoError")throw M;return-M.errno}}function Ho(n,s,c,u){try{return s=ie.getStr(s),u=ie.getStr(u),s=ie.calculateAt(n,s),u=ie.calculateAt(c,u),h.rename(s,u),0}catch(x){if(typeof h>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function Wo(n){try{return n=ie.getStr(n),h.rmdir(n),0}catch(s){if(typeof h>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function zo(n,s,c,u,x,f){try{var g=at(n),S=Jt(x,f,!0);return S?g.sock_ops.sendmsg(g,z,s,c,S.addr,S.port):h.write(g.stream,z,s,c)}catch(R){if(typeof h>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}function Yo(n,s,c){try{var u=Se.createSocket(n,s,c);return I(u.stream.fd<64),u.stream.fd}catch(x){if(typeof h>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function Qo(n,s){try{return n=ie.getStr(n),ie.doStat(h.stat,n,s)}catch(c){if(typeof h>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function Xo(n,s,c){try{return s=ie.getStr(s),s=ie.calculateAt(n,s),c===0?h.unlink(s):c===512?h.rmdir(s):_e("Invalid flags passed to unlinkat"),0}catch(u){if(typeof h>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}var qo=(n,s,c,u,x)=>{},Jo=()=>{for(var n=new Array(256),s=0;s<256;++s)n[s]=String.fromCharCode(s);wr=n},wr,De=n=>{for(var s="",c=n;Q[c];)s+=wr[Q[c++]];return s},ct={},rt={},Lt={},lt,pe=n=>{throw new lt(n)},jr,Pt=n=>{throw new jr(n)},dt=(n,s,c)=>{n.forEach(function(S){Lt[S]=s});function u(S){var R=c(S);R.length!==n.length&&Pt("Mismatched type converter count");for(var M=0;M<n.length;++M)We(n[M],R[M])}var x=new Array(s.length),f=[],g=0;s.forEach((S,R)=>{rt.hasOwnProperty(S)?x[R]=rt[S]:(f.push(S),ct.hasOwnProperty(S)||(ct[S]=[]),ct[S].push(()=>{x[R]=rt[S],++g,g===f.length&&u(x)}))}),f.length===0&&u(x)};function Zo(n,s,c={}){var u=s.name;if(n||pe(`type "${u}" must have a positive integer typeid pointer`),rt.hasOwnProperty(n)){if(c.ignoreDuplicateRegistrations)return;pe(`Cannot register type '${u}' twice`)}if(rt[n]=s,delete Lt[n],ct.hasOwnProperty(n)){var x=ct[n];delete ct[n],x.forEach(f=>f())}}function We(n,s,c={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Zo(n,s,c)}var Xe=8,en=(n,s,c,u)=>{s=De(s),We(n,{name:s,fromWireType:function(x){return!!x},toWireType:function(x,f){return f?c:u},argPackAdvance:Xe,readValueFromPointer:function(x){return this.fromWireType(Q[x])},destructorFunction:null})},tn=n=>({count:n.count,deleteScheduled:n.deleteScheduled,preservePointerOnDelete:n.preservePointerOnDelete,ptr:n.ptr,ptrType:n.ptrType,smartPtr:n.smartPtr,smartPtrType:n.smartPtrType}),er=n=>{function s(c){return c.$$.ptrType.registeredClass.name}pe(s(n)+" instance already deleted")},tr=!1,Ar=n=>{},rn=n=>{n.smartPtr?n.smartPtrType.rawDestructor(n.smartPtr):n.ptrType.registeredClass.rawDestructor(n.ptr)},Tr=n=>{n.count.value-=1;var s=n.count.value===0;s&&rn(n)},Mr=(n,s,c)=>{if(s===c)return n;if(c.baseClass===void 0)return null;var u=Mr(n,s,c.baseClass);return u===null?null:c.downcast(u)},Dr={},on=()=>Object.keys(Et).length,nn=()=>{var n=[];for(var s in Et)Et.hasOwnProperty(s)&&n.push(Et[s]);return n},Ct=[],rr=()=>{for(;Ct.length;){var n=Ct.pop();n.$$.deleteScheduled=!1,n.delete()}},yt,sn=n=>{yt=n,Ct.length&&yt&&yt(rr)},an=()=>{o.getInheritedInstanceCount=on,o.getLiveInheritedInstances=nn,o.flushPendingDeletes=rr,o.setDelayFunction=sn},Et={},cn=(n,s)=>{for(s===void 0&&pe("ptr should not be undefined");n.baseClass;)s=n.upcast(s),n=n.baseClass;return s},ln=(n,s)=>(s=cn(n,s),Et[s]),It=(n,s)=>{(!s.ptrType||!s.ptr)&&Pt("makeClassHandle requires ptr and ptrType");var c=!!s.smartPtrType,u=!!s.smartPtr;return c!==u&&Pt("Both smartPtrType and smartPtr must be specified"),s.count={value:1},St(Object.create(n,{$$:{value:s,writable:!0}}))};function Lr(n){var s=this.getPointee(n);if(!s)return this.destructor(n),null;var c=ln(this.registeredClass,s);if(c!==void 0){if(c.$$.count.value===0)return c.$$.ptr=s,c.$$.smartPtr=n,c.clone();var u=c.clone();return this.destructor(n),u}function x(){return this.isSmartPointer?It(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:s,smartPtrType:this,smartPtr:n}):It(this.registeredClass.instancePrototype,{ptrType:this,ptr:n})}var f=this.registeredClass.getActualType(s),g=Dr[f];if(!g)return x.call(this);var S;this.isConst?S=g.constPointerType:S=g.pointerType;var R=Mr(s,this.registeredClass,S.registeredClass);return R===null?x.call(this):this.isSmartPointer?It(S.registeredClass.instancePrototype,{ptrType:S,ptr:R,smartPtrType:this,smartPtr:n}):It(S.registeredClass.instancePrototype,{ptrType:S,ptr:R})}var St=n=>typeof FinalizationRegistry>"u"?(St=s=>s,n):(tr=new FinalizationRegistry(s=>{console.warn(s.leakWarning.stack.replace(/^Error: /,"")),Tr(s.$$)}),St=s=>{var c=s.$$,u=!!c.smartPtr;if(u){var x={$$:c},f=c.ptrType.registeredClass;x.leakWarning=new Error(`Embind found a leaked C++ instance ${f.name} <${Ge(c.ptr)}>.
We'll free it automatically in this case, but this functionality is not reliable across various environments.
Make sure to invoke .delete() manually once you're done with the instance instead.
Originally allocated`),"captureStackTrace"in Error&&Error.captureStackTrace(x.leakWarning,Lr),tr.register(s,x,s)}return s},Ar=s=>tr.unregister(s),St(n)),dn=()=>{Object.assign(Ot.prototype,{isAliasOf(n){if(!(this instanceof Ot)||!(n instanceof Ot))return!1;var s=this.$$.ptrType.registeredClass,c=this.$$.ptr;n.$$=n.$$;for(var u=n.$$.ptrType.registeredClass,x=n.$$.ptr;s.baseClass;)c=s.upcast(c),s=s.baseClass;for(;u.baseClass;)x=u.upcast(x),u=u.baseClass;return s===u&&c===x},clone(){if(this.$$.ptr||er(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var n=St(Object.create(Object.getPrototypeOf(this),{$$:{value:tn(this.$$)}}));return n.$$.count.value+=1,n.$$.deleteScheduled=!1,n},delete(){this.$$.ptr||er(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&pe("Object already scheduled for deletion"),Ar(this),Tr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||er(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&pe("Object already scheduled for deletion"),Ct.push(this),Ct.length===1&&yt&&yt(rr),this.$$.deleteScheduled=!0,this}})};function Ot(){}var kt=(n,s)=>Object.defineProperty(s,"name",{value:n}),Pr=(n,s,c)=>{if(n[s].overloadTable===void 0){var u=n[s];n[s]=function(...x){return n[s].overloadTable.hasOwnProperty(x.length)||pe(`Function '${c}' called with an invalid number of arguments (${x.length}) - expects one of (${n[s].overloadTable})!`),n[s].overloadTable[x.length].apply(this,x)},n[s].overloadTable=[],n[s].overloadTable[u.argCount]=u}},Ir=(n,s,c)=>{o.hasOwnProperty(n)?((c===void 0||o[n].overloadTable!==void 0&&o[n].overloadTable[c]!==void 0)&&pe(`Cannot register public name '${n}' twice`),Pr(o,n,n),o.hasOwnProperty(c)&&pe(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),o[n].overloadTable[c]=s):(o[n]=s,c!==void 0&&(o[n].numArguments=c))},un=48,pn=57,mn=n=>{if(n===void 0)return"_unknown";n=n.replace(/[^a-zA-Z0-9_]/g,"$");var s=n.charCodeAt(0);return s>=un&&s<=pn?`_${n}`:n};function xn(n,s,c,u,x,f,g,S){this.name=n,this.constructor=s,this.instancePrototype=c,this.rawDestructor=u,this.baseClass=x,this.getActualType=f,this.upcast=g,this.downcast=S,this.pureVirtualFunctions=[]}var or=(n,s,c)=>{for(;s!==c;)s.upcast||pe(`Expected null or instance of ${c.name}, got an instance of ${s.name}`),n=s.upcast(n),s=s.baseClass;return n};function hn(n,s){if(s===null)return this.isReference&&pe(`null is not a valid ${this.name}`),0;s.$$||pe(`Cannot pass "${ut(s)}" as a ${this.name}`),s.$$.ptr||pe(`Cannot pass deleted object as a pointer of type ${this.name}`);var c=s.$$.ptrType.registeredClass,u=or(s.$$.ptr,c,this.registeredClass);return u}function _n(n,s){var c;if(s===null)return this.isReference&&pe(`null is not a valid ${this.name}`),this.isSmartPointer?(c=this.rawConstructor(),n!==null&&n.push(this.rawDestructor,c),c):0;(!s||!s.$$)&&pe(`Cannot pass "${ut(s)}" as a ${this.name}`),s.$$.ptr||pe(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&s.$$.ptrType.isConst&&pe(`Cannot convert argument of type ${s.$$.smartPtrType?s.$$.smartPtrType.name:s.$$.ptrType.name} to parameter type ${this.name}`);var u=s.$$.ptrType.registeredClass;if(c=or(s.$$.ptr,u,this.registeredClass),this.isSmartPointer)switch(s.$$.smartPtr===void 0&&pe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:s.$$.smartPtrType===this?c=s.$$.smartPtr:pe(`Cannot convert argument of type ${s.$$.smartPtrType?s.$$.smartPtrType.name:s.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:c=s.$$.smartPtr;break;case 2:if(s.$$.smartPtrType===this)c=s.$$.smartPtr;else{var x=s.clone();c=this.rawShare(c,Gt.toHandle(()=>x.delete())),n!==null&&n.push(this.rawDestructor,c)}break;default:pe("Unsupporting sharing policy")}return c}function fn(n,s){if(s===null)return this.isReference&&pe(`null is not a valid ${this.name}`),0;s.$$||pe(`Cannot pass "${ut(s)}" as a ${this.name}`),s.$$.ptr||pe(`Cannot pass deleted object as a pointer of type ${this.name}`),s.$$.ptrType.isConst&&pe(`Cannot convert argument of type ${s.$$.ptrType.name} to parameter type ${this.name}`);var c=s.$$.ptrType.registeredClass,u=or(s.$$.ptr,c,this.registeredClass);return u}function Bt(n){return this.fromWireType(B[n>>2])}var gn=()=>{Object.assign(Ft.prototype,{getPointee(n){return this.rawGetPointee&&(n=this.rawGetPointee(n)),n},destructor(n){var s;(s=this.rawDestructor)==null||s.call(this,n)},argPackAdvance:Xe,readValueFromPointer:Bt,fromWireType:Lr})};function Ft(n,s,c,u,x,f,g,S,R,M,O){this.name=n,this.registeredClass=s,this.isReference=c,this.isConst=u,this.isSmartPointer=x,this.pointeeType=f,this.sharingPolicy=g,this.rawGetPointee=S,this.rawConstructor=R,this.rawShare=M,this.rawDestructor=O,!x&&s.baseClass===void 0?u?(this.toWireType=hn,this.destructorFunction=null):(this.toWireType=fn,this.destructorFunction=null):this.toWireType=_n}var Or=(n,s,c)=>{o.hasOwnProperty(n)||Pt("Replacing nonexistant public symbol"),o[n].overloadTable!==void 0&&c!==void 0?o[n].overloadTable[c]=s:(o[n]=s,o[n].argCount=c)},Cn=(n,s,c)=>{I("dynCall_"+n in o,`bad function pointer type - dynCall function not found for sig '${n}'`),c!=null&&c.length?I(c.length===n.substring(1).replace(/j/g,"--").length):I(n.length==1);var u=o["dynCall_"+n];return u(s,...c)},Nt=[],$t,nr=n=>{var s=Nt[n];return s||(n>=Nt.length&&(Nt.length=n+1),Nt[n]=s=$t.get(n)),I($t.get(n)==s,"JavaScript-side Wasm function table mirror is out of date!"),s},yn=(n,s,c=[])=>{if(n.includes("j"))return Cn(n,s,c);I(nr(s),`missing table entry in dynCall: ${s}`);var u=nr(s)(...c);return u},En=(n,s)=>(I(n.includes("j")||n.includes("p"),"getDynCaller should only be called with i64 sigs"),(...c)=>yn(n,s,c)),ot=(n,s)=>{n=De(n);function c(){return n.includes("j")?En(n,s):nr(s)}var u=c();return typeof u!="function"&&pe(`unknown function pointer with signature ${n}: ${s}`),u},Sn=(n,s)=>{var c=kt(s,function(u){this.name=s,this.message=u;var x=new Error(u).stack;x!==void 0&&(this.stack=this.toString()+`
`+x.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(n.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c},kr,Br=n=>{var s=Ms(n),c=De(s);return qe(s),c},Ut=(n,s)=>{var c=[],u={};function x(f){if(!u[f]&&!rt[f]){if(Lt[f]){Lt[f].forEach(x);return}c.push(f),u[f]=!0}}throw s.forEach(x),new kr(`${n}: `+c.map(Br).join([", "]))},Kn=(n,s,c,u,x,f,g,S,R,M,O,F,$)=>{O=De(O),f=ot(x,f),S&&(S=ot(g,S)),M&&(M=ot(R,M)),$=ot(F,$);var H=mn(O);Ir(H,function(){Ut(`Cannot construct ${O} due to unbound types`,[u])}),dt([n,s,c],u?[u]:[],oe=>{var we;oe=oe[0];var ge,Ke;u?(ge=oe.registeredClass,Ke=ge.instancePrototype):Ke=Ot.prototype;var Re=kt(O,function(...xr){if(Object.getPrototypeOf(this)!==N)throw new lt("Use 'new' to construct "+O);if(q.constructor_body===void 0)throw new lt(O+" has no accessible constructor");var to=q.constructor_body[xr.length];if(to===void 0)throw new lt(`Tried to invoke ctor of ${O} with invalid number of parameters (${xr.length}) - expected (${Object.keys(q.constructor_body).toString()}) parameters instead!`);return to.apply(this,xr)}),N=Object.create(Ke,{constructor:{value:Re}});Re.prototype=N;var q=new xn(O,Re,N,$,ge,f,S,M);q.baseClass&&((we=q.baseClass).__derivedClasses??(we.__derivedClasses=[]),q.baseClass.__derivedClasses.push(q));var me=new Ft(O,q,!0,!1,!1),xe=new Ft(O+"*",q,!1,!1,!1),je=new Ft(O+" const*",q,!1,!0,!1);return Dr[n]={pointerType:xe,constPointerType:je},Or(H,Re),[me,xe,je]})},sr=(n,s)=>{for(var c=[],u=0;u<n;u++)c.push(B[s+u*4>>2]);return c},bn=n=>{for(;n.length;){var s=n.pop(),c=n.pop();c(s)}};function Fr(n){for(var s=1;s<n.length;++s)if(n[s]!==null&&n[s].destructorFunction===void 0)return!0;return!1}function vn(n,s){if(!(n instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof n} which is not a function`);var c=kt(n.name||"unknownFunctionName",function(){});c.prototype=n.prototype;var u=new c,x=n.apply(u,s);return x instanceof Object?x:u}function Rn(n,s,c,u){for(var x=Fr(n),f=n.length,g="",S="",R=0;R<f-2;++R)g+=(R!==0?", ":"")+"arg"+R,S+=(R!==0?", ":"")+"arg"+R+"Wired";var M=`
        return function (${g}) {
        if (arguments.length !== ${f-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${f-2}');
        }`;x&&(M+=`var destructors = [];
`);var O=x?"destructors":"null",F=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];s&&(M+="var thisWired = classParam['toWireType']("+O+`, this);
`);for(var R=0;R<f-2;++R)M+="var arg"+R+"Wired = argType"+R+"['toWireType']("+O+", arg"+R+`);
`,F.push("argType"+R);if(s&&(S="thisWired"+(S.length>0?", ":"")+S),M+=(c||u?"var rv = ":"")+"invoker(fn"+(S.length>0?", ":"")+S+`);
`,x)M+=`runDestructors(destructors);
`;else for(var R=s?1:2;R<n.length;++R){var $=R===1?"thisWired":"arg"+(R-2)+"Wired";n[R].destructorFunction!==null&&(M+=`${$}_dtor(${$});
`,F.push(`${$}_dtor`))}return c&&(M+=`var ret = retType['fromWireType'](rv);
return ret;
`),M+=`}
`,M=`if (arguments.length !== ${F.length}){ throw new Error(humanName + "Expected ${F.length} closure arguments " + arguments.length + " given."); }
${M}`,[F,M]}function ir(n,s,c,u,x,f){var g=s.length;g<2&&pe("argTypes array size mismatch! Must at least get return value and 'this' types!"),I(!f,"Async bindings are only supported with JSPI.");for(var S=s[1]!==null&&c!==null,R=Fr(s),M=s[0].name!=="void",O=[n,pe,u,x,bn,s[0],s[1]],F=0;F<g-2;++F)O.push(s[F+2]);if(!R)for(var F=S?1:2;F<s.length;++F)s[F].destructorFunction!==null&&O.push(s[F].destructorFunction);let[$,H]=Rn(s,S,M,f);$.push(H);var oe=vn(Function,$)(...O);return kt(n,oe)}var wn=(n,s,c,u,x,f)=>{I(s>0);var g=sr(s,c);x=ot(u,x),dt([],[n],S=>{S=S[0];var R=`constructor ${S.name}`;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[s-1]!==void 0)throw new lt(`Cannot register multiple constructors with identical number of parameters (${s-1}) for class '${S.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return S.registeredClass.constructor_body[s-1]=()=>{Ut(`Cannot construct ${S.name} due to unbound types`,g)},dt([],g,M=>(M.splice(1,0,null),S.registeredClass.constructor_body[s-1]=ir(R,M,null,x,f),[])),[]})},Nr=n=>{n=n.trim();const s=n.indexOf("(");return s!==-1?(I(n[n.length-1]==")","Parentheses for argument names should match."),n.substr(0,s)):n},jn=(n,s,c,u,x,f,g,S,R)=>{var M=sr(c,u);s=De(s),s=Nr(s),f=ot(x,f),dt([],[n],O=>{O=O[0];var F=`${O.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),S&&O.registeredClass.pureVirtualFunctions.push(s);function $(){Ut(`Cannot call ${F} due to unbound types`,M)}var H=O.registeredClass.instancePrototype,oe=H[s];return oe===void 0||oe.overloadTable===void 0&&oe.className!==O.name&&oe.argCount===c-2?($.argCount=c-2,$.className=O.name,H[s]=$):(Pr(H,s,F),H[s].overloadTable[c-2]=$),dt([],M,ge=>{var Ke=ir(F,ge,O,f,g,R);return H[s].overloadTable===void 0?(Ke.argCount=c-2,H[s]=Ke):H[s].overloadTable[c-2]=Ke,[]}),[]})},ar=[],Le=[],$r=n=>{n>9&&--Le[n+1]===0&&(I(Le[n]!==void 0,"Decref for unallocated handle."),Le[n]=void 0,ar.push(n))},An=()=>Le.length/2-5-ar.length,Tn=()=>{Le.push(0,1,void 0,1,null,1,!0,1,!1,1),I(Le.length===5*2),o.count_emval_handles=An},Gt={toValue:n=>(n||pe("Cannot use deleted val. handle = "+n),I(n===2||Le[n]!==void 0&&n%2===0,`invalid handle: ${n}`),Le[n]),toHandle:n=>{switch(n){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const s=ar.pop()||Le.length;return Le[s]=n,Le[s+1]=1,s}}}},Mn={name:"emscripten::val",fromWireType:n=>{var s=Gt.toValue(n);return $r(n),s},toWireType:(n,s)=>Gt.toHandle(s),argPackAdvance:Xe,readValueFromPointer:Bt,destructorFunction:null},Ur=n=>We(n,Mn),ut=n=>{if(n===null)return"null";var s=typeof n;return s==="object"||s==="array"||s==="function"?n.toString():""+n},Dn=(n,s)=>{switch(s){case 4:return function(c){return this.fromWireType(te[c>>2])};case 8:return function(c){return this.fromWireType(ce[c>>3])};default:throw new TypeError(`invalid float width (${s}): ${n}`)}},Ln=(n,s,c)=>{s=De(s),We(n,{name:s,fromWireType:u=>u,toWireType:(u,x)=>{if(typeof x!="number"&&typeof x!="boolean")throw new TypeError(`Cannot convert ${ut(x)} to ${this.name}`);return x},argPackAdvance:Xe,readValueFromPointer:Dn(s,c),destructorFunction:null})},Pn=(n,s,c,u,x,f,g)=>{var S=sr(s,c);n=De(n),n=Nr(n),x=ot(u,x),Ir(n,function(){Ut(`Cannot call ${n} due to unbound types`,S)},s-1),dt([],S,R=>{var M=[R[0],null].concat(R.slice(1));return Or(n,ir(n,M,null,x,f,g),s-1),[]})},In=(n,s,c)=>{switch(s){case 1:return c?u=>z[u]:u=>Q[u];case 2:return c?u=>re[u>>1]:u=>V[u>>1];case 4:return c?u=>A[u>>2]:u=>B[u>>2];default:throw new TypeError(`invalid integer width (${s}): ${n}`)}},On=(n,s,c,u,x)=>{s=De(s),x===-1&&(x=4294967295);var f=O=>O;if(u===0){var g=32-8*c;f=O=>O<<g>>>g}var S=s.includes("unsigned"),R=(O,F)=>{if(typeof O!="number"&&typeof O!="boolean")throw new TypeError(`Cannot convert "${ut(O)}" to ${F}`);if(O<u||O>x)throw new TypeError(`Passing a number "${ut(O)}" from JS side to C/C++ side to an argument of type "${s}", which is outside the valid range [${u}, ${x}]!`)},M;S?M=function(O,F){return R(F,this.name),F>>>0}:M=function(O,F){return R(F,this.name),F},We(n,{name:s,fromWireType:f,toWireType:M,argPackAdvance:Xe,readValueFromPointer:In(s,c,u!==0),destructorFunction:null})},kn=(n,s,c)=>{var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],x=u[s];function f(g){var S=B[g>>2],R=B[g+4>>2];return new x(z.buffer,R,S)}c=De(c),We(n,{name:c,fromWireType:f,argPackAdvance:Xe,readValueFromPointer:f},{ignoreDuplicateRegistrations:!0})},Bn=(n,s)=>{Ur(n)},Fn=(n,s)=>{s=De(s);var c=s==="std::string";We(n,{name:s,fromWireType(u){var x=B[u>>2],f=u+4,g;if(c)for(var S=f,R=0;R<=x;++R){var M=f+R;if(R==x||Q[M]==0){var O=M-S,F=Fe(S,O);g===void 0?g=F:(g+="\0",g+=F),S=M+1}}else{for(var $=new Array(x),R=0;R<x;++R)$[R]=String.fromCharCode(Q[f+R]);g=$.join("")}return qe(u),g},toWireType(u,x){x instanceof ArrayBuffer&&(x=new Uint8Array(x));var f,g=typeof x=="string";g||x instanceof Uint8Array||x instanceof Uint8ClampedArray||x instanceof Int8Array||pe("Cannot pass non-string to std::string"),c&&g?f=At(x):f=x.length;var S=vt(4+f+1),R=S+4;if(B[S>>2]=f,Y(f),c&&g)gt(x,R,f+1);else if(g)for(var M=0;M<f;++M){var O=x.charCodeAt(M);O>255&&(qe(R),pe("String has UTF-16 code units that do not fit in 8 bits")),Q[R+M]=O}else for(var M=0;M<f;++M)Q[R+M]=x[M];return u!==null&&u.push(qe,S),S},argPackAdvance:Xe,readValueFromPointer:Bt,destructorFunction(u){qe(u)}})},Gr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Nn=(n,s)=>{I(n%2==0,"Pointer passed to UTF16ToString must be aligned to two bytes!");for(var c=n,u=c>>1,x=u+s/2;!(u>=x)&&V[u];)++u;if(c=u<<1,c-n>32&&Gr)return Gr.decode(Q.subarray(n,c));for(var f="",g=0;!(g>=s/2);++g){var S=re[n+g*2>>1];if(S==0)break;f+=String.fromCharCode(S)}return f},$n=(n,s,c)=>{if(I(s%2==0,"Pointer passed to stringToUTF16 must be aligned to two bytes!"),I(typeof c=="number","stringToUTF16(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),c??(c=2147483647),c<2)return 0;c-=2;for(var u=s,x=c<n.length*2?c/2:n.length,f=0;f<x;++f){var g=n.charCodeAt(f);re[s>>1]=g,Ie(g),s+=2}return re[s>>1]=0,Ie(0),s-u},Un=n=>n.length*2,Gn=(n,s)=>{I(n%4==0,"Pointer passed to UTF32ToString must be aligned to four bytes!");for(var c=0,u="";!(c>=s/4);){var x=A[n+c*4>>2];if(x==0)break;if(++c,x>=65536){var f=x-65536;u+=String.fromCharCode(55296|f>>10,56320|f&1023)}else u+=String.fromCharCode(x)}return u},Vn=(n,s,c)=>{if(I(s%4==0,"Pointer passed to stringToUTF32 must be aligned to four bytes!"),I(typeof c=="number","stringToUTF32(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),c??(c=2147483647),c<4)return 0;for(var u=s,x=u+c-4,f=0;f<n.length;++f){var g=n.charCodeAt(f);if(g>=55296&&g<=57343){var S=n.charCodeAt(++f);g=65536+((g&1023)<<10)|S&1023}if(A[s>>2]=g,Y(g),s+=4,s+4>x)break}return A[s>>2]=0,Y(0),s-u},Hn=n=>{for(var s=0,c=0;c<n.length;++c){var u=n.charCodeAt(c);u>=55296&&u<=57343&&++c,s+=4}return s},Wn=(n,s,c)=>{c=De(c);var u,x,f,g;s===2?(u=Nn,x=$n,g=Un,f=S=>V[S>>1]):s===4&&(u=Gn,x=Vn,g=Hn,f=S=>B[S>>2]),We(n,{name:c,fromWireType:S=>{for(var R=B[S>>2],M,O=S+4,F=0;F<=R;++F){var $=S+4+F*s;if(F==R||f($)==0){var H=$-O,oe=u(O,H);M===void 0?M=oe:(M+="\0",M+=oe),O=$+s}}return qe(S),M},toWireType:(S,R)=>{typeof R!="string"&&pe(`Cannot pass non-string to C++ string type ${c}`);var M=g(R),O=vt(4+M+s);return B[O>>2]=M/s,Y(M/s),x(R,O+4,M+s),S!==null&&S.push(qe,O),O},argPackAdvance:Xe,readValueFromPointer:Bt,destructorFunction(S){qe(S)}})},zn=(n,s)=>{s=De(s),We(n,{isVoid:!0,name:s,argPackAdvance:0,fromWireType:()=>{},toWireType:(c,u)=>{}})},Yn=1,Qn=()=>Yn,Xn=n=>{n>9&&(Le[n+1]+=1)},qn=(n,s)=>{var c=rt[n];return c===void 0&&pe(`${s} has unknown type ${Br(n)}`),c},Jn=(n,s)=>{n=qn(n,"_emval_take_value");var c=n.readValueFromPointer(s);return Gt.toHandle(c)},cr=(n,s)=>(I(n==n>>>0||n==(n|0)),I(s===(s|0)),s+2097152>>>0<4194305-!!n?(n>>>0)+s*4294967296:NaN);function Zn(n,s,c){var u=cr(n,s),x=new Date(u*1e3);A[c>>2]=x.getUTCSeconds(),Y(x.getUTCSeconds()),A[c+4>>2]=x.getUTCMinutes(),Y(x.getUTCMinutes()),A[c+8>>2]=x.getUTCHours(),Y(x.getUTCHours()),A[c+12>>2]=x.getUTCDate(),Y(x.getUTCDate()),A[c+16>>2]=x.getUTCMonth(),Y(x.getUTCMonth()),A[c+20>>2]=x.getUTCFullYear()-1900,Y(x.getUTCFullYear()-1900),A[c+24>>2]=x.getUTCDay(),Y(x.getUTCDay());var f=Date.UTC(x.getUTCFullYear(),0,1,0,0,0,0),g=(x.getTime()-f)/(1e3*60*60*24)|0;A[c+28>>2]=g,Y(g)}var Kt=n=>n%4===0&&(n%100!==0||n%400===0),es=[0,31,60,91,121,152,182,213,244,274,305,335],ts=[0,31,59,90,120,151,181,212,243,273,304,334],Vr=n=>{var s=Kt(n.getFullYear()),c=s?es:ts,u=c[n.getMonth()]+n.getDate()-1;return u};function rs(n,s,c){var u=cr(n,s),x=new Date(u*1e3);A[c>>2]=x.getSeconds(),Y(x.getSeconds()),A[c+4>>2]=x.getMinutes(),Y(x.getMinutes()),A[c+8>>2]=x.getHours(),Y(x.getHours()),A[c+12>>2]=x.getDate(),Y(x.getDate()),A[c+16>>2]=x.getMonth(),Y(x.getMonth()),A[c+20>>2]=x.getFullYear()-1900,Y(x.getFullYear()-1900),A[c+24>>2]=x.getDay(),Y(x.getDay());var f=Vr(x)|0;A[c+28>>2]=f,Y(f),A[c+36>>2]=-(x.getTimezoneOffset()*60),Y(-(x.getTimezoneOffset()*60));var g=new Date(x.getFullYear(),0,1),S=new Date(x.getFullYear(),6,1).getTimezoneOffset(),R=g.getTimezoneOffset(),M=(S!=R&&x.getTimezoneOffset()==Math.min(R,S))|0;A[c+32>>2]=M,Y(M)}var os=function(n){var s=(()=>{var c=new Date(A[n+20>>2]+1900,A[n+16>>2],A[n+12>>2],A[n+8>>2],A[n+4>>2],A[n>>2],0),u=A[n+32>>2],x=c.getTimezoneOffset(),f=new Date(c.getFullYear(),0,1),g=new Date(c.getFullYear(),6,1).getTimezoneOffset(),S=f.getTimezoneOffset(),R=Math.min(S,g);if(u<0)A[n+32>>2]=+(g!=S&&R==x),Y(+(g!=S&&R==x));else if(u>0!=(R==x)){var M=Math.max(S,g),O=u>0?R:M;c.setTime(c.getTime()+(O-x)*6e4)}A[n+24>>2]=c.getDay(),Y(c.getDay());var F=Vr(c)|0;A[n+28>>2]=F,Y(F),A[n>>2]=c.getSeconds(),Y(c.getSeconds()),A[n+4>>2]=c.getMinutes(),Y(c.getMinutes()),A[n+8>>2]=c.getHours(),Y(c.getHours()),A[n+12>>2]=c.getDate(),Y(c.getDate()),A[n+16>>2]=c.getMonth(),Y(c.getMonth()),A[n+20>>2]=c.getYear(),Y(c.getYear());var $=c.getTime();return isNaN($)?-1:$/1e3})();return Ds((ee=s,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)),s>>>0},Hr=n=>{var s=At(n)+1,c=vt(s);return c&&gt(n,c,s),c},ns=(n,s,c)=>{var u=new Date().getFullYear(),x=new Date(u,0,1),f=new Date(u,6,1),g=x.getTimezoneOffset(),S=f.getTimezoneOffset(),R=Math.max(g,S);B[n>>2]=R*60,Y(R*60),A[s>>2]=+(g!=S),Y(+(g!=S));function M(oe){var ge=oe.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ge?ge[1]:"GMT"}var O=M(x),F=M(f),$=Hr(O),H=Hr(F);S<g?(B[c>>2]=$,Y($),B[c+4>>2]=H,Y(H)):(B[c>>2]=H,Y(H),B[c+4>>2]=$,Y($))},ss=()=>{_e("native code called abort()")},is=()=>Date.now(),as=n=>U(Fe(n)),Wr=()=>2147483648,cs=()=>Wr(),Vt;Vt=()=>performance.now();var ls=(n,s,c)=>Q.copyWithin(n,s,s+c),ds=n=>{var s=X.buffer,c=(n-s.byteLength+65535)/65536;try{return X.grow(c),le(),1}catch(u){U(`growMemory: Attempted to grow heap from ${s.byteLength} bytes to ${n} bytes, but got error: ${u}`)}},us=n=>{var s=Q.length;n>>>=0,I(n>s);var c=Wr();if(n>c)return U(`Cannot enlarge memory, requested ${n} bytes, but the limit is ${c} bytes!`),!1;for(var u=(O,F)=>O+(F-O%F)%F,x=1;x<=4;x*=2){var f=s*(1+.2/x);f=Math.min(f,n+100663296);var g=Math.min(c,u(Math.max(n,f),65536)),S=Vt(),R=ds(g),M=Vt();if(_o(`Heap resize call from ${s} to ${g} took ${M-S} msecs. Success: ${!!R}`),R)return!0}return U(`Failed to grow the heap from ${s} bytes to ${g} bytes, not enough memory!`),!1},lr={},ps=()=>l||"./this.program",bt=()=>{if(!bt.strings){var n=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:n,_:ps()};for(var c in lr)lr[c]===void 0?delete s[c]:s[c]=lr[c];var u=[];for(var c in s)u.push(`${c}=${s[c]}`);bt.strings=u}return bt.strings},ms=(n,s)=>{for(var c=0;c<n.length;++c)I(n.charCodeAt(c)===(n.charCodeAt(c)&255)),z[s++]=n.charCodeAt(c),et(n.charCodeAt(c));z[s]=0,et(0)},xs=(n,s)=>{var c=0;return bt().forEach((u,x)=>{var f=s+c;B[n+x*4>>2]=f,Y(f),ms(u,f),c+=u.length+1}),0},hs=(n,s)=>{var c=bt();B[n>>2]=c.length,Y(c.length);var u=0;return c.forEach(x=>u+=x.length+1),B[s>>2]=u,Y(u),0};function _s(n){try{var s=ie.getStreamFromFD(n);return h.close(s),0}catch(c){if(typeof h>"u"||c.name!=="ErrnoError")throw c;return c.errno}}function fs(n,s){try{var c=0,u=0,x=0,f=ie.getStreamFromFD(n),g=f.tty?2:h.isDir(f.mode)?3:h.isLink(f.mode)?7:4;return z[s]=g,et(g),re[s+2>>1]=x,Ie(x),he=[c>>>0,(ee=c,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[s+8>>2]=he[0],A[s+12>>2]=he[1],Be(c),he=[u>>>0,(ee=u,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[s+16>>2]=he[0],A[s+20>>2]=he[1],Be(u),0}catch(S){if(typeof h>"u"||S.name!=="ErrnoError")throw S;return S.errno}}var gs=(n,s,c,u)=>{for(var x=0,f=0;f<c;f++){var g=B[s>>2],S=B[s+4>>2];s+=8;var R=h.read(n,z,g,S,u);if(R<0)return-1;if(x+=R,R<S)break}return x};function Cs(n,s,c,u){try{var x=ie.getStreamFromFD(n),f=gs(x,s,c);return B[u>>2]=f,Y(f),0}catch(g){if(typeof h>"u"||g.name!=="ErrnoError")throw g;return g.errno}}function ys(n,s,c,u,x){var f=cr(s,c);try{if(isNaN(f))return 61;var g=ie.getStreamFromFD(n);return h.llseek(g,f,u),he=[g.position>>>0,(ee=g.position,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],A[x>>2]=he[0],A[x+4>>2]=he[1],Be(g.position),g.getdents&&f===0&&u===0&&(g.getdents=null),0}catch(S){if(typeof h>"u"||S.name!=="ErrnoError")throw S;return S.errno}}var Es=(n,s,c,u)=>{for(var x=0,f=0;f<c;f++){var g=B[s>>2],S=B[s+4>>2];s+=8;var R=h.write(n,z,g,S,u);if(R<0)return-1;x+=R}return x};function Ss(n,s,c,u){try{var x=ie.getStreamFromFD(n),f=Es(x,s,c);return B[u>>2]=f,Y(f),0}catch(g){if(typeof h>"u"||g.name!=="ErrnoError")throw g;return g.errno}}var Ks=(n,s,c,u)=>{var x=0,f=0,g=0,S=0,R=0,M=0,O;function F($,H,oe,ge,Ke,Re){var N,q,me,xe;return q=$===10?28:16,Ke=$===10?vr(Ke):Xt(Ke),N=vt(q),xe=Zt(N,$,Ke,Re),I(!xe),me=vt(32),A[me+4>>2]=$,Y($),A[me+8>>2]=H,Y(H),A[me+12>>2]=oe,Y(oe),B[me+24>>2]=ge,B[me+20>>2]=N,$===10?(A[me+16>>2]=28,Y(28)):(A[me+16>>2]=16,Y(16)),A[me+28>>2]=0,Y(0),me}if(c&&(g=A[c>>2],S=A[c+4>>2],R=A[c+8>>2],M=A[c+12>>2]),R&&!M&&(M=R===2?17:6),!R&&M&&(R=M===17?2:1),M===0&&(M=6),R===0&&(R=1),!n&&!s)return-2;if(g&-1088||c!==0&&A[c>>2]&2&&!n)return-1;if(g&32)return-2;if(R!==0&&R!==1&&R!==2)return-7;if(S!==0&&S!==2&&S!==10)return-6;if(s&&(s=Fe(s),f=parseInt(s,10),isNaN(f)))return g&1024?-2:-8;if(!n)return S===0&&(S=2),(g&1)===0&&(S===2?x=pr(2130706433):x=[0,0,0,1]),O=F(S,R,M,null,x,f),B[u>>2]=O,0;if(n=Fe(n),x=Mt(n),x!==null)if(S===0||S===2)S=2;else if(S===10&&g&8)x=[0,0,pr(65535),x],S=10;else return-2;else if(x=qt(n),x!==null)if(S===0||S===10)S=10;else return-2;return x!=null?(O=F(S,R,M,n,x,f),B[u>>2]=O,0):g&4?-2:(n=Me.lookup_name(n),x=Mt(n),S===0?S=2:S===10&&(x=[0,0,pr(65535),x]),O=F(S,R,M,null,x,f),B[u>>2]=O,0)},bs=(n,s,c,u,x,f,g)=>{var S=Rr(n,s);if(S.errno)return-6;var R=S.port,M=S.addr,O=!1;if(c&&u){var F;if(g&1||!(F=Me.lookup_addr(M))){if(g&8)return-2}else M=F;var $=gt(M,c,u);$+1>=u&&(O=!0)}if(x&&f){R=""+R;var $=gt(R,x,f);$+1>=f&&(O=!0)}return O?-12:0},vs=(n,s)=>{for(var c=0,u=0;u<=s;c+=n[u++]);return c},zr=[31,29,31,30,31,30,31,31,30,31,30,31],Yr=[31,28,31,30,31,30,31,31,30,31,30,31],Rs=(n,s)=>{for(var c=new Date(n.getTime());s>0;){var u=Kt(c.getFullYear()),x=c.getMonth(),f=(u?zr:Yr)[x];if(s>f-c.getDate())s-=f-c.getDate()+1,c.setDate(1),x<11?c.setMonth(x+1):(c.setMonth(0),c.setFullYear(c.getFullYear()+1));else return c.setDate(c.getDate()+s),c}return c},ws=(n,s)=>{I(n.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),z.set(n,s)},Qr=(n,s,c,u)=>{var x=B[u+40>>2],f={tm_sec:A[u>>2],tm_min:A[u+4>>2],tm_hour:A[u+8>>2],tm_mday:A[u+12>>2],tm_mon:A[u+16>>2],tm_year:A[u+20>>2],tm_wday:A[u+24>>2],tm_yday:A[u+28>>2],tm_isdst:A[u+32>>2],tm_gmtoff:A[u+36>>2],tm_zone:x?Fe(x):""},g=Fe(c),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var R in S)g=g.replace(new RegExp(R,"g"),S[R]);var M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],O=["January","February","March","April","May","June","July","August","September","October","November","December"];function F(N,q,me){for(var xe=typeof N=="number"?N.toString():N||"";xe.length<q;)xe=me[0]+xe;return xe}function $(N,q){return F(N,q,"0")}function H(N,q){function me(je){return je<0?-1:je>0?1:0}var xe;return(xe=me(N.getFullYear()-q.getFullYear()))===0&&(xe=me(N.getMonth()-q.getMonth()))===0&&(xe=me(N.getDate()-q.getDate())),xe}function oe(N){switch(N.getDay()){case 0:return new Date(N.getFullYear()-1,11,29);case 1:return N;case 2:return new Date(N.getFullYear(),0,3);case 3:return new Date(N.getFullYear(),0,2);case 4:return new Date(N.getFullYear(),0,1);case 5:return new Date(N.getFullYear()-1,11,31);case 6:return new Date(N.getFullYear()-1,11,30)}}function ge(N){var q=Rs(new Date(N.tm_year+1900,0,1),N.tm_yday),me=new Date(q.getFullYear(),0,4),xe=new Date(q.getFullYear()+1,0,4),je=oe(me),we=oe(xe);return H(je,q)<=0?H(we,q)<=0?q.getFullYear()+1:q.getFullYear():q.getFullYear()-1}var Ke={"%a":N=>M[N.tm_wday].substring(0,3),"%A":N=>M[N.tm_wday],"%b":N=>O[N.tm_mon].substring(0,3),"%B":N=>O[N.tm_mon],"%C":N=>{var q=N.tm_year+1900;return $(q/100|0,2)},"%d":N=>$(N.tm_mday,2),"%e":N=>F(N.tm_mday,2," "),"%g":N=>ge(N).toString().substring(2),"%G":ge,"%H":N=>$(N.tm_hour,2),"%I":N=>{var q=N.tm_hour;return q==0?q=12:q>12&&(q-=12),$(q,2)},"%j":N=>$(N.tm_mday+vs(Kt(N.tm_year+1900)?zr:Yr,N.tm_mon-1),3),"%m":N=>$(N.tm_mon+1,2),"%M":N=>$(N.tm_min,2),"%n":()=>`
`,"%p":N=>N.tm_hour>=0&&N.tm_hour<12?"AM":"PM","%S":N=>$(N.tm_sec,2),"%t":()=>"	","%u":N=>N.tm_wday||7,"%U":N=>{var q=N.tm_yday+7-N.tm_wday;return $(Math.floor(q/7),2)},"%V":N=>{var q=Math.floor((N.tm_yday+7-(N.tm_wday+6)%7)/7);if((N.tm_wday+371-N.tm_yday-2)%7<=2&&q++,q){if(q==53){var xe=(N.tm_wday+371-N.tm_yday)%7;xe!=4&&(xe!=3||!Kt(N.tm_year))&&(q=1)}}else{q=52;var me=(N.tm_wday+7-N.tm_yday-1)%7;(me==4||me==5&&Kt(N.tm_year%400-1))&&q++}return $(q,2)},"%w":N=>N.tm_wday,"%W":N=>{var q=N.tm_yday+7-(N.tm_wday+6)%7;return $(Math.floor(q/7),2)},"%y":N=>(N.tm_year+1900).toString().substring(2),"%Y":N=>N.tm_year+1900,"%z":N=>{var q=N.tm_gmtoff,me=q>=0;return q=Math.abs(q)/60,q=q/60*100+q%60,(me?"+":"-")+("0000"+q).slice(-4)},"%Z":N=>N.tm_zone,"%%":()=>"%"};g=g.replace(/%%/g,"\0\0");for(var R in Ke)g.includes(R)&&(g=g.replace(new RegExp(R,"g"),Ke[R](f)));g=g.replace(/\0\0/g,"%");var Re=Tt(g,!1);return Re.length>s?0:(ws(Re,n),Re.length-1)},js=(n,s,c,u,x)=>Qr(n,s,c,u),Xr=function(n,s,c,u){n||(n=this),this.parent=n,this.mount=n.mount,this.mounted=null,this.id=h.nextInode++,this.name=s,this.mode=c,this.node_ops={},this.stream_ops={},this.rdev=u},dr=365,ur=146;Object.defineProperties(Xr.prototype,{read:{get:function(){return(this.mode&dr)===dr},set:function(n){n?this.mode|=dr:this.mode&=-366}},write:{get:function(){return(this.mode&ur)===ur},set:function(n){n?this.mode|=ur:this.mode&=-147}},isFolder:{get:function(){return h.isDir(this.mode)}},isDevice:{get:function(){return h.isChrdev(this.mode)}}}),h.FSNode=Xr,h.createPreloadedFile=jo,h.staticInit(),o.FS_createPath=h.createPath,o.FS_createDataFile=h.createDataFile,o.FS_createPreloadedFile=h.createPreloadedFile,o.FS_unlink=h.unlink,o.FS_createLazyFile=h.createLazyFile,o.FS_createDevice=h.createDevice,Jo(),lt=o.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},jr=o.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},dn(),an(),gn(),kr=o.UnboundTypeError=Sn(Error,"UnboundTypeError"),Tn();function As(){so("fetchSettings")}var qr={__assert_fail:go,__cxa_throw:yo,__handle_stack_overflow:Eo,__syscall_bind:Mo,__syscall_connect:Do,__syscall_faccessat:Lo,__syscall_fcntl64:Po,__syscall_fstat64:Io,__syscall_getdents64:Oo,__syscall_getsockname:ko,__syscall_getsockopt:Bo,__syscall_ioctl:Fo,__syscall_lstat64:No,__syscall_newfstatat:$o,__syscall_openat:Uo,__syscall_poll:Go,__syscall_recvfrom:Vo,__syscall_renameat:Ho,__syscall_rmdir:Wo,__syscall_sendto:zo,__syscall_socket:Yo,__syscall_stat64:Qo,__syscall_unlinkat:Xo,_embind_register_bigint:qo,_embind_register_bool:en,_embind_register_class:Kn,_embind_register_class_constructor:wn,_embind_register_class_function:jn,_embind_register_emval:Ur,_embind_register_float:Ln,_embind_register_function:Pn,_embind_register_integer:On,_embind_register_memory_view:kn,_embind_register_optional:Bn,_embind_register_std_string:Fn,_embind_register_std_wstring:Wn,_embind_register_void:zn,_emscripten_get_now_is_monotonic:Qn,_emval_decref:$r,_emval_incref:Xn,_emval_take_value:Jn,_gmtime_js:Zn,_localtime_js:rs,_mktime_js:os,_tzset_js:ns,abort:ss,emscripten_date_now:is,emscripten_err:as,emscripten_get_heap_max:cs,emscripten_get_now:Vt,emscripten_memcpy_js:ls,emscripten_resize_heap:us,environ_get:xs,environ_sizes_get:hs,fd_close:_s,fd_fdstat_get:fs,fd_read:Cs,fd_seek:ys,fd_write:Ss,getaddrinfo:Ks,getnameinfo:bs,strftime:Qr,strftime_l:js},ze=no(),vt=Ee("malloc"),qe=Ee("free"),Ts=Ee("fflush"),Ms=Ee("__getTypeName"),pr=Ee("htonl"),Rt=Ee("htons"),Jr=Ee("ntohs"),Ds=Ee("setTempRet0"),Zr=()=>(Zr=ze.emscripten_stack_init)(),mr=()=>(mr=ze.emscripten_stack_get_base)(),wt=()=>(wt=ze.emscripten_stack_get_end)(),Ls=Ee("__cxa_is_pointer_type"),Ps=o.___set_stack_limits=Ee("__set_stack_limits");o.dynCall_jiji=Ee("dynCall_jiji"),o.dynCall_iiiji=Ee("dynCall_iiiji"),o.dynCall_iiijjji=Ee("dynCall_iiijjji"),o.dynCall_jiiij=Ee("dynCall_jiiij"),o.dynCall_iiiiij=Ee("dynCall_iiiiij"),o.dynCall_iiiiiij=Ee("dynCall_iiiiiij"),o.dynCall_jiiji=Ee("dynCall_jiiji"),o.dynCall_ijii=Ee("dynCall_ijii"),o.dynCall_viiiiij=Ee("dynCall_viiiiij"),o.dynCall_iiij=Ee("dynCall_iiij"),o.dynCall_iiijiiii=Ee("dynCall_iiijiiii"),o.dynCall_ji=Ee("dynCall_ji"),o.dynCall_viijii=Ee("dynCall_viijii"),o.dynCall_iiiiijj=Ee("dynCall_iiiiijj"),o.dynCall_iiiiiijj=Ee("dynCall_iiiiiijj"),o._ff_h264_cabac_tables=805276,o.addRunDependency=Pe,o.removeRunDependency=Te,o.FS_createPath=h.createPath,o.FS_createLazyFile=h.createLazyFile,o.FS_createDevice=h.createDevice,o.FS_createPreloadedFile=h.createPreloadedFile,o.FS=h,o.FS_createDataFile=h.createDataFile,o.FS_unlink=h.unlink;var Is=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","exitJS","getCallstack","emscriptenLog","convertPCtoSourceLocation","readEmAsmArgs","listenOnce","autoResumeAudioContext","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","stringToUTF8OnStack","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","stackTrace","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","createDyncallWrapper","safeSetTimeout","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","setMainLoop","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","SDL_unicode","SDL_ttfContext","SDL_audio","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","getFunctionArgsName","createJsInvokerSignature","registerInheritedInstance","unregisterInheritedInstance","enumReadValueFromPointer","validateThis","getStringOrSymbol","emval_get_global","emval_returnValue","emval_lookupTypes","emval_addMethodCaller"];Is.forEach(io);var Os=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","FS_createFolder","FS_createLink","FS_readFile","out","err","callMain","abort","wasmMemory","wasmExports","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","setStackLimits","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","isLeapYear","ydayFromDate","arraySum","addDays","ERRNO_CODES","ERRNO_MESSAGES","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","Protocols","Sockets","initRandomFill","randomFill","timers","warnOnce","UNWIND_CACHE","readEmAsmArgsArray","jstoi_q","jstoi_s","getExecutableName","dynCallLegacy","getDynCaller","dynCall","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","writeArrayToMemory","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","ExitStatus","getEnvStrings","doReadv","doWritev","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","SYSCALLS","getSocketFromFD","getSocketAddress","preloadPlugins","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","InternalError","BindingError","throwInternalError","throwBindingError","registeredTypes","awaitingDependencies","typeDependencies","tupleRegistrations","structRegistrations","sharedRegisterType","whenDependentTypesAreResolved","embind_charCodes","embind_init_charCodes","readLatin1String","getTypeName","getFunctionName","heap32VectorToArray","requireRegisteredType","usesDestructorStack","createJsInvoker","UnboundTypeError","PureVirtualError","GenericWireTypeSize","EmValType","init_embind","throwUnboundTypeError","ensureOverloadTable","exposePublicSymbol","replacePublicSymbol","extendError","createNamedFunction","embindRepr","registeredInstances","getBasestPointer","getInheritedInstance","getInheritedInstanceCount","getLiveInheritedInstances","registeredPointers","registerType","integerReadValueFromPointer","floatReadValueFromPointer","readPointer","runDestructors","newFunc","craftInvokerFunction","embind__requireFunction","genericPointerToWireType","constNoSmartPtrRawPointerToWireType","nonConstNoSmartPtrRawPointerToWireType","init_RegisteredPointer","RegisteredPointer","RegisteredPointer_fromWireType","runDestructor","releaseClassHandle","finalizationRegistry","detachFinalizer_deps","detachFinalizer","attachFinalizer","makeClassHandle","init_ClassHandle","ClassHandle","throwInstanceAlreadyDeleted","deletionQueue","flushPendingDeletes","delayFunction","setDelayFunction","RegisteredClass","shallowCopyInternalPointer","downcastPointer","upcastPointer","char_0","char_9","makeLegalFunctionName","emval_freelist","emval_handles","emval_symbols","init_emval","count_emval_handles","Emval","emval_methodCallers","reflectConstruct","IDBFS"];Os.forEach(Cr);var Ht;ue=function n(){Ht||eo(),Ht||(ue=n)};function ks(){Zr(),Ce()}function eo(){if(ne>0||(ks(),pt(),ne>0))return;function n(){Ht||(Ht=!0,o.calledRun=!0,!Z&&(xt(),i(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),I(!o._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Ze()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),n()},1)):n(),ye()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return eo(),r.ready}})();let module;const useKbres=()=>{const[e,r]=reactExports.useState(null);return reactExports.useEffect(()=>{if(module!==void 0){r(module);return}createModule().then(o=>{module=o,r(o)}).catch(o=>{console.log(o)})},[]),e},title$2="Matrix Lighting",MatrixLightingPane=styled(CenterPane)`
  height: 100%;
  overflow: auto;
  grid-column: span 2;
`,Container$d=styled.div`
  display: flex;
  align-items: center;
  padding: 16px;
  flex-direction: column;
`,MatrixEditor=styled.div`
  display: flex;
  // align-items: flex-end;
  justify-content: center;
  width: 100%;
  max-width: 960px;
`,MatrixConfigure=styled.div`
  margin-left: 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
`,MatrixControlRows=styled.div`
  width: 400px;
`,MatrixIndex=styled.div`
  font-size: 14px;
  color: var(--color_label);
`,MatrixWrapper=styled.div`
  border: 1px solid var(--border_color_cell);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 5px;
  padding: 1px;
  background: var(--bg_menu);
  height: fit-content;
`,Light=styled.div.attrs(({$color:e})=>({style:{background:`rgb(${e.r},${e.g},${e.b})`,boxShadow:`rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset, rgb(${e.r},${e.g},${e.b}) 0px 0px 3px`}}))`
  width: 20px;
  height: 20px;
  display: inline-block;
  border-radius: 50%;
  cursor: pointer;
  margin: 1px;
`,ColorPicker=styled(SketchPicker)`
  line-height: 1;
  input {
    color: var(--color_accent);
    background: none;
    border: none !important;
    border-bottom: 1px solid var(--color_accent) !important;
    box-shadow: none !important;
    text-align: center;
  }
  label {
    color: var(--color_accent) !important;
  }
  .flexbox-fix {
    border: none !important;
  }
  position: absolute;
  transform: translate3d(14px, -22px, 0);
  z-index: 1;
  &::after {
    content: '';
    position: absolute;
    width: 0px;
    height: 0px;
    border: 11px solid var(--border_color_cell);
    border-top-color: transparent;
    border-bottom-color: transparent;
    border-left-color: transparent;
    top: 12px;
    left: -22px;
    pointer-events: none;
  }
`,ColorPreview=styled.div`
  width: 20px;
  height: 20px;
  border-radius: 20px;
  background: ${e=>`rgb(${e.$color.r},${e.$color.g},${e.$color.b})`};
  border: 1px solid var(--color_accent);
  cursor: pointer;
  margin-left: 5px;
`,MatrixList=styled.div`
  margin-top: 20px;
  display: flex;
  width: 100%;
  border-top: 1px solid var(--border_color_cell);
  padding-top: 10px;
  flex-wrap: wrap;
  & > div {
    margin: 0 6px 6px 0;
  }
`,MatrixButtons=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,FpsSelect=styled(AccentSelect)`
  > div[class*='-control'] {
    width: 100%;
  }
`,FlexLabel$1=styled.div`
  color: var(--color_label);
  font-weight: 400;
  display: inline-flex;
  align-items: center;
`,HiddenInput$2=styled.input`
  display: none;
`,MainMatrixContainer=styled.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,getMatrixData=(e,r,o,i,a)=>{const d=o*i*a,l=Array(i).fill(0).map(()=>Array(o).fill({r:0,g:0,b:0}));for(let p=r;p<r+d;p+=a){const m=p%d/a,_=~~(m/o),C=m%o,[y,b,K]=[e[p],e[p+1],e[p+2]];l[_][C]={r:y,g:b,b:K}}return l},Lighting=reactExports.memo(({color:e,row:r,col:o,changing:i})=>{const a=useAppDispatch(),d=_=>{_.button===0&&(i.current=!0,a(updateMatrix({row:r,col:o})),window.addEventListener("pointerup",p))},l=()=>{i.current&&a(updateMatrix({row:r,col:o}))},p=()=>{i.current=!1,window.removeEventListener("pointerup",p)},m=_=>{_.preventDefault(),a(updateColor(e))};return jsxRuntimeExports.jsx(Light,{onContextMenu:m,onPointerDown:d,onPointerOver:l,$color:e})},shallowEqual),MatrixFrame=reactExports.memo(({matrix:e,index:r,active:o})=>{const i=useAppDispatch(),a=reactExports.useRef(null),d=e.length,l=e[0].length,p=l*5,m=d*5,_=K=>{K.preventDefault()},C=K=>{i(updateMatrixIndex(r))},y=K=>{r!==void 0&&i(sortMatrixByIndex({newIndex:r}))},b=reactExports.useCallback(()=>{if(!a.current)return;const K=a.current;K.width=10*l,K.height=10*d;const v=K.getContext("2d");for(let j=0;j<d;j++)for(let w=0;w<l;w++){const L=e[j][w];v.beginPath(),v.arc(w*10+5,j*10+5,4,0,Math.PI*2),v.fillStyle=`rgb(${L.r}, ${L.g}, ${L.b})`,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowBlur=5,v.shadowColor=`rgb(${L.r}, ${L.g}, ${L.b})`,v.fill()}},[e]);return reactExports.useEffect(b,[e]),jsxRuntimeExports.jsx("div",{style:{width:p,height:m,background:"#000",border:o?"1px solid var(--color_accent)":"1px solid var(--border_color_cell)",borderRadius:5,cursor:"pointer"},draggable:!0,onDragStart:C,onDragOver:_,onDragEnter:y,onClick:()=>i(updateMatrixIndex(r)),children:jsxRuntimeExports.jsx("canvas",{style:{width:"100%",height:"100%"},ref:a})})},shallowEqual),MatrixPane=reactExports.memo(({matrix:e})=>{const r=reactExports.useRef(!1);return jsxRuntimeExports.jsx(MatrixWrapper,{children:e.map((o,i)=>jsxRuntimeExports.jsx("div",{style:{display:"flex"},children:o.map((a,d)=>jsxRuntimeExports.jsx(Lighting,{color:a,row:i,col:d,changing:r},d))},i))})},shallowEqual),Pane$4=()=>{var nt,st;const{t:e,i18n:r}=useTranslation(),o=useAppDispatch(),i=useKbres(),a=useAppSelector(getActiveColor),d=useAppSelector(getMatrixList),l=useAppSelector(getMatrixIdx),p=useAppSelector(getActiveMatrix),m=useAppSelector(getFps),_=useAppSelector(getSaving),C=useAppSelector(getFileContent),y=useAppSelector(getRows),b=useAppSelector(getCols),[K,v]=reactExports.useState(!1),[j,w]=reactExports.useState(null),[L,T]=reactExports.useState(null),[P,k]=reactExports.useState(!1),[G,U]=reactExports.useState(!1),W=useAppSelector(getImportEnable),X=useAppSelector(getMaxFrame),Z=(st=(nt=useAppSelector(getSelectedTabkbConfig))==null?void 0:nt.matrixLighting)==null?void 0:st.shareApi,I=reactExports.useMemo(()=>[5,10,15,20].map(ne=>({label:ne+" "+e("FPS"),value:ne})),[r.language]),z=I.find(ne=>ne.value===m),Q=reactExports.useRef(null),re=reactExports.useRef(null),V=reactExports.useRef(null),A=reactExports.useRef(null),B=reactExports.useRef(null),te=reactExports.useRef(),ce={default:{picker:{background:"var(--border_color_cell)"}}},le=["#000","#fff","#f00","#0f0","#00f","#ff0","#f0f","#0ff"],Ce=ne=>{!P||!Q.current||!re.current||ne.target!==re.current&&!Q.current.contains(ne.target)&&k(!1)},ye=ne=>{if(!ne.target.files)return;const de=new Image,ue=URL.createObjectURL(ne.target.files[0]);de.onload=()=>{const ve=pixleImg(de,b,y);o(setMatrix(getMatrixData(ve,0,b,y,4))),URL.revokeObjectURL(ue),V.current&&(V.current.value="")},de.src=ue},Oe=async ne=>{if(!ne.target.files||!i||K)return;v(!0);const de="pixel.out",ue=ne.target.files[0],ve=await ue.arrayBuffer(),ke=new Uint8Array(ve);i.FS.writeFile(ue.name,ke);const Pe=new i.IntVec;Pe.push_back(b),Pe.push_back(y),i.pixelit(ue.name,de,Pe,X);const Te=i.FS.readFile(de),_e=[],_t=y*b*3;for(let Qe=0;Qe<Te.length;Qe+=_t)_e.push(getMatrixData(Te,Qe,b,y,3));o(setMatrixList(_e)),A.current&&(A.current.value=""),v(!1)},Ne=async ne=>{if(w(null),!ne.target.files)return;const de=ne.target.files[0];if(!de)return;const ue=new FileReader;ue.onabort=()=>w(e("File reading was cancelled.")),ue.onerror=()=>w(e("Failed to read file.")),ue.onload=()=>{if(ue.result){const ve=Array.from(new Uint8Array(ue.result)),ke=ve.slice(0,mlHeaderSize),Pe=ve.slice(mlHeaderSize);if(!lodashExports.isEqual(mlHeader,ke.slice(0,mlHeader.length))){w(e("Could not load file: invalid data."));return}const[Te,_e,_t,Qe]=ke.slice(mlHeader.length);if(Te===0||y!==_t||b!==Qe||b*y*3*Te!==Pe.length){w(e("Could not load file: invalid data."));return}o(loadFile({frames:Te,fps:_e,data:Pe}))}},ue.readAsArrayBuffer(de),B.current&&(B.current.value="")},Ye=async()=>{try{await o(saveToKeyboard())}catch{w(e("Failed to save."))}},Je=()=>{var ne;(ne=B.current)==null||ne.click()},pt=async()=>{const ne=`via_lighting_${b}_${y}.tabml`;try{const de=await window.showSaveFilePicker({suggestedName:ne}),ue=new Blob([Uint8Array.from(C)],{type:"octet/stream"}),ve=await de.createWritable();await ve.write(ue),await ve.close()}catch(de){console.log(de)}},[xt,Ze]=reactExports.useState(!1),ht=()=>{if(xt||!Z)return;const ne=new AbortController,de=ne.signal;let ue=new FormData;ue.append("file",new Blob([Uint8Array.from(C)])),w(null),Ze(!0),fetch(Z,{method:"POST",body:ue,signal:de}).then(ve=>{if(ve.status!==200){console.log(ve.status),w(e("Sharing failed"));return}ve.json().then(ke=>{ke.error?(console.log(ke.error),w(e("Sharing failed"))):T(e("Sharing success")),setTimeout(()=>{T(null)},3e3)})}).catch(ve=>{console.log(ve),w(e("Sharing failed"))}).finally(()=>{Ze(!1)}),setTimeout(()=>{ne.abort(),Ze(!1)},60*1e3)};return reactExports.useEffect(()=>(document.addEventListener("click",Ce),()=>{document.removeEventListener("click",Ce)}),[P]),reactExports.useEffect(()=>(clearInterval(te.current),G&&(te.current=setInterval(()=>{o(nextMatrix())},1e3/m)),()=>{clearInterval(te.current)}),[G,m]),jsxRuntimeExports.jsx(MatrixLightingPane,{onDragOver:ne=>{ne.preventDefault()},children:jsxRuntimeExports.jsxs(Container$d,{children:[jsxRuntimeExports.jsxs(MatrixEditor,{children:[jsxRuntimeExports.jsxs(MainMatrixContainer,{children:[jsxRuntimeExports.jsx(MatrixPane,{matrix:p}),jsxRuntimeExports.jsxs(MatrixIndex,{children:[l+1,"/",d.length]})]}),jsxRuntimeExports.jsx(MatrixConfigure,{children:jsxRuntimeExports.jsxs(MatrixControlRows,{children:[jsxRuntimeExports.jsxs(ControlRow,{style:{pointerEvents:G?"none":"auto"},children:[jsxRuntimeExports.jsxs(FlexLabel$1,{children:[jsxRuntimeExports.jsx(ColorPreview,{ref:re,onMouseOver:()=>k(!0),$color:a}),P&&jsxRuntimeExports.jsx("div",{ref:Q,children:jsxRuntimeExports.jsx(ColorPicker,{styles:ce,presetColors:le,disableAlpha:!0,color:a,onChange:ne=>{o(updateColor(ne.rgb))}})}),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(MatrixButtons,{children:jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>o(resetMatrix()),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faTrash}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Delete All")})]})})})]}),jsxRuntimeExports.jsxs(ControlRow,{style:{pointerEvents:G?"none":"auto"},children:[jsxRuntimeExports.jsx(FlexLabel$1,{children:jsxRuntimeExports.jsxs(MatrixButtons,{children:[jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:d.length>=X,onClick:()=>o(copyMatrix()),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faCopy}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Copy")})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:d.length>=X,onClick:()=>o(addMatrix()),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faAdd}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Add")})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>o(deleteMatrix()),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faMinus}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Delete")})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>o(fillMatrix()),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faRotateLeft}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Reset")})]}),W&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>{var ne;return(ne=V.current)==null?void 0:ne.click()},children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faImage}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Import Image")})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>{var ne;return(ne=A.current)==null?void 0:ne.click()},children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faVideo}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Import Video")})]})]})]})}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(HiddenInput$2,{accept:"image/*",onChange:ye,type:"file",ref:V}),jsxRuntimeExports.jsx(HiddenInput$2,{accept:"video/mp4,image/gif",onChange:Oe,type:"file",ref:A})]})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(FlexLabel$1,{children:jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(FpsSelect,{value:z,onChange:ne=>o(setFps(ne.value)),options:I})})}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(MatrixButtons,{children:jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>U(!G),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:G?faStop:faPlay}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e(G?"Stop":"Play")})]})})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(FlexLabel$1,{children:jsxRuntimeExports.jsxs(MatrixButtons,{children:[jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:Je,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faFileImport}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Import File")})]}),jsxRuntimeExports.jsx(HiddenInput$2,{accept:".tabml",onChange:Ne,type:"file",ref:B}),jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:pt,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faDownload}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Download File")})]}),Z&&jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:ht,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faShare}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e("Share")})]})]})}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{disabled:_,onClick:Ye,children:e("Save")})})]}),j?jsxRuntimeExports.jsx(ErrorMessage,{onClick:()=>w(null),children:j}):null,L?jsxRuntimeExports.jsx(SuccessMessage,{onClick:()=>T(null),children:L}):null]})})]}),jsxRuntimeExports.jsx(MatrixList,{children:d.map((ne,de)=>jsxRuntimeExports.jsx(MatrixFrame,{matrix:ne,index:de,active:de===l},de))})]})})},Icon$3=()=>jsxRuntimeExports.jsx("svg",{viewBox:"-1 -1 18 18",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M3.5 2.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm11.5 0a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm-1.25 7a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zm1.25 4.5a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM2.25 9.25a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zm7-1.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM8 15a1.25 1.25 0 100-2.5A1.25 1.25 0 008 15zM9.25 2.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM2.25 15a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5z"})}),Title$3=title$2,MatrixLighting=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$3,Pane:Pane$4,Title:Title$3},Symbol.toStringTag,{value:"Module"})),SvgIconBorder=({size:e})=>jsxRuntimeExports.jsx("svg",{style:{float:"right",marginRight:"-"+e/4+"px"},width:e,viewBox:"-6 -6 36.00 36.00",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("g",{children:jsxRuntimeExports.jsx("path",{d:"M10 3C12.2415 5.33579 13.6191 8.50702 13.6191 12C13.6191 15.493 12.2415 18.6642 10 21",stroke:"var(--color_inside-accent)",strokeWidth:"2",strokeLinecap:"round"})})}),SvgIconLineArrowDown=e=>jsxRuntimeExports.jsx("svg",{fill:"currentColor",viewBox:"-2.4 -2.4 28.80 28.80",...e,children:jsxRuntimeExports.jsx("g",{children:jsxRuntimeExports.jsx("path",{d:"M15.29,16.29,13,18.59V7a1,1,0,0,0-2,0V18.59l-2.29-2.3a1,1,0,1,0-1.42,1.42l4,4a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l4-4a1,1,0,0,0-1.42-1.42ZM19,2H5A1,1,0,0,0,5,4H19a1,1,0,0,0,0-2Z"})})}),SvgIconArrowUpLine=e=>jsxRuntimeExports.jsx(SvgIconLineArrowDown,{transform:"matrix(-1, 0, 0, -1, 0, 0)",...e}),SvgIconArrowDownLine=e=>jsxRuntimeExports.jsx("svg",{fill:"currentColor",viewBox:"-2.4 -2.4 28.80 28.80",...e,children:jsxRuntimeExports.jsx("g",{children:jsxRuntimeExports.jsx("path",{d:"M19,20H5a1,1,0,0,0,0,2H19a1,1,0,0,0,0-2Zm-7.71-2.29a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l4-4a1,1,0,0,0-1.42-1.42L13,14.59V3a1,1,0,0,0-2,0V14.59l-2.29-2.3a1,1,0,1,0-1.42,1.42Z"})})}),SvgIconLineArrowUp=e=>jsxRuntimeExports.jsx(SvgIconArrowDownLine,{transform:"matrix(-1, 0, 0, -1, 0, 0)",...e}),ActuationContainer=styled.div`
  display: flex;
  margin-left: 50px;
  margin-bottom: 10px;
  font-size: 12px;
`,IconWrapper$1=styled.div`
  width: 30px;
  height: 30px;
  border: 2px solid var(--color_accent);
  border-radius: 5px;
  color: var(--color_accent);
`,Point=styled.div`
  width: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
`,Position=styled.div`
  padding: 5px 0;
  text-decoration: ${e=>e.$enable?"underline":"none"};
  cursor: ${e=>e.$enable?"pointer":"default"};
  color: var(--color_label-highlighted);
  pointer-events: ${e=>e.$enable?"auto":"none"};
`,DialogContainer=styled.dialog`
  padding: 0;
  border-width: 0;

  background: transparent;
  &::backdrop {
    background: rgba(0, 0, 0, 0.75);
  }

  & > div {
    transition: transform 0.2s ease-out;
    transform: translateY(-20px);
  }

  &[open] > div {
    transform: translateY(0px);
  }
`,Controls$1=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
`,Range=styled(AccentRange)`
  transform: rotate(90deg);
  transform-origin: center;
  height: 150px;
  width: 150px;
`,RangeWrapper=styled.div`
  position: relative;
`,RangeLabel=styled.div.attrs(e=>({style:{top:134/(meta.max-meta.min)*(e.$value-meta.min)+4}}))`
  position: absolute;
  left: 120px;
  font-size: 12px;
  color: var(--color_accent);
`,Dialog$1=e=>{const{t:r}=useTranslation(),o=reactExports.useRef(null),i=reactExports.useCallback(()=>{o.current&&o.current.close(),e.onClose&&e.onClose()},[o.current,e.onClose]);return reactExports.useEffect(()=>{o.current&&(e.isOpen?o.current.showModal():o.current.close())},[e.isOpen]),jsxRuntimeExports.jsx(DialogContainer,{ref:o,children:jsxRuntimeExports.jsxs(ModalContainer,{children:[jsxRuntimeExports.jsx(PromptText,{children:e.children}),jsxRuntimeExports.jsx(Controls$1,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:i,children:r("Confirm")})})]})})},meta={min:.5,max:2.5},ActuationPointConfigure=({actuation:e,updateActuation:r})=>{const[o,i]=reactExports.useState(e),a=useAppSelector(getDKSActuations),d=[{Icon:SvgIconLineArrowDown,value:o},{Icon:SvgIconArrowDownLine,value:a[1]},{Icon:SvgIconArrowUpLine,value:a[1]},{Icon:SvgIconLineArrowUp,value:o}],[l,p]=reactExports.useState(!1),m=()=>{p(!1),r(o)};return reactExports.useEffect(()=>{i(e)},[e]),jsxRuntimeExports.jsxs(ActuationContainer,{children:[d.map(({Icon:_,value:C},y)=>jsxRuntimeExports.jsxs(Point,{children:[jsxRuntimeExports.jsxs(Position,{onClick:()=>p(!0),$enable:y===0||y===3,children:[C," mm"]}),jsxRuntimeExports.jsx(IconWrapper$1,{children:jsxRuntimeExports.jsx(_,{width:30})})]},y)),jsxRuntimeExports.jsx(Dialog$1,{isOpen:l,onClose:m,children:jsxRuntimeExports.jsxs(RangeWrapper,{children:[jsxRuntimeExports.jsxs(RangeLabel,{$value:o,children:[o,"mm"]}),jsxRuntimeExports.jsx(Range,{max:meta.max,min:meta.min,defaultValue:o,step:.05,onChange:_=>{i(_)}})]})})]})},size=100,minSize=24,calcWidthFromLength=e=>e===0?0:e===1?minSize:(e-1)*size,Flow=styled.div.attrs(e=>({style:{width:e.$width+"px"}}))`
  position: absolute;
  z-index: 1;
  top: 0;
  left: 0;
  background: var(--color_accent);
  border-radius: ${minSize}px;
  height: ${minSize}px;
  cursor: pointer;
`,IconWrapper=styled.div`
  width: ${minSize}px;
  height: ${minSize}px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: var(--color_label-highlighted);
  border-radius: ${minSize}px;
  background: var(--bg_control);
`,PointContainer=styled.div.attrs(e=>({style:{left:size*e.$index+"px"}}))`
  position: absolute;
  height: ${minSize}px;
`,Dragger$1=styled.div.attrs(e=>({style:{left:e.$width>0?e.$width-minSize/2+minSize/4+"px":"0px",cursor:e.$width>0?"ew-resize":"pointer",width:e.$width>0?minSize/2+"px":minSize+"px"}}))`
  position: absolute;
  z-index: 2;
  height: ${minSize}px;
  top: 0;
`,getMaxLength=(e,r)=>{let o=1;for(let i=e+1;i<r.length-1&&!(r[i]===DKSPoint.Down||r[i]===DKSPoint.Single);i++)o++;return o},isDisabled=(e,r)=>{if(e===0||e===r.length-1)return!1;for(let o=0;o<e;o++)if(r[o]>e-o+1)return!0;return!1},PointControl=({points:e,pointIndex:r,updatePointLength:o,pointLength:i})=>{const a=isDisabled(r,i),d=i[r],l=getMaxLength(r,e),p=r===e.length-1?minSize:l*size,[m,_]=reactExports.useState(0),C=w=>{var P;const L=(P=j.current)==null?void 0:P.getBoundingClientRect().x;if(!L)return;let T=w-L;T>p?T=p:T<minSize&&(T=minSize),_(T)},y=(w,L)=>{const T=Math.floor(m/size)+(m%size>size/2?1:0)+1;o(r,T),_(calcWidthFromLength(T))},b=(w,L)=>{const{clientX:T}=w;C(T)},K=(w,L)=>{const{clientX:T}=w;C(T)},v=()=>{_(0),o(r,0)},j=reactExports.useRef(null);return reactExports.useEffect(()=>{_(calcWidthFromLength(d))},[d]),jsxRuntimeExports.jsxs(PointContainer,{ref:j,$index:r,children:[m===0&&jsxRuntimeExports.jsx(IconWrapper,{children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faPlus})}),!a&&jsxRuntimeExports.jsx(Draggable,{axis:"x",onStart:K,onDrag:b,onStop:y,position:{x:0,y:0},children:jsxRuntimeExports.jsx(Dragger$1,{$width:m})}),m>0&&jsxRuntimeExports.jsx(Flow,{$width:m,onClick:v,children:jsxRuntimeExports.jsx(SvgIconBorder,{size:minSize})})]})},KeyBox=styled.div`
  border: 4px solid
    ${e=>e.$active?"var(--color_accent)":"var(--border_color_icon)"};
  width: 50px;
  height: 50px;
  border-radius: 10px;
  background: var(--bg_control);
  margin-right: 30px;
  cursor: pointer;
  text-align: center;
  line-height: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  // position: relative;
  // padding: 0;
  // &:hover {
  //   background: var(--bg_control);
  //   border: 4px solid
  //     ${e=>e.$active?"var(--color_accent)":"var(--border_color_icon)"};
  // }
`,KeyLabel=styled.div`
  white-space: pre-wrap;
  text-overflow: ellipsis;
  overflow: hidden;
  user-select: none;
  color: var(--color_label-highlighted);
`,KeyBinding=({dksKey:e,rowIndex:r,updateKey:o})=>{const i=useDispatch(),d=useAppSelector(getDksAction)===r,{basicKeyToByte:l,byteToKey:p}=useAppSelector(getBasicKeyToByte),m=useAppSelector(getSelectedDefinition),_=m?m.customKeycodes:void 0,C=d?"":getNameForByte(e,l,p,_),y=reactExports.useRef(null),b=w=>{w.preventDefault();const L=mapEvtToKeycode(w);if(L){const T=getByteForCode(L,l);o(T)}i(updateDksAction(null))},K=w=>{var T;const L=w.target;w.target===y.current||(T=y.current)!=null&&T.contains(L)||L.classList.contains("dks-keycode-submenu")||i(updateDksAction(null))},v=()=>{i(updateDksAction(r))},j=w=>{w.preventDefault(),e!==0&&o(0)};return reactExports.useEffect(()=>(d&&(window.addEventListener("keyup",b),document.addEventListener("click",K)),()=>{window.removeEventListener("keyup",b),document.removeEventListener("click",K)}),[d]),reactExports.useEffect(()=>()=>{i(updateDksAction(null))},[]),jsxRuntimeExports.jsx(KeyBox,{$active:d,onClick:v,onContextMenu:j,ref:y,children:jsxRuntimeExports.jsx(KeyLabel,{children:C})})},Row=styled.div`
  padding: 5px 0;
  display: flex;
  align-items: center;
`,Points=styled.div`
  width: 330px;
  display: flex;
  align-items: center;
  overflow: hidden;
  position: relative;
  height: 24px;
`,lengthToPoint=e=>{let r=DKSPoint.Hold,o=DKSPoint.Hold,i=DKSPoint.Hold,a=DKSPoint.Hold;switch(e[0]){case 1:r=DKSPoint.Single;break;case 2:r=DKSPoint.Down,o=DKSPoint.Up,i=DKSPoint.Hold,a=DKSPoint.Up;break;case 3:r=DKSPoint.Down,o=DKSPoint.Hold,i=DKSPoint.Up,a=DKSPoint.Up;break;case 4:r=DKSPoint.Down,o=DKSPoint.Hold,i=DKSPoint.Hold,a=DKSPoint.Up;break}switch(e[1]){case 1:o=DKSPoint.Single;break;case 2:o=DKSPoint.Down,i=DKSPoint.Up,a=DKSPoint.Up;break;case 3:case 4:o=DKSPoint.Down,i=DKSPoint.Hold,a=DKSPoint.Up;break}switch(e[2]){case 1:i=DKSPoint.Single;break;case 2:case 3:case 4:i=DKSPoint.Down,a=DKSPoint.Up;break}return e[3]===1&&(a=DKSPoint.Single),[r,o,i,a]},pointToLength=e=>{const[r,o,i,a]=e;let d=0,l=0,p=0,m=0;return r===DKSPoint.Single?d=1:r===DKSPoint.Down&&(o===DKSPoint.Hold?d=i===DKSPoint.Hold?4:3:d=2),o===DKSPoint.Single?l=1:o===DKSPoint.Down&&d<3&&(l=i===DKSPoint.Hold?3:2),i===DKSPoint.Single?p=1:i===DKSPoint.Down&&d<4&&l<3&&(p=2),a===DKSPoint.Single&&(m=1),[d,l,p,m]},ActionRow=({action:e,index:r,updateAction:o})=>{const i=pointToLength(e.points),a=(l,p)=>{const m=i.map((_,C)=>C===l?p:_);o(r,{key:e.key,points:lengthToPoint(m)})},d=l=>{o(r,{key:l,points:e.points})};return jsxRuntimeExports.jsxs(Row,{children:[jsxRuntimeExports.jsx(KeyBinding,{rowIndex:r,dksKey:e.key,updateKey:d}),jsxRuntimeExports.jsx(Points,{children:e.points.map((l,p)=>jsxRuntimeExports.jsx(PointControl,{points:e.points,pointIndex:p,pointLength:i,updatePointLength:a},p))})]})},ActionGrid=styled.div``,DKSActionPane=({actions:e,updateActions:r})=>{const o=(i,a)=>{const d=e.map((l,p)=>p===i?a:l);r(d)};return jsxRuntimeExports.jsx(ActionGrid,{children:e.map((i,a)=>jsxRuntimeExports.jsx(ActionRow,{action:i,index:a,updateAction:o},a))})},KeycodeList=styled.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, 64px);
  grid-auto-rows: 64px;
  justify-content: center;
  grid-gap: 10px;
`,MenuContainer$3=styled.div`
  padding: 10px 10px 0;
  display: flex;
`,Keycode=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 64px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 10px;
  &:hover {
    border-color: var(--color_accent);
    transform: translate3d(0, -2px, 0);
  }
  ${e=>e.disabled&&"cursor:not-allowed;filter:opacity(50%);"}
`,KeycodeContent=styled.div`
  text-overflow: ellipsis;
  overflow: hidden;
`;styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 10px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--color_accent);
  border-color: var(--color_inside_accent);
  color: var(--color_inside_accent);
  margin: 0;
`;const KeycodeContainer$1=styled.div`
  padding: 12px;
  padding-bottom: 30px;
`,KeycodeDesc=styled.div`
  position: fixed;
  bottom: 0;
  background: #d9d9d97a;
  box-sizing: border-box;
  transition: opacity 0.4s ease-out;
  height: 25px;
  width: 100%;
  line-height: 14px;
  padding: 5px;
  font-size: 14px;
  opacity: 1;
  pointer-events: none;
  &:empty {
    opacity: 0;
  }
`,generateKeycodeCategories=(e,r=16)=>getKeycodes(r).concat(getOtherMenu(e)),maybeFilter=(e,r)=>e?()=>!0:r,KeycodePane=({actions:e,updateActions:r})=>{var re;const{t:o}=useTranslation(),i=useAppDispatch(),a=useAppSelector(V=>V.macros),d=useAppSelector(getSelectedDefinition),l=useAppSelector(getSelectedConnectedDevice),p=useAppSelector(getSelectedKeymap),m=useAppSelector(getSelectedKey);useAppSelector(getSelectedKeyDefinitions);const{basicKeyToByte:_}=useAppSelector(getBasicKeyToByte),C=useAppSelector(getMacroCount),y=useAppSelector(getDksAction),b=reactExports.useMemo(()=>generateKeycodeCategories(_,C),[_,C]);if(!d||!l||!p)return null;const[K,v]=reactExports.useState(b[0].id),[j,w]=reactExports.useState(null),[L,T]=reactExports.useState(!1),P=()=>{if(distExports.isVIADefinitionV3(d))return k(d);const{lighting:V,customKeycodes:A}=d,{keycodes:B}=distExports.getLightingDefinition(V);return b.filter(maybeFilter(B===distExports.KeycodeType.QMK,({id:te})=>te!=="qmk_lighting")).filter(maybeFilter(B===distExports.KeycodeType.WT,({id:te})=>te!=="lighting")).filter(maybeFilter(typeof A<"u",({id:te})=>te!=="custom"))},k=V=>{const B=["default",...V.keycodes||[]].flatMap(te=>categoriesForKeycodeModule(te));return(d.customKeycodes||[]).length!==0&&B.push("custom"),b.filter(te=>B.includes(te.id))},G=()=>jsxRuntimeExports.jsx(ErrorMessage,{children:o("Your current firmware does not support macros. Install the latest firmware for your device.")}),U=()=>{const{t:V}=useTranslation();return jsxRuntimeExports.jsx(MenuContainer$3,{children:P().map(({id:A,label:B})=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:A===K,onClick:()=>v(A),className:"dks-keycode-submenu",style:{fontSize:18},children:V(B)},A))})},W=()=>(i(disableGlobalHotKeys()),jsxRuntimeExports.jsx(KeycodeModal,{defaultValue:m!==null?p[m]:void 0,onExit:()=>{i(enableGlobalHotKeys()),T(!1)},onConfirm:V=>{i(enableGlobalHotKeys()),X(V),T(!1)}})),X=V=>{if(m!==null&&y!==null){const A=e.map((B,te)=>te===y?{...B,key:V}:B);r(A)}},Z=(V,A)=>{if(V=="text")T(!0);else return keycodeInMaster(V,_)&&X(getByteForCode(V,_))},I=(V,A)=>{const{code:B,title:te,name:ce}=V;return jsxRuntimeExports.jsx(Keycode,{disabled:!keycodeInMaster(B,_)&&B!="text",onClick:()=>Z(B),onMouseOver:()=>w(te?`${B}: ${te}`:B),onMouseOut:()=>w(null),children:jsxRuntimeExports.jsx(KeycodeContent,{children:ce})},B)},z=(V,A)=>{const B=V.map((te,ce)=>I(te));switch(A){case"macro":return a.isFeatureSupported?jsxRuntimeExports.jsx(KeycodeList,{children:B}):G();case"custom":return!distExports.isVIADefinitionV2(d)&&!distExports.isVIADefinitionV3(d)||!d.customKeycodes?null:jsxRuntimeExports.jsx(KeycodeList,{children:d.customKeycodes.map((te,ce)=>I({...te,code:`CUSTOM(${ce})`}))});default:return jsxRuntimeExports.jsx(KeycodeList,{children:B})}},Q=(re=b.find(({id:V})=>V===K))==null?void 0:re.keycodes;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{style:{background:"none",borderTop:"none",borderRight:"none"},children:U()}),jsxRuntimeExports.jsxs(OverflowCell,{style:{borderRight:"none"},children:[jsxRuntimeExports.jsx(KeycodeContainer$1,{children:z(Q,K)}),jsxRuntimeExports.jsx(KeycodeDesc,{children:j}),L&&W()]})]})},HiddenInput$1=styled.input`
  display: none;
`,MediaRow=styled.div`
  max-width: 960px;
  width: 100%;
  display: flex;
  border: 1px solid var(--border_color_cell);
  border-style: dashed;
  justify-content: center;
  align-items: center;
  padding: 10px;
  border-radius: 15px;
  min-height: 100px;
  margin-bottom: 10px;
  box-sizing: border-box;
  text-align: center;
  color: var(--color_label-highlighted);
`,FlexLabel=styled.div`
  color: var(--color_label);
  font-weight: 400;
  display: inline-flex;
  align-items: center;
  position: relative;
`,getScreenFiles=e=>{const r=i=>new Promise((a,d)=>{const l=document.createElement("video");l.onloadedmetadata=()=>{a([l.videoWidth,l.videoHeight])},l.src=i,l.load()}),o=i=>new Promise((a,d)=>{const l=document.createElement("img");l.onload=()=>{a([l.width,l.height])},l.src=i});return Promise.all(e.map(async i=>{const a=URL.createObjectURL(i),d=await i.arrayBuffer(),l=new Uint8Array(d);let p=0,m=0;return i.type.startsWith("video")?[p,m]=await r(a):i.type.startsWith("image")&&([p,m]=await o(a)),{name:i.name,type:i.type,src:a,width:p,height:m,byteArray:l}}))},ExportSelect=({area:e,onChange:r})=>{const{t:o}=useTranslation(),i=useAppSelector(getSelectedTool),a=useAppSelector(getExportOptions),d=useAppSelector(getSelectedConnectedDevice),l=d?d.vendorProductId:-1;if(!a)return null;const p=a.map(_=>({label:`${o(_.label)} (${_.owidth}x${_.oheight})`,value:_})),m=p.find(_=>_.value===e);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:r,value:m,options:p},l+i)})},printBytes=e=>{if(e===0)return 0;const r=["Bytes","kB","MB","GB"],o=Math.floor(Math.log10(e)/3),i=r[o],a=o===0?1:Math.pow(1e3,o);return`${(e/a).toFixed(o)} ${i}`},Pane$3=styled.div`
  display: flex;
  width: 100%;
`,Configure=styled.div`
  width: 450px;
  margin-right: 10px;
  flex-shrink: 0;
  padding-top: 10px;
`,NoSelectedKey=styled.div`
  width: 100%;
  display: block;
  border: 1px solid var(--border_color_cell);
  border-style: dashed;
  padding: 20px 20px;
  border-radius: 15px;
  box-sizing: border-box;
  text-align: center;
  color: var(--color_label-highlighted);
`,KeycodeContainer=styled.div`
  height: calc(100vh - 580px);
  padding-left: 10px;
  overflow-y: auto;
  width: 100%;
  border-left: 1px solid var(--border_color_cell);
`,DksBindingContainer=styled.div`
  height: calc(100vh - 600px);
  overflow-y: auto;
  padding-left: 10px;
  color: var(--color_label);
`,DksBindings=styled.div`
  flex-wrap: wrap;
  display: flex;
  margin-top: 20px;
`,DksBindingOriginKey=styled.div`
  padding: 0 20px;
  cursor: pointer;
`,DksBindingKey=styled.div`
  width: 50px;
  height: 50px;
  border-radius: 10px;
  background: var(--bg_control);
  margin-right: 30px;
  cursor: pointer;
  text-align: center;
  line-height: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  border: 2px solid var(--border_color_icon);
  margin-right: 10px;
  & > span {
    white-space: pre-wrap;
    text-overflow: ellipsis;
    overflow: hidden;
    user-select: none;
    color: var(--color_label-highlighted);
  }
`,DksBinding=styled.div`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  & > button {
    margin-left: 10px;
  }
  &:hover ${DksBindingKey} {
    border-color: var(--color_accent);
  }
`,DksBindingKeys=styled.div`
  display: flex;
  cursor: pointer;
`,ConfigureHeader=styled.div`
  position: relative;
  height: 24px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--border_color_cell);
  text-align: center;
  color: var(--color_label);
  > span {
    color: var(--color_accent);
  }
  margin-bottom: 10px;
  ${SimpleIconButton} {
    position: absolute;
    padding: 0 10px;
    font-size: 16px;
    left: 0px;
    top: 2px;
  }
`,DKSConfigure=()=>{const{t:e}=useTranslation(),r=useAppDispatch(),o=useAppSelector(getSelectedKey),i=useAppSelector(getSelectedDefinition),a=useAppSelector(getSelectedLayerIndex),d=o!==null&&i,l=useAppSelector(getConfiguredDksData),p=useAppSelector(getSelectedKeymapIndexes),{basicKeyToByte:m,byteToKey:_}=useAppSelector(getBasicKeyToByte),C=useAppSelector(getSelectedDefinition),y=C?C.customKeycodes:void 0,b=useAppSelector(getSelectedRawLayers),K=useAppSelector(getSelectDksData);if(!K)return null;const v=k=>getNameForByte(k,m,_,y),{actuation:j,actions:w}=K,L=k=>{o!==null&&r(updateDksData(a,o,{actuation:k,actions:w}))},T=k=>{o!==null&&r(updateDksData(a,o,{actuation:j,actions:k}))},P=()=>{o!==null&&(r(updateDksData(a,o,null)),r(updateSelectedKey(null)))};return jsxRuntimeExports.jsxs(Pane$3,{children:[jsxRuntimeExports.jsx(Configure,{children:d?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ConfigureHeader,{children:[jsxRuntimeExports.jsx(SimpleIconButton,{onClick:()=>r(updateSelectedKey(null)),children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faChevronLeft})}),"["," ",jsxRuntimeExports.jsx("span",{children:v(b[a].keymap[p[o]])})," ","]"]}),jsxRuntimeExports.jsx(ActuationPointConfigure,{actuation:j,updateActuation:L}),jsxRuntimeExports.jsx(DKSActionPane,{actions:w,updateActions:T}),jsxRuntimeExports.jsx("div",{style:{borderTop:"1px solid var(--border_color_cell)",marginTop:20},children:jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(FlexLabel,{}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(SimpleIconButton,{style:{fontSize:20,paddingRight:10},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{onClick:P,icon:faTrashCan})})})]})})]}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:l.length>0?jsxRuntimeExports.jsxs(DksBindingContainer,{children:[e("Current bindings")," : ",l.length,jsxRuntimeExports.jsx(DksBindings,{children:l.map((k,G)=>{var W;const U=p.indexOf(k.key);return U===-1?null:jsxRuntimeExports.jsxs(DksBinding,{children:[jsxRuntimeExports.jsx(DksBindingOriginKey,{onClick:()=>{r(setLayer(k.layerIdx)),r(updateSelectedKey(U))},children:jsxRuntimeExports.jsx(DksBindingKey,{children:jsxRuntimeExports.jsx("span",{children:v(b[k.layerIdx].keymap[k.key])})})}),jsxRuntimeExports.jsx(DksBindingKeys,{onClick:()=>{r(setLayer(k.layerIdx)),r(updateSelectedKey(U))},children:(W=k.data)==null?void 0:W.actions.map((X,Z)=>jsxRuntimeExports.jsx(DksBindingKey,{children:jsxRuntimeExports.jsx("span",{children:v(X.key)})},Z))}),jsxRuntimeExports.jsx(SimpleIconButton,{onClick:()=>r(updateDksData(k.layerIdx,U,null)),children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faTrashCan})})]},G)})})]}):jsxRuntimeExports.jsx(NoSelectedKey,{children:e("Selecting a key to start setting dynamic keystroke")})})}),jsxRuntimeExports.jsx(KeycodeContainer,{children:jsxRuntimeExports.jsx(KeycodePane,{actions:w,updateActions:T})})]})},PerKeyAct=styled.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,ActuationConfiger=()=>{const{t:e}=useTranslation(),r=useDispatch(),o=useAppDispatch(),i=useAppSelector(getActuationPoint),a=useAppSelector(getSelectedKeys),[d,l]=reactExports.useState(i),p=useAppSelector(getEnableAP),m=useAppSelector(getSelectedActuationMap),_=()=>{a&&o(updatePerKeyActuation(a,d)),r(clearSelectedKeys())},C=()=>{a&&o(deletePerKeyActuation(a)),r(clearSelectedKeys())},y=useAppSelector(getSelectedKeymapIndexes);return reactExports.useEffect(()=>{if(m&&a&&a.length>0){const b=a[a.length-1];if(!m[b])return;const K=m[b].actuationPoint;K&&l(K)}},[a]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Set Actuatoin Point")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:p,onChange:b=>o(updateEnableAP(b))})})]}),p&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Global actuation")," ",i.toFixed(1)," mm"]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{min:.1,max:4,step:.05,value:i,onChange:b=>o(updateActuationPoint(b))})})]}),jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsx(Label$1,{style:{color:"var(--color_label-highlighted)",marginTop:20},children:e("Selecting keys to set per key actuation")})}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Per key actuation")," ",`${d} mm`," "]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PerKeyAct,{children:jsxRuntimeExports.jsx(AccentRange,{min:.1,max:4,step:.05,value:d,disabled:!(a!=null&&a.length),onChange:b=>l(b)})})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(FlexLabel,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:()=>{r(updateSelectedKeys([...y.keys()]))},style:{marginRight:5},children:e("Select All")}),jsxRuntimeExports.jsx(AccentButton,{disabled:!(a!=null&&a.length),onClick:()=>{r(updateSelectedKeys([]))},children:e("Deselect All")})]}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(AccentButton,{disabled:!(a!=null&&a.length),onClick:C,children:e("Delete")}),jsxRuntimeExports.jsx(PrimaryAccentButton,{style:{marginLeft:5},disabled:!(a!=null&&a.length),onClick:_,children:e("Confirm")})]})]})]})]})},RTConfiger=()=>{const e=useDispatch(),r=useAppDispatch(),o=useAppSelector(getEnableRT),i=useAppSelector(getContinuousRT),a=useAppSelector(getSelectedKeys),d=useAppSelector(getSelectedActuationMap),[l,p]=reactExports.useState(defaultRtSensitivity),[m,_]=reactExports.useState(defaultRt2ndSensitivity),C=()=>{a&&r(updatePerKeyRT(a,l,m)),e(clearSelectedKeys())},y=()=>{a&&r(deletePerKeyRT(a)),e(clearSelectedKeys())},b=useAppSelector(getSelectedKeymapIndexes);return reactExports.useEffect(()=>{if(d&&a&&a.length>0){const K=a[a.length-1];if(!d[K])return;const v=d[K].rtSensitivity,j=d[K].rt2ndSensitivity;v&&p(v),j&&_(j)}},[a]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:t("Rapit Trigger")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:o,onChange:K=>r(updateEnableRT(K))})})]}),o&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:t("Continuous rapid trigger")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:i,onChange:K=>r(updateContinuousRT(K))})})]}),jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsx(Label$1,{style:{color:"var(--color_label-highlighted)",marginTop:20},children:t("Selecting keys to set rapid trigger")})}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[t("Press(active)")," ",t("sensitivity")," ",l.toFixed(2)," ","mm"]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{min:.1,max:2.35,step:.05,value:l,disabled:!(a!=null&&a.length),onChange:K=>p(K)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[t("Release(reset)")," ",t("sensitivity")," ",m.toFixed(2)," mm"]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{min:.1,max:2.35,step:.05,value:m,disabled:!(a!=null&&a.length),onChange:K=>_(K)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(FlexLabel,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:()=>{e(updateSelectedKeys([...b.keys()]))},style:{marginRight:5},children:t("Select All")}),jsxRuntimeExports.jsx(AccentButton,{disabled:!(a!=null&&a.length),onClick:()=>{e(updateSelectedKeys([]))},children:t("Deselect All")})]}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(AccentButton,{disabled:!(a!=null&&a.length),onClick:y,children:t("Delete")}),jsxRuntimeExports.jsx(PrimaryAccentButton,{style:{marginLeft:5},disabled:!(a!=null&&a.length),onClick:C,children:t("Confirm")})]})]})]})]})},SelfCheck=()=>{const e=useAppDispatch(),{t:r}=useTranslation(),o=useAppSelector(getSelfChecked),i=useAppSelector(getSelfCheckTimeout);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(AccentButton,{onClick:()=>e(selfCheck()),children:[r(i===-1?"Check Failed, Retry":o?"Recheck":"Self Check"),i>0&&` , ${r("Wait")} ${i} ${r("S")}`]})})},title$1="Actuation",MenuContainer$2=styled.div`
  padding: 15px 10px 20px 10px;
`,ActuationPane=styled(CenterPane)`
  height: 100%;
`,Container$c=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
`,Pane$2=()=>{const{t:e,i18n:r}=useTranslation(),o=useDispatch(),i=useAppSelector(getSelfChecked),a=[{action:"AP",configure:jsxRuntimeExports.jsx(ActuationConfiger,{})},{action:"RT",configure:jsxRuntimeExports.jsx(RTConfiger,{})},{action:"DKS",configure:jsxRuntimeExports.jsx(DKSConfigure,{})},{action:"SELF CHECK",configure:jsxRuntimeExports.jsx(SelfCheck,{})}],d=useAppSelector(getActiveMenu),l=m=>{o(updateMenu(m)),o(clearSelectedKeys())},p=reactExports.useMemo(()=>a.map(m=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:m.action===d,onClick:()=>l(m.action),style:{borderWidth:0,textAlign:"center",cursor:i?"pointer":"default"},children:e(m.action)},m.action)),[a,d,r.language]);return reactExports.useEffect(()=>{switch(d){case"DKS":o(setConfigureKeyboardIsSelectable(!0));break;case"AP":case"RT":o(updateShowLayerControl(!1)),o(updateMultiSelectAble(!0)),o(setLayer(0));break}return()=>{o(setConfigureKeyboardIsSelectable(!1)),o(updateMultiSelectAble(!1)),o(updateShowLayerControl(!0)),o(updateSelectedKey(null)),o(updateSelectedKeys([]))}},[d]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{children:jsxRuntimeExports.jsx(MenuContainer$2,{children:p})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(ActuationPane,{children:jsxRuntimeExports.jsx(Container$c,{children:a.filter(m=>m.action===d)[0].configure})})})]})},Icon$2=()=>jsxRuntimeExports.jsx("svg",{fill:"currentColor",viewBox:"0 0 54 54",children:jsxRuntimeExports.jsx("path",{d:"M 13.7851 49.5742 L 42.2382 49.5742 C 47.1366 49.5742 49.5743 47.1367 49.5743 42.3086 L 49.5743 13.6914 C 49.5743 8.8633 47.1366 6.4258 42.2382 6.4258 L 13.7851 6.4258 C 8.9101 6.4258 6.4257 8.8398 6.4257 13.6914 L 6.4257 42.3086 C 6.4257 47.1602 8.9101 49.5742 13.7851 49.5742 Z M 13.8554 45.8008 C 11.5117 45.8008 10.1992 44.5586 10.1992 42.1211 L 10.1992 13.8789 C 10.1992 11.4414 11.5117 10.1992 13.8554 10.1992 L 42.1679 10.1992 C 44.4882 10.1992 45.8007 11.4414 45.8007 13.8789 L 45.8007 42.1211 C 45.8007 44.5586 44.4882 45.8008 42.1679 45.8008 Z M 28.0351 13.4571 C 27.4960 13.4571 27.0976 13.6914 26.6523 14.1133 L 18.7070 22.0352 C 18.4023 22.3398 18.2148 22.7617 18.2148 23.2539 C 18.2148 24.2149 18.9882 24.9414 19.9257 24.9414 C 20.4413 24.9414 20.8632 24.7539 21.1913 24.4258 L 24.0742 21.4961 L 26.4648 18.6602 L 26.2773 23.6289 L 26.2773 32.2774 L 26.4648 37.2461 L 24.0742 34.4102 L 21.1913 31.4571 C 20.8632 31.1289 20.4413 30.9414 19.9257 30.9414 C 18.9882 30.9414 18.2148 31.6680 18.2148 32.6289 C 18.2148 33.1211 18.4023 33.5430 18.7070 33.8477 L 26.6523 41.7695 C 27.0976 42.2149 27.4960 42.4492 28.0351 42.4492 C 28.5273 42.4492 28.9257 42.2383 29.3944 41.7695 L 37.3398 33.8477 C 37.6444 33.5430 37.8085 33.1211 37.8085 32.6289 C 37.8085 31.6680 37.0820 30.9414 36.1210 30.9414 C 35.6054 30.9414 35.1835 31.1523 34.8788 31.4571 L 31.9726 34.4102 L 29.6054 37.2227 L 29.7929 32.2774 L 29.7929 23.6289 L 29.6054 18.6836 L 31.9726 21.4961 L 34.8788 24.4258 C 35.1835 24.7305 35.6054 24.9414 36.1210 24.9414 C 37.0820 24.9414 37.8085 24.2149 37.8085 23.2539 C 37.8085 22.7617 37.6444 22.3398 37.3398 22.0352 L 29.3944 14.1133 C 28.9257 13.6445 28.5273 13.4571 28.0351 13.4571 Z"})}),Title$2=title$1,Actuation=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$2,Pane:Pane$2,Title:Title$2},Symbol.toStringTag,{value:"Module"})),ProgressBarContainer=styled.div`
  position: relative;
  margin-top: 10px;
  line-height: 1;
  &:hover {
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,ProgressBar=styled.div`
  background: var(--bg_control);
  position: relative;
  padding: 5px;
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 10px;
  cursor: pointer;
  width: 250px;

  > span {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    background: var(--color_accent);
    height: 10px;
    width: 100%;
    transform: scaleX(0.01);
    transform-origin: left;
    transition: transform 0.4s ease-in-out;
  }
`,SavingStatus=styled.div`
  margin-left: 10px;
`,printTime=e=>{e=~~e;const r=~~(e/60),o=e%60;return`${r}:${o<10?"0":""}${o}`},SavingProgress=({bufferSize:e,bytesSended:r,sendSpeed:o})=>{const{t:i}=useTranslation();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ProgressBarContainer,{children:[jsxRuntimeExports.jsx(ProgressBar,{children:jsxRuntimeExports.jsx("span",{style:{transform:`scaleX(${r/e})`}})}),jsxRuntimeExports.jsxs(ProgressBarTooltip,{children:[printBytes(o),"/s,"," ",`  -${printTime((e-r)/o)}`]})]}),jsxRuntimeExports.jsxs(SavingStatus,{children:[~~(r/e*100)," % (",printBytes(r)," /"," ",printBytes(e),")"," ",r===0&&i("Initializing")]})]})},Dialog=e=>{const{t:r}=useTranslation(),o=e.cancelText??"Cancel",i=e.confirmText??"Confirm";return jsxRuntimeExports.jsx(ModalBackground,{children:jsxRuntimeExports.jsxs(ModalContainer,{children:[jsxRuntimeExports.jsx(PromptText,{children:e.text&&e.text}),jsxRuntimeExports.jsxs(RowDiv$1,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:e.onExit,children:r(o)}),jsxRuntimeExports.jsx(PrimaryAccentButton,{onClick:e.onConfirm,children:r(i)})]})]})})},FileSaveControl=({area:e,setArea:r,generate:o,disabled:i})=>{const{t:a}=useTranslation(),d=useAppDispatch(),l=useAppSelector(getSavingState$2),[p,m]=reactExports.useState(""),_=useAppSelector(getBufferSize$2),C=useAppSelector(getBytesSended$2),y=useAppSelector(getSendSpeed$2),[b,K]=reactExports.useState(!1),[v,j]=reactExports.useState(!1),w=useAppSelector(getSelectedTool),L=useAppSelector(getLightingSupport),T=async()=>{m(""),K(!0);const P=async()=>{let k=null;try{k=o()}catch(G){console.log(G)}if(K(!1),k==null){m(a("Failed to process."));return}await d(initSendState({size:k.length})),d(saveTabFile(k,G=>{G||m(a("Failed to save."))}))};setTimeout(()=>{P()},300)};return reactExports.useEffect(()=>{l!=="saving"&&j(!1)},[l]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[a("Type"),"："]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ExportSelect,{area:e,onChange:P=>r(P.value)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(FlexLabel,{children:[p&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),p]})," ",b&&a("Processing"),l==="saving"&&jsxRuntimeExports.jsx(SavingProgress,{bufferSize:_,sendSpeed:y,bytesSended:C})]}),jsxRuntimeExports.jsxs(Detail,{children:[l==="saving"&&C>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:()=>j(!0),children:a("Cancel")}),v&&l==="saving"&&C>0&&jsxRuntimeExports.jsx(Dialog,{text:a(`Cancel transfer will revert to factory default ${w}, confirm cancel?`),cancelText:"No",confirmText:"Yes",onConfirm:()=>{d(updateState$2("canceled")),j(!1)},onExit:()=>j(!1)})]}),l!=="saving"&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:T,disabled:i,children:a("Save")})})]})]}),L&&jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsx(Label$1,{style:{fontSize:16},children:a("To boost the data transfer speed, the backlight will shut off during transfer period and resume afterwards.")})})]})},MediaContainer=styled.div.attrs(({$width:e,$height:r})=>({style:{width:e,height:r,display:e>0&&r>0?"block":"none"}}))`
  position: relative;
`,Dragger=styled.div`
  top: 0;
  left: 0;
  position: absolute;
  cursor: move;
  cursor: grab;
  transition: all 0.3s;
  z-index: 1;
  &.react-draggable-dragging {
    transition: none;
    cursor: grabbing;
  }
`,getDimension=(e,r)=>{if(e&&r){const[o,i]=[r.width,r.height],[a,d]=[e.owidth,e.oheight],l=o/i,p=a/d;return l>p?[~~(l*d),d]:[a,~~(a/l)]}return[0,0]},CropTool=reactExports.memo(()=>{const{t:e}=useTranslation(),r=useAppSelector(getSelectedTool),o=useAppSelector(getDefaultArea),i=useAppSelector(getKbresFlags);if(!o)return null;const[a,d]=reactExports.useState([]),[l,p]=reactExports.useState(o),m=a[0],_=reactExports.useRef(null),[C,y]=getDimension(l,m),[b,K]=reactExports.useState(Math.floor((C-l.owidth)/2)),[v,j]=reactExports.useState(Math.floor((y-l.oheight)/2)),w={left:0,top:0,right:C-l.owidth,bottom:y-l.oheight},L=r==="video"?"image/gif,video/mp4":"image/png,image/jpeg,image/bmp",T=()=>{var I;(I=_.current)==null||I.click()},P=useKbres(),k=async I=>{I.target.files&&d(await getScreenFiles(Array.from(I.target.files)))},G=(I,z)=>{K(z.x),j(z.y)},U=reactExports.useRef(null),W=reactExports.useRef(0),X=()=>{if(!U.current){W.current=0;return}const I=U.current,z=I.getContext("2d");z.clearRect(0,0,I.width,I.height);const Q=5;z.setLineDash([Q,Q]),z.lineDashOffset=W.current,z.strokeStyle="white",z.beginPath(),z.rect(0,0,I.width,I.height),z.stroke(),z.lineDashOffset=W.current+Q,z.strokeStyle="black",z.beginPath(),z.rect(0,0,I.width,I.height),z.stroke(),W.current+=3,setTimeout(X,200)};reactExports.useEffect(()=>{setTimeout(()=>{K(Math.floor((C-l.owidth)/2)),j(Math.floor((y-l.oheight)/2)),W.current===0&&X()},0)},[l,C,y]);const Z=()=>{if(!P)return null;const I="/tabkb";try{P.FS.stat(I)}catch{P.FS.mkdir(I)}const z=`${l.format}`,Q=I+"/"+m.name;P.FS.writeFile(Q,m.byteArray);const re=new P.IntVec;re.push_back(l.owidth),re.push_back(l.oheight);const V=new P.IntVec;V.push_back(C),V.push_back(y);const A=new P.IntVec;A.push_back(b),A.push_back(v),console.debug(Q,z,l.orientations,[l.owidth,l.oheight],[C,y],[b,v],l.format,l.animFramesLimit,i);let B=0;return r==="image"?B=P.convert_image_ext(Q,z,l.orientations,re,V,A,l.format,i):B=P.convert_video_ext(Q,z,l.orientations,re,V,A,l.format,l.animFramesLimit,i),P.FS.unlink(Q),B===0?P.FS.readFile(z):null};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MediaRow,{children:jsxRuntimeExports.jsxs(MediaContainer,{$width:C,$height:y,children:[jsxRuntimeExports.jsx(Media,{type:m==null?void 0:m.type,src:m==null?void 0:m.src,width:C,height:y}),jsxRuntimeExports.jsx(Draggable,{position:{x:b,y:v},onStop:G,bounds:w,children:jsxRuntimeExports.jsx(Dragger,{children:m&&jsxRuntimeExports.jsx("canvas",{ref:U,width:l.owidth,height:l.oheight})})})]})}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("File"),"：",m==null?void 0:m.name]}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:T,children:e("Import "+(r==="video"?"Video":"Image"))}),jsxRuntimeExports.jsx(HiddenInput$1,{accept:L,onChange:k,type:"file",ref:_})]})]}),jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsxs(Label$1,{children:[e("Original Size"),": ",(m==null?void 0:m.width)||0," x ",(m==null?void 0:m.height)||0]})}),jsxRuntimeExports.jsx(FileSaveControl,{area:l,setArea:p,generate:Z,disabled:!m})]})},shallowEqual),Slider=styled.div.attrs(e=>({style:{width:e.$width,height:e.$height}}))`
  position: relative;
  overflow: hidden;
`,upAnima=keyframes`
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-100%);
  }
`,downAnim=keyframes`
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(100%);
  }
`,leftAnim=keyframes`
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
`,rightAnim=keyframes`
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(100%);
  }
`,SliderImage=styled.img.attrs(e=>{let r="0",o="0";if(e.$isNext)switch(e.$anim){case 3:o="100%";break;case 2:o="-100%";break;case 5:r="100%";break;case 4:r="-100%";break}return{style:{width:e.$width,height:e.$height,left:r,top:o,zIndex:e.$anim!==1||e.$isNext?0:1}}})`
  background: #000;
  object-fit: cover;
  position: absolute;
  animation-name: ${e=>{if(!e.$isNext)return"";switch(e.$anim){case 3:return upAnima;case 2:return downAnim;case 5:return leftAnim;case 4:return rightAnim;default:return""}}};
  animation-delay: ${e=>(e.$interval||1)-.3}s;
  animation-duration: 0.3s;
  animation-fill-mode: forwards;
  animation-timing-function: linear;
  pointer-events: none;
`,SliderTool=()=>{var W,X;const{t:e,i18n:r}=useTranslation(),o=useAppSelector(getDefaultArea),i=useAppSelector(getKbresFlags);if(!o)return null;const a=reactExports.useMemo(()=>[5,10,15,30].map(Z=>({label:Z+" "+e("S"),value:Z})),[r.language]),d=reactExports.useMemo(()=>[{label:e("None"),value:1},{label:e("Top to bottom"),value:2},{label:e("Bottom to top"),value:3},{label:e("Left to right"),value:4},{label:e("Right to left"),value:5}],[r.language]),[l,p]=reactExports.useState(o),m=reactExports.useRef(null),[_,C]=reactExports.useState([]),[y,b]=reactExports.useState(0),K=_.length<=1||y===_.length-1?0:y+1,[v,j]=reactExports.useState(a[0].value),[w,L]=reactExports.useState(d[0].value),T=reactExports.useRef(null),P=useKbres(),k=()=>{var Z;(Z=m.current)==null||Z.click()},G=async Z=>{if(Z.target.files){const I=Array.from(Z.target.files).filter(Q=>["image/jpeg","image/png","image/bmp"].includes(Q.type)),z=lodashExports.sortBy(await getScreenFiles(I),[Q=>Q.name]);C(z),b(0)}};reactExports.useEffect(()=>{m.current!==null&&(m.current.setAttribute("directory",""),m.current.setAttribute("webkitdirectory",""))},[m]),reactExports.useEffect(()=>{if(_.length!==0)return T.current=setInterval(()=>{b(Z=>Z===_.length-1?0:Z+1)},v*1e3),()=>{T.current&&(clearInterval(T.current),b(0))}},[l,w,v,_]);const U=()=>{if(!P)return null;const Z="/tabkb";try{P.FS.stat(Z)}catch{P.FS.mkdir(Z)}const I=l.format,z=l.format,Q=new P.StrVec;for(const A of _)P.FS.writeFile(Z+"/"+A.name,A.byteArray),Q.push_back(Z+"/"+A.name);const re=new P.IntVec;re.push_back(l.owidth),re.push_back(l.oheight),console.debug(Z,I,l.orientations,v,w,[l.owidth,l.oheight],z,i);const V=P.convert_image_folder_ext(Q,I,l.orientations,v,w,re,z,i);for(let A=0;A<Q.size();A++){const B=Q.get(A);P.FS.unlink(B)}return V===0?P.FS.readFile(I):null};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MediaRow,{children:jsxRuntimeExports.jsxs(Slider,{$width:l.owidth,$height:l.oheight,children:[_.length>0&&jsxRuntimeExports.jsx(SliderImage,{$interval:v,$anim:w,src:(W=_[y])==null?void 0:W.src,$width:l.owidth,$height:l.oheight}),_.length>1&&jsxRuntimeExports.jsx(SliderImage,{$interval:v,$anim:w,$isNext:!0,src:(X=_[K])==null?void 0:X.src,$width:l.owidth,$height:l.oheight})]},y)}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("image"),": ",_.length===0?0:y+1," / ",_.length," ",_.length===0?"":`( ${_[y].name} )`]}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:k,children:e("Import From Album")}),jsxRuntimeExports.jsx(HiddenInput$1,{onChange:G,type:"file",ref:m})]})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Interval"),": "]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:Z=>j(Z.value),value:a.find(Z=>Z.value===v),options:a})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Transition Animation"),": "]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:Z=>L(Z.value),value:d.find(Z=>Z.value===w),options:d})})]}),jsxRuntimeExports.jsx(FileSaveControl,{area:l,setArea:p,generate:U,disabled:_.length===0})]})},title="Screen",ScreenPane=styled(CenterPane)`
  height: 100%;
`,MenuContainer$1=styled.div`
  padding: 15px 10px 20px 10px;
  pointer-events: ${e=>e.$disabled?"none":"auto"};
`,Container$b=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
`,Media=reactExports.memo(({type:e,src:r,width:o,height:i})=>jsxRuntimeExports.jsxs("div",{style:{pointerEvents:"none"},children:[(e==null?void 0:e.startsWith("image"))&&jsxRuntimeExports.jsx("img",{src:r,style:{width:o,height:i}}),(e==null?void 0:e.startsWith("video"))&&jsxRuntimeExports.jsx("video",{style:{width:o,height:i},muted:!0,autoPlay:!0,loop:!0,src:r})]}),shallowEqual),Pane$1=()=>{const{t:e}=useTranslation(),r=useDispatch(),o=useAppSelector(getSelectedTool),i=useAppSelector(getSavingState$2),a=useAppSelector(getScreenMenus),d=useAppSelector(getDeviceConfig),l=a.map(m=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:o===m,onClick:()=>r(updateTool(m)),style:{borderWidth:0,textAlign:"center"},children:e(m)},m)),p=()=>{if(!d)return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{});switch(o){case"video":return jsxRuntimeExports.jsx(CropTool,{},"video");case"image":return jsxRuntimeExports.jsx(CropTool,{},"image");case"slider":return jsxRuntimeExports.jsx(SliderTool,{},"slider")}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{children:jsxRuntimeExports.jsx(MenuContainer$1,{$disabled:i==="saving",children:l})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(ScreenPane,{children:jsxRuntimeExports.jsx(Container$b,{children:p()})})})]})},Icon$1=()=>jsxRuntimeExports.jsx("svg",{viewBox:"1 1 22 22",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M6.25,4 L17.75,4 C19.4830315,4 20.8992459,5.35645477 20.9948552,7.06557609 L21,7.25 L21,16.75 C21,18.4830315 19.6435452,19.8992459 17.9344239,19.9948552 L17.75,20 L6.25,20 C4.51696854,20 3.10075407,18.6435452 3.00514479,16.9344239 L3,16.75 L3,7.25 C3,5.51696854 4.35645477,4.10075407 6.06557609,4.00514479 L6.25,4 L17.75,4 L6.25,4 Z M17.75,5.5 L6.25,5.5 C5.3318266,5.5 4.57880766,6.20711027 4.5058012,7.10647279 L4.5,7.25 L4.5,16.75 C4.5,17.6681734 5.20711027,18.4211923 6.10647279,18.4941988 L6.25,18.5 L17.75,18.5 C18.6681734,18.5 19.4211923,17.7928897 19.4941988,16.8935272 L19.5,16.75 L19.5,7.25 C19.5,6.3318266 18.7928897,5.57880766 17.8935272,5.5058012 L17.75,5.5 Z M10.0527864,9.5854102 C10.1625594,9.3658642 10.4120593,9.26236922 10.639617,9.328815 L10.7236068,9.3618034 L15.1055728,11.5527864 C15.2023365,11.6011683 15.2807978,11.6796295 15.3291796,11.7763932 C15.4389526,11.9959392 15.3720486,12.2576361 15.1823574,12.3998148 L15.1055728,12.4472136 L10.7236068,14.6381966 C10.6541791,14.6729105 10.5776225,14.690983 10.5,14.690983 C10.2545401,14.690983 10.0503916,14.5141078 10.0080557,14.2808586 L10,14.190983 L10,9.80901699 C10,9.73139445 10.0180725,9.65483791 10.0527864,9.5854102 Z"})}),Title$1=title,Screen=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$1,Media,Pane:Pane$1,Title:Title$1},Symbol.toStringTag,{value:"Module"})),FirmwarePane=styled(CenterPane)`
  grid-column: span 2;
`,Container$a=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,HiddenInput=styled.input`
  display: none;
`,PointBadge=styled.div`
  position: absolute;
  background: rgb(220 53 69);
  padding: 5px;
  border-radius: 50%;
  right: 0;
  top: 0;
`,TextBadge=styled.span`
  position: absolute;
  top: 4px;
  display: inline-block;
  background: rgb(220 53 69);
  line-height: 1em;
  color: #fff;
  font-size: 12px;
  margin-left: 6px;
  padding: 2px;
  vertical-align: middle;
  border-radius: 5px;
`,Pane=()=>{const{t:e}=useTranslation(),r=useAppDispatch(),o=useAppSelector(getSavingState$1),i=useAppSelector(getBufferSize$1),a=useAppSelector(getBytesSended$1),d=useAppSelector(getSendSpeed$1),l=useAppSelector(getFirmwareNeedUpdate),p=useAppSelector(getSelectedDeviceFirmwareVersion),m=useAppSelector(getCfgFirmwareVersion),_=useAppSelector(getCfgFirmwareFile),[C,y]=reactExports.useState(null),[b,K]=reactExports.useState(),v=reactExports.useRef(null),j=()=>{var k;(k=v.current)==null||k.click()},w=async k=>{var G;if((G=k.target.files)!=null&&G[0]){const U=k.target.files[0],W=U.name,X=await U.arrayBuffer(),Z=new Uint8Array(X);K({name:W,byteArray:Z}),r(updateState$1("waiting"))}else K(null)},L=async()=>{if(!_||C)return;const k="/tabkb/firmwares/"+_,G=await fetch(k,{cache:"reload"});if(G.status!==200){console.log(k+": "+G.statusText);return}const U=await G.arrayBuffer(),W=new Uint8Array(U);y(W)},T=()=>{if(!C){r(updateState$1("failed"));return}r(saveTabFirmware$1(C))},P=()=>{b&&r(saveTabFirmware$1(b.byteArray))};return reactExports.useEffect(()=>{L()},[]),jsxRuntimeExports.jsx(FirmwarePane,{children:jsxRuntimeExports.jsxs(Container$a,{children:[p&&jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Current Version"),": v",p,l&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[", ",e("Update Available")," : v",m," ",jsxRuntimeExports.jsx(TextBadge,{children:"new"})]})]}),l&&jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:T,disabled:o==="saving",children:e("Update")})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Firmware"),"：",b==null?void 0:b.name]}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(AccentButton,{disabled:o==="saving",onClick:j,children:e("Open")}),jsxRuntimeExports.jsx(HiddenInput,{accept:".uf2",onChange:w,type:"file",ref:v})]})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(FlexLabel,{children:[o==="failed"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),e("Failed to flash.")]}),o==="completed"&&e("Flash successful.")," ",o==="saving"&&jsxRuntimeExports.jsx(SavingProgress,{bufferSize:i,sendSpeed:d,bytesSended:a})]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:P,disabled:!b||o==="saving",children:e("Flash")})})]}),jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsx(Label$1,{style:{fontSize:16},children:e("Please DO NOT disconnect or switch mode during the upgrade, until the keyboard auto-reboot finishes.")})})]})})},Icon=()=>{const e=useAppSelector(getFirmwareNeedUpdate);return jsxRuntimeExports.jsxs("div",{style:{position:"relative"},children:[e?jsxRuntimeExports.jsx(PointBadge,{}):null,jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faMicrochip})]})},Title="Firmware",Firmware=Object.freeze(Object.defineProperty({__proto__:null,Icon,Pane,Title},Symbol.toStringTag,{value:"Module"})),Container$9=styled.div`
  position: absolute;
  left: 15px;
  font-weight: 400;
  top: 10px;
`,Label=styled.label`
  font-size: 20px;
  text-transform: uppercase;
  color: var(--color_label-highlighted);
  margin-right: 6px;
`,LayerButton=styled.button`
  outline: none;
  font-variant-numeric: tabular-nums;
  border: none;
  background: ${e=>e.$selected?"var(--color_accent)":"transparent"};
  color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--color_label-highlighted)"};
  cursor: pointer;
  font-size: 20px;
  font-weight: 400;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"auto":"var(--bg_menu)"};
    color: ${e=>e.$selected?"auto":"var(--color_label-highlighted)"};
  }
`,LayerControl=()=>{const{t:e}=useTranslation(),r=useDispatch(),o=useAppSelector(getNumberOfLayers),i=useAppSelector(getSelectedLayerIndex),a=reactExports.useMemo(()=>new Array(o).fill(0).map((d,l)=>l).map(d=>jsxRuntimeExports.jsx(LayerButton,{$selected:d===i,onClick:()=>r(setLayer(d)),children:d},d)),[o,i]);return jsxRuntimeExports.jsxs(Container$9,{children:[jsxRuntimeExports.jsx(Label,{children:e("Layer")}),a]})},createRetry=(e,r)=>{const o={retriesLeft:e,timeoutWait:r};return{retry:l=>{o.retriesLeft=o.retriesLeft-1,o.retriesLeft<=0?console.error("Exhausted all retries"):(console.log(`Retrying after waiting ${o.timeoutWait}`),setTimeout(l,o.timeoutWait),o.timeoutWait=o.timeoutWait*2)},clear:()=>{console.log("Clearing retries back to:",e),o.retriesLeft=e,o.timeoutWait=r},retriesLeft:()=>o.retriesLeft>=1}},selectConnectedDeviceRetry=createRetry(8,100),selectConnectedDeviceByPath=e=>async(r,o)=>{await r(reloadConnectedDevices());const i=getConnectedDevices(o())[e];i&&r(selectConnectedDevice(i))},selectConnectedDevice=e=>async r=>{const o=extractDeviceInfo(e);try{r(selectDevice(e)),await r(loadMacros(e)),await r(loadLayoutOptions()),await r(loadMatrixLighintConfig()),await r(loadActuation());const{protocol:i}=e;try{i<11?await r(updateLightingData(e)):i>=11&&await r(updateV3MenuData(e))}catch{r(logAppError({message:"Loading lighting/menu data failed",deviceInfo:o}))}await r(loadKeymapFromDevice(e)),selectConnectedDeviceRetry.clear()}catch(i){selectConnectedDeviceRetry.retriesLeft()?(r(logAppError({message:"Loading device failed - retrying",deviceInfo:o})),selectConnectedDeviceRetry.retry(()=>{r(selectConnectedDevice(e))})):(r(logAppError({message:"All retries failed for attempting connection with device",deviceInfo:o})),console.log("Hard resetting device store:",i),r(clearAllDevices()))}},reloadConnectedDevices=()=>async(e,r)=>{const o=r(),i=getSelectedDevicePath(o),a=getForceAuthorize(o),d=getSupportedIds(o),l=await getRecognisedDevices(d,a),p=await Promise.all(l.map(v=>new KeyboardAPI(v.path).getProtocolVersion())),m=await Promise.all(l.map(v=>new KeyboardAPI(v.path).getFirmwareVersion())),_=l.filter((v,j)=>p[j]===-1);_.length&&_.forEach(v=>{const j=extractDeviceInfo(v);e(logAppError({message:"Received invalid protocol version from device",deviceInfo:j}))});const C=l.filter((v,j)=>p[j]!==-1).map((v,j)=>{const{path:w,productId:L,vendorId:T,productName:P}=v,k=p[j],G=m[j];return{path:w,productId:L,vendorId:T,protocol:k,firmware:G,productName:P,hasResolvedDefinition:!1,requiredDefinitionVersion:k>=11?"v3":"v2",vendorProductId:getVendorProductId(v.vendorId,v.productId)}});await e(reloadDefinitions(C));const y=getDefinitions(r()),b=C.filter((v,j)=>isAuthorizedDeviceConnected(v,y)).reduce((v,j,w)=>(v[j.path]={...j,hasResolvedDefinition:!0},v),{});C.filter(v=>!isAuthorizedDeviceConnected(v,y)).forEach(tryForgetDevice);const K=Object.entries(b);if(K.forEach(([v,j])=>{console.info("Setting connected device:",j.protocol,v,j)}),e(updateConnectedDevices(b)),(!i||!b[i])&&K.length>0){const v=K[0][1];e(selectConnectedDevice(v))}else K.length===0&&e(selectDevice(null))},loadSupportedIds=()=>async e=>{e(updateSupportedIds(getSupportedIdsFromStore())),await e(loadTabkbIds()),await e(updateDefinitions(getDefinitionsFromStore())),e(loadStoredCustomDefinitions()),e(reloadConnectedDevices())},isElectron=/Electron/.test(navigator.userAgent),Container$8=styled.div`
  position: absolute;
  right: 15px;
  top: 0px;
  font-size: 18px;
  pointer-events: none;
  font-weight: 400;
`,KeyboardTitle=styled.label`
  pointer-events: all;
  display: inline-block;
  background: var(--color_accent);
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  font-size: 18px;
  text-transform: uppercase;
  color: var(--color_inside-accent);
  padding: 1px 10px;
  margin-right: 10px;
  border: solid 1px var(--bg_control);
  border-top: none;
  cursor: pointer;
  transition: all 0.1s ease-out;
  &:hover {
    filter: brightness(0.7);
  }
`,KeyboardList=styled.ul`
  padding: 0;
  border: 1px solid var(--bg_control);
  width: 160px;
  border-radius: 6px;
  background-color: var(--bg_menu);
  margin: 0;
  margin-top: 5px;
  right: 10px;
  position: absolute;
  pointer-events: ${e=>e.$show?"all":"none"};
  transition: all 0.2s ease-out;
  z-index: 11;
  opacity: ${e=>e.$show?1:0};
  overflow: hidden;
  transform: ${e=>e.$show?0:"translateY(-5px)"};
`,KeyboardButton=styled.button`
  display: block;
  text-align: center;
  outline: none;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  border: none;
  background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"transparent"};
  color: ${e=>e.$selected?"var(--color_icon_highlighted)":"var(--color_label-highlighted)"};
  cursor: pointer;
  text-align: left;
  font-size: 14px;
  text-transform: uppercase;
  padding: 5px 10px;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"var(--bg_control)"};
    color: ${e=>e.$selected?"var(--color_control-highlighted)":"var(--color_label-highlighted)"};
  }
`,ClickCover$1=styled.div`
  position: fixed;
  z-index: 10;
  pointer-events: all;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.4;
  background: rgba(0, 0, 0, 0.75);
`,KeyboardSelectors=e=>{const{t:r}=useTranslation(),o=async()=>{const i=await HID.requestDevice();i&&e.selectKeyboard(i.__path)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[e.show&&jsxRuntimeExports.jsx(ClickCover$1,{onClick:e.onClickOut}),jsxRuntimeExports.jsxs(KeyboardList,{$show:e.show,children:[e.keyboards.map(([i,a])=>jsxRuntimeExports.jsx(KeyboardButton,{$selected:i===e.selectedPath,onClick:()=>e.selectKeyboard(i),children:a.name},i)),!isElectron&&jsxRuntimeExports.jsxs(KeyboardButton,{onClick:o,children:[r("Authorize New"),jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faPlus,style:{marginLeft:"10px"}})]})]})]})},Badge=()=>{const e=useAppDispatch(),r=useAppSelector(getDefinitions),o=useAppSelector(getSelectedDefinition),i=useAppSelector(getConnectedDevices),a=useAppSelector(getSelectedDevicePath),[d,l]=reactExports.useState(!1),p=reactExports.useMemo(()=>Object.entries(i).map(([m,_])=>[m,r[_.vendorProductId]&&r[_.vendorProductId][_.requiredDefinitionVersion]]).filter(m=>m[1]),[i,r]);return!o||!a?null:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(Container$8,{children:[jsxRuntimeExports.jsxs(KeyboardTitle,{onClick:()=>l(!d),children:[o.name,jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faAngleDown,style:{transform:d?"rotate(180deg)":"",transition:"transform 0.2s ease-out",marginLeft:"5px"}})]}),jsxRuntimeExports.jsx(KeyboardSelectors,{show:d,selectedPath:a,keyboards:p,onClickOut:()=>l(!1),selectKeyboard:m=>{e(selectConnectedDeviceByPath(m)),l(!1)}})]})})},MenuContainer=styled.div`
  padding: 15px 10px 20px 10px;
`;[...makeCustomMenus([])];function getCustomPanes(e){return e.find(r=>r===distExports.CustomFeaturesV2.RotaryEncoder)?[RotaryEncoder]:[]}const getRowsForKeyboard=()=>{const e=useAppSelector(getIsMacroFeatureSupported),r=useAppSelector(getV3MenuComponents),o=useAppSelector(getSelectedDefinition),i=useAppSelector(getNumberOfLayers),a=useAppSelector(getSelectedTabkbConfig);return o?distExports.isVIADefinitionV2(o)?getRowsForKeyboardV2(o,e,i):distExports.isVIADefinitionV3(o)?[...filterInferredRows(o,e,i,[Keycode$2,Layouts$1,Macros,SaveLoad]),...r,...filterTabRows(a,[Actuation,MatrixLighting,Screen,Firmware])]:[]:[]},filterTabRows=(e,r)=>{if(!e)return[];let o=[];return e.screen||(o=[...o,Screen]),e.actuation||(o=[...o,Actuation]),e.matrixLighting||(o=[...o,MatrixLighting]),e.firmware||(o=[...o,Firmware]),r.filter(i=>!o.includes(i))},filterInferredRows=(e,r,o,i)=>{const{layouts:a}=e;let d=[];return a.optionKeys&&Object.entries(a.optionKeys).length!==0||(d=[...d,Layouts$1]),o===0&&(d=[...d,Keycode$2,SaveLoad]),r||(d=[...d,Macros]),i.filter(p=>!d.includes(p))},getRowsForKeyboardV2=(e,r,o)=>{let i=[Keycode$2,Layouts$1,Macros,SaveLoad];if(distExports.isVIADefinitionV2(e)){const{lighting:a,customFeatures:d}=e,{supportedLightingValues:l}=distExports.getLightingDefinition(a);l.length!==0&&(i=[...i,Lighting$1]),d&&(i=[...i,...getCustomPanes(d)])}return filterInferredRows(e,r,o,i)},Loader=e=>{const{t:r}=useTranslation(),{loadProgress:o,selectedDefinition:i}=e,a=useAppDispatch(),d=useAppSelector(getSelectedTheme),l=useAppSelector(getConnectedDevices),p=useAppSelector(getSupportedIds),m=!Object.values(p).length,_=!Object.values(l).length,[C,y]=reactExports.useState(!1);return reactExports.useEffect(()=>{const b=setTimeout(()=>{i||y(!0)},3e3);return()=>clearTimeout(b)},[i]),jsxRuntimeExports.jsxs(LoaderPane,{children:[jsxRuntimeExports.jsx(ChippyLoader,{theme:d,progress:o||null}),(C||_)&&!m&&!isElectron?jsxRuntimeExports.jsxs(AccentButtonLarge,{onClick:()=>a(reloadConnectedDevices()),children:[r("Authorize device"),jsxRuntimeExports.jsx(FontAwesomeIcon,{style:{marginLeft:"10px"},icon:faPlus})]}):jsxRuntimeExports.jsx(LoadingText$1,{isSearching:!i})]})},LoaderPane=styled(CenterPane)`
  display: flex;
  align-items: center;
  justify-content: center;
  row-gap: 50px;
  position: absolute;
  bottom: 50px;
  top: 50px;
  left: 0;
  right: 0;
  z-index: 4;
`,ConfigurePane=()=>{const e=useAppSelector(getSelectedDefinition),r=useAppSelector(getLoadProgress),o=useAppSelector(getRenderMode);return!e||r!==1?o==="2D"?jsxRuntimeExports.jsx(Loader,{selectedDefinition:e||null,loadProgress:r}):null:jsxRuntimeExports.jsx(ConfigureBasePane,{children:jsxRuntimeExports.jsx(ConfigureGrid,{})})},ConfigureGrid=()=>{var m,_;const{t:e}=useTranslation(),r=useDispatch(),[o,i]=reactExports.useState(0),a=getRowsForKeyboard(),d=(m=a[o])==null?void 0:m.Pane,l=(_=a[o])==null?void 0:_.Title,p=useAppSelector(getShowLayerControl);return reactExports.useEffect(()=>(l==="Keymap"&&r(setConfigureKeyboardIsSelectable(!0)),r(updateSelectedRowTitle(l)),()=>{r(setConfigureKeyboardIsSelectable(!1))}),[l]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ConfigureFlexCell,{onClick:C=>{C.target.nodeName!=="CANVAS"&&r(clearSelectedKey())},style:{pointerEvents:"none",position:"absolute",top:50,left:0,right:0},children:jsxRuntimeExports.jsxs("div",{style:{pointerEvents:"all"},children:[p&&jsxRuntimeExports.jsx(LayerControl,{}),jsxRuntimeExports.jsx(Badge,{})]})}),jsxRuntimeExports.jsxs(Grid,{style:{pointerEvents:"none"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all"},children:jsxRuntimeExports.jsx(MenuContainer,{children:(a||[]).map(({Icon:C,Title:y},b)=>jsxRuntimeExports.jsx(Row$1,{onClick:K=>i(b),$selected:o===b,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(C,{}),jsxRuntimeExports.jsx(MenuTooltip,{children:e(y)})]})},b))})}),d&&jsxRuntimeExports.jsx(d,{})]})]})};function Layouts({definition:e,onLayoutChange:r,RowComponent:o=IndentedControlRow}){const i=useAppSelector(getDesignSelectedOptionKeys),a=useDispatch();if(React.useEffect(()=>{a(updateSelectedOptionKeys([]))},[e]),React.useEffect(()=>{r(i)},[i]),!e.layouts.labels)return null;const d=e.layouts.labels.map((l,p)=>{const m=e.layouts.optionKeys[p];if(Array.isArray(l)){const _=l[0],C=l.slice(1),y=C.map((b,K)=>({label:b,value:m[K]}));return jsxRuntimeExports.jsxs(o,{children:[jsxRuntimeExports.jsx(Label$1,{children:_}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:b=>{if(b&&b.label){const K=C.indexOf(b.label),v=Array.from(i).map(j=>j||0);v[p]=K,a(updateSelectedOptionKeys(v))}},value:i[p]?y[i[p]]:y[0],options:y})})]},`${p}-${_}`)}return typeof l=="string"?jsxRuntimeExports.jsxs(o,{children:[jsxRuntimeExports.jsx(Label$1,{children:l}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!i[p],onChange:_=>{const C=Array.from(i).map(y=>y||0);C[p]=Number(_),a(updateSelectedOptionKeys(C))}})})]},`${p}-${l}`):null});return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:d})}const Container$7=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,ControlGroup=styled.div`
  margin-bottom: 0.75rem;
  padding-bottom: 0.75rem;
  width: 100%;

  &:last-child {
    padding-bottom: 0;
  }
`,ControlGroupHeader=styled.div`
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0;
  margin-bottom: 0.5rem;
`,TestControls=()=>{const[e,r]=reactExports.useState(!0),[o,i]=reactExports.useState(0),[a,d]=reactExports.useState([0,0]),[l,p]=reactExports.useState(0),[m,_]=reactExports.useState(0),{basicKeyToByte:C,byteToKey:y}=useAppSelector(getBasicKeyToByte),b=useAppSelector(getSelected256PaletteColor),K=useDispatch(),v=[{label:"Option 1",value:"0"},{label:"Option 2",value:"1"}];return jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Controls"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Button"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{children:"Click"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Disabled Button"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{disabled:!0,children:"Disabled"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Text Input"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(TextInput,{})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[m," / ",anyKeycodeToString(m,C,y)]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:m,setValue:_,meta:{}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[a[0],", ",a[1]]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ArrayColorPicker,{color:a,setColor:(j,w)=>d([j,w])})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[b[0],", ",b[1]]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ColorPalettePicker,{color:b,setColor:(j,w)=>K(setSelectedPaletteColor([j,w]))})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:o}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:100,min:0,defaultValue:o,onChange:i})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:+e}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:e,onChange:r})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:+l}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:v[l],options:v,onChange:j=>{j&&p(+j.value)}})})]}),jsxRuntimeExports.jsx(MacroRecorder,{selectedMacro:[[RawKeycodeSequenceAction.Delay,4]],setUnsavedMacro:j=>j,undoMacro:()=>null,saveMacro:()=>null,isDelaySupported:!0}),jsxRuntimeExports.jsx(MacroRecorder,{setUnsavedMacro:j=>j,undoMacro:()=>null,saveMacro:()=>null,isDelaySupported:!0})]})},Debug=()=>{const e=useAppSelector(getSelectedKeyboardAPI),r=useAppSelector(getConnectedDevices),o=Object.entries(useAppSelector(getDefinitions)).flatMap(([j,w])=>[[j,w.v2],[j,w.v3]]).filter(([j,w])=>w!==void 0),i=Object.entries(useAppSelector(getBaseDefinitions)).flatMap(([j,w])=>[[j,w.v2],[j,w.v3]]).filter(([j,w])=>w!==void 0),a=Object.entries(useAppSelector(getCustomDefinitions)).flatMap(([j,w])=>[[j,w.v2],[j,w.v3]]).filter(([j,w])=>w!==void 0),[d,l]=reactExports.useState(0),[p,m]=reactExports.useState([]),[_,C]=reactExports.useState(0),[y,b]=reactExports.useState(!1),K=o.map(([,j],w)=>({label:j.name,value:`${w}`})),v=o[d];return jsxRuntimeExports.jsx(Pane$e,{children:jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsxs(Container$7,{children:[jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Key Testing"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Show Matrix"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:y,onChange:j=>b(j)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Set next key"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>{const{keys:j,optionKeys:w}=v[1].layouts,L=w?Object.entries(w).flatMap(([P,k])=>k[0]):[],T=[...j,...L];_!==void 0&&C(getNextKey(_,T)||0)},children:"Next"})})]})]}),K&&jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Layout Testing"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Dummy Keyboard"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:j=>j&&l(+j.value),defaultValue:K[0],options:K})})]})]}),v&&jsxRuntimeExports.jsx(Layouts,{definition:v[1],onLayoutChange:j=>{m(j)}}),e&&jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Connected Device Debugging"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"EEPROM Reset"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.resetEEPROM(),children:"Reset"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Bootloader Jump"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.jumpToBootloader(),children:"Jump"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Clear all macros"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.resetMacros(),children:"Clear"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Benchmark Switch State Query Speed"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:async()=>{const j=performance.now();await Array(1e3).fill(0).map(w=>e.getKeyboardValue(KeyboardValue.SWITCH_MATRIX_STATE,[],20)),console.info("1000 commands in ",performance.now()-j,"ms")},children:"Benchmark"})})]})]}),jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Device IDs"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Connected Devices"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(r).length," Devices"]})]}),Object.values(r).map(j=>{const w=o.find(([L])=>L===j.vendorProductId.toString());return w?jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:w[1].name}),jsxRuntimeExports.jsxs(Detail,{children:["0x",j.vendorProductId.toString(16).toUpperCase()]})]},j.path):null}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Local definitions"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(a).length," Definitions"]})]}),Object.values(a).map(([j,w],L)=>jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:w.name}),jsxRuntimeExports.jsxs(Detail,{children:["0x",parseInt(j).toString(16).toUpperCase()]})]},L)),jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsxs("details",{children:[jsxRuntimeExports.jsxs("summary",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Remote definitions"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(i).length," Definitions"]})]}),Object.values(i).map(([j,w],L)=>jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:w.name}),jsxRuntimeExports.jsxs(Detail,{children:["0x",parseInt(j).toString(16).toUpperCase()]})]},L))]})})]}),jsxRuntimeExports.jsx(TestControls,{})]})})})},MessageDialogContainer=styled.dialog`
  padding: 0;
  border-width: 0;

  background: transparent;
  &::backdrop {
    background: rgba(0, 0, 0, 0.75);
  }

  & > div {
    transition: transform 0.2s ease-out;
    transform: translateY(-20px);
  }

  &[open] > div {
    transform: translateY(0px);
  }
`,Controls=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
`,MessageDialog=e=>{const r=reactExports.useRef(null),o=reactExports.useCallback(()=>{r.current&&r.current.close(),e.onClose&&e.onClose()},[r.current,e.onClose]);return reactExports.useEffect(()=>(r.current&&(e.isOpen?r.current.showModal():r.current.close()),()=>{o()}),[e.isOpen]),jsxRuntimeExports.jsx(MessageDialogContainer,{ref:r,children:jsxRuntimeExports.jsxs(ModalContainer,{children:[jsxRuntimeExports.jsx(PromptText,{children:e.children}),jsxRuntimeExports.jsx(Controls,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:o,children:"Confirm"})})]})})};let designWarningSeen=Number(localStorage.getItem("designWarningSeen")||0),hideDesignWarning=sessionStorage.getItem("hideDesignWarning")||designWarningSeen>4;const DesignErrorMessage=styled(ErrorMessage)`
  margin: 0;
  font-style: italic;
`,Container$6=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,DesignPane=styled(Pane$e)`
  display: grid;
  max-width: 100vw;
  grid-template-columns: 100vw;
  grid-template-rows: min-content;
`,UploadIcon=styled.div`
  height: 200px;
  width: 50%;
  cursor: pointer;
  max-width: 560px;
  border-radius: 6px;
  margin: 50px 10px;
  animation-duration: 1.5s;
  animation-name: border-glow;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  svg {
    color: transparent;
    stroke-width: 8px;
    animation-duration: 1.5s;
    animation-name: text-glow;
    animation-iteration-count: infinite;
    animation-direction: alternate;
    animation-timing-function: ease-in-out;
    font-size: 100px;
  }
`,makeReaderPromise=e=>new Promise((r,o)=>{const i=new FileReader;i.onload=()=>{if(!i.result)return o();r([e.name,i.result.toString()])},i.onerror=o,i.onabort=o,i.readAsBinaryString(e)}),isVIADefinition=e=>distExports.isVIADefinitionV2(e)||distExports.isVIADefinitionV3(e);function importDefinitions(e,r,o,i){Promise.all(e.map(makeReaderPromise)).then(a=>{let d=[];i([]);const l=a.map(([p,m])=>{if(d.length>0)return null;try{const _=JSON.parse(m.toString());if(r==="v2"?distExports.isKeyboardDefinitionV2(_)||distExports.isVIADefinitionV2(_):distExports.isKeyboardDefinitionV3(_)||distExports.isVIADefinitionV3(_))return r==="v2"?distExports.isVIADefinitionV2(_)?_:distExports.keyboardDefinitionV2ToVIADefinitionV2(_):distExports.isVIADefinitionV3(_)?_:distExports.keyboardDefinitionV3ToVIADefinitionV3(_);d=(r==="v2"?distExports.isKeyboardDefinitionV2.errors||distExports.isVIADefinitionV2.errors||[]:distExports.isKeyboardDefinitionV3.errors||distExports.isVIADefinitionV3.errors||[]).map(y=>`${p} ${y.dataPath?y.dataPath+": ":"Object: "}${y.message}`)}catch(_){_.name?d.push(`${_.name}: ${_.message}`):d.push(`${_}`)}}).filter(isVIADefinition);d.length?i(d):(o(loadCustomDefinitions({definitions:l,version:r})),o(storeCustomDefinitions({definitions:l,version:r})),o(ensureSupportedIds({productIds:l.map(p=>p.vendorProductId),version:r})),o(selectDevice(null)),o(reloadConnectedDevices()))})}function onDrop(e,r,o,i){e.preventDefault();const{dataTransfer:a}=e;if(a!=null&&a.items){const d=Array.from(a.items).filter(l=>l.kind==="file"&&l.type==="application/json").map(l=>l.getAsFile()).filter(l=>l!==null);d.length&&importDefinitions(d,r,o,i)}}const DesignTab=()=>{const{t:e}=useTranslation(),r=useDispatch(),o=Object.values(useAppSelector(getCustomDefinitions)),i=useAppSelector(getDesignDefinitionVersion),a=useAppSelector(getSelectedDefinitionIndex),d=useAppSelector(getShowMatrix),[l,p]=reactExports.useState([]),m=reactExports.useMemo(()=>o.filter(K=>K[i]),[o,i]),_=m.map((K,v)=>({label:K[i].name,value:v.toString()})),C=reactExports.useRef(null),y=m[a]&&m[a][i],b=reactExports.useRef();return jsxRuntimeExports.jsxs(DesignPane,{onDragOver:K=>{K.dataTransfer.effectAllowed="copyMove",K.dataTransfer.dropEffect="none",K.preventDefault(),K.stopPropagation()},children:[jsxRuntimeExports.jsx(MessageDialog,{isOpen:!hideDesignWarning,onClose:()=>{sessionStorage.setItem("hideDesignWarning","1"),hideDesignWarning="1",designWarningSeen=designWarningSeen+1,localStorage.setItem("designWarningSeen",`${designWarningSeen}`)},children:"This feature is intended for development purposes. If your keyboard is not recognized automatically by VIA, please contact your keyboard's manufacturer or vendor."}),jsxRuntimeExports.jsx(SinglePaneFlexCell,{ref:C,children:!y&&jsxRuntimeExports.jsx(UploadIcon,{onClick:()=>{b.current&&b.current.click()},onDrop:K=>onDrop(K,i,r,p),onDragOver:K=>{K.dataTransfer.effectAllowed="copyMove",K.dataTransfer.dropEffect="copy",K.preventDefault(),K.stopPropagation()},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faUpload})})}),jsxRuntimeExports.jsxs(Grid,{style:{overflow:"hidden"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all"},children:jsxRuntimeExports.jsx(MenuContainer$8,{children:jsxRuntimeExports.jsx(Row$1,{$selected:!0,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faBook}),jsxRuntimeExports.jsx(MenuTooltip,{children:e("Add Definition")})]})})})}),jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsxs(Container$6,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Load Draft Definition")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentUploadButton,{multiple:!0,inputRef:b,onLoad:K=>{importDefinitions(Array.from(K),i,r,p)},children:e("Load")})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Use V2 definitions (deprecated)")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:i==="v2",onChange:K=>r(updateDesignDefinitionVersion(K?"v2":"v3"))})})]}),y&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Shown Keyboard Definition")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:K=>{r(updateSelectedOptionKeys([])),K&&r(updateSelectedDefinitionIndex(+K.value))},value:_[a],options:_})})]})}),y&&jsxRuntimeExports.jsx(Layouts,{definition:y,onLayoutChange:K=>{r(updateSelectedOptionKeys(K))}}),y&&jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Show Matrix")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:d,onChange:K=>{r(updateShowMatrix(K))}})})]}),l.map(K=>jsxRuntimeExports.jsx(IndentedControlRow,{children:jsxRuntimeExports.jsx(DesignErrorMessage,{children:K})})),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Draft Definitions")}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(m).length," ",e("Definitions")]})]}),m.map(K=>jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:K[i].name}),jsxRuntimeExports.jsxs(Detail,{children:[formatNumberAsHex(K[i].vendorProductId,8),jsxRuntimeExports.jsx(IconButtonUnfilledContainer,{onClick:()=>{r(unloadCustomDefinition({id:K[i].vendorProductId,version:i}))},style:{marginLeft:10,borderRadius:4},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faXmark,size:"lg"})})]})]},`${i}-${K[i].vendorProductId}`))]})})]})]})},Container$5=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,DiagnosticContainer=styled(Container$5)`
  margin-top: 20px;
  padding-top: 20px;
`,SettingsErrorMessage=styled(ErrorMessage)`
  margin: 0;
  font-style: italic;
`,Settings=()=>{const{t:e}=useTranslation(),r=useDispatch(),o=useAppSelector(getShowDesignTab),i=useAppSelector(getDisableFastRemap),a=useAppSelector(getThemeMode),d=useAppSelector(getThemeName),l=useAppSelector(getRenderMode),p=useAppSelector(getSelectedConnectedDevice),[m,_]=reactExports.useState(!1),C=Object.keys(THEMES).map(v=>({label:v.replaceAll("_"," "),value:v})),y=C.find(v=>v.value===d),b=webGLIsAvailable?[{label:"2D",value:"2D"},{label:"3D",value:"3D"}]:[{label:"2D",value:"2D"}],K=b.find(v=>v.value===l);return jsxRuntimeExports.jsx(Pane$e,{children:jsxRuntimeExports.jsxs(Grid,{style:{overflow:"hidden"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all",borderTop:"none"},children:jsxRuntimeExports.jsx(MenuContainer$8,{children:jsxRuntimeExports.jsx(Row$1,{$selected:!0,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faToolbox}),jsxRuntimeExports.jsx(MenuTooltip,{children:e("General")})]})})})}),jsxRuntimeExports.jsxs(SpanOverflowCell,{style:{flex:1,borderWidth:0},children:[jsxRuntimeExports.jsxs(Container$5,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Show Design tab")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>r(toggleCreatorMode()),isChecked:o})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Fast Key Mapping")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>r(toggleFastRemap()),isChecked:!i})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Light Mode")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>r(toggleThemeMode()),isChecked:a==="light"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Keycap Theme")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:y,options:C,onChange:v=>{v&&r(updateThemeName(v.value))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Render Mode")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:K,options:b,onChange:v=>{v&&r(updateRenderMode(v.value))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Show Diagnostic Information")}),jsxRuntimeExports.jsx(Detail,{children:p?jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>_(!m),isChecked:m}):jsxRuntimeExports.jsx(SettingsErrorMessage,{children:e("Requires connected device")})})]})]}),m&&p?jsxRuntimeExports.jsxs(DiagnosticContainer,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("VIA Firmware Protocol")}),jsxRuntimeExports.jsx(Detail,{children:p.protocol})]}),!!p.firmware&&jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("VIA Firmware Version")}),jsxRuntimeExports.jsxs(Detail,{children:["0x",p.firmware.toString()]})]})]}):null]})]})})},name="Tester",lighting="none",layouts={width:22.5,height:6.25,optionKeys:{},keys:[{row:0,col:0,x:0,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"accent"},{row:0,col:1,x:2,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:2,x:3,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:3,x:4,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:4,x:5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:5,x:6.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:6,x:7.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:7,x:8.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:8,x:9.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:9,x:11,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:10,x:12,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:11,x:13,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:12,x:14,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:13,x:15.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:14,x:16.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:15,x:17.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:16,x:18.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:17,x:19.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:18,x:20.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:19,x:21.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:20,x:0,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:21,x:1,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:22,x:2,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:23,x:3,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:24,x:4,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:25,x:5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:26,x:6,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:27,x:7,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:28,x:8,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:29,x:9,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:30,x:10,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:31,x:11,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:32,x:12,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:33,x:13,y:1.25,r:0,rx:0,ry:0,h:1,w:2,color:"mod"},{row:0,col:34,x:15.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:35,x:16.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:36,x:17.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:37,x:18.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:38,x:19.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:39,x:20.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:40,x:21.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:41,x:0,y:2.25,r:0,rx:0,ry:0,h:1,w:1.5,color:"mod"},{row:0,col:42,x:1.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:43,x:2.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:44,x:3.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:45,x:4.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:46,x:5.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:47,x:6.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:48,x:7.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:49,x:8.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:50,x:9.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:51,x:10.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:52,x:11.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:53,x:12.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:54,x:13.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1.5,color:"alpha"},{row:0,col:55,x:15.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:56,x:16.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:57,x:17.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:58,x:18.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:59,x:19.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:60,x:20.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:61,x:21.5,y:2.25,r:0,rx:0,ry:0,h:2,w:1,color:"mod"},{row:0,col:62,x:0,y:3.25,r:0,rx:0,ry:0,h:1,w:1.75,color:"mod"},{row:0,col:63,x:1.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:64,x:2.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:65,x:3.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:66,x:4.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:67,x:5.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:68,x:6.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:69,x:7.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:70,x:8.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:71,x:9.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:72,x:10.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:73,x:11.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:74,x:12.75,y:3.25,r:0,rx:0,ry:0,h:1,w:2.25,color:"accent"},{row:0,col:75,x:18.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:76,x:19.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:77,x:20.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:78,x:0,y:4.25,r:0,rx:0,ry:0,h:1,w:2.25,color:"mod"},{row:0,col:79,x:2.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:80,x:3.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:81,x:4.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:82,x:5.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:83,x:6.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:84,x:7.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:85,x:8.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:86,x:9.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:87,x:10.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:88,x:11.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:89,x:12.25,y:4.25,r:0,rx:0,ry:0,h:1,w:2.75,color:"mod"},{row:0,col:90,x:16.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:91,x:18.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:92,x:19.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:93,x:20.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:94,x:21.5,y:4.25,r:0,rx:0,ry:0,h:2,w:1,color:"accent"},{row:0,col:95,x:0,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:96,x:1.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:97,x:2.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:98,x:3.75,y:5.25,r:0,rx:0,ry:0,h:1,w:6.25,color:"alpha"},{row:0,col:99,x:10,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:100,x:11.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:101,x:12.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:102,x:13.75,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:103,x:15.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:104,x:16.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:105,x:17.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:106,x:18.5,y:5.25,r:0,rx:0,ry:0,h:1,w:2,color:"alpha"},{row:0,col:107,x:20.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"}]},matrix={rows:1,cols:108},vendorProductId=0,fullKeyboardDefinition={name,lighting,layouts,matrix,vendorProductId},Container$4=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,TestPane=styled(Pane$e)`
  display: flex;
  height: 100%;
  max-width: 100vw;
  flex-direction: column;
`,TestContext=React.createContext([{clearTestKeys:()=>{}},(...e)=>{}]),Test$1=()=>{const{t:e}=useTranslation(),r=useDispatch(),o=useAppSelector(getSelectedConnectedDevice),i=useAppSelector(getSelectedDefinition),a=useAppSelector(getSelectedKeyDefinitions),d=useAppSelector(getIsTestMatrixEnabled),l=useAppSelector(getTestKeyboardSoundsSettings),[p]=reactExports.useContext(TestContext),{progress:m}=useProgress(),C=o&&i&&a&&PROTOCOL_GAMMA<=o.protocol,y=d?i:fullKeyboardDefinition;if(!y||typeof y=="string")return null;const b=[{label:"Sine",value:"sine"},{label:"Triangle",value:"triangle"},{label:"Sawtooth",value:"sawtooth"},{label:"Square",value:"square"}],K=b.find(w=>w.value===l.waveform),v=[{label:"Wicki-Hayden",value:TestKeyboardSoundsMode.WickiHayden},{label:"Chromatic",value:TestKeyboardSoundsMode.Chromatic},{label:"Random",value:TestKeyboardSoundsMode.Random}],j=v.find(w=>w.value===l.mode);return m!==100?null:jsxRuntimeExports.jsx(TestPane,{children:jsxRuntimeExports.jsxs(Grid,{children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all"},children:jsxRuntimeExports.jsx(MenuContainer$8,{children:jsxRuntimeExports.jsx(Row$1,{$selected:!0,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faCircleQuestion}),jsxRuntimeExports.jsx(MenuTooltip,{children:e("Check Key")})]})})})}),jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsxs(Container$4,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Reset Keyboard")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:p.clearTestKeys,children:e("Reset")})})]}),C&&i?jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Test Matrix")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:d,onChange:w=>{r(setTestMatrixEnabled(w)),p.clearTestKeys()}})})]}):null,jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Key Sounds")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:l.isEnabled,onChange:w=>{r(setTestKeyboardSoundsSettings({isEnabled:w}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Volume")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:100,min:0,defaultValue:l.volume,onChange:w=>{r(setTestKeyboardSoundsSettings({volume:w}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Transpose")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:24,min:-24,defaultValue:l.transpose,onChange:w=>{r(setTestKeyboardSoundsSettings({transpose:w}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Waveform")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{isSearchable:!1,defaultValue:K,options:b,onChange:w=>{w&&r(setTestKeyboardSoundsSettings({waveform:w.value}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:e("Mode")}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{isSearchable:!1,defaultValue:j,options:v,onChange:w=>{w&&r(setTestKeyboardSoundsSettings({mode:w.value}))}})})]})]})})]})})},Container$3=styled.div`
  display: flex;
  flex-direction: column;
  padding: 16px;
  user-select: text;
  border-top: 1px solid var(--color_accent);
  &:last-of-type {
    border-bottom: 1px solid var(--color_accent);
  }
`,printId=e=>formatNumberAsHex(e,4),ErrorListContainer=e=>{const{t:r}=useTranslation(),{clear:o,save:i,hasErrors:a}=e;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(IconButtonGroupContainer,{style:{margin:"10px 15px"},children:[jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:o,disabled:!a,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faCancel}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:r("Clear")})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:i,disabled:!a,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faDownload}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:r("Download")})]})]}),e.children]})},AppErrors=({})=>{const e=useAppSelector(getAppErrors),r=useDispatch();return jsxRuntimeExports.jsx(ErrorListContainer,{clear:()=>r(clearAppErrors()),save:()=>saveAppErrors(e),hasErrors:!!e.length,children:e.map(({timestamp:o,deviceInfo:{productId:i,productName:a,vendorId:d},message:l})=>jsxRuntimeExports.jsxs(Container$3,{children:[o,jsxRuntimeExports.jsx("ul",{children:l==null?void 0:l.split(`
`).map(p=>jsxRuntimeExports.jsx("li",{children:p}))}),jsxRuntimeExports.jsxs("ul",{children:[jsxRuntimeExports.jsxs("li",{children:["Device: ",a]}),jsxRuntimeExports.jsxs("li",{children:["Vid: ",printId(d)]}),jsxRuntimeExports.jsxs("li",{children:["Pid: ",printId(i)]})]})]},o))})};async function saveErrors(e,r,o,i){try{const a=await window.showSaveFilePicker({suggestedName:`${o}.csv`}),d=[r.join(", ")],l=e.map(i),p=d.concat(...l).join(`
`),m=new Blob([p],{type:"text/csv"}),_=await a.createWritable();await _.write(m),await _.close()}catch{console.log("User cancelled save errors request")}}const saveAppErrors=async e=>saveErrors(e,["timestamp","productName","vendorId","productId","message"],"VIA-app-errors",({timestamp:r,deviceInfo:{productName:o,vendorId:i,productId:a},message:d})=>`${r}, ${o}, ${printId(i)}, ${printId(a)}, "${d}"`),IconButtonGroupContainer=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,ErrorPanes=[[1,AppErrors,faComputer,"App"]],Errors=()=>{const[e,r]=reactExports.useState(0),o=(ErrorPanes.find(([i])=>e===i)||ErrorPanes[0])[1];return jsxRuntimeExports.jsx(Pane$e,{children:jsxRuntimeExports.jsxs(Grid,{style:{overflow:"hidden"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all",borderTop:"none"},children:jsxRuntimeExports.jsx(MenuContainer$8,{children:ErrorPanes.map(([i,a,d,l])=>jsxRuntimeExports.jsx(Row$1,{$selected:e===i,onClick:()=>{r(i)},children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:d}),jsxRuntimeExports.jsx(MenuTooltip,{children:l})]})},i))})}),jsxRuntimeExports.jsx(SpanOverflowCell,{style:{flex:1,borderWidth:0},children:jsxRuntimeExports.jsx(o,{})})]})})},ErrorLink=()=>{const e=useAppSelector(getAppErrors),[r]=useLocation(),o=r==="/errors";return e.length?jsxRuntimeExports.jsx(Link$1,{to:"/errors",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{$selected:o,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:ErrorsPaneConfig.icon,color:o?"inherit":"gold"}),jsxRuntimeExports.jsxs(CategoryMenuTooltip,{children:[e.length," error",e.length>1?"s":""]})]})}):null},ErrorsPaneConfig={component:Errors,path:"/errors",icon:faWarning,key:"errors",title:"Errors"},Container$2=styled.div`
  padding-top: 20px;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
`,Boot=()=>{const{t:e}=useTranslation(),r=useAppDispatch(),o=useAppSelector(getSavingState),i=useAppSelector(getBufferSize),a=useAppSelector(getBytesSended),d=useAppSelector(getSendSpeed),l=reactExports.useRef(null),[p,m]=reactExports.useState(),_=()=>{var b;(b=l.current)==null||b.click()},C=async b=>{var K;if((K=b.target.files)!=null&&K[0]){const v=b.target.files[0],j=v.name,w=await v.arrayBuffer(),L=new Uint8Array(w);m({name:j,byteArray:L}),r(updateState("waiting"))}else m(null)},y=()=>{p&&r(saveTabFirmware(p.byteArray))};return jsxRuntimeExports.jsx(Pane$e,{children:jsxRuntimeExports.jsxs(Container$2,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[e("Firmware"),"：",p==null?void 0:p.name]}),jsxRuntimeExports.jsxs(Detail,{children:[jsxRuntimeExports.jsx(AccentButton,{disabled:o==="saving",onClick:_,children:e("Open")}),jsxRuntimeExports.jsx(HiddenInput$3,{accept:".uf2",onChange:C,type:"file",ref:l})]})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(FlexLabel,{children:[o==="failed"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),e("Failed to flash.")]}),o==="completed"&&e("Flash successful.")," ",o==="saving"&&jsxRuntimeExports.jsx(SavingProgress,{bufferSize:i,sendSpeed:d,bytesSended:a})]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:y,disabled:!p||o==="saving",children:e("Flash")})})]})]})})},PANES=[{key:"default",component:ConfigurePane,icon:faKeyboard,title:"Configure",path:"/"},{key:"test",component:Test$1,icon:faStethoscope,path:"/test",title:"Key Tester"},{key:"design",component:DesignTab,icon:faBrush,path:"/design",title:"Design"},{key:"settings",component:Settings,icon:faGear,path:"/settings",title:"Settings"},{key:"debug",icon:faBug,component:Debug,path:"/debug",title:"Debug"},{key:"boot",icon:faSatelliteDish,component:Boot,path:"/boot",title:"2.4G boot"},ErrorsPaneConfig],VIALogo=e=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 525.74 268.41",...e,children:[jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsx("style",{children:".cls-1{fill:currentColor}"})}),jsxRuntimeExports.jsx("g",{id:"Layer_2","data-name":"Layer 2",children:jsxRuntimeExports.jsx("g",{id:"Layer_2-2","data-name":"Layer 2",children:jsxRuntimeExports.jsx("path",{className:"cls-1",d:"M524.6 237.33 459.25 37.88C451.73 14.93 432.81.12 411 .12h-.13c-21.87.06-40.79 15-48.21 38.11l-64 199.23a22.93 22.93 0 0 0 43.66 14l18.74-58.35h100.81l19.13 58.5a22.93 22.93 0 0 0 43.58-14.28Zm-145-90a2.78 2.78 0 0 1-2.65-3.63l29.37-91.41C407.82 47.68 410 46 411 46c1 0 3.17 1.68 4.65 6.19l30 91.49a2.78 2.78 0 0 1-2.64 3.64ZM212.25 1.21A22.93 22.93 0 0 0 183.41 16l-64 199.23c-1.47 4.57-3.66 6.28-4.69 6.29-1 0-3.17-1.68-4.64-6.19L44.72 15.91A22.92 22.92 0 1 0 1.15 30.18l65.34 199.45c7.52 23 26.44 37.77 48.22 37.77h.14c21.86-.06 40.78-15 48.2-38.11l64-199.23a22.93 22.93 0 0 0-14.8-28.85ZM306.09 1.1a22.93 22.93 0 0 0-28.84 14.82l-71.5 222.54a22.93 22.93 0 1 0 43.66 14l71.5-222.55A22.93 22.93 0 0 0 306.09 1.1Zm-78.17 255.45a12.5 12.5 0 1 1 12.5-12.5 12.5 12.5 0 0 1-12.5 12.5Zm70.7-220.91a12.5 12.5 0 1 1 12.5-12.5 12.5 12.5 0 0 1-12.5 12.5Z"})})})]}),ExternalLinkContainer=styled.span`
  position: absolute;
  right: 1em;
  display: flex;
  gap: 1em;
`,ExternalLinks=()=>jsxRuntimeExports.jsxs(ExternalLinkContainer,{children:[jsxRuntimeExports.jsx("a",{href:"https://caniusevia.com/",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(VIALogo,{height:"25px",fill:"currentColor"}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"Firmware + Docs"})]})}),jsxRuntimeExports.jsx("a",{href:"https://discord.gg/NStTR5YaPB",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:faDiscord}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"Discord"})]})}),jsxRuntimeExports.jsx("a",{href:"https://github.com/tabkb/via-app",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:faGithub}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"Github"})]})})]}),Container$1=styled.div`
  position: absolute;
  right: 200px;
  font-size: 18px;
`,LanguageList=styled.ul`
  padding: 0;
  border: 1px solid var(--bg_control);
  width: 160px;
  border-radius: 6px;
  background-color: var(--bg_menu);
  margin: 0;
  margin-top: 5px;
  top: 30px;
  right: 0px;
  position: absolute;
  pointer-events: ${e=>e.$show?"all":"none"};
  transition: all 0.2s ease-out;
  z-index: 11;
  opacity: ${e=>e.$show?1:0};
  overflow: hidden;
  transform: ${e=>e.$show?0:"translateY(-5px)"};
`,LanugaeButton=styled.button`
  display: block;
  text-align: center;
  outline: none;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  border: none;
  background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"transparent"};
  color: ${e=>e.$selected?"var(--color_icon_highlighted)":"var(--color_label-highlighted)"};
  cursor: pointer;
  text-align: left;
  font-size: 14px;
  text-transform: uppercase;
  padding: 5px 10px;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"var(--bg_control)"};
    color: ${e=>e.$selected?"var(--color_control-highlighted)":"var(--color_label-highlighted)"};
  }
`,ClickCover=styled.div`
  position: fixed;
  z-index: 10;
  pointer-events: all;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.4;
  background: rgba(0, 0, 0, 0.75);
`,LanguageSelectors=e=>{const r=[{code:"en",lang:"English"},{code:"zh",lang:"中文"},{code:"ko",lang:"한국어"}],{i18n:o}=useTranslation(),i=d=>{o.changeLanguage(d),e.onClickOut()},a=reactExports.useMemo(()=>o.resolvedLanguage?o.resolvedLanguage:o.languages[o.languages.length-1],[o.resolvedLanguage,o.languages]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[e.show&&jsxRuntimeExports.jsx(ClickCover,{onClick:e.onClickOut}),jsxRuntimeExports.jsx(LanguageList,{$show:e.show,children:r.map(({lang:d,code:l})=>jsxRuntimeExports.jsx(LanugaeButton,{$selected:l===a,onClick:()=>i(l),children:d},l))})]})},LanguageSelect=()=>{const[e,r]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(Container$1,{children:[jsxRuntimeExports.jsx(CategoryIconContainer,{children:jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:faLanguage,onClick:()=>r(!0)})}),jsxRuntimeExports.jsx(LanguageSelectors,{show:e,onClickOut:()=>r(!1)})]})},__vite_import_meta_env__={DEV:!1},Container=styled.div`
  width: 100vw;
  height: 25px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border_color_cell);
  display: flex;
  align-items: center;
  justify-content: center;
`,{DEBUG_PROD,DEV}=__vite_import_meta_env__,showDebugPane=DEBUG_PROD==="true"||DEV,GlobalContainer=styled(Container)`
  background: var(--bg_outside-accent);
  column-gap: 20px;
`,UnconnectedGlobalMenu=()=>{var l;const{t:e,i18n:r}=useTranslation(),o=useAppSelector(getShowDesignTab),i=(l=useAppSelector(getSelectedTabkbConfig))==null?void 0:l.g24boot,[a]=useLocation(),d=reactExports.useMemo(()=>PANES.filter(p=>p.key!==ErrorsPaneConfig.key).map(p=>p.key==="boot"&&!i||p.key==="design"&&!o||p.key==="debug"&&!showDebugPane?null:jsxRuntimeExports.jsx(Link$1,{to:p.path,children:jsxRuntimeExports.jsxs(CategoryIconContainer,{$selected:p.path===a,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:p.icon}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:e(p.title)})]})},p.key)),[a,o,r.language,i]);return jsxRuntimeExports.jsx(React.Fragment,{children:jsxRuntimeExports.jsxs(GlobalContainer,{children:[jsxRuntimeExports.jsx(ErrorLink,{}),d,jsxRuntimeExports.jsx(LanguageSelect,{}),jsxRuntimeExports.jsx(ExternalLinks,{})]})})},overrideParam=new URL(window.location.href).searchParams.get("override_hid_check");overrideParam!==null&&localStorage.setItem("override_hid_check",overrideParam);const overrideHidCheck=localStorage.getItem("override_hid_check")||"false",OVERRIDE_HID_CHECK=!!JSON.parse(overrideHidCheck),ErrorHome=styled.div`
  background: var(--bg_gradient);
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  height: 100%;
  overflow: hidden;
  height: auto;
  left: 0;
  right: 0;
  bottom: 0;
  padding-top: 24px;
  position: absolute;
  border-top: 1px solid var(--border_color_cell);
`,UsbError=styled.div`
  align-items: center;
  display: flex;
  color: var(--color_label);
  flex-direction: column;
  height: 100%;
  justify-content: center;
  margin: 0 auto;
  max-width: 650px;
  text-align: center;
`,UsbErrorIcon=styled.div`
  font-size: 2rem;
`,UsbErrorHeading=styled.h1`
  margin: 1rem 0 0;
`,UsbErrorWebHIDLink=styled.a`
  text-decoration: underline;
  color: var(--color_label-highlighted);
`,timeoutRepeater=(e,r,o=0)=>()=>setTimeout(()=>{e(),o>0&&timeoutRepeater(e,r,o-1)()},r),Home=e=>{const{t:r}=useTranslation(),{hasHIDSupport:o}=e,i=useAppDispatch();useAppSelector(getSelectedKey),useAppSelector(getSelectedDefinition),useAppSelector(getConnectedDevices),useAppSelector(getSelectedLayerIndex),useAppSelector(getSelectedKeyDefinitions),useAppSelector(getDisableFastRemap);const{basicKeyToByte:a}=useAppSelector(getBasicKeyToByte),d=useAppSelector(getSelectedKeyboardAPI),l=timeoutRepeater(()=>{i(reloadConnectedDevices())},500,1),p=reactExports.createRef();return reactExports.useEffect(()=>{if(o)return p.current&&p.current.focus(),startMonitoring(),usbDetect.on("change",l),i(loadSupportedIds()),i(loadTabkbConfigs()),()=>{usbDetect.off("change",l)}},[]),reactExports.useEffect(()=>{i(updateSelectedKey(null))},[d]),!o&&!OVERRIDE_HID_CHECK?jsxRuntimeExports.jsx(ErrorHome,{ref:p,tabIndex:0,children:jsxRuntimeExports.jsxs(UsbError,{children:[jsxRuntimeExports.jsx(UsbErrorIcon,{children:"❌"}),jsxRuntimeExports.jsx(UsbErrorHeading,{children:r("USB Detection Error")}),jsxRuntimeExports.jsxs("p",{children:["Looks like there was a problem getting USB detection working. Right now, we only support"," ",jsxRuntimeExports.jsx(UsbErrorWebHIDLink,{href:"https://caniuse.com/?search=webhid",target:"_blank",children:"browsers that have WebHID enabled"}),", so make sure yours is compatible before trying again."]})]})}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e.children})},useSize=e=>{const[r,o]=reactExports.useState();return reactExports.useLayoutEffect(()=>{e.current&&o(e.current.getBoundingClientRect())},[e]),useResizeObserver(e,i=>o(i.contentRect)),r},ZOOM=5.5*.8,Camera=()=>{const{progress:e}=useProgress(),r=useThree(d=>d.camera),[o,i]=[7,7],a=J({config:{duration:800},from:{x:o}});return React.useEffect(()=>{e===100&&(console.debug("lets animate"),a.x.start(i))},[e]),React.useEffect(()=>(console.debug("mounting"),()=>{console.debug("unmounting")}),[]),useFrame(()=>{a.x.isAnimating&&(r.position.setZ(a.x.get()),r.position.setY(.4*Math.pow(a.x.get()-i,1)),r.updateProjectionMatrix()),r.zoom!==ZOOM&&(r.zoom=ZOOM,r.updateProjectionMatrix())}),jsxRuntimeExports.jsx(PerspectiveCamera,{"position-z":o,makeDefault:!0,fov:25})},CaseGroup=styled.div``,OuterCase=styled.div`
  background: ${e=>e.background};
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,InnerCase=styled.div`
  background: ${e=>e.background};
  top: 0;
  left: 0;
  position: absolute;
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,CaseInsideBorder=10,Case$1=React.memo(e=>{const r=useAppSelector(getSelectedTheme),o=reactExports.useMemo(()=>r[distExports.KeyColorType.Accent].c,[r]),i=e.width*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,a=CSSVarObject.keyYPos*e.height-CSSVarObject.keyYSpacing,d=CSSVarObject.insideBorder,l=i+d*1,p=i+d*3,[m,_]=[a+d,a+d*3],[C,y,b]=[.15,.25,.2].map(K=>getDarkenedColor(o,K));return jsxRuntimeExports.jsxs(CaseGroup,{children:[jsxRuntimeExports.jsx(OuterCase,{background:o,width:p,height:_,style:{borderRadius:8,boxShadow:"var(--box-shadow-keyboard)"}}),jsxRuntimeExports.jsx(InnerCase,{background:`linear-gradient(200deg,${C} 40%,${y},${b} 80%)`,width:l,height:m,style:{transform:`translate( ${l-i}px,
           ${m-a}px)`,boxShadow:"var(--box-shadow-keyboard)",borderRadius:8}})]})},shallowEqual);var DisplayMode=(e=>(e[e.Test=1]="Test",e[e.Configure=2]="Configure",e[e.Design=3]="Design",e[e.ConfigureColors=4]="ConfigureColors",e[e.ConfigureDKS=5]="ConfigureDKS",e[e.ConfigureAP=6]="ConfigureAP",e[e.ConfigureRT=7]="ConfigureRT",e))(DisplayMode||{}),KeycapState=(e=>(e[e.Pressed=1]="Pressed",e[e.Unpressed=2]="Unpressed",e))(KeycapState||{});const KeycapContainer=styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 52px;
  height: 54px;
  &:hover {
    z-index: 1;
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,TooltipContainer=styled.div`
  position: absolute;
  transform: rotate(${e=>e.$rotate}rad);
  width: 100%;
  height: 100%;
  bottom: 0;
`,TestOverlay=styled.div`
  transition: all 0.2s ease-out;
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
`,CanvasContainerBG=styled.div``,CanvasContainer=styled.div`
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 10%);
`,ComboKeycap=e=>{const{normalizedRects:r,clipPath:o,overflowsTexture:i,macroData:a,label:d,canvasRef:l,onClick:p,onPointerDown:m,onPointerOver:_,onPointerOut:C,disabled:y,...b}=e,[K,v]=r;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(KeycapContainer,{...b,children:[jsxRuntimeExports.jsxs(ComboKeyBoundingContainer,{$selected:e.selected,onClick:p,onPointerDown:m,onPointerOver:_,onPointerOut:C,style:{cursor:y?"initial":"pointer",position:"relative",animation:e.disabled?"initial":e.selected?".75s infinite alternate select-glow":"",transform:`translateX(${-Math.abs(K[0]-v[0])*CSSVarObject.keyXPos/2}px) perspective(100px) translateZ(${e.keycapZ}px)`,width:Math.max(K[2],v[2])*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:Math.max(K[3],v[3])*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing,clipPath:o},children:[jsxRuntimeExports.jsx(ComboKeyRectContainer,{style:{position:"absolute",borderRadius:3,background:getDarkenedColor(e.color.c,.8),transform:`translate(${CSSVarObject.keyXPos*K[0]}px,${CSSVarObject.keyYPos*K[1]}px)`,width:K[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:K[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}),jsxRuntimeExports.jsx(ComboKeyRectContainer,{style:{position:"absolute",borderRadius:3,transform:`translate(${CSSVarObject.keyXPos*v[0]}px,${CSSVarObject.keyYPos*v[1]}px)`,background:getDarkenedColor(e.color.c,.8),width:v[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:v[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}),jsxRuntimeExports.jsx(ComboKeyBGContainer,{style:{position:"absolute",borderRadius:3,background:getDarkenedColor(e.color.c,.8),transform:`translate(${CSSVarObject.keyXPos*K[0]+1}px,${1+CSSVarObject.keyYPos*K[1]}px)`,width:K[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-2,height:K[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-2}}),jsxRuntimeExports.jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${CSSVarObject.keyXPos*K[0]+CSSVarObject.faceXPadding[0]}px,${CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*K[1]}px)`,width:K[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1],height:K[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]}}),jsxRuntimeExports.jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${CSSVarObject.keyXPos*v[0]+CSSVarObject.faceXPadding[0]}px,${CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*v[1]}px)`,width:v[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1],height:v[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]}}),jsxRuntimeExports.jsx(CanvasContainerBG,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${1+CSSVarObject.keyXPos*K[0]+CSSVarObject.faceXPadding[0]}px,${1+CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*K[1]}px)`,width:K[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1]-2,height:K[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]-2},children:jsxRuntimeExports.jsx("canvas",{ref:l,style:{}})}),DisplayMode.Test===e.mode?jsxRuntimeExports.jsx(TestOverlay,{style:{background:e.keycapColor,opacity:e.keycapOpacity}}):null]}),(e.macroData||e.overflowsTexture)&&jsxRuntimeExports.jsx(TooltipContainer,{$rotate:e.rotation[2],children:jsxRuntimeExports.jsx(Keycap2DTooltip,{children:e.macroData||e.label&&e.label.tooltipLabel})})]})})},ComboKeyBoundingContainer=styled.div`
  box-sizing: border-box;
  transition: transform 0.2s ease-out;
  animation: ${e=>e.$selected?".75s infinite alternate select-glow":"initial"};
  &:hover {
    transform: perspective(100px) translateZ(-5px);
    animation: 0.5s 1 forwards select-glow;
  }
`,ComboKeyRectContainer=styled.div`
  box-sizing: border-box;
  padding: 2px 6px 10px 6px;
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 20%);
`,ComboKeyBGContainer=styled.div`
  box-sizing: border-box;
  padding: 3px 7px 10px 6px;
`,EncoderKeyContainer=styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 52px;
  opacity: 1;
  height: 52px;
  &:hover {
    z-index: 1;
    animation: 0.75s infinite alternate select-glow;
  }
`,EncoderKeyContent2=styled.div`
  --inner-padding: ${e=>e.$innerPadding}px;
  --size: ${e=>e.$size}px;
  --inner-size: ${e=>e.$size-e.$innerPadding*2}px;
  --half-size: ${e=>(e.$size-e.$innerPadding*2)/2}px;
  --half-size-p1: ${e=>1+(e.$size-e.$innerPadding*2)/2}px;
  --half-size-p05p: ${e=>e.$innerPadding/2+(e.$size-e.$innerPadding*2)/2}px;
  background-color: currentColor;
  padding: var(--inner-padding);
  min-width: var(--size);
  min-height: var(--size);
  clip-path: polygon(
    50% 0%,
    46.93% 3.1%,
    43.47% 0.43%,
    40.83% 3.9%,
    37.06% 1.7%,
    34.89% 5.49%,
    30.87% 3.81%,
    29.21% 7.85%,
    25% 6.7%,
    23.89% 10.92%,
    19.56% 10.33%,
    19.01% 14.66%,
    14.64% 14.64%,
    14.66% 19.01%,
    10.33% 19.56%,
    10.92% 23.89%,
    6.7% 25%,
    7.85% 29.21%,
    3.81% 30.87%,
    5.49% 34.89%,
    1.7% 37.06%,
    3.9% 40.83%,
    0.43% 43.47%,
    3.1% 46.93%,
    0% 50%,
    3.1% 53.07%,
    0.43% 56.53%,
    3.9% 59.17%,
    1.7% 62.94%,
    5.49% 65.11%,
    3.81% 69.13%,
    7.85% 70.79%,
    6.7% 75%,
    10.92% 76.11%,
    10.33% 80.44%,
    14.66% 80.99%,
    14.64% 85.36%,
    19.01% 85.34%,
    19.56% 89.67%,
    23.89% 89.08%,
    25% 93.3%,
    29.21% 92.15%,
    30.87% 96.19%,
    34.89% 94.51%,
    37.06% 98.3%,
    40.83% 96.1%,
    43.47% 99.57%,
    46.93% 96.9%,
    50% 100%,
    53.07% 96.9%,
    56.53% 99.57%,
    59.17% 96.1%,
    62.94% 98.3%,
    65.11% 94.51%,
    69.13% 96.19%,
    70.79% 92.15%,
    75% 93.3%,
    76.11% 89.08%,
    80.44% 89.67%,
    80.99% 85.34%,
    85.36% 85.36%,
    85.34% 80.99%,
    89.67% 80.44%,
    89.08% 76.11%,
    93.3% 75%,
    92.15% 70.79%,
    96.19% 69.13%,
    94.51% 65.11%,
    98.3% 62.94%,
    96.1% 59.17%,
    99.57% 56.53%,
    96.9% 53.07%,
    100% 50%,
    96.9% 46.93%,
    99.57% 43.47%,
    96.1% 40.83%,
    98.3% 37.06%,
    94.51% 34.89%,
    96.19% 30.87%,
    92.15% 29.21%,
    93.3% 25%,
    89.08% 23.89%,
    89.67% 19.56%,
    85.34% 19.01%,
    85.36% 14.64%,
    80.99% 14.66%,
    80.44% 10.33%,
    76.11% 10.92%,
    75% 6.7%,
    70.79% 7.85%,
    69.13% 3.81%,
    65.11% 5.49%,
    62.94% 1.7%,
    59.17% 3.9%,
    56.53% 0.43%,
    53.07% 3.1%
  );

  background-image: radial-gradient(
      currentColor var(--half-size),
      transparent var(--half-size-p1)
    ),
    radial-gradient(
      rgba(255, 255, 255, 0.6) var(--half-size),
      transparent var(--half-size-p1)
    ),
    radial-gradient(
      rgba(0, 0, 0, 0.2) var(--half-size),
      transparent var(--half-size-p05p)
    ),
    radial-gradient(
      rgba(0, 0, 0, 0.2) var(--half-size),
      transparent var(--half-size-p05p)
    );
  background-size: var(--size) var(--size);
  background-position: 0px 0px, -0.5px -0.5px, 0px 0px,
    calc(var(--inner-padding) / 2) calc(var(--inner-padding) / 2);
  background-repeat: repeat;

  transition: transform 0.5s ease-out;
  transform: rotate(0);
  box-sizing: border-box;
  &:hover {
    transform: rotate(450deg);
  }
`,EncoderKey=e=>jsxRuntimeExports.jsx(EncoderKeyContainer,{onClick:e.onClick,style:e.style,children:jsxRuntimeExports.jsx(EncoderKeyContent2,{$size:e.size&&+e.size,$innerPadding:5*e.size/52})}),getMacroData$1=({macroExpression:e,label:r})=>r&&r.length>15?r:e&&e.length?e:null,paintKeycapLabel$1=(e,r,o,i,a,d)=>{const l=e.getContext("2d");if(l==null)return;const p=devicePixelRatio,[m,_]=[e.width,e.height];e.width=m*p,e.height=_*p,e.style.width=`${m}px`,e.style.height=`${_}px`,l.scale(p,p);const C="Fira Sans, Arial Rounded MT, Arial Rounded MT Bold, Arial",y={x:4,y:4},b={x:4,y:4},K={x:3},v={x:4,y:4};if(l.beginPath(),l.moveTo(0,0),l.lineTo(e.width,0),l.lineTo(e.width,e.height),l.lineTo(0,e.height),l.lineTo(0,0),l.clip(),l.fillStyle=r,DisplayMode.ConfigureAP===i||DisplayMode.ConfigureRT===i||DisplayMode.ConfigureDKS===i){let w=10,L=.75*w,T=_/2;const P=1,k=Math.min(m-1,120),G=L+2,U=_-3;l.font=`${w}px ${C}`,l.textAlign="right";const W=!!(a!=null&&a.actuationPoint),X=!!(a!=null&&a.rtSensitivity)&&!!(a!=null&&a.rt2ndSensitivity);if(DisplayMode.ConfigureAP===i&&(d?l.fillText("DKS",k,U):(W&&l.fillText(String(a.actuationPoint),k,U),X&&l.fillText("RT",k,G))),DisplayMode.ConfigureRT===i&&(d?l.fillText("DKS",k,U):(l.textAlign="left",X&&l.fillText(String(a.rtSensitivity),P,U),l.textAlign="right",X&&l.fillText(String(a.rt2ndSensitivity),k,U),W&&l.fillText("AP",k,G))),DisplayMode.ConfigureDKS===i)if(d)l.fillText("DKS",k,U);else{const I=[];W&&I.push("AP"),X&&I.push("RT"),(W||X)&&l.fillText(I.join(","),k,G)}l.textAlign="start",w=13*o.size,L=.75*w,l.font=`bold ${w}px ${C}`;const Z=o.label||o.key;return l.fillText(Z,K.x,T+.5*L),l.measureText(Z).width>m-K.x}if(o!==void 0){if(o.topLabel&&o.bottomLabel){let w=16,L=.75*w,T=o.offset[0]*L,P=o.offset[1]*L;l.font=`bold ${w}px ${C}`,l.fillText(o.topLabel,y.x,y.y+T+L),l.fillText(o.bottomLabel,b.x,_-b.y-P)}else if(o.centerLabel){let w=13*o.size,L=.75*w,T=_/2;return l.font=`bold ${w}px ${C}`,l.fillText(o.label,K.x,T+.5*L),l.measureText(o.centerLabel).width>m-K.x}else if(typeof o.label=="string"){let w=22,L=.75*w;l.font=`bold ${w}px ${C}`,l.fillText(o.label,v.x,v.y+L)}}},paintKeycap$1=(e,r,o,i,a,d,l,p)=>{const[m,_]=[CSSVarObject.keyWidth,CSSVarObject.keyHeight];if(e.width=m*r-CSSVarObject.faceXPadding.reduce((y,b)=>y+b,0),e.height=_*o-CSSVarObject.faceYPadding.reduce((y,b)=>y+b,0),e.getContext("2d")!=null)return paintKeycapLabel$1(e,i,a,d,l,p)},Keycap$1=React.memo(e=>{const{label:r,scale:o,color:i,selected:a,multiSelected:d,disabled:l,mode:p,rotation:m,keyState:_,shouldRotate:C,textureWidth:y,textureHeight:b,skipFontCheck:K,idx:v,actuation:j,dksData:w,multiSelect:L}=e,T=r&&getMacroData$1(r),[P,k]=reactExports.useState(!1),[G,U]=reactExports.useState(!1),W=reactExports.useRef(null),X=React.useCallback(()=>{if(W.current&&i&&r&&(document.fonts.check('bold 16px "Fira Sans"',r.label)||K)){const Ce=paintKeycap$1(W.current,y,b,i.t,r,p,j,w);k(!!Ce)}},[W.current,y,r&&r.key,o[0],o[1],i&&i.t,i&&i.c,C,p,j,w]);reactExports.useEffect(X,[r&&r.key,K,i&&i.c,i&&i.t,p,j,w]),reactExports.useEffect(()=>(document.fonts.addEventListener("loadingdone",X),()=>{document.fonts.removeEventListener("loadingdone",X)}),[]);const[Z,I]=[-8,0],z=DisplayMode.Test===p?TestKeyState.KeyDown===_?KeycapState.Pressed:KeycapState.Unpressed:G||a?KeycapState.Pressed:KeycapState.Unpressed,[Q]=z===KeycapState.Pressed?[Z,m[2]]:[I,m[2]+Math.PI*Number(C)],re=_===TestKeyState.KeyUp,V=DisplayMode.Test===p?z===KeycapState.Unpressed?re?"mediumvioletred":"lightgrey":"mediumvioletred":(z===KeycapState.Unpressed,"lightgrey"),A=z===KeycapState.Unpressed?re?.4:0:.6,[B,te,ce,le]=reactExports.useMemo(()=>{const Ce=()=>{};return l?[Ce,Ce,Ce,Ce]:e.mode===DisplayMode.ConfigureColors?[Ce,ye=>{e.onPointerOver&&e.onPointerOver(ye,v)},Ce,ye=>{e.onPointerDown&&e.onPointerDown(ye,v)}]:[ye=>e.onClick(ye,v),ye=>{e.onPointerOver&&e.onPointerOver(ye,v),U(!0)},()=>U(!1),ye=>{e.onPointerDown&&e.onPointerDown(ye,v)}]},[l,e.onClick,e.onPointerDown,e.onPointerOver,U,v,p,L]);return C?jsxRuntimeExports.jsx(EncoderKey,{onClick:B,size:y*CSSVarObject.keyWidth,style:{transform:`translate(${e.position[0]-(CSSVarObject.keyWidth*y-CSSVarObject.keyWidth)/2}px,${y*(CSSVarObject.keyHeight-CSSVarObject.keyWidth)/2+e.position[1]-(CSSVarObject.keyHeight*b-CSSVarObject.keyHeight)/2}px) rotate(${-e.rotation[2]}rad)`,borderRadius:3,color:e.color.c}}):e.clipPath?jsxRuntimeExports.jsx(ComboKeycap,{...e,onClick:B,onPointerDown:le,onPointerOver:te,onPointerOut:ce,keycapZ:Q,keycapOpacity:A,keycapColor:V,canvasRef:W,macroData:T,overflowsTexture:P,style:{transform:`translate(${CSSVarObject.keyWidth/2+e.position[0]-(CSSVarObject.keyXPos*y-CSSVarObject.keyXSpacing)/2}px,${CSSVarObject.keyHeight/2+e.position[1]-(CSSVarObject.keyYPos*b-CSSVarObject.keyYSpacing)/2}px) rotate(${-e.rotation[2]}rad)`,width:y*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:b*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(KeycapContainer,{onClick:B,onPointerDown:le,onPointerOver:te,onPointerOut:ce,style:{transform:`translate(${CSSVarObject.keyWidth/2+e.position[0]-(CSSVarObject.keyXPos*y-CSSVarObject.keyXSpacing)/2}px,${CSSVarObject.keyHeight/2+e.position[1]-(CSSVarObject.keyYPos*b-CSSVarObject.keyYSpacing)/2}px) rotate(${-e.rotation[2]}rad)`,width:y*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:b*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing,cursor:l?"initial":"pointer"},children:[jsxRuntimeExports.jsxs(GlowContainer,{$selected:a,$multiSelected:L&&d,style:{animation:l?"initial":a?".75s infinite alternate select-glow":"",background:getDarkenedColor(e.color.c,.8),transform:`perspective(100px) translateZ(${Q}px)`,borderRadius:3,width:y*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:b*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing},children:[DisplayMode.Test===p?jsxRuntimeExports.jsx(TestOverlay,{style:{background:V,opacity:A}}):null,jsxRuntimeExports.jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:W,style:{}})})]}),(T||P)&&jsxRuntimeExports.jsx(TooltipContainer,{$rotate:m[2],children:jsxRuntimeExports.jsx(Keycap2DTooltip,{children:T||r&&r.tooltipLabel})})]})})},shallowEqual),GlowContainer=styled.div`
  box-sizing: border-box;
  padding: 2px 6px 10px 6px;
  transition: transform 0.2s ease-out;
  box-shadow: ${e=>e.$multiSelected?"inset -2px -2px 0 rgb(199 21 133 / 80%), inset 2px 2px 0 rgb(199 21 133 / 90%)":"inset -1px -1px 0 rgb(0 0 0 / 20%), inset 1px 1px 0 rgb(255 255 255 / 20%)"};
  animation: ${e=>e.$selected?".75s infinite alternate select-glow":"initial"};
  &:hover {
    transform: perspective(100px) translateZ(-5px);
    animation: 0.5s 1 forwards select-glow;
  }
`;function getKeycapSharedProps(e,r,o,i,a,d,l,p,m,_){const{position:C,rotation:y,scale:b,color:K,idx:v,onClick:j,onPointerDown:w,onPointerOver:L}=i.coords[r],T=e.ei!==void 0;return{mode:o.mode,position:C,rotation:y,scale:getScale(e,b),textureWidth:e.w,textureHeight:e.h,textureOffsetX:e.w2?Math.abs(e.w2-e.w):0,color:K,shouldRotate:T,onPointerDown:w,onPointerOver:L,keyState:o.pressedKeys?o.pressedKeys[r]:-1,disabled:!o.selectable&&!o.multiSelect,selected:r===a,multiSelected:d!==null&&d.includes(r),idx:v,label:l[r],onClick:j,key:i.indices[r],skipFontCheck:p,dksData:m[r],actuation:_[r],multiSelect:!!o.multiSelect}}const getKeysKeysIndices=e=>(r,o)=>{const i=r.ei!==void 0;return`${e}-${o}-${r.w}-${r.h}-${i}`};function getLabels(e,r,o,i,a){return e.matrixKeycodes.length?e.keys.map((d,l)=>getLabel(e.matrixKeycodes[l],d.w,r,e.definition,o,i,a)):[]}function getKeysKeys(e,r,o,i){const{keys:a}=e,{rowMap:d}=getKeyboardRowPartitions(a),l=a.map(distExports.getBoundingBox),[p,m]=[Math.min(...l.map(C=>C.xStart)),Math.min(...l.map(C=>C.yStart))],_=a.map(C=>{const y={...C};return p<0&&(y.x=y.x-p),m<0&&(y.y=y.y-m),y}).map(calculatePointPosition);return{indices:a.map(getKeysKeysIndices(e.definition.vendorProductId)),coords:a.map((C,y)=>{const[b,K]=_[y],v=C.r*(2*Math.PI)/360,j=KeycapMetric.keyXSpacing/KeycapMetric.keyWidth,w=KeycapMetric.keyYSpacing/KeycapMetric.keyHeight,L=(1+j)*(C.w2||C.w)-j,T=C.h*(1+w)-w,P=getMeshName(C,d[getKeyId(C)],!1),k=e.keyColors?y:C.color,G=r[k];return{position:i(b+p,K+m),rotation:[0,0,-v],scale:[L,T,1],color:G,meshKey:P,idx:y,onClick:(U,W)=>{U.stopPropagation(),!e.multiSelect&&o(updateSelectedKey(W))},onPointerDown:e.onKeycapPointerDown,onPointerOver:e.onKeycapPointerOver}})}}function useSkipFontCheck(){const[e,r]=reactExports.useState(!1),o=reactExports.useCallback(()=>{r(!1)},[]),i=reactExports.useCallback(()=>{r(!0)},[]);return reactExports.useEffect(()=>{document.fonts.load("Fira Sans").then(o,i)},[]),e}const KeyGroupContainer=styled.div`
  position: absolute;
  top: ${e=>CaseInsideBorder*1.5}px;
  left: ${e=>CaseInsideBorder*1.5}px;
`,getPosition$1=(e,r)=>[e-CSSVarObject.keyWidth/2,r-CSSVarObject.keyHeight/2,0],getRGBArray=e=>e.map(([r,o])=>{const i=getRGB({hue:Math.round(255*r/360),sat:Math.round(255*o)}),a=`#${new Color(i).getHexString()}`;return{c:a,t:a}}),KeyGroup$1=e=>{const r=useAppDispatch(),o=useAppSelector(getSelectedKey),i=useAppSelector(getSelectedKeys),a=useAppSelector(getSelectedTheme),d=useAppSelector(getExpressions),l=useSkipFontCheck(),p=e.keyColors?getRGBArray(e.keyColors):a,{basicKeyToByte:m,byteToKey:_}=useAppSelector(getBasicKeyToByte),C=useAppSelector(U=>U.macros),{keys:y,selectedKey:b}=e,K=b===void 0?o:b,v=reactExports.useMemo(()=>getKeysKeys(e,p,r,getPosition$1),[y,p,e.onKeycapPointerDown,e.onKeycapPointerOver]),j=useAppSelector(getSelectedDksmap)||[],w=useAppSelector(getSelectedActuationMap)||[],L=useAppSelector(getTapDanceKeycodes),T=reactExports.useMemo(()=>getLabels(e,d,m,_,L),[y,e.matrixKeycodes,C,e.definition,L]),{width:P,height:k}=calculateKeyboardFrameDimensions(y),G=reactExports.useMemo(()=>e.keys.map((U,W)=>U.d?null:jsxRuntimeExports.jsx(Keycap$1,{...getComboKeyProps(U),...getKeycapSharedProps(U,W,e,v,K,i,T,l,j,w)})),[y,K,i,T,e.pressedKeys,e.selectable,p,e.definition.vendorProductId,l,e.mode,j,w,e.multiSelect]);return jsxRuntimeExports.jsx(KeyGroupContainer,{height:k,width:P,style:{pointerEvents:e.selectable||e.multiSelect?"all":"none"},children:G})},generateRowColArray=(e,r,o)=>{const i=e.filter(l=>l.ei===void 0&&!l.d),a=i.reduce((l,p)=>(l[p.row][p.col]=calculatePointPosition(p),l),Array(r).fill(0).map(()=>Array(o).fill(0))).map(l=>l.sort((p,m)=>p[0]-m[0])),d=i.reduce((l,p)=>(l[p.col][p.row]=calculatePointPosition(p),l),Array(o).fill(0).map(()=>Array(r).fill(0))).map(l=>l.sort((p,m)=>p[1]-m[1]));return{rowKeys:a,colKeys:d}},Matrix=({rowKeys:e,colKeys:r})=>jsxRuntimeExports.jsxs(SVG,{style:{position:"absolute",top:CSSVarObject.insideBorder,left:CSSVarObject.insideBorder},children:[e.map((o,i)=>jsxRuntimeExports.jsx(RowLine,{points:o.map(a=>(a||[]).join(",")).join(" ")},i)),r.map((o,i)=>jsxRuntimeExports.jsx(ColLine,{points:o.map(a=>(a||[]).join(",")).join(" ")},i))]}),SVG=styled.svg`
  transform: rotateZ(0);
  width: 100%;
  height: 100%;
`,RowLine=styled.polyline`
  stroke: var(--color_accent);
  stroke-width: 3;
  fill-opacity: 0;
  stroke-opacity: 0.4;
  stroke-linecap: round;
`,ColLine=styled.polyline`
  stroke: var(--color_light-grey);
  stroke-width: 3;
  fill-opacity: 0;
  stroke-opacity: 0.4;
  stroke-linecap: round;
`,MatrixLines$1=({keys:e,rows:r,cols:o,width:i,height:a})=>{const{rowKeys:d,colKeys:l}=generateRowColArray(e,r,o);return jsxRuntimeExports.jsx(Matrix,{rowKeys:d,colKeys:l})},KeyboardCanvas$1=e=>{const{containerDimensions:r,shouldHide:o,...i}=e,{width:a,height:d}=reactExports.useMemo(()=>calculateKeyboardFrameDimensions(i.keys),[i.keys]),l=r.height,p=35,m=Math.min(Math.min(1,r&&r.width/((CSSVarObject.keyWidth+CSSVarObject.keyXSpacing)*a-CSSVarObject.keyXSpacing+p*2)),l/((CSSVarObject.keyHeight+CSSVarObject.keyYSpacing)*d-CSSVarObject.keyYSpacing+p*2))||1;return jsxRuntimeExports.jsx("div",{style:{transform:`scale(${m}, ${m})`,opacity:o?0:1,position:"absolute",pointerEvents:o?"none":"all"},children:jsxRuntimeExports.jsx(KeyboardCanvasContent$1,{...i,width:a,height:d})})},KeyboardGroup$2=styled.div`
  position: relative;
`,KeyboardCanvasContent$1=React.memo(e=>{const{matrixKeycodes:r,keys:o,definition:i,pressedKeys:a,mode:d,showMatrix:l,selectable:p,width:m,height:_}=e;return jsxRuntimeExports.jsxs(KeyboardGroup$2,{children:[jsxRuntimeExports.jsx(Case$1,{width:m,height:_}),jsxRuntimeExports.jsx(KeyGroup$1,{...e,keys:o,mode:d,matrixKeycodes:r,selectable:p,definition:i,pressedKeys:a}),l&&jsxRuntimeExports.jsx(MatrixLines$1,{keys:o,rows:i.matrix.rows,cols:i.matrix.cols,width:m,height:_})]})},shallowEqual),Heart=React.memo(e=>{const r=Math.atan(2/e.caseWidth),o=50/2,i=2,a=1,l=-(-e.caseWidth-a*2-i*2)/Math.cos(r),p=.1*l/22,m=95,_=95*p,C=(l-_)/2,y=reactExports.useMemo(()=>{const K=new Shape;return K.moveTo(p*(25-o),p*(25-m)),K.bezierCurveTo(p*(25-o),p*(25-m),p*(20-o),p*(0-m),p*(0-o),p*(0-m)),K.bezierCurveTo(p*(-30-o),p*(0-m),p*(-30-o),p*(35-m),p*(-30-o),p*(35-m)),K.bezierCurveTo(p*(-30-o),p*(55-m),p*(-10-o),p*(77-m),p*(25-o),p*(95-m)),K.bezierCurveTo(p*(60-o),p*(77-m),p*(80-o),p*(55-m),p*(80-o),p*(35-m)),K.bezierCurveTo(p*(80-o),p*(35-m),p*(80-o),p*(0-m),p*(50-o),p*(0-m)),K.bezierCurveTo(p*(35-o),p*(0-m),p*(25-o),p*(25-m),p*(25-o),p*(25-m)),K},[e.caseWidth,e.caseHeight,e.color]),b={depth:4,bevelEnabled:!0,bevelSegments:10,bevelSize:1,bevelThickness:1};return jsxRuntimeExports.jsxs("mesh",{position:[-l+C,i*2+a*2+e.caseHeight/2,0],scale:1,rotation:[Math.PI/2,r,Math.PI/2],children:[jsxRuntimeExports.jsx("extrudeGeometry",{attach:"geometry",args:[y,b]}),jsxRuntimeExports.jsx("meshPhongMaterial",{color:e.color,transparent:!0,opacity:1})]})},shallowEqual),makeShape2=e=>{const i=10+Math.tan(Math.PI*7.5/180)*e,a=e/2,d=new Shape;let l=2,p=Math.PI/2;return d.moveTo(-i,a),d.absarc(-i-l,a-l,l,p*1+p,p*1,!0),d.absarc(-2,a,l,p*1,p*1-p,!0),d.absarc(-2,-a,l,p*3+p,p*3,!0),d.absarc(-10-l,-a-l,l,p*2+p,p*2,!0),d},Case=React.memo(e=>{const r=useAppSelector(getSelectedTheme),o=reactExports.useMemo(()=>r[distExports.KeyColorType.Accent].c,[r]),i="#212020",a=reactExports.useMemo(()=>r[distExports.KeyColorType.Accent].t,[r]),d=e.width*KeycapMetric.keyXPos-KeycapMetric.keyXSpacing,l=KeycapMetric.keyYPos*e.height-KeycapMetric.keyYSpacing,p=4,m=d+p*1,_=d+p*2.5,[C,y]=reactExports.useMemo(()=>[l+p,l+p*2].map(makeShape2),[l]),b=1,K=10,w=10+Math.tan(Math.PI*7.5/180)*(l+p*2);return jsxRuntimeExports.jsxs("group",{scale:1,"position-z":-1*2,"rotation-y":-Math.PI/2,children:[jsxRuntimeExports.jsx(Heart,{caseWidth:w,caseHeight:l,color:a}),jsxRuntimeExports.jsxs("mesh",{position:[-1,0,-_/2],castShadow:!0,children:[jsxRuntimeExports.jsx("extrudeGeometry",{attach:"geometry",args:[y,{depth:_,bevelEnabled:!0,bevelSize:b,bevelThickness:b,bevelSegments:K}]}),jsxRuntimeExports.jsx("meshPhongMaterial",{color:o,shininess:100,reflectivity:1,specular:getDarkenedColor(o,.2)})]}),jsxRuntimeExports.jsxs("mesh",{position:[0,0,-m/2],castShadow:!0,children:[jsxRuntimeExports.jsx("extrudeGeometry",{attach:"geometry",args:[C,{depth:m,bevelEnabled:!0,bevelSize:b/2,bevelThickness:b,bevelSegments:K}]}),jsxRuntimeExports.jsx("meshPhongMaterial",{color:i,shininess:100,reflectivity:1,specular:getDarkenedColor(o,.2)})]})]})}),getMacroData=({macroExpression:e,label:r})=>r&&r.length>15?r:e&&e.length?e:null,paintEncoder=(e,[r,o],i,a)=>{const[p,m]=[512*r,512*o];e.width=p,e.height=m;const _=e.getContext("2d"),C=2.6;if(_){_.fillStyle=i,_.clearRect(0,0,e.width,e.height),_.fillRect(0,0,e.width,e.height),_.fill(),_.fillStyle=a;const y=.4*p/C;_.ellipse(.5*p/C,2.1*m/C,y,y,Math.PI/4,0,2*Math.PI),_.fill()}},paintKeycapLabel=(e,r,o,i,a,d,l)=>{const p=e.getContext("2d");if(p==null)return;const m="Fira Sans, Arial Rounded MT, Arial Rounded MT Bold, Arial",_={x:.015,y:.02},C={x:.01,y:-.01},y={x:.01,y:.02};if(p.beginPath(),p.moveTo(r.bl.x*e.width,(1-r.bl.y)*e.height),p.lineTo(r.bl.x*e.width,(1-r.tr.y)*e.height),p.lineTo(r.tr.x*e.width,(1-r.tr.y)*e.height),p.lineTo(r.tr.x*e.width,(1-r.bl.y)*e.height),p.lineTo(r.bl.x*e.width,(1-r.bl.y)*e.height),p.clip(),p.fillStyle=o,DisplayMode.ConfigureAP===a||DisplayMode.ConfigureRT===a||DisplayMode.ConfigureDKS===a){let K=30,v=.75*K/e.height,j=(r.tr.y+r.bl.y)/2;const w=r.bl.x*e.width,L=r.tr.x*e.width,T=(1-(r.tr.y-v-.01))*e.height,P=(1-(r.bl.y+.015))*e.height;p.font=`${K}px ${m}`,p.textAlign="right";const k=!!(d!=null&&d.actuationPoint),G=!!(d!=null&&d.rtSensitivity)&&!!(d!=null&&d.rt2ndSensitivity);if(DisplayMode.ConfigureAP===a&&(l?p.fillText("DKS",L,P):(k&&p.fillText(String(d.actuationPoint),L,P),G&&p.fillText("RT",L,T))),DisplayMode.ConfigureRT===a&&(l?p.fillText("DKS",L,P):(p.textAlign="left",G&&p.fillText(String(d.rtSensitivity),w,P),p.textAlign="right",G&&p.fillText(String(d.rt2ndSensitivity),L,P),k&&p.fillText("AP",L,T))),DisplayMode.ConfigureDKS===a)if(l)p.fillText("DKS",L,P);else{const W=[];k&&W.push("AP"),G&&W.push("RT"),(k||G)&&p.fillText(W.join(","),L,T)}K=37.5*i.size,v=.75*K/e.height,p.textAlign="start",p.font=`bold ${K}px ${m}`;const U=i.label||i.key;return p.fillText(U,(r.bl.x+C.x)*e.width,(1-(j-.5*v-C.y))*e.height),p.measureText(U).width>(r.tr.x-(r.bl.x+C.x))*e.width}if(p.textAlign="left",i!==void 0){if(i.topLabel&&i.bottomLabel){let K=52,v=.75*K/e.height,j=i.offset[0]*v,w=i.offset[1]*v;p.font=`bold ${K}px ${m}`,p.fillText(i.topLabel,(r.bl.x+_.x)*e.width,(1-(r.tr.y-v-_.y-j))*e.height),p.fillText(i.bottomLabel,(r.bl.x+_.x)*e.width,(1-(r.bl.y+_.y+w))*e.height)}else if(i.centerLabel){let K=37.5*i.size,v=.75*K/e.height,j=(r.tr.y+r.bl.y)/2;return p.font=`bold ${K}px ${m}`,p.fillText(i.label,(r.bl.x+C.x)*e.width,(1-(j-.5*v-C.y))*e.height),p.measureText(i.centerLabel).width>(r.tr.x-(r.bl.x+C.x))*e.width}else if(typeof i.label=="string"){let K=75,v=.75*K/e.height;p.font=`bold ${K}px ${m}`,p.fillText(i.label,(r.bl.x+y.x)*e.width,(1-(r.tr.y-v-y.y))*e.height)}}},calculateTextureRects=(e,r,o,i,a)=>{const d=.3846153846153846,m=.445/19.05*d;let _=Math.min(2.75,o),C=Math.min(2.75,i);(e>1||r>1)&&(_=1,C=1);let y={bl:{x:m,y:m},tr:{x:_*d-m,y:C*d-m}},b={bl:{x:y.bl.x+.07,y:y.bl.y+.08},tr:{x:y.tr.x-.07,y:y.tr.y-.0146}};return a>0&&(b.bl.x+=a*d,b.tr.x+=a*d,y.bl.x+=a*d,y.tr.x+=a*d),{keycapRect:y,faceRect:b}},paintKeycap=(e,[r,o],i,a,d,l,p,m,_,C,y)=>{const b=calculateTextureRects(r,o,i,a,m),K=512;e.width=K*r,e.height=K*o;const v=e.getContext("2d");if(v!=null)return v.fillStyle=d,v.fillRect(0,0,e.width,e.height),paintKeycapLabel(e,b.faceRect,l,p,_,C,y)},Keycap=React.memo(e=>{const{label:r,scale:o,color:i,onClick:a,selected:d,multiSelected:l,disabled:p,mode:m,rotation:_,keyState:C,shouldRotate:y,keycapGeometry:b,textureOffsetX:K,textureWidth:v,textureHeight:j,onPointerOver:w,onPointerDown:L,idx:T,actuation:P,multiSelect:k,dksData:G}=e,U=reactExports.useRef(),W=r&&getMacroData(r),[X,Z]=reactExports.useState(!1),[I,z]=reactExports.useState(!1),Q=reactExports.useRef(),re=reactExports.useRef(document.createElement("canvas")),V=React.useCallback(()=>{if(re.current&&i){if(y)paintEncoder(re.current,[o[0],o[1]],i.c,i.t);else{const de=paintKeycap(re.current,[o[0],o[1]],v,j,i.c,i.t,r,K,m,P,G);Z(!!de)}Q.current.needsUpdate=!0}},[re.current,v,r&&r.key,o[0],o[1],i&&i.t,i&&i.c,y,m,P,G]);reactExports.useEffect(V,[r&&r.key,i&&i.c,i&&i.t,m,P,G]);const A=J({config:{duration:800},from:{x:0,y:"#f4a0a0"},loop:d?{reverse:!0}:!1,to:{x:100,y:"#b49999"}});let B=b.boundingBox.max.z;const[te,ce]=[B,B+8],le=DisplayMode.Test===m?TestKeyState.KeyDown===C?KeycapState.Pressed:KeycapState.Unpressed:I||d?KeycapState.Unpressed:KeycapState.Pressed,[Ce,ye]=le===KeycapState.Pressed?[te,_[2]]:[ce,_[2]+Math.PI*Number(y)],Oe=C===TestKeyState.KeyUp,Ne=DisplayMode.Test===m?le===KeycapState.Unpressed?Oe?"palevioletred":"lightgrey":"pink":(le===KeycapState.Unpressed,"lightgrey"),{z:Ye,b:Je,rotateZ:pt,tooltipScale:xt}=J({config:{duration:100},z:Ce,b:Ne,rotateZ:ye,tooltipScale:I?1:0}),[Ze,ht,nt,st]=reactExports.useMemo(()=>{const de=()=>{};return p?[de,de,de,de]:e.mode===DisplayMode.ConfigureColors?[de,ue=>{w&&w(ue,T)},de,ue=>{L&&L(ue,T)}]:[ue=>a(ue,T),ue=>{w&&w(ue,T),z(!0)},()=>z(!1),ue=>{L&&L(ue,T)}]},[p,a,L,w,z,T,m,k]),ne=E.meshPhongMaterial;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(E.mesh,{...e,ref:U,"position-z":Ye,"rotation-z":pt,onClick:Ze,onPointerDown:st,onPointerOver:ht,onPointerOut:nt,geometry:b,children:jsxRuntimeExports.jsx(ne,{attach:"material",color:d?A.y:k&&l?"palevioletred":Je,children:jsxRuntimeExports.jsx("canvasTexture",{ref:Q,attach:"map",image:re.current})})}),(W||X)&&jsxRuntimeExports.jsx(React.Suspense,{fallback:null,children:jsxRuntimeExports.jsx(E.group,{position:e.position,"position-z":20,scale:xt,children:jsxRuntimeExports.jsx(Html,{transform:!0,style:{pointerEvents:"none"},children:jsxRuntimeExports.jsx(KeycapTooltip,{children:W||r&&r.tooltipLabel})})})})]})},shallowEqual),glbSrc="/assets/keyboard_components-DECp5JAr.glb",getSRGBArray=e=>e.map(([r,o])=>{const i=getRGB({hue:Math.round(255*r/360),sat:Math.round(255*o)}),a=`#${new Color(i).convertSRGBToLinear().getHexString()}`;return{c:a,t:a}}),getPosition=(e,r)=>[KeycapMetric.keyXPos*e/CSSVarObject.keyXPos,-r*KeycapMetric.keyYPos/CSSVarObject.keyYPos,0],KeyGroup=e=>{const r=useAppDispatch(),o=useGLTF(glbSrc,!0).scene,i=useAppSelector(getSelectedKey),a=useAppSelector(getSelectedKeys),d=useAppSelector(getSelectedSRGBTheme),l=useAppSelector(getExpressions),p=useSkipFontCheck(),m=e.keyColors?getSRGBArray(e.keyColors):d,{basicKeyToByte:_,byteToKey:C}=useAppSelector(getBasicKeyToByte),y=useAppSelector(W=>W.macros),{keys:b,selectedKey:K}=e,v=K===void 0?i:K,j=reactExports.useMemo(()=>getKeysKeys(e,m,r,getPosition),[b,m,e.onKeycapPointerDown,e.onKeycapPointerOver]),w=useAppSelector(getSelectedDksmap)||[],L=useAppSelector(getSelectedActuationMap)||[],T=useAppSelector(getTapDanceKeycodes),P=reactExports.useMemo(()=>getLabels(e,l,_,C,T),[b,e.matrixKeycodes,y,e.definition]),{width:k,height:G}=calculateKeyboardFrameDimensions(b),U=reactExports.useMemo(()=>e.keys.map((W,X)=>{const{meshKey:Z}=j.coords[X];return W.d?null:jsxRuntimeExports.jsx(Keycap,{keycapGeometry:(o.getObjectByName(Z)||o.getObjectByName("K-R1-100")).geometry,...getKeycapSharedProps(W,X,e,j,v,a,P,p,w,L)})}),[b,v,a,P,e.pressedKeys,e.selectable,m,e.definition.vendorProductId,p,e.mode,w,L,e.multiSelect]);return jsxRuntimeExports.jsx("group",{scale:1,position:[(-k*KeycapMetric.keyXPos+KeycapMetric.keyXSpacing)/2,(KeycapMetric.keyYPos*G-KeycapMetric.keyYSpacing)/2,0],children:U})},MatrixLines=({keys:e,rows:r,cols:o,width:i,height:a})=>{const[d,l]=["lightpink","lightgrey"],{rowKeys:p,colKeys:m}=generateRowColArray(e,r,o);return jsxRuntimeExports.jsx("group",{scale:.35,rotation:[Math.PI,0,0],position:[-i*KeycapMetric.keyXPos/2,(a+.4)*KeycapMetric.keyYPos/2,11],children:jsxRuntimeExports.jsxs(Segments,{lineWidth:1,children:[p.flatMap(_=>{const C=_.filter(y=>y);return C.length>=2?C.reduce((y,b,K)=>y.prev===null?{res:[],prev:b}:{res:[...y.res,jsxRuntimeExports.jsx(Segment,{start:[y.prev[0],y.prev[1],0],end:[b[0],b[1],0],color:d},`row-${K}`)],prev:b},{res:[],prev:null}).res:[]}),m.flatMap(_=>{const C=_.filter(y=>y);return C.length>=2?C.reduce((y,b,K)=>y.prev===null?{res:[],prev:b}:{res:[...y.res,jsxRuntimeExports.jsx(Segment,{start:[y.prev[0],y.prev[1],0],end:[b[0],b[1],0],color:l},`col-${K}`)],prev:b},{res:[],prev:null}).res:[]})]})},`${r}-${o}-${i}-${a}`)},KeyboardCanvas=e=>{const{containerDimensions:r,shouldHide:o,...i}=e,{width:a,height:d}=reactExports.useMemo(()=>calculateKeyboardFrameDimensions(i.keys),[i.keys]),[l,p]=reactExports.useState(!1),{verticalPostion:m,tilt:_}=J({config:{tension:35,friction:5,mass:.3},verticalPostion:l?1:-3,tilt:l?-.15:0});reactExports.useEffect(()=>{const y=document.querySelector("canvas");y&&(y.addEventListener("mouseenter",()=>{p(!0)}),y.addEventListener("mouseleave",()=>{p(!1)}))},[]);const C=Math.min(Math.min(1,r&&r.width/((CSSVarObject.keyWidth+CSSVarObject.keyXSpacing)*a-CSSVarObject.keyXSpacing+70)),500/((CSSVarObject.keyHeight+CSSVarObject.keyYSpacing)*d-CSSVarObject.keyYSpacing+70))||1;return jsxRuntimeExports.jsx("group",{position:[0,-0,-19],scale:.015*C,visible:!o,children:jsxRuntimeExports.jsx(KeyboardCanvasContent,{...i,width:a,height:d,verticalPostion:m,tilt:_})})},KeyboardCanvasContent=React.memo(e=>{const{matrixKeycodes:r,keys:o,definition:i,pressedKeys:a,mode:d,showMatrix:l,selectable:p,width:m,height:_,verticalPostion:C,tilt:y}=e;return jsxRuntimeExports.jsx(E.group,{"position-y":C,"rotation-x":y,children:jsxRuntimeExports.jsxs(PresentationControls,{enabled:e.mode!==DisplayMode.ConfigureColors,global:!0,snap:!0,speed:1,zoom:1,polar:[-Math.PI/10,Math.PI/10],azimuth:[-Math.PI/16,Math.PI/16],config:{mass:1,tension:170,friction:26},children:[jsxRuntimeExports.jsx(Case,{width:m,height:_}),jsxRuntimeExports.jsx(KeyGroup,{...e,keys:o,mode:d,matrixKeycodes:r,selectable:p,definition:i,pressedKeys:a}),l&&jsxRuntimeExports.jsx(MatrixLines,{keys:o,rows:i.matrix.rows,cols:i.matrix.cols,width:m,height:_})]})})},shallowEqual),useGlobalKeys=e=>{const r=!e,o=reactExports.useState({}),[i,a]=o;function d(p){p.preventDefault(),!r&&!p.repeat&&i[getIndexByEvent(p)??-1]!==TestKeyState.KeyDown&&a(m=>({...m,[getIndexByEvent(p)]:TestKeyState.KeyDown}))}const l=p=>{p.preventDefault(),!r&&i[getIndexByEvent(p)]!==TestKeyState.KeyUp&&a(m=>({...m,[getIndexByEvent(p)]:TestKeyState.KeyUp}))};return reactExports.useEffect(()=>(e&&(window.addEventListener("keydown",d),window.addEventListener("keyup",l)),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",l)}),[e]),o},invertTestKeyState=e=>e===TestKeyState.KeyDown?TestKeyState.KeyUp:TestKeyState.KeyDown,useMatrixTest=(e,r,o,i)=>{const a=reactExports.useState([]),[,d]=a,l=useDispatch(),p=reactExports.useRef(e);reactExports.useEffect(()=>{let C=[];const y=()=>{p.current=!1},b=async(K,v,j,w)=>{if(e&&K&&j){const{cols:L,rows:T}=j.matrix,P=Math.ceil(L/8),k=Math.floor(28/P);try{let G=[];for(let W=0;W<T;W+=k){const X=Math.min(T*P-G.length,P*k);G.push(...await K.getKeyboardValue(KeyboardValue.SWITCH_MATRIX_STATE,v>=12?[W]:[],X))}if(!G.some((W,X)=>W^(w[X]||0))){await K.timeout(20),p.current&&b(K,v,j,w);return}d(W=>G.reduce((X,Z,I)=>{const z=Z^(w[I]||0);if(z===0)return X;const Q=~~(I/P),re=8*(P-1-I%P);return Array(Math.max(0,Math.min(8,L-re))).fill(0).reduce((V,A,B)=>{const te=L*Q+B+re;return V[te]=(z>>B&1)===1?invertTestKeyState(V[te]):V[te],V},X)},Array.isArray(W)&&W.length===T*L?[...W]:Array(T*L).fill(TestKeyState.Initial))),await K.timeout(20),p.current&&b(K,v,j,G)}catch{p.current=!1,l(setTestMatrixEnabled(!1))}}};return e&&r&&o&&i&&(p.current=!0,b(r,o.protocol,i,C)),()=>{y()}},[e,i,r]);const m=C=>{C.preventDefault()},_=C=>{C.preventDefault()};return reactExports.useEffect(()=>(e&&(window.addEventListener("keydown",m),window.addEventListener("keyup",_)),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",_)}),[e]),a},useColorPainter=(e,r)=>{const o=useAppSelector(getSelectedConnectedDevice),i=useAppSelector(getSelectedKeyboardAPI),a=useAppSelector(getSelectedCustomMenuData)||{__perKeyRGB:[]},[d,l]=reactExports.useState([]);reactExports.useEffect(()=>{const m=a.__perKeyRGB??[],C=(e.find(y=>"li"in y)?e.map(y=>y.li??-1):[]).map(y=>{const b=m[y??-1];if(b)return getHSVFrom256(b)});l(C)},[a.__perKeyRGB&&a.__perKeyRGB.length,e]);const p=reactExports.useCallback((m,_)=>{if(m.buttons===1&&i){const C=Math.round(r[0]*255/360),y=Math.round(r[1]*255),b=e[_].li;b!==void 0&&(i.setPerKeyRGBMatrix(b,C,y),i.commitCustomMenu(0),l(K=>(K[_]=r,[...K])))}},[l,r,e,o]);return{keyColors:d,onKeycapPointerDown:p,onKeycapPointerOver:p}},useMultiSelect=()=>{const e=useDispatch(),r=reactExports.useRef(!1),o=()=>{window.removeEventListener("pointerup",o),r.current=!1};return{onMultiPointerDown:(d,l)=>{window.addEventListener("pointerup",o),e(toggleSelectedKey(l)),r.current=!0},onMultiPointerOver:(d,l)=>{r.current&&e(addSelectedKey(l))}}},getKeyboardCanvas=e=>e==="2D"?KeyboardCanvas$1:KeyboardCanvas,ConfigureKeyboard=e=>{const{selectable:r,dimensions:o}=e,i=useAppSelector(k=>getSelectedKeymap(k)||[]),a=useAppSelector(getSelectedKeyDefinitions),d=useAppSelector(getSelectedDefinition),l=useAppSelector(getShowKeyPainter),p=useAppSelector(getSelectedPaletteColor),{keyColors:m,onKeycapPointerDown:_,onKeycapPointerOver:C}=useColorPainter(a,p),[y,b]=reactExports.useMemo(()=>m&&a?[a.filter((k,G)=>m[G]&&m[G].length),m.filter(k=>k&&k.length)]:[null,null],[a,m]),K=useAppSelector(getSelectedRowTitle),{onMultiPointerDown:v,onMultiPointerOver:j}=useMultiSelect(),w=useAppSelector(getMultiSelectAble),L=useAppSelector(getActiveMenu);let T=DisplayMode.Configure;if(L==="DKS"?T=DisplayMode.ConfigureDKS:L==="RT"?T=DisplayMode.ConfigureRT:L==="AP"&&(T=DisplayMode.ConfigureAP),!d||!o)return null;const P=getKeyboardCanvas(e.nDimension);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[K===Title$2?jsxRuntimeExports.jsx(P,{matrixKeycodes:i,keys:a,selectable:!w&&!!r,multiSelect:w,definition:d,containerDimensions:o,mode:T,onKeycapPointerDown:w?v:void 0,onKeycapPointerOver:w?j:void 0}):jsxRuntimeExports.jsx(P,{matrixKeycodes:i,keys:a,selectable:!!r,definition:d,containerDimensions:o,mode:DisplayMode.Configure,shouldHide:l}),y&&y.length&&b&&b.length?jsxRuntimeExports.jsx(P,{matrixKeycodes:i,keys:y,selectable:l,definition:d,containerDimensions:o,mode:DisplayMode.ConfigureColors,keyColors:b,onKeycapPointerDown:_,onKeycapPointerOver:C,shouldHide:!l}):null]})},TestKeyboard=e=>{const{selectable:r,containerDimensions:o,matrixKeycodes:i,keys:a,pressedKeys:d,definition:l,nDimension:p}=e;if(!o)return null;const m=getKeyboardCanvas(p);return jsxRuntimeExports.jsx(m,{matrixKeycodes:i,keys:a,selectable:!!r,definition:l,pressedKeys:d,containerDimensions:o,mode:DisplayMode.Test})},DesignKeyboard=e=>{const{containerDimensions:r,showMatrix:o,definition:i,selectedOptionKeys:a}=e,{keys:d,optionKeys:l}=i.layouts;if(!r)return null;const p=reactExports.useMemo(()=>l?Object.entries(l).flatMap(([C,y])=>{const b=parseInt(C);return a[b]?y[a[b]]:y[0]}):[],[l,a]),m=reactExports.useMemo(()=>[...d,...p],[d,p]),_=getKeyboardCanvas(e.nDimension);return jsxRuntimeExports.jsx(_,{matrixKeycodes:EMPTY_ARR,keys:m,selectable:!1,definition:i,containerDimensions:r,mode:DisplayMode.Design,showMatrix:o})},Design=e=>{const r=Object.values(useAppSelector(getCustomDefinitions)),o=useAppSelector(getDesignDefinitionVersion),i=useAppSelector(getSelectedDefinitionIndex),a=useAppSelector(getDesignSelectedOptionKeys),d=useAppSelector(getShowMatrix),l=reactExports.useMemo(()=>r.filter(m=>m[o]),[r,o]),p=l[i]&&l[i][o];return p&&jsxRuntimeExports.jsx(DesignKeyboard,{containerDimensions:e.dimensions,definition:p,selectedOptionKeys:a,showMatrix:d,nDimension:e.nDimension})},EMPTY_ARR=[],Test=e=>{const r=useAppDispatch(),[o]=useLocation(),i=o==="/test",a=useAppSelector(getSelectedKeyboardAPI),d=useAppSelector(getSelectedConnectedDevice),l=useAppSelector(getSelectedDefinition),p=useAppSelector(getSelectedKeyDefinitions),m=useAppSelector(getIsTestMatrixEnabled),_=useAppSelector(getTestKeyboardSoundsSettings),C=useAppSelector(X=>getSelectedKeymap(X)||[]),[y,b]=useGlobalKeys(!m&&i),[K,v]=useMatrixTest(m&&i,a,d,l),j=reactExports.useCallback(()=>{b(EMPTY_ARR),v(EMPTY_ARR)},[b,v]),w=reactExports.useContext(TestContext);reactExports.useEffect(()=>{w[0].clearTestKeys!==j&&w[1]({clearTestKeys:j})},[w,j]),reactExports.useEffect(()=>{o!=="/test"&&(r(setTestMatrixEnabled(!1)),w[0].clearTestKeys()),o!=="/"&&r(setLayer(0))},[o]);const L=m&&p?p.map(({row:X,col:Z})=>l&&K[X*l.matrix.cols+Z]):[],T=m?l:fullKeyboardDefinition,P=m?p:fullKeyboardDefinition.layouts.keys;if(!T||typeof T=="string")return null;const k=m?L:y,{partitionedKeys:G}=reactExports.useMemo(()=>getKeyboardRowPartitions(P),[P]),U=m?K:y,W=G.map(X=>X.map(({row:Z,col:I})=>U[Z*T.matrix.cols+I]));return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TestKeyboard,{definition:T,keys:P,pressedKeys:k,matrixKeycodes:m?C:matrixKeycodes,containerDimensions:e.dimensions,nDimension:e.nDimension}),W&&_.isEnabled&&jsxRuntimeExports.jsx(TestKeyboardSounds,{pressedKeys:W})]})},UpdateUVMaps=()=>{const e=useGLTF(glbSrc,!0).scene;return reactExports.useEffect(()=>{Object.values(e.children).forEach(r=>{if(r.isGroup)return;const o=r,i=1/2.6,a=o.geometry,{min:d}=a.boundingBox,l=19.05,p=.445,m=o.geometry.attributes.position;o.geometry.attributes.uv||o.geometry.setAttribute("uv",new BufferAttribute(new Float32Array(m.count*2),2,!1));const _=o.geometry.attributes.uv,C=new Float32Array(_.count*2);for(let y=0;y<o.geometry.attributes.uv.count;y++)C[2*y]=i*(m.array[y*3]-d.x+p)/l,C[2*y+1]=i*(m.array[y*3+1]-d.y+p)/l;_.copyArray(C),a.center(),_.needsUpdate=!0})},[e]),null},cubeySrc="/assets/cubey-koQI6_tt.glb",LoaderCubey=React.memo(({visible:e,theme:r})=>{const o=useGLTF(cubeySrc);console.debug(o,"cubey");const i=reactExports.useRef(),a=e?-.3:10,d=getDarkenedColor(r.accent.c,.8),l={"upper-body":new Color(r.mod.c),"lower-body":new Color(r.mod.t),accent:new Color(d),bowtie:new Color(d)};return o.scene.children.forEach(p=>{const m=p.name.split("_")[0],_=l[m];_&&(p.material.color=_)}),useFrame(({clock:p})=>{e&&(i.current.rotation.z=Math.sin(p.elapsedTime)*(Math.PI/40),i.current.rotation.y=Math.PI+Math.sin(.6*p.elapsedTime)*(Math.PI/16),i.current.position.y=a+.2*Math.sin(p.elapsedTime))}),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("group",{scale:.6,position:[0,a,-19],children:jsxRuntimeExports.jsx(PresentationControls,{enabled:!0,global:!0,snap:!0,speed:1,zoom:1,rotation:[0,0,0],polar:[-Math.PI/3,Math.PI/3],config:{mass:2,tension:200,friction:14},children:jsxRuntimeExports.jsx("group",{ref:i,children:jsxRuntimeExports.jsx("primitive",{object:o.scene})})})})})},shallowEqual);useGLTF.preload(cubeySrc);useGLTF.preload(glbSrc);const KeyboardBG$1=React.memo(e=>{const{onClick:r,visible:o,color:i}=e;return jsxRuntimeExports.jsxs("mesh",{receiveShadow:!0,position:[0,-5.75,0],rotation:[-Math.PI/2+Math.PI/14,0,0],onClick:r,visible:o,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[100,100]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:i})]})},shallowEqual),CanvasRouter$1=()=>{const[e]=useLocation(),r=reactExports.useRef(document.body),o=reactExports.useRef(null),i=useAppSelector(getLoadProgress),{progress:a}=useProgress(),d=useAppDispatch(),l=useSize(r),p=Object.values(useAppSelector(getCustomDefinitions)),m=useAppSelector(getSelectedDefinition),_=useAppSelector(getDesignDefinitionVersion),C=useAppSelector(getSelectedTheme),y=reactExports.useMemo(()=>C[distExports.KeyColorType.Accent].c,[C]),[b,K]=reactExports.useState(!1),v=e==="/"&&(!m||i!==1),j=reactExports.useMemo(()=>p.filter(W=>W[_]),[p,_]),w=e==="/design"&&!j.length,L=e==="/"&&(!m||(i+a/100)/2!==1),T=reactExports.useCallback(()=>{d(updateSelectedKey(null))},[d]),P="hid"in navigator||OVERRIDE_HID_CHECK,k=!P||["/settings","/errors","/boot"].includes(e)||w||L,G=useAppSelector(getConfigureKeyboardIsSelectable),U=v;return reactExports.useEffect(()=>{document.fonts.load("bold 16px Fira Sans").finally(()=>{K(!0)})},[]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(UpdateUVMaps,{}),jsxRuntimeExports.jsx("div",{style:{height:500,width:"100%",top:0,transform:k?U?l?`translateY(${-300+l.height/2}px)`:"":"translateY(-500px)":"",position:k&&!U?"absolute":"relative",overflow:"visible",zIndex:0,visibility:k&&!U?"hidden":"visible"},ref:o,children:jsxRuntimeExports.jsxs(Canvas,{flat:!0,shadows:!0,style:{overflow:"visible"},children:[jsxRuntimeExports.jsx(Lights,{}),jsxRuntimeExports.jsx(KeyboardBG$1,{onClick:T,color:y,visible:!U}),jsxRuntimeExports.jsx(OrbitControls,{enabled:!1}),jsxRuntimeExports.jsx(Camera,{}),jsxRuntimeExports.jsx(LoaderCubey,{theme:C,visible:U&&!m}),jsxRuntimeExports.jsx(Html,{center:!0,position:[0,U?m?0:-1:10,-19],children:P?m?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{style:{textAlign:"center",color:"var(--color_accent)",fontSize:60},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{spinPulse:!0,icon:faSpinner})})}):jsxRuntimeExports.jsxs(AccentButtonLarge,{onClick:()=>d(reloadConnectedDevices()),style:{width:"max-content"},children:["Authorize device",jsxRuntimeExports.jsx(FontAwesomeIcon,{style:{marginLeft:"10px"},icon:faUnlock})]}):null}),b?jsxRuntimeExports.jsx(KeyboardGroup$1,{containerRef:o,configureKeyboardIsSelectable:G,loadProgress:i}):null]})})]})},Lights=React.memo(()=>{const d=reactExports.useRef(null);reactExports.useEffect(()=>{d.current&&(d.current.shadow.mapSize.width=2048,d.current.shadow.mapSize.height=2048)},[d.current]);const l=React.useMemo(()=>{const m=new Object3D;return m.position.set(0,0,-19),m.updateMatrixWorld(),m},[]);return!0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("ambientLight",{intensity:0}),jsxRuntimeExports.jsx(SpotLight,{ref:d,distance:15,position:[0,12,-17],angle:Math.PI/5,attenuation:5,target:l,intensity:10,castShadow:!0,anglePower:5}),jsxRuntimeExports.jsx("pointLight",{position:[3,.5,-15],intensity:.8}),jsxRuntimeExports.jsx("pointLight",{position:[-3,.5,-15],intensity:.8})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("ambientLight",{intensity:.4}),jsxRuntimeExports.jsx("pointLight",{position:[-.5,.5,-15],intensity:1.5})]})},shallowEqual),getRouteX$1=e=>{switch(e){case"/debug":return-60;case"/design":return-40;case"/test":return-20;case"/":return 0;default:return-60}},KeyboardGroup$1=React.memo(e=>{const{loadProgress:r,configureKeyboardIsSelectable:o}=e,[i]=useLocation(),a=getRouteX$1(i),d=J({config:mt.stiff,x:a}),l=useSize(e.containerRef);return jsxRuntimeExports.jsx(E.group,{"position-x":d.x,children:jsxRuntimeExports.jsx(Keyboards$1,{configureKeyboardIsSelectable:o,loadProgress:r,dimensions:l})})},shallowEqual),Keyboards$1=React.memo(e=>{const{loadProgress:r,dimensions:o,configureKeyboardIsSelectable:i}=e,a=-getRouteX$1("/test"),d=-getRouteX$1("/design"),l=-getRouteX$1("/debug");return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("group",{visible:r===1,children:jsxRuntimeExports.jsx(ConfigureKeyboard,{dimensions:o,selectable:i,nDimension:"3D"})}),jsxRuntimeExports.jsx("group",{"position-x":a,children:jsxRuntimeExports.jsx(Test,{dimensions:o,nDimension:"3D"})}),jsxRuntimeExports.jsx("group",{"position-x":d,children:jsxRuntimeExports.jsx(Design,{dimensions:o,nDimension:"3D"})}),jsxRuntimeExports.jsx("group",{"position-x":l})]})},shallowEqual),KeyboardBG=styled.div`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: ${e=>`linear-gradient(30deg, rgba(150,150,150,1) 10%,${getDarkenedColor(e.$color)} 50%, rgba(150,150,150,1) 90%)`};
  opacity: ${e=>e.$visible?1:0};
`,KeyboardRouteGroup=styled.div`
  position: absolute;
  left: 0;
  transform: translateX(${e=>e.$position*100}vw);
  height: 100%;
  width: 100vw;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
`,CanvasRouter=()=>{const[e]=useLocation(),r=reactExports.useRef(document.body),o=reactExports.useRef(null),i=useAppSelector(getLoadProgress),{progress:a}=useProgress(),d=useAppDispatch(),l=useSize(o),p=useSize(r),m=Object.values(useAppSelector(getCustomDefinitions)),_=useAppSelector(getSelectedDefinition),C=useAppSelector(getDesignDefinitionVersion),y=useAppSelector(getSelectedTheme),b=reactExports.useMemo(()=>y[distExports.KeyColorType.Accent].c,[y]),K=e==="/"&&(!_||i!==1),v=reactExports.useMemo(()=>m.filter(U=>U[C]),[m,C]),j=e==="/design"&&!v.length,w=e==="/"&&(!_||(i+a/100)/2!==1),L=reactExports.useCallback(()=>{d(updateSelectedKey(null))},[d]),P=!("hid"in navigator||OVERRIDE_HID_CHECK)||["/settings","/errors","/boot"].includes(e)||j||w,k=useAppSelector(getConfigureKeyboardIsSelectable),G=K;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{style:{height:500,width:"100%",top:0,transform:P?G?p?`translateY(${-300+p.height/2}px)`:"":"translateY(-500px)":"",position:P&&!G?"absolute":"relative",overflow:"visible",zIndex:2,visibility:P&&!G?"hidden":"visible"},onClick:U=>{U.target.nodeName!=="CANVAS"&&d(clearSelectedKey())},ref:o,children:P?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(KeyboardBG,{onClick:L,$color:b,$visible:!G}),jsxRuntimeExports.jsx(KeyboardGroup,{containerDimensions:l,configureKeyboardIsSelectable:k,loadProgress:i})]})})})},getRouteX=e=>{switch(e){case"/debug":return-300;case"/design":return-200;case"/test":return-100;case"/":return 0;default:return-300}},KeyboardGroupContainer=styled.div`
  z-index: 2;
  display: block;
  white-space: nowrap;
  height: 100%;
  background: linear-gradient(90deg, red, blue);
  width: max-content;
  position: absolute;
  top: 0;
  left: 0;
`,KeyboardGroup=React.memo(e=>{const r=useDispatch(),{loadProgress:o,configureKeyboardIsSelectable:i,containerDimensions:a}=e,[d]=useLocation(),l=reactExports.useRef(null),p=getRouteX(d),m={transition:"transform 0.25s ease-in-out",transform:`translate(${p}vw, 0px)`},_=reactExports.useCallback(()=>{l.current&&(l.current.style.transition=m.transition)},[l.current]),C=reactExports.useCallback(()=>{l.current&&(l.current.style.transition="")},[l.current]);return reactExports.useEffect(()=>(l.current&&(l.current.addEventListener("transitionend",C),l.current.style.transform=m.transform),()=>{var y;l.current&&((y=l.current)==null||y.removeEventListener("transitionend",C))}),[]),reactExports.useEffect(()=>{l.current&&l.current.style.transform!==m.transform&&(_(),l.current.style.transform=m.transform)},[p]),jsxRuntimeExports.jsx(KeyboardGroupContainer,{onClick:y=>{var b;((b=y.target)==null?void 0:b.parentNode)===l.current&&r(updateSelectedKeys([]))},ref:l,children:jsxRuntimeExports.jsx(Keyboards,{configureKeyboardIsSelectable:i,loadProgress:o,dimensions:a})})},shallowEqual),Keyboards=React.memo(e=>{const{dimensions:r,configureKeyboardIsSelectable:o}=e;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:0,children:jsxRuntimeExports.jsx(ConfigureKeyboard,{dimensions:r,selectable:o,nDimension:"2D"})}),jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:1,children:jsxRuntimeExports.jsx(Test,{dimensions:r,nDimension:"2D"})}),jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:2,children:jsxRuntimeExports.jsx(Design,{dimensions:r,nDimension:"2D"})}),jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:3})]})},shallowEqual),GlobalStyle=createGlobalStyle`
  *:focus {
    outline: none;
  }
`,hashLocation=()=>window.location.hash.replace(/^#/,"")||"/",hashNavigate=e=>navigate("#"+e),useHashLocation=(...e)=>[useLocationProperty(hashLocation),hashNavigate],Routes=()=>{const e="hid"in navigator||OVERRIDE_HID_CHECK,r=useAppSelector(getRenderMode),o=reactExports.useMemo(()=>PANES.map(d=>jsxRuntimeExports.jsx(Route,{component:d.component,path:d.path},d.key)),[]),i=r==="2D"?CanvasRouter:CanvasRouter$1,a=reactExports.useState({clearTestKeys:()=>{}});return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(ErrorBoundary,{showDialog:!0,children:jsxRuntimeExports.jsx(Router,{hook:useHashLocation,children:jsxRuntimeExports.jsxs(TestContext.Provider,{value:a,children:[jsxRuntimeExports.jsx(GlobalStyle,{}),e&&jsxRuntimeExports.jsx(UnconnectedGlobalMenu,{}),jsxRuntimeExports.jsx(i,{}),jsxRuntimeExports.jsx(Home,{hasHIDSupport:e,children:o})]})})})})},Root=()=>jsxRuntimeExports.jsx(Provider,{store,children:jsxRuntimeExports.jsx(Routes,{})});instance.use(Browser$1).use(initReactI18next).use(resourcesToBackend(e=>__variableDynamicImportRuntimeHelper(Object.assign({"./locales/en.json":()=>__vitePreload(()=>import("./en-BIHI7g3E.js"),[]),"./locales/ko.json":()=>__vitePreload(()=>import("./ko-BkiAkXrA.js"),[]),"./locales/zh.json":()=>__vitePreload(()=>import("./zh-BCWDiiOg.js"),[])}),`./locales/${e}.json`,3))).init({fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1}});const elem=document.getElementById("root");elem&&(clientExports.createRoot(elem).render(jsxRuntimeExports.jsx(Root,{})),document.documentElement.dataset.themeMode=getThemeModeFromStore(),updateCSSVariables(getThemeNameFromStore()));
